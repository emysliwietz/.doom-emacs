% Created 2025-01-15 Wed 00:52
% Intended LaTeX compiler: lualatex
\documentclass[a4wide,10pt]{article}
\usepackage{amsmath}
\usepackage{fontspec}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{capt-of}
\usepackage{hyperref}
\usepackage{polyglossia}
\setmainlanguage[variant=usmax]{english}
\author{Egidius Mysliwietz}
\date{\today}
\title{Emacs config}
\hypersetup{
 pdfauthor={Egidius Mysliwietz},
 pdftitle={Emacs config},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 29.4 (Org mode 9.7.19)}, 
 pdflang={English}}

% Setup for code blocks [1/2]

\usepackage{fvextra}

\fvset{%
  commandchars=\\\{\},
  highlightcolor=white!95!black!80!blue,
  breaklines=true,
  breaksymbol=\color{white!60!black}\tiny\ensuremath{\hookrightarrow}}

% Make line numbers smaller and grey.
\renewcommand\theFancyVerbLine{\footnotesize\color{black!40!white}\arabic{FancyVerbLine}}

\usepackage{xcolor}

% In case engrave-faces-latex-gen-preamble has not been run.
\providecolor{EfD}{HTML}{f7f7f7}
\providecolor{EFD}{HTML}{28292e}

% Define a Code environment to prettily wrap the fontified code.
\usepackage[breakable,xparse]{tcolorbox}
\DeclareTColorBox[]{Code}{o}%
{colback=EfD!98!EFD, colframe=EfD!95!EFD,
  fontupper=\footnotesize\setlength{\fboxsep}{0pt},
  colupper=EFD,
  IfNoValueTF={#1}%
  {boxsep=2pt, arc=2.5pt, outer arc=2.5pt,
    boxrule=0.5pt, left=2pt}%
  {boxsep=2.5pt, arc=0pt, outer arc=0pt,
    boxrule=0pt, leftrule=1.5pt, left=0.5pt},
  right=2pt, top=1pt, bottom=0.5pt,
  breakable}

% Support listings with captions
\usepackage{float}
\floatstyle{plain}
\newfloat{listing}{htbp}{lst}
\newcommand{\listingsname}{Listing}
\floatname{listing}{\listingsname}
\newcommand{\listoflistingsname}{List of Listings}
\providecommand{\listoflistings}{\listof{listing}{\listoflistingsname}}


% Setup for code blocks [2/2]: syntax highlighting colors

\newcommand\efstrut{\vrule height 2.1ex depth 0.8ex width 0pt}
\definecolor{EFD}{HTML}{bbc2cf}
\definecolor{EfD}{HTML}{282c34}
\newcommand{\EFD}[1]{\textcolor{EFD}{#1}} % default
\newcommand{\EFvp}[1]{#1} % variable-pitch
\definecolor{EFh}{HTML}{5B6268}
\newcommand{\EFh}[1]{\textcolor{EFh}{#1}} % shadow
\definecolor{EFsc}{HTML}{98be65}
\newcommand{\EFsc}[1]{\textcolor{EFsc}{#1}} % success
\definecolor{EFw}{HTML}{ECBE7B}
\newcommand{\EFw}[1]{\textcolor{EFw}{#1}} % warning
\definecolor{EFe}{HTML}{ff6c6b}
\newcommand{\EFe}[1]{\textcolor{EFe}{#1}} % error
\definecolor{EFl}{HTML}{51afef}
\newcommand{\EFl}[1]{\textcolor{EFl}{\textbf{#1}}} % link
\definecolor{EFlv}{HTML}{ee82ee}
\newcommand{\EFlv}[1]{\textcolor{EFlv}{\textbf{#1}}} % link-visited
\definecolor{EFhi}{HTML}{1B2229}
\definecolor{Efhi}{HTML}{51afef}
\newcommand{\EFhi}[1]{\colorbox{Efhi}{\efstrut{}\textcolor{EFhi}{#1}}} % highlight
\definecolor{EFc}{HTML}{5B6268}
\newcommand{\EFc}[1]{\textcolor{EFc}{#1}} % font-lock-comment-face
\definecolor{EFcd}{HTML}{5B6268}
\newcommand{\EFcd}[1]{\textcolor{EFcd}{#1}} % font-lock-comment-delimiter-face
\definecolor{EFs}{HTML}{98be65}
\newcommand{\EFs}[1]{\textcolor{EFs}{#1}} % font-lock-string-face
\definecolor{EFd}{HTML}{83898d}
\newcommand{\EFd}[1]{\textcolor{EFd}{#1}} % font-lock-doc-face
\definecolor{EFm}{HTML}{a9a1e1}
\newcommand{\EFm}[1]{\textcolor{EFm}{#1}} % font-lock-doc-markup-face
\definecolor{EFk}{HTML}{51afef}
\newcommand{\EFk}[1]{\textcolor{EFk}{#1}} % font-lock-keyword-face
\definecolor{EFb}{HTML}{c678dd}
\newcommand{\EFb}[1]{\textcolor{EFb}{#1}} % font-lock-builtin-face
\definecolor{EFf}{HTML}{c678dd}
\newcommand{\EFf}[1]{\textcolor{EFf}{#1}} % font-lock-function-name-face
\definecolor{EFv}{HTML}{dcaeea}
\newcommand{\EFv}[1]{\textcolor{EFv}{#1}} % font-lock-variable-name-face
\definecolor{EFt}{HTML}{ECBE7B}
\newcommand{\EFt}[1]{\textcolor{EFt}{#1}} % font-lock-type-face
\definecolor{EFo}{HTML}{a9a1e1}
\newcommand{\EFo}[1]{\textcolor{EFo}{#1}} % font-lock-constant-face
\definecolor{EFwr}{HTML}{ECBE7B}
\newcommand{\EFwr}[1]{\textcolor{EFwr}{#1}} % font-lock-warning-face
\definecolor{EFnc}{HTML}{51afef}
\newcommand{\EFnc}[1]{\textcolor{EFnc}{\textbf{#1}}} % font-lock-negation-char-face
\definecolor{EFpp}{HTML}{51afef}
\newcommand{\EFpp}[1]{\textcolor{EFpp}{\textbf{#1}}} % font-lock-preprocessor-face
\definecolor{EFrc}{HTML}{51afef}
\newcommand{\EFrc}[1]{\textcolor{EFrc}{\textbf{#1}}} % font-lock-regexp-grouping-construct
\definecolor{EFrb}{HTML}{51afef}
\newcommand{\EFrb}[1]{\textcolor{EFrb}{\textbf{#1}}} % font-lock-regexp-grouping-backslash
\definecolor{Efob}{HTML}{23272e}
\newcommand{\EFob}[1]{\colorbox{Efob}{\efstrut{}#1}} % org-block
\definecolor{EFobb}{HTML}{5B6268}
\definecolor{Efobb}{HTML}{23272e}
\newcommand{\EFobb}[1]{\colorbox{Efobb}{\efstrut{}\textcolor{EFobb}{#1}}} % org-block-begin-line
\definecolor{EFobe}{HTML}{5B6268}
\definecolor{Efobe}{HTML}{23272e}
\newcommand{\EFobe}[1]{\colorbox{Efobe}{\efstrut{}\textcolor{EFobe}{#1}}} % org-block-end-line
\definecolor{EFOa}{HTML}{51afef}
\newcommand{\EFOa}[1]{\textcolor{EFOa}{\textbf{#1}}} % outline-1
\definecolor{EFOb}{HTML}{c678dd}
\newcommand{\EFOb}[1]{\textcolor{EFOb}{\textbf{#1}}} % outline-2
\definecolor{EFOc}{HTML}{a9a1e1}
\newcommand{\EFOc}[1]{\textcolor{EFOc}{\textbf{#1}}} % outline-3
\definecolor{EFOd}{HTML}{7cc3f3}
\newcommand{\EFOd}[1]{\textcolor{EFOd}{\textbf{#1}}} % outline-4
\definecolor{EFOe}{HTML}{d499e5}
\newcommand{\EFOe}[1]{\textcolor{EFOe}{\textbf{#1}}} % outline-5
\definecolor{EFOf}{HTML}{a8d7f7}
\newcommand{\EFOf}[1]{\textcolor{EFOf}{\textbf{#1}}} % outline-6
\definecolor{EFOg}{HTML}{e2bbee}
\newcommand{\EFOg}[1]{\textcolor{EFOg}{\textbf{#1}}} % outline-7
\definecolor{EFOh}{HTML}{dceffb}
\newcommand{\EFOh}[1]{\textcolor{EFOh}{\textbf{#1}}} % outline-8
\definecolor{EFhn}{HTML}{da8548}
\newcommand{\EFhn}[1]{\textcolor{EFhn}{\textbf{#1}}} % highlight-numbers-number
\definecolor{EFhq}{HTML}{51afef}
\newcommand{\EFhq}[1]{\textcolor{EFhq}{#1}} % highlight-quoted-quote
\definecolor{EFhs}{HTML}{ECBE7B}
\newcommand{\EFhs}[1]{\textcolor{EFhs}{#1}} % highlight-quoted-symbol
\definecolor{EFrda}{HTML}{51afef}
\newcommand{\EFrda}[1]{\textcolor{EFrda}{#1}} % rainbow-delimiters-depth-1-face
\definecolor{EFrdb}{HTML}{c678dd}
\newcommand{\EFrdb}[1]{\textcolor{EFrdb}{#1}} % rainbow-delimiters-depth-2-face
\definecolor{EFrdc}{HTML}{98be65}
\newcommand{\EFrdc}[1]{\textcolor{EFrdc}{#1}} % rainbow-delimiters-depth-3-face
\definecolor{EFrdd}{HTML}{a9a1e1}
\newcommand{\EFrdd}[1]{\textcolor{EFrdd}{#1}} % rainbow-delimiters-depth-4-face
\definecolor{EFrde}{HTML}{4db5bd}
\newcommand{\EFrde}[1]{\textcolor{EFrde}{#1}} % rainbow-delimiters-depth-5-face
\definecolor{EFrdf}{HTML}{51afef}
\newcommand{\EFrdf}[1]{\textcolor{EFrdf}{#1}} % rainbow-delimiters-depth-6-face
\definecolor{EFrdg}{HTML}{c678dd}
\newcommand{\EFrdg}[1]{\textcolor{EFrdg}{#1}} % rainbow-delimiters-depth-7-face
\definecolor{EFrdh}{HTML}{98be65}
\newcommand{\EFrdh}[1]{\textcolor{EFrdh}{#1}} % rainbow-delimiters-depth-8-face
\definecolor{EFrdi}{HTML}{a9a1e1}
\newcommand{\EFrdi}[1]{\textcolor{EFrdi}{#1}} % rainbow-delimiters-depth-9-face
\definecolor{EFany}{HTML}{ECBE7B}
\definecolor{Efany}{HTML}{ECBE7B}
\newcommand{\EFany}[1]{\colorbox{Efany}{\efstrut{}\textcolor{EFany}{#1}}} % ansi-color-yellow
\definecolor{EFanr}{HTML}{ff6c6b}
\definecolor{Efanr}{HTML}{ff6c6b}
\newcommand{\EFanr}[1]{\colorbox{Efanr}{\efstrut{}\textcolor{EFanr}{#1}}} % ansi-color-red
\definecolor{EFanb}{HTML}{282c34}
\newcommand{\EFanb}[1]{\textcolor{EFanb}{#1}} % ansi-color-black
\definecolor{EFang}{HTML}{98be65}
\definecolor{Efang}{HTML}{98be65}
\newcommand{\EFang}[1]{\colorbox{Efang}{\efstrut{}\textcolor{EFang}{#1}}} % ansi-color-green
\definecolor{EFanB}{HTML}{51afef}
\definecolor{EfanB}{HTML}{51afef}
\newcommand{\EFanB}[1]{\colorbox{EfanB}{\efstrut{}\textcolor{EFanB}{#1}}} % ansi-color-blue
\definecolor{EFanc}{HTML}{46D9FF}
\definecolor{Efanc}{HTML}{46D9FF}
\newcommand{\EFanc}[1]{\colorbox{Efanc}{\efstrut{}\textcolor{EFanc}{#1}}} % ansi-color-cyan
\definecolor{Efanw}{HTML}{bbc2cf}
\newcommand{\EFanw}[1]{\colorbox{Efanw}{\efstrut{}#1}} % ansi-color-white
\definecolor{EFanm}{HTML}{c678dd}
\definecolor{Efanm}{HTML}{c678dd}
\newcommand{\EFanm}[1]{\colorbox{Efanm}{\efstrut{}\textcolor{EFanm}{#1}}} % ansi-color-magenta
\definecolor{EFANy}{HTML}{eec78e}
\definecolor{EfANy}{HTML}{eec78e}
\newcommand{\EFANy}[1]{\colorbox{EfANy}{\efstrut{}\textcolor{EFANy}{#1}}} % ansi-color-bright-yellow
\definecolor{EFANr}{HTML}{ff8281}
\definecolor{EfANr}{HTML}{ff8281}
\newcommand{\EFANr}[1]{\colorbox{EfANr}{\efstrut{}\textcolor{EFANr}{#1}}} % ansi-color-bright-red
\definecolor{EFANb}{HTML}{73797e}
\definecolor{EfANb}{HTML}{73797e}
\newcommand{\EFANb}[1]{\colorbox{EfANb}{\efstrut{}\textcolor{EFANb}{#1}}} % ansi-color-bright-black
\definecolor{EFANg}{HTML}{a7c77c}
\definecolor{EfANg}{HTML}{a7c77c}
\newcommand{\EFANg}[1]{\colorbox{EfANg}{\efstrut{}\textcolor{EFANg}{#1}}} % ansi-color-bright-green
\definecolor{EFANB}{HTML}{6bbbf1}
\definecolor{EfANB}{HTML}{6bbbf1}
\newcommand{\EFANB}[1]{\colorbox{EfANB}{\efstrut{}\textcolor{EFANB}{#1}}} % ansi-color-bright-blue
\definecolor{EFANc}{HTML}{61deff}
\definecolor{EfANc}{HTML}{61deff}
\newcommand{\EFANc}[1]{\colorbox{EfANc}{\efstrut{}\textcolor{EFANc}{#1}}} % ansi-color-bright-cyan
\definecolor{EFANw}{HTML}{DFDFDF}
\definecolor{EfANw}{HTML}{DFDFDF}
\newcommand{\EFANw}[1]{\colorbox{EfANw}{\efstrut{}\textcolor{EFANw}{#1}}} % ansi-color-bright-white
\definecolor{EFANm}{HTML}{ce8ce2}
\definecolor{EfANm}{HTML}{ce8ce2}
\newcommand{\EFANm}[1]{\colorbox{EfANm}{\efstrut{}\textcolor{EFANm}{#1}}} % ansi-color-bright-magenta
\usepackage{biblatex}
\addbibresource{/home/user/dox/bib/bib.bib}
\begin{document}

\maketitle
\tableofcontents

\section{Config}
\label{sec:org114314b}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{\$DOOMDIR/config.el -*- lexical-binding: t; -*-}

\EFcd{;;} \EFc{Variable to determine how many modules are loaded, for debugging}
\EFcd{;;} \EFc{Any number is number of modules}
\EFcd{;;} \EFc{nil means all}
\EFrda{(}\EFk{setq} debug-my-config nil\EFrda{)}

\EFcd{;;} \EFc{Place your private configuration here! Remember, you do not need to run 'doom}
\EFcd{;;} \EFc{sync' after modifying this file!}


\EFcd{;;} \EFc{Some functionality uses this to identify you, e.g. GPG configuration, email}
\EFcd{;;} \EFc{clients, file templates and snippets.}
\EFrda{(}\EFk{setq} \EFv{user-full-name} \EFs{"Egidius Mysliwietz"}
      \EFv{user-mail-address} \EFs{"egidius@mysliwietz.de"}
      \EFcd{;}\EFc{auth-sources '(default "secrets:Passwords" "\char126{}/.authinfo.gpg")}
      \EFv{auth-sources} \EFhq{'}\EFrdb{(}default \EFs{"\char126{}/.authinfo"}\EFrdb{)}
      \EFv{auth-source-cache-expiry} nil\EFrda{)}

\EFcd{;;} \EFc{Doom exposes five (optional) variables for controlling fonts in Doom. Here}
\EFcd{;;} \EFc{are the three important ones:}
\EFcd{;;}
\EFcd{;;} \EFc{+ `}\textcolor[HTML]{a9a1e1}{doom-font}\EFc{'}
\EFcd{;;} \EFc{+ `}\textcolor[HTML]{a9a1e1}{doom-variable-pitch-font}\EFc{'}
\EFcd{;;} \EFc{+ `}\textcolor[HTML]{a9a1e1}{doom-big-font}\EFc{' -- used for `}\textcolor[HTML]{a9a1e1}{doom-big-font-mode}\EFc{'; use this for}
\EFcd{;;}   \EFc{presentations or streaming.}
\EFcd{;;}
\EFcd{;;} \EFc{They all accept either a font-spec, font string ("Input Mono-12"), or xlfd}
\EFcd{;;} \EFc{font string. You generally only need these two:}
\EFcd{;;} \EFc{(setq doom-font (font-spec :family "monospace" :size 12 :weight 'semi-light)}
\EFcd{;;}       \EFc{doom-variable-pitch-font (font-spec :family "sans" :size 13))}

\EFcd{;;} \EFc{There are two ways to load a theme. Both assume the theme is installed and}
\EFcd{;;} \EFc{available. You can either set `}\textcolor[HTML]{a9a1e1}{doom-theme}\EFc{' or manually load a theme with the}
\EFcd{;;} \EFc{`}\textcolor[HTML]{a9a1e1}{load-theme}\EFc{' function. This is the default:}
\EFrda{(}\EFk{setq} \EFv{doom-theme} \EFhq{'}\EFhs{doom-one}\EFrda{)}
\EFrda{(}\EFk{custom-set-faces!}
  \EFhq{'}\EFrdb{(}doom-modeline-buffer-modified \EFb{:foreground} \EFs{"orange"}\EFrdb{)}
  \EFhq{'}\EFrdb{(}org-cite \EFb{:foreground} \EFs{"purple"}\EFrdb{)}
  \EFhq{'}\EFrdb{(}org-cite-key \EFb{:foreground} \EFs{"MediumPurple1"} \EFb{:slant} italic\EFrdb{)}\EFrda{)}


\EFcd{;;} \EFc{If you use `}\textcolor[HTML]{a9a1e1}{org}\EFc{' and don't want your org files in the default location below,}
\EFcd{;;} \EFc{change `}\textcolor[HTML]{a9a1e1}{org-directory}\EFc{'. It must be set before org loads!}
\EFrda{(}\EFk{setq} \EFv{org-directory} \EFs{"\char126{}/org/"}\EFrda{)}

\EFcd{;;} \EFc{This determines the style of line numbers in effect. If set to `}\textcolor[HTML]{a9a1e1}{nil}\EFc{', line}
\EFcd{;;} \EFc{numbers are disabled. For relative line numbers, set this to `}\textcolor[HTML]{a9a1e1}{relative}\EFc{'.}
\EFrda{(}\EFk{setq} \EFv{display-line-numbers-type} t\EFrda{)}

\EFcd{;;} \EFc{Here are some additional functions/macros that could help you configure Doom:}
\EFcd{;;}
\EFcd{;;} \EFc{- `}\textcolor[HTML]{a9a1e1}{load!}\EFc{' for loading external *.el files relative to this one}
\EFcd{;;} \EFc{- `}\textcolor[HTML]{a9a1e1}{use-package!}\EFc{' for configuring packages}
\EFcd{;;} \EFc{- `}\textcolor[HTML]{a9a1e1}{after!}\EFc{' for running code after a package has loaded}
\EFcd{;;} \EFc{- `}\textcolor[HTML]{a9a1e1}{add-load-path!}\EFc{' for adding directories to the `}\textcolor[HTML]{a9a1e1}{load-path}\EFc{', relative to}
\EFcd{;;}   \EFc{this file. Emacs searches the `}\textcolor[HTML]{a9a1e1}{load-path}\EFc{' when you load packages with}
\EFcd{;;}   \EFc{`}\textcolor[HTML]{a9a1e1}{require}\EFc{' or `}\textcolor[HTML]{a9a1e1}{use-package}\EFc{'.}
\EFcd{;;} \EFc{- `}\textcolor[HTML]{a9a1e1}{map!}\EFc{' for binding new keys}
\EFcd{;;}
\EFcd{;;} \EFc{To get information about any of these functions/macros, move the cursor over}
\EFcd{;;} \EFc{the highlighted symbol at press '}\textcolor[HTML]{a9a1e1}{K}\EFc{' (non-evil users must press 'C-c c k').}
\EFcd{;;} \EFc{This will open documentation for it, including demos of how they are used.}
\EFcd{;;}
\EFcd{;;} \EFc{You can also try '}\textcolor[HTML]{a9a1e1}{gd}\EFc{' (or 'C-c c d') to jump to their definition and see how}
\EFcd{;} \EFc{they are implemented.}

\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.doom.d/modules"}\EFrda{)}

\EFcd{;} \EFc{Make sure compile warnings are shown immediately even if init is incomplete to preserve knowledge of files and location}
\EFrda{(}\EFk{defun} \EFf{dont-delay-compile-warnings} \EFrdb{(}fun type \EFt{\&rest} args\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{eq} type \EFhq{'}\EFhs{bytecomp}\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{after-init-time} t\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{apply} fun type args\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{apply} fun type args\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{advice-add} \EFhq{'}\EFhs{display-warning} \EFb{:around} \EFhq{\#'}\EFhs{dont-delay-compile-warnings}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{--} \EFrdb{(}var\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{when} ,var
    \EFrdc{(}\EFk{setq} ,var \EFrdd{(}\EFo{-} ,var \EFhn{1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{++} \EFrdb{(}var\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{when} ,var
    \EFrdc{(}\EFk{setq} ,var \EFrdd{(}\EFo{+} ,var \EFhn{1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{setq} \EFv{use-package-verbose} t\EFrda{)}
\EFrda{(}\EFv{async-bytecomp-package-mode} \EFhn{1}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{after-startup} \EFrdb{(}\EFt{\&rest} func\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{unless} debug-my-config \EFrdc{(}\EFk{add-hook!} \EFhq{'}\EFhs{after-startup-hook}
                             \EFhq{'}\EFrdd{(}lambda \EFrda{(}\EFrda{)} ,@func\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{mkdir} \EFrdb{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"modules"}\EFrdb{)} t\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{execution-time} \EFrdb{(}func\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}time \EFrda{(}\EFo{current-time}\EFrda{)}\EFrdd{)}\EFrdc{)}
     ,func
     \EFrdc{(}\EFo{float-time} \EFrdd{(}\EFo{time-since} time\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{execution-time-format} \EFrdb{(}func\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}time \EFrda{(}\EFo{current-time}\EFrda{)}\EFrdd{)}\EFrdc{)}
     ,func
     \EFrdc{(}\EFo{message} \EFrdd{(}\EFo{format} \EFs{"Loaded \%s in \%.06f."} \EFhq{'},func \EFrda{(}\EFo{float-time} \EFrdb{(}\EFo{time-since} time\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{load-module} \EFrdb{(}module\EFrdb{)}
   \EFhq{`}\EFrdb{(}\EFk{when}
        \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{not} debug-my-config\EFrdd{)} \EFrdd{(}\EFo{>} debug-my-config \EFhn{0}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFk{--} debug-my-config\EFrdc{)}
      \EFrdc{(}\EFo{make-thread}
       \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}\EFo{benchmark} \EFrdc{(}\EFk{benchmark-run} \EFrdd{(}\EFo{require} ,module\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}time \EFrdc{(}\EFo{car} benchmark\EFrdc{)}\EFrdb{)}
             \EFrdb{(}gbc \EFrdc{(}\EFo{nth} \EFhn{1} benchmark\EFrdc{)}\EFrdb{)}
             \EFrdb{(}gbt \EFrdc{(}\EFo{nth} \EFhn{2} benchmark\EFrdc{)}\EFrdb{)}\EFrda{)}
         \EFrda{(}\EFo{message} \EFs{"\%s - Loaded \%s in \%.06fs, using \%s garbage collections in \%.06fs."}
                  ,debug-my-config ,module time gbc gbt\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{Load a module only if dependency could successfully be loaded}
\EFrda{(}\EFk{defmacro} \EFf{load-module-if} \EFrdb{(}dependency module\EFrdb{)}
\EFhq{`}\EFrdb{(}\EFk{when} \EFrdc{(}\EFo{require} ,dependency nil \EFhq{'}\EFhs{noerror}\EFrdc{)}
   \EFrdc{(}\EFk{load-module} ,module\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{cl}\EFrda{)} \EFcd{;} \EFc{Still a requirement for ivy}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{private-config}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{exwm}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{exwm-randr}\EFrda{)}

\EFcd{;} \EFc{Unsorted}
\EFrda{(}\EFk{setq} \EFv{doom-modeline-enable-word-count} t\EFrda{)}
\EFcd{;}\EFc{(doom/quickload-session)}

\EFrda{(}\EFk{defun} \EFf{doom--get-modules} \EFrdb{(}file\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFrdc{(}\EFo{file-exists-p} file\EFrdc{)}
    \EFrdc{(}\EFo{user-error} \EFs{"\%s does not exist"} file\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{with-temp-buffer}
    \EFrdc{(}\EFo{insert-file-contents} file\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{re-search-forward} \EFs{"(doom! "} nil t\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{match-beginning} \EFhn{0}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{cdr} \EFrda{(}\EFo{sexp-at-point}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{doom--put-modules} \EFrdb{(}tmpfile modules\EFrdb{)}
  \EFrdb{(}\EFk{with-temp-file} tmpfile
    \EFrdc{(}\EFv{delay-mode-hooks} \EFrdd{(}\EFo{emacs-lisp-mode}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFo{replace-regexp-in-string} \EFs{" "} \EFs{"\char92{}n"} \EFrda{(}\EFo{prin1-to-string} modules\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{indent-region} \EFrdd{(}\EFo{point-min}\EFrdd{)} \EFrdd{(}\EFo{point-max}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{indent-buffer} \EFrdb{(}\EFrdb{)}
  \EFd{"Indent each nonblank line in the buffer"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{indent-region} \EFrdc{(}\EFo{point-min}\EFrdc{)} \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{doom/what-has-changed} \EFrdb{(}\EFrdb{)}
  \EFd{"Open an ediff session to compare the module list in}
\EFd{\char126{}/.emacs.d/init.example.el and \char126{}/.doom.d/init.el."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}old-modules \EFrda{(}\EFf{doom--get-modules} \EFrdb{(}\EFo{expand-file-name} \EFrdc{(}\EFo{concat} \EFv{doom-emacs-dir} \EFs{"templates/init.example.el"}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}new-modules \EFrda{(}\EFf{doom--get-modules} \EFrdb{(}\EFo{expand-file-name} \EFs{"init.el"} \EFv{doom-private-dir}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}example-init-el \EFs{"/tmp/doom-init.example.el"}\EFrdd{)}
        \EFrdd{(}private-init-el \EFs{"/tmp/doom-private-init.el"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{doom--put-modules} example-init-el old-modules\EFrdc{)}
    \EFrdc{(}\EFf{doom--put-modules} private-init-el new-modules\EFrdc{)}
    \EFrdc{(}\EFo{ediff} private-init-el example-init-el\EFrdc{)}\EFrdb{)}\EFrda{)}

\end{Verbatim}
\end{Code}
\section{Packages}
\label{sec:org855ab50}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;} \EFc{-*- no-byte-compile: t; -*-}
\EFcd{;;;} \EFc{\$DOOMDIR/packages.el}

\EFcd{;;} \EFc{To install a package with Doom you must declare them here and run 'doom sync'}
\EFcd{;;} \EFc{on the command line, then restart Emacs for the changes to take effect -- or}
\EFcd{;;} \EFc{use 'M-x doom/reload'.}


\EFcd{;;} \EFc{To install SOME-PACKAGE from MELPA, ELPA or emacsmirror:}
\EFcd{;}\EFc{(package! some-package)}

\EFcd{;;} \EFc{To install a package directly from a remote git repo, you must specify a}
\EFcd{;;} \EFc{`}\textcolor[HTML]{a9a1e1}{:recipe}\EFc{'. You'll find documentation on what `}\textcolor[HTML]{a9a1e1}{:recipe}\EFc{' accepts here:}
\EFcd{;;} \EFc{https://github.com/raxod502/straight.el\#the-recipe-format}
\EFcd{;}\EFc{(package! another-package}
\EFcd{;}  \EFc{:recipe (:host github :repo "username/repo"))}

\EFcd{;;} \EFc{If the package you are trying to install does not contain a PACKAGENAME.el}
\EFcd{;;} \EFc{file, or is located in a subdirectory of the repo, you'll need to specify}
\EFcd{;;} \EFc{`}\textcolor[HTML]{a9a1e1}{:files}\EFc{' in the `}\textcolor[HTML]{a9a1e1}{:recipe}\EFc{':}
\EFcd{;}\EFc{(package! this-package}
\EFcd{;}  \EFc{:recipe (:host github :repo "username/repo"}
\EFcd{;}           \EFc{:files ("some-file.el" "src/lisp/*.el")))}

\EFcd{;;} \EFc{If you'd like to disable a package included with Doom, you can do so here}
\EFcd{;;} \EFc{with the `}\textcolor[HTML]{a9a1e1}{:disable}\EFc{' property:}
\EFcd{;}\EFc{(package! builtin-package :disable t)}

\EFcd{;;} \EFc{You can override the recipe of a built in package without having to specify}
\EFcd{;;} \EFc{all the properties for `}\textcolor[HTML]{a9a1e1}{:recipe}\EFc{'. These will inherit the rest of its recipe}
\EFcd{;;} \EFc{from Doom or MELPA/ELPA/Emacsmirror:}
\EFcd{;}\EFc{(package! builtin-package :recipe (:nonrecursive t))}
\EFcd{;}\EFc{(package! builtin-package-2 :recipe (:repo "myfork/package"))}

\EFcd{;;} \EFc{Specify a `}\textcolor[HTML]{a9a1e1}{:branch}\EFc{' to install a package from a particular branch or tag.}
\EFcd{;;} \EFc{This is required for some packages whose default branch isn't '}\textcolor[HTML]{a9a1e1}{master}\EFc{' (which}
\EFcd{;;} \EFc{our package manager can't deal with; see raxod502/straight.el\#279)}
\EFcd{;}\EFc{(package! builtin-package :recipe (:branch "develop"))}

\EFcd{;;} \EFc{Use `}\textcolor[HTML]{a9a1e1}{:pin}\EFc{' to specify a particular commit to install.}
\EFcd{;}\EFc{(package! builtin-package :pin "1a2b3c4d5e")}


\EFcd{;;} \EFc{Doom's packages are pinned to a specific commit and updated from release to}
\EFcd{;;} \EFc{release. The `}\textcolor[HTML]{a9a1e1}{unpin!}\EFc{' macro allows you to unpin single packages...}
\EFcd{;}\EFc{(unpin! pinned-package)}
\EFcd{;;} \EFc{...or multiple packages}
\EFcd{;}\EFc{(unpin! pinned-package another-pinned-package)}
\EFcd{;;} \EFc{...Or *all* packages (NOT RECOMMENDED; will likely break things)}
\EFcd{;}\EFc{(unpin! t)}

\EFrda{(}\EFk{package!} xelb\EFrda{)}
\EFrda{(}\EFk{package!} exwm\EFrda{)}
\EFrda{(}\EFk{package!} winum\EFrda{)}
\EFrda{(}\EFk{package!} try\EFrda{)}
\EFrda{(}\EFk{package!} counsel\EFrda{)}

\EFrda{(}\EFk{package!} diredfl\EFrda{)}
\EFrda{(}\EFk{package!} all-the-icons-dired\EFrda{)}
\EFrda{(}\EFk{package!} diredful\EFrda{)}
\EFrda{(}\EFk{package!} dired-git-info\EFrda{)}
\EFrda{(}\EFk{package!} async\EFrda{)}
\EFrda{(}\EFk{package!} dired-quick-sort\EFrda{)}
\EFrda{(}\EFk{package!} openwith\EFrda{)}
\EFrda{(}\EFk{package!} lispy\EFrda{)}
\EFrda{(}\EFk{package!} hydra\EFrda{)}
\EFrda{(}\EFk{package!} ace-link\EFrda{)}
\EFrda{(}\EFk{package!} sudo-edit\EFrda{)}
\EFrda{(}\EFk{package!} rotate\EFrda{)}
\EFrda{(}\EFk{package!} vlf\EFrda{)}
\EFrda{(}\EFk{package!} evil-escape \EFb{:disable} t\EFrda{)}

\EFcd{;} \EFc{Auto Activating Snippets}
\EFrda{(}\EFk{package!} aas \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"ymarco/auto-activating-snippets"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{package!} string-inflection\EFrda{)}
\EFrda{(}\EFk{package!} info-colors\EFrda{)}
\EFrda{(}\EFk{package!} modus-themes\EFrda{)}
\EFcd{;}\EFc{(package! theme-magic)}
\EFrda{(}\EFk{package!} keycast\EFrda{)}
\EFrda{(}\EFk{package!} page-break-lines \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"purcell/page-break-lines"}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{package!} spray\EFrda{)}
\EFcd{;}\EFc{(package! authinfo-color-mode}
\EFcd{;}  \EFc{:recipe (:repo "lisp/authinfo-color-mode"))}
\EFrda{(}\EFk{package!} systemd\EFrda{)}
\EFcd{;} \EFc{Ebooks}
\EFrda{(}\EFk{package!} calibredb\EFrda{)}
\EFrda{(}\EFk{package!} nov\EFrda{)}
\EFcd{;} \EFc{Email}
\EFrda{(}\EFk{package!} org-mime\EFrda{)}
\EFrda{(}\EFk{package!} org-auto-tangle\EFrda{)}
\EFrda{(}\EFk{package!} mu4e-alert\EFrda{)}
\EFrda{(}\EFk{package!} outline-minor-faces\EFrda{)}
\EFrda{(}\EFk{package!} mu4e-conversation\EFrda{)}
\EFrda{(}\EFk{package!} elfeed-summary\EFrda{)}
\EFrda{(}\EFk{package!} org-modern\EFrda{)}
\EFrda{(}\EFk{package!} good-scroll\EFrda{)}
\EFrda{(}\EFk{package!} desktop-environment\EFrda{)}
\EFrda{(}\EFk{package!} emms\EFrda{)}
\EFrda{(}\EFk{package!} elfeed-tube\EFrda{)}
\EFrda{(}\EFk{package!} mpv\EFrda{)}
\EFrda{(}\EFk{package!} elfeed-tube-mpv\EFrda{)}
\EFrda{(}\EFk{package!} spell-fu\EFrda{)}
\EFrda{(}\EFk{package!} wallpaper\EFrda{)}
\end{Verbatim}
\end{Code}
\section{Secrets\hfill{}\textsc{crypt}}
\label{sec:orgf710807}
-----BEGIN PGP MESSAGE-----

jA0ECQMCpaa2IHWz/qX/0ncB5MHYMuE7woX9lpKqkvubmgY7wy3/6LCoYMn6XYRY
sY2v9BQxlfFkz+rwgWnsdRYeGLR8Yd8mpHGeGg4jrvC8v5eiOhaqCKpyNiAcMpOv
age95IpQjrQoIy0CPDtiouDWKNrXrTSQctareltEAkkB+p48HdVkKg==
=z0qj
-----END PGP MESSAGE-----
\section{Modules}
\label{sec:org62a56e9}
\subsection{DPI Scaling Tweaks}
\label{sec:org5c40d7c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{dpi-scaling-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orga0bfaa9}
\subsubsection{Code}
\label{sec:orgd9b7871}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{setq} \EFv{display-pixels-per-inch} \EFrdb{(}\EFo{getenv} \EFs{"XFT\_DPI"}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{dpi-scaling-tweaks}\EFrda{)}
\EFrda{(}\EFk{if} \EFrdb{(}\EFo{string=} \EFrdc{(}\EFo{getenv} \EFs{"XFT\_DPI"}\EFrdc{)} \EFs{"192"}\EFrdb{)}
    \EFrdb{(}\EFk{setq} \EFv{exwm-systemtray--icon-min-size} \EFhn{32}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{exwm-systemtray--icon-min-size} \EFhn{16}\EFrdb{)}
  \EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Utility functions}
\label{sec:orgd561a12}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{utility-functions}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org8466cb1}
\begin{Code}
\begin{Verbatim}
\color{EFD}
\EFrda{(}\EFk{setq} home-hostname-alist \EFhq{'}\EFrdb{(}\EFs{"astaroth"} \EFs{"jarvis"}\EFrdb{)}
      home? \EFrdb{(}\EFo{member} \EFrdc{(}\EFv{system-name}\EFrdc{)} home-hostname-alist\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{require} \EFhq{'}\EFo{string-inflection}\EFrda{)}
\EFrda{(}\EFk{defun} \EFf{string-inflection-title-to-lisp-case-function} \EFrdb{(}title-str\EFrdb{)}
  \EFd{"Title String for Something => title-string-for-something"}
  \EFrdb{(}\EFo{string-inflection-kebab-case-function} \EFrdc{(}\EFo{s-replace-all} \EFhq{'}\EFrdd{(}\EFrda{(}\EFs{" "} . \EFs{"-"}\EFrda{)}\EFrdd{)} title-str\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;} \EFc{Sometimes exwm fails to sets a buffer, so set it to scratch}
\EFcd{;;;} \EFc{with a button press}
\EFrda{(}\EFk{defun} \EFf{go-to-scratch} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFs{"\%s"} \EFrdc{(}\EFo{selected-window}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFrdc{(}\EFo{format} \EFs{"Class: \%s"} \EFv{exwm-class-name}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFrdc{(}\EFo{format} \EFs{"Instance: \%s"} \EFv{exwm-instance-name}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFrdc{(}\EFo{format} \EFs{"Title: \%s"} \EFv{exwm-title}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFrdc{(}\EFo{format} \EFs{"Type: \%s"} \EFv{exwm-window-type}\EFrdc{)}\EFrdb{)}
  \EFcd{;}\EFc{(message "\%s" (exwm-class-name (selected-window)))}
  \EFrdb{(}\EFo{switch-to-buffer} \EFs{"*scratch*"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{go-to-scratch-other} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{switch-to-buffer-other-frame} \EFs{"*scratch*"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} save-temp-location \EFs{"\char126{}/dox/temp-save/"}\EFrda{)}
\EFrda{(}\EFk{defun} \EFf{save-buffer-temp} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}s \EFrda{(}\EFo{buffer-string}\EFrda{)}\EFrdd{)}
         \EFrdd{(}ss \EFrda{(}\EFo{split-string} s \EFs{" "}\EFrda{)}\EFrdd{)}
         \EFrdd{(}nl \EFrda{(}\EFo{butlast} ss \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{length} ss\EFrdc{)} \EFhn{5}\EFrdb{)}\EFrda{)}\EFrdd{)}

         \EFrdc{)}
    \EFrdc{(}\EFo{set-visited-file-name} \EFrdd{(}\EFo{concat} save-temp-location \EFrda{(}\EFo{mapconcat} \EFhq{'}\EFrdb{(}lambda \EFrdc{(}x\EFrdc{)}  \EFrdc{(}\EFo{format} \EFs{"\%s"} x\EFrdc{)}\EFrdb{)}  nl \EFs{" "}\EFrda{)} \EFs{".org"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{save-buffer}\EFrdc{)}
    \EFrdb{)}
  \EFrda{)}

  \EFrda{(}\EFk{defun} \EFf{switchmonitor-next} \EFrdb{(}\EFrdb{)}
    \EFrdb{(}\EFk{interactive}\EFrdb{)}
    \EFrdb{(}\EFo{shell-command} \EFs{"xdotool mousemove\_relative 1920 0"}\EFrdb{)}\EFrda{)}

  \EFrda{(}\EFk{defun} \EFf{switchmonitor-prev} \EFrdb{(}\EFrdb{)}
    \EFrdb{(}\EFk{interactive}\EFrdb{)}
    \EFrdb{(}\EFo{shell-command} \EFs{"xdotool mousemove\_relative -- -1920 0"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{ifdirexists} \EFrdb{(}dir \EFt{\&rest} actions\EFrdb{)}
  \EFd{"Execute functions taking dir as an argument if dir exists"}
  \EFhq{`}\EFrdb{(}\EFk{when} \EFrdc{(}\EFo{file-exists-p} ,dir\EFrdc{)}
     \EFrdc{(}\EFrdd{(}\EFk{lambda} \EFrda{(}dir\EFrda{)}
       ,@actions\EFrdd{)} \EFwr{,dir}\textcolor[HTML]{98be65}{)}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{utility-functions}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Autocorrect}
\label{sec:orgef22f6f}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{auto-correct}\EFrda{)}
\end{Verbatim}
\end{Code}

\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{auto-correct.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFo{define-key} \EFv{ctl-x-map} \EFs{"\char92{}C-i"}
  \EFhq{\#'}\EFhs{endless/ispell-word-then-abbrev}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{endless/simple-get-word} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{car-safe} \EFrdc{(}\EFk{save-excursion} \EFrdd{(}\EFo{ispell-get-word} nil\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{endless/ispell-word-then-abbrev} \EFrdb{(}p\EFrdb{)}
  \EFd{"Call `}\textcolor[HTML]{a9a1e1}{ispell-word}\EFd{', then create an abbrev for it.}
\EFd{With prefix P, create local abbrev. Otherwise it will}
\EFd{be global.}
\EFd{If there's nothing wrong with the word at point, keep}
\EFd{looking for a typo until the beginning of buffer. You can}
\EFd{skip typos you don't want to fix with `}\textcolor[HTML]{a9a1e1}{SPC}\EFd{', and you can}
\EFd{abort completely with `}\textcolor[HTML]{a9a1e1}{C-g}\EFd{'."}
  \EFrdb{(}\EFk{interactive} \EFs{"P"}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}bef aft\EFrdc{)}
    \EFrdc{(}\EFk{save-excursion}
      \EFrdd{(}\EFk{while} \EFrda{(}\EFk{if} \EFrdb{(}\EFk{setq} bef \EFrdc{(}\EFf{endless/simple-get-word}\EFrdc{)}\EFrdb{)}
                 \EFcd{;;} \EFc{Word was corrected or used quit.}
                 \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{ispell-word} nil \EFhq{'}\EFhs{quiet}\EFrdc{)}
                     nil \EFcd{;} \EFc{End the loop.}
                   \EFcd{;;} \EFc{Also end if we reach `}\textcolor[HTML]{a9a1e1}{bob}\EFc{'.}
                   \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{bobp}\EFrdd{)}\EFrdc{)}\EFrdb{)}
               \EFcd{;;} \EFc{If there's no word at point, keep looking}
               \EFcd{;;} \EFc{until `}\textcolor[HTML]{a9a1e1}{bob}\EFc{'.}
               \EFrdb{(}\EFo{not} \EFrdc{(}\EFo{bobp}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{backward-word}\EFrda{)}
        \EFrda{(}\EFo{backward-char}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} aft \EFrda{(}\EFf{endless/simple-get-word}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFk{and} aft bef \EFrda{(}\EFo{not} \EFrdb{(}\EFo{equal} aft bef\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}aft \EFrdc{(}\EFo{downcase} aft\EFrdc{)}\EFrdb{)}
              \EFrdb{(}bef \EFrdc{(}\EFo{downcase} bef\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{define-abbrev}
            \EFrdb{(}\EFk{if} p \EFv{local-abbrev-table} \EFv{global-abbrev-table}\EFrdb{)}
            bef aft\EFrda{)}
          \EFrda{(}\EFo{message} \EFs{"\char92{}"\%s\char92{}" now expands to \char92{}"\%s\char92{}" \%sally"}
                   bef aft \EFrdb{(}\EFk{if} p \EFs{"loc"} \EFs{"glob"}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{user-error} \EFs{"No typo at or before point"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{save-abbrevs} \EFhq{'}\EFhs{silently}\EFrda{)}
\EFrda{(}\EFk{setq-default} \EFv{abbrev-mode} t\EFrda{)}

\EFrda{(}\EFk{setq} ispell-abbrev-local nil\EFrda{)}
\EFrda{(}\EFk{defun} \EFf{ispell-abbrev-advice} \EFrdb{(}ispell-func \EFt{\&rest} args\EFrdb{)}
  \EFd{"Advice for `}\textcolor[HTML]{a9a1e1}{ispell-word}\EFd{'. Creates an abbrev for the correction made.}
\EFd{Unless ispell-abbrev-local, abbrev will be global.}
\EFd{ISPELL-FUNC passed as adviced function."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}before \EFrda{(}\EFo{downcase} \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{thing-at-point} \EFhq{'}\EFhs{word}\EFrdc{)} \EFs{""}\EFrdb{)}\EFrda{)}\EFrdd{)}
        after
        \EFrdd{(}res \EFrda{(}\EFo{apply} ispell-func args\EFrda{)}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{setq} after \EFrdd{(}\EFo{downcase} \EFrda{(}\EFk{or} \EFrdb{(}\EFo{thing-at-point} \EFhq{'}\EFhs{word}\EFrdb{)} \EFs{""}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{string=} after before\EFrdd{)}
      \EFrdd{(}\EFo{define-abbrev}
        \EFrda{(}\EFk{if} ispell-abbrev-local \EFv{local-abbrev-table} \EFv{global-abbrev-table}\EFrda{)} before after\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFs{"\char92{}"\%s\char92{}" now expands to \char92{}"\%s\char92{}" \%sally."}
               before after \EFrdd{(}\EFk{if} ispell-abbrev-local \EFs{"loc"} \EFs{"glob"}\EFrdd{)}\EFrdc{)}
    res\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{advice-add} \EFhq{'}\EFhs{ispell-word} \EFb{:around} \EFhq{\#'}\EFhs{ispell-abbrev-advice}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{auto-correct}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Beancount}
\label{sec:org9e0dd7a}
\subsubsection{Requirements}
\label{sec:orgfb83020}
\subsubsection{Code}
\label{sec:org5b9dc07}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{beancount-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{beancount.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{use-package!} beancount
  \EFb{:mode} \EFrdb{(}\EFs{"\char92{}\char92{}.beancount\char92{}\char92{}'"} . beancount-mode\EFrdb{)}
  \EFb{:init}
  \EFrdb{(}\EFk{after!} all-the-icons
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{all-the-icons-icon-alist}
                 \EFhq{'}\EFrdd{(}\EFs{"\char92{}\char92{}.beancount\char92{}\char92{}'"} all-the-icons-material \EFs{"attach\_money"} \EFb{:face} all-the-icons-lblue\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{all-the-icons-mode-icon-alist}
                 \EFhq{'}\EFrdd{(}beancount-mode all-the-icons-material \EFs{"attach\_money"} \EFb{:face} all-the-icons-lblue\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{setq} beancount-electric-currency t\EFrdb{)}
  \EFrdb{(}\EFk{defun} \EFf{beancount-bal} \EFrdc{(}\EFrdc{)}
    \EFd{"Run bean-report bal."}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{compilation-read-command} nil\EFrda{)}\EFrdd{)}
      \EFrdd{(}beancount--run \EFs{"bean-report"}
                      \EFrda{(}\EFo{file-relative-name} \EFv{buffer-file-name}\EFrda{)} \EFs{"bal"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:map} beancount-mode-map
        \EFb{:n} \EFs{"TAB"} \EFhq{\#'}\EFhs{beancount-align-to-previous-number}
        \EFb{:i} \EFs{"RET"} \EFrdc{(}\EFk{cmd!} \EFrdd{(}\EFo{newline-and-indent}\EFrdd{)} \EFrdd{(}beancount-align-to-previous-number\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-select-account} \EFrdb{(}\EFrdb{)}
  \EFd{"Select and insert account from current buffer"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{with-temp-buffer}
    \EFrdc{(}\EFf{beancount-open-local}\EFrdc{)}
    \EFrdc{(}\EFo{completing-read} \EFs{"Account: "} \EFrdd{(}beancount-collect-unique beancount-account-regexp \EFhn{0}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-imported-transaction-change-unknown-account} \EFrdb{(}\EFrdb{)}
  \EFd{"Change the Unknown:account field in an imported beancount entry."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}beancount-goto-transaction-begin\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}ba \EFrdb{(}\EFf{beancount-select-account}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{re-search-forward} \EFs{"Unknown:account"}\EFrdd{)}
      \EFrdd{(}\EFo{replace-match} ba\EFrdd{)}
      \EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFf{beancount-finalize-transaction}\EFrdb{)}
  \EFrdb{(}beancount-goto-next-transaction\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-imported-credit-transaction-change-unknown-account} \EFrdb{(}\EFrdb{)}
  \EFd{"Change the Unknown:account field in an imported VR-Visa-Gold beancount entry."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}beancount-goto-transaction-begin\EFrdc{)}
    \EFrdc{(}\EFo{re-search-forward} \EFs{"Assets:VR-Giro"}\EFrdc{)}
    \EFrdc{(}\EFo{replace-match} \EFs{"Assets:VR-Visa-Gold"}\EFrdc{)}
    \EFrdb{)}
  \EFrdb{(}\EFf{beancount-imported-transaction-change-unknown-account}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-finalize-transaction} \EFrdb{(}\EFrdb{)}
  \EFd{"Change transaction marked with * into *"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}beancount-goto-transaction-begin\EFrdc{)}
    \EFrdc{(}\EFo{re-search-forward} \EFs{"!"}\EFrdc{)}
    \EFrdc{(}\EFo{replace-match} \EFs{"*"}\EFrdc{)}
    \EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-transaction-align} \EFrdb{(}\EFrdb{)}
  \EFd{"Align beancount transaction."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}beancount-align-to-previous-number\EFrdb{)}
  \EFrdb{(}beancount-goto-next-transaction\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{end-of-buffer-p} \EFrdb{(}\EFrdb{)}
  \EFd{"Check if cursor is at the end of the buffer."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{=} \EFrdc{(}\EFo{point}\EFrdc{)} \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{recenter-middle} \EFrdb{(}\EFrdb{)}
  \EFd{"Like recenter-top-bottom, but only centers in middle"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{recenter} nil t\EFrdb{)}\EFrda{)}

\EFcd{;} \EFc{Center screen when going to next or prev transaction}
\EFrda{(}\EFo{advice-add} \EFhq{'}\EFhs{+beancount/next-transaction} \EFb{:after} \EFhq{\#'}\EFhs{recenter-middle}\EFrda{)}
\EFrda{(}\EFo{advice-add} \EFhq{'}\EFhs{+beancount/previous-transaction} \EFb{:after} \EFhq{\#'}\EFhs{recenter-middle}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-cleanup-whitespace-in-quotes} \EFrdb{(}str\EFrdb{)}
  \EFd{"Replace multiple spaces in STR with a single space, but only between quotes."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}start \EFhn{0}\EFrdd{)}
        \EFrdd{(}res \EFs{""}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{while} \EFrdd{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{\char92{}"[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{\char92{}"]*\char92{}"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} str start\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}match \EFrdc{(}\EFo{match-string} \EFhn{0} str\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{setq} res \EFrdb{(}\EFo{concat} res
                          \EFrdc{(}\EFo{substring} str start \EFrdd{(}\EFo{match-beginning} \EFhn{0}\EFrdd{)}\EFrdc{)}
                          \EFrdc{(}\EFo{replace-regexp-in-string} \EFs{"[[:space:]]\char92{}\char92{}\{2,\char92{}\char92{}\}"} \EFs{" "} match\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{setq} start \EFrdb{(}\EFo{match-end} \EFhn{0}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{concat} res \EFrdd{(}\EFo{substring} str start\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-cleanup-buffer} \EFrdb{(}\EFrdb{)}
  \EFd{"Cleanup whitespace in the current buffer."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{while} \EFrdd{(}\EFo{not} \EFrda{(}\EFo{eobp}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}line \EFrdc{(}\EFo{buffer-substring-no-properties} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)} \EFrdd{(}\EFo{line-end-position}\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}clean-line \EFrdc{(}\EFf{beancount-cleanup-whitespace-in-quotes} line\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{delete-region} \EFrdb{(}\EFo{line-beginning-position}\EFrdb{)} \EFrdb{(}\EFo{line-end-position}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{insert} clean-line\EFrda{)}
        \EFrda{(}\EFo{forward-line} \EFhn{1}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-cleanup-hook} \EFrdb{(}\EFrdb{)}
  \EFd{"Add `beancount-cleanup-buffer` to `before-save-hook` in Beancount mode."}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{beancount-mode}\EFrdc{)}
    \EFrdc{(}\EFo{add-hook} \EFhq{'}\EFv{before-save-hook} \EFhq{\#'}\EFhs{beancount-cleanup-buffer} nil t\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFhs{beancount-mode-hook} \EFhq{\#'}\EFhs{beancount-cleanup-hook}\EFrda{)}


  \EFrda{(}\EFk{defun} \EFf{beancount-note-processing-date} \EFrdb{(}\EFrdb{)}
  \EFd{"Adds the date the transaction was filed/processed on as note."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}beancount-goto-transaction-begin\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}start \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{evil-forward-WORD-end}\EFrdd{)}
      \EFrdd{(}\EFo{forward-char}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}end \EFrdc{(}\EFo{point}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{let} \EFrdb{(}\EFrdc{(}word \EFrdd{(}\EFo{buffer-substring} start end\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}beancount-goto-transaction-end\EFrdb{)}
          \EFrdb{(}\EFo{insert} \EFs{"  processed: \char92{}""}\EFrdb{)}
          \EFrdb{(}\EFo{insert} word\EFrdb{)}
          \EFrdb{(}\EFo{insert} \EFs{"\char92{}"\char92{}n"}\EFrdb{)}
          \EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} beancount
\EFrdb{(}\EFk{defun} \EFf{+beancount--navigate-next-transaction} \EFrdc{(}\EFrdc{)}
  \EFd{"Move point to beginning of next transaction."}
  \EFrdc{(}\EFk{interactive}\EFrdc{)}
  \EFcd{;;} \EFc{make sure we actually move to the next xact, even if we are the beginning}
  \EFcd{;;} \EFc{of one now.}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{looking-at} +beancount--payee-any-status-regex\EFrdd{)}
      \EFrdd{(}\EFo{forward-line}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{re-search-forward}  +beancount--payee-any-status-regex nil t\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{match-beginning} \EFhn{0}\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{not} \EFrda{(}\EFk{or} \EFrdb{(}\EFo{string-equal} \EFrdc{(}\EFf{beancount-get-transaction-type}\EFrdc{)} \EFs{"*"}\EFrdb{)}
               \EFrdb{(}\EFf{end-of-buffer-p}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}+beancount--navigate-next-transaction\EFrdd{)}
\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-get-transaction-type} \EFrdb{(}\EFrdb{)}
  \EFd{"Get the type of the current transaction."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{beginning-of-line}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{looking-at} \EFs{"\char94{}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[0-9]\char92{}\char92{}\{}\textcolor[HTML]{dcaeea}{4\char92{}\char92{}}\EFs{\}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[0-9]\char92{}\char92{}\{}\textcolor[HTML]{dcaeea}{2\char92{}\char92{}}\EFs{\}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[0-9]\char92{}\char92{}\{}\textcolor[HTML]{dcaeea}{2\char92{}\char92{}}\EFs{\}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[a-z\char92{}\char92{}*\char92{}\char92{}!]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"}\EFrdd{)}
        \EFrdd{(}\EFo{match-string} \EFhn{4}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} beancount
\EFrdb{(}\EFk{defun} \EFf{+beancount/sort-region} \EFrdc{(}beg end \EFt{\&optional} reverse\EFrdc{)}
  \EFd{"Sort the transactions inside BEG and END.}
\EFd{If REVERSE (the prefix arg) is non-nil, sort the transactions in reverst order."}
  \EFrdc{(}\EFk{interactive}
   \EFrdd{(}\EFo{list} \EFrda{(}\EFo{region-beginning}\EFrda{)}
         \EFrda{(}\EFo{region-end}\EFrda{)}
         \EFrda{(}\EFk{and} \EFv{current-prefix-arg} t\EFrda{)}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}new-beg beg\EFrda{)}
         \EFrda{(}new-end end\EFrda{)}
         \EFrda{(}bounds \EFrdb{(}\EFk{save-excursion}
                   \EFrdc{(}\EFo{list} \EFrdd{(}+beancount--navigate-beginning-of-xact\EFrdd{)}
                         \EFrdd{(}+beancount--navigate-end-of-xact\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
         \EFrda{(}point-delta \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{point}\EFrdc{)} \EFrdc{(}\EFo{car} bounds\EFrdc{)}\EFrdb{)}\EFrda{)}
         \EFrda{(}target-xact \EFrdb{(}\EFo{buffer-substring} \EFrdc{(}\EFo{car} bounds\EFrdc{)} \EFrdc{(}\EFo{cadr} bounds\EFrdc{)}\EFrdb{)}\EFrda{)}
         \EFrda{(}\EFv{inhibit-modification-hooks} t\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFk{save-excursion}
      \EFrda{(}\EFk{save-restriction}
        \EFrdb{(}\EFo{goto-char} beg\EFrdb{)}
        \EFcd{;;} \EFc{make sure beg of region is at the beginning of a line}
        \EFrdb{(}\EFo{beginning-of-line}\EFrdb{)}
        \EFcd{;;} \EFc{make sure point is at the beginning of a xact}
        \EFrdb{(}\EFk{unless} \EFrdc{(}\EFo{looking-at} +beancount--payee-any-status-regex\EFrdc{)}
          \EFrdc{(}+beancount--navigate-next-transaction\EFrdc{)}\EFrdb{)}
        \EFrdb{(}\EFk{setq} new-beg \EFrdc{(}\EFo{point}\EFrdc{)}\EFrdb{)}
        \EFrdb{(}\EFo{goto-char} end\EFrdb{)}
        \EFrdb{(}+beancount--navigate-next-transaction\EFrdb{)}
        \EFcd{;;} \EFc{make sure end of region is at the beginning of next record after the}
        \EFcd{;;} \EFc{region}
        \EFrdb{(}\EFk{setq} new-end \EFrdc{(}\EFo{point}\EFrdc{)}\EFrdb{)}
        \EFrdb{(}\EFo{narrow-to-region} new-beg new-end\EFrdb{)}
        \EFrdb{(}\EFo{goto-char} new-beg\EFrdb{)}
        \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{inhibit-field-text-motion} t\EFrdd{)}\EFrdc{)}
          \EFrdc{(}\EFf{sort-subr}
           reverse
           \EFhq{\#'}\EFhs{+beancount--navigate-next-xact}
           \EFhq{\#'}\EFhs{+beancount--navigate-end-of-xact}
           \EFhq{\#'}\EFhs{+beancount--sort-startkey}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFo{re-search-forward} \EFrda{(}\EFo{regexp-quote} target-xact\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{+} \EFrdb{(}\EFo{match-beginning} \EFhn{0}\EFrdb{)} point-delta\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
\EFrda{)}


\EFrda{(}\EFo{provide} \EFhq{'}\EFo{beancount-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Dired}
\label{sec:org66d3bf8}
\subsubsection{Dired Inline images}
\label{sec:org1db3dd8}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{dired-inline-images}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:orgb5b4ba7}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{dired-inline-images.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{defun} \EFf{dired-preview--dired-line-is-previewable} \EFrdb{(}\EFrdb{)}
  \EFd{"Return non-nil if line under point is previewable"}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}fname \EFrda{(}\EFo{dired-get-filename} nil\EFrda{)}\EFrdd{)}
         \EFrdd{(}ext \EFrda{(}\EFo{upcase} \EFrdb{(}\EFo{file-name-extension} fname\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}allowed-extensions \EFhq{'}\EFrda{(}\EFs{"PBM"} \EFs{"XBM"} \EFs{"XPM"} \EFs{"GIF"} \EFs{"JPEG"} \EFs{"JPG"} \EFs{"TIFF"} \EFs{"TIF"} \EFs{"PNG"} \EFs{"SVG"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}search-fun \EFrda{(}\EFo{apply-partially} \EFrdb{(}\EFk{lambda} \EFrdc{(}a b\EFrdc{)} \EFrdc{(}\EFo{string=} a b\EFrdc{)}\EFrdb{)} ext\EFrda{)}\EFrdd{)}
         \EFrdd{(}is-ext-allowed \EFrda{(}\EFf{seq-find} search-fun allowed-extensions nil\EFrda{)}\EFrdd{)}\EFrdc{)}
    is-ext-allowed\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dired-preview--readin} \EFrdb{(}filename\EFrdb{)}
  \EFd{"Read in the file.}

\EFd{Return a string suitable for insertion in `}\textcolor[HTML]{a9a1e1}{dired}\EFd{' buffer."}
    \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}preview-image \EFrda{(}\EFo{create-image} filename \EFhq{'}\EFhs{imagemagick} nil \EFb{:height} \EFhn{200}\EFrda{)}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFk{with-temp-buffer}
        \EFrdd{(}\EFo{insert-image} preview-image\EFrdd{)}
        \EFrdd{(}\EFo{insert} \EFs{"\char92{}n"}\EFrdd{)}
        \EFrdd{(}\EFo{buffer-string}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dired-preview-insert} \EFrdb{(}\EFrdb{)}          \EFcd{;;} \EFc{Copied more or less directly from dired-subtree}
  \EFd{"Insert preview under this file."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFf{dired-preview--dired-line-is-previewable}\EFrdd{)}
             \EFrdd{(}\EFo{not} \EFrda{(}dired-subtree--is-expanded-p\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}filename \EFrdb{(}\EFo{dired-get-filename} nil\EFrdb{)}\EFrda{)}
           \EFrda{(}listing \EFrdb{(}\EFf{dired-preview--readin} filename\EFrdb{)}\EFrda{)}
           beg end\EFrdd{)}
      \EFrdd{(}\EFo{read-only-mode} \EFhn{-1}\EFrdd{)}
      \EFrdd{(}\EFo{move-end-of-line} \EFhn{1}\EFrdd{)}
      \EFcd{;;} \EFc{this is pretty ugly, I'm sure it can be done better}
      \EFrdd{(}\EFk{save-excursion}
        \EFrda{(}\EFo{insert} listing\EFrda{)}
        \EFrda{(}\EFk{setq} end \EFrdb{(}\EFo{+} \EFrdc{(}\EFo{point}\EFrdc{)} \EFhn{2}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{newline}\EFrdd{)}
      \EFrdd{(}\EFk{setq} beg \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}\EFv{inhibit-read-only} t\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{remove-text-properties} \EFrdb{(}\EFo{1-} beg\EFrdb{)} beg \EFhq{'}\EFrdb{(}dired-filename\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}ov \EFrdc{(}\EFo{make-overlay} beg end\EFrdc{)}\EFrdb{)}
             \EFrdb{(}parent \EFrdc{(}dired-subtree--get-ov \EFrdd{(}\EFo{1-} beg\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}depth \EFrdc{(}\EFk{or} \EFrdd{(}\EFk{and} parent \EFrda{(}\EFo{+} \EFhn{2} \EFrdb{(}\EFo{overlay-get} parent \EFhq{'}\EFhs{dired-subtree-depth}\EFrdb{)}\EFrda{)}\EFrdd{)}
                        \EFhn{2}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}face \EFrdc{(}\EFo{intern} \EFrdd{(}\EFo{format} \EFs{"dired-subtree-depth-\%d-face"} depth\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{when} dired-subtree-use-backgrounds
          \EFrdb{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{face} face\EFrdb{)}\EFrda{)}
        \EFcd{;;} \EFc{refactor this to some function}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFv{line-prefix}
                     \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{stringp} dired-subtree-line-prefix\EFrdc{)}
                         \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{not} dired-subtree-use-backgrounds\EFrdd{)}
                             \EFrdd{(}\EFo{apply} \EFhq{'}\EFhs{concat} \EFrda{(}\EFo{-repeat} depth dired-subtree-line-prefix\EFrda{)}\EFrdd{)}
                           \EFrdd{(}\EFk{cond}
                            \EFrda{(}\EFrdb{(}\EFo{eq} nil dired-subtree-line-prefix-face\EFrdb{)}
                             \EFrdb{(}\EFo{apply} \EFhq{'}\EFhs{concat}
                                    \EFrdc{(}\EFo{-repeat} depth dired-subtree-line-prefix\EFrdc{)}\EFrdb{)}\EFrda{)}
                            \EFrda{(}\EFrdb{(}\EFo{eq} \EFhq{'}\EFhs{subtree} dired-subtree-line-prefix-face\EFrdb{)}
                             \EFrdb{(}\EFo{concat}
                              dired-subtree-line-prefix
                              \EFrdc{(}\EFo{propertize}
                               \EFrdd{(}\EFo{apply} \EFhq{'}\EFhs{concat}
                                      \EFrda{(}\EFo{-repeat} \EFrdb{(}\EFo{1-} depth\EFrdb{)} dired-subtree-line-prefix\EFrda{)}\EFrdd{)}
                               \EFhq{'}\EFhs{face} face\EFrdc{)}\EFrdb{)}\EFrda{)}
                            \EFrda{(}\EFrdb{(}\EFo{eq} \EFhq{'}\EFhs{parents} dired-subtree-line-prefix-face\EFrdb{)}
                             \EFrdb{(}\EFo{concat}
                              dired-subtree-line-prefix
                              \EFrdc{(}\EFo{apply} \EFhq{'}\EFhs{concat}
                                     \EFrdd{(}\EFk{--map}
                                      \EFrda{(}\EFo{propertize} dired-subtree-line-prefix
                                                  \EFhq{'}\EFhs{face}
                                                  \EFrdb{(}\EFo{intern} \EFrdc{(}\EFo{format} \EFs{"dired-subtree-depth-\%d-face"} it\EFrdc{)}\EFrdb{)}\EFrda{)}
                                      \EFrda{(}\EFo{number-sequence} \EFhn{1} \EFrdb{(}\EFo{1-} depth\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{funcall} dired-subtree-line-prefix depth\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{dired-subtree-name} filename\EFrda{)}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{dired-subtree-parent} parent\EFrda{)}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{dired-subtree-depth} depth\EFrda{)}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{evaporate} t\EFrda{)}
        \EFrda{(}\EFk{push} ov dired-subtree-overlays\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{-} beg \EFhn{1}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{dired-move-to-filename}\EFrdd{)}
      \EFrdd{(}\EFo{read-only-mode} \EFhn{1}\EFrdd{)}
      \EFrdd{(}\EFo{run-hooks} \EFhq{'}\EFhs{dired-subtree-after-insert-hook}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dired-preview-insert-preview-or-subtree} \EFrdb{(}orig-fun\EFrdb{)}
  \EFd{"Call the right insert function for a preview or a subtree"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}dired-subtree--dired-line-is-directory-or-link-p\EFrdd{)} \EFrdd{(}\EFo{apply} orig-fun nil\EFrdd{)}\EFrdc{)}
        \EFrdc{(}\EFrdd{(}\EFf{dired-preview--dired-line-is-previewable}\EFrdd{)} \EFrdd{(}\EFf{dired-preview-insert}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{advice-add} \EFhq{'}\EFhs{dired-subtree-insert} \EFb{:around} \EFhq{\#'}\EFhs{dired-preview-insert-preview-or-subtree}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{dired-inline-images}\EFrda{)}

\end{Verbatim}
\end{Code}
\subsubsection{Dired Tweaks}
\label{sec:orgefc4977}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{dired-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org27923a3}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;}\EFc{(package! casual-dired)}
\EFrda{(}\EFk{package!} dired-open-with\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:org2d40f71}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{dired-tweaks.el -*- lexical-binding: t; -*-}

\EFcd{;;} \EFc{Dired}

\EFcd{;;;} \EFc{Casual Dired Shortcut Menu}
\EFrda{(}\EFk{after!} dired
  \EFrdb{(}\EFo{define-key} \EFv{dired-mode-map} \EFrdc{(}\EFo{kbd} \EFs{"C-o"}\EFrdc{)} \EFhq{'}\EFhs{casual-dired-tmenu}\EFrdb{)}\EFrda{)}

\EFcd{;;;} \EFc{Colourful dired}
\EFrda{(}\EFk{use-package!} diredfl
  \EFb{:init} \EFrdb{(}\EFv{diredfl-global-mode} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} all-the-icons-dired
  \EFb{:config}
  \EFcd{;}\EFc{(all-the-icons-dired-mode 1)}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{dired-mode-hook} \EFhq{'}\EFv{all-the-icons-dired-mode}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dired-open-file} \EFrdb{(}\EFrdb{)}
  \EFd{"In dired, open the file named on this line."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}file \EFrda{(}\EFo{dired-get-filename} nil t\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFs{"Opening \%s..."} file\EFrdc{)}
    \EFrdc{(}\EFo{call-process} \EFs{"xdg-open"} nil \EFhn{0} nil file\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{define-minor-mode} \EFv{dired-follow-mode}
  \EFd{"Diplay file at point in dired after a move."}
  \EFb{:lighter} \EFs{" dired-f"}
  \EFb{:global} t
  \EFrdb{(}\EFk{if} \EFv{dired-follow-mode}
      \EFrdc{(}\EFo{advice-add} \EFhq{'}\EFhs{dired-next-line} \EFb{:after} \EFrdd{(}\EFk{lambda} \EFrda{(}arg\EFrda{)} \EFrda{(}\EFo{dired-display-file}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{advice-remove} \EFhq{'}\EFhs{dired-next-line} \EFrdd{(}\EFk{lambda} \EFrda{(}arg\EFrda{)} \EFrda{(}\EFo{dired-display-file}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{vc-follow-symlinks} t
      \EFv{dired-listing-switches} \EFs{"-ahlt"}
      diredp-toggle-find-file-reuse-dir \EFhn{1}
      image-dired-thumb-size \EFhn{100}
      diredp-image-preview-in-tooltip \EFhn{100}
      \EFv{dired-auto-revert-buffer} t
      diredp-hide-details-initially-flag nil
      \EFv{dired-hide-details-mode} \EFhn{0}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{image-view} \EFrdb{(}direction\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)}
     \EFrdc{(}\EFk{interactive}\EFrdc{)}
     \EFrdc{(}\EFo{quit-window}\EFrdc{)}
     \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}pt \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}
           filename\EFrdd{)}
       \EFrdd{(}\EFk{or} \EFrda{(}\EFk{ignore-errors}
             \EFrdb{(}\EFk{catch} \EFhq{'}\EFo{filename}
               \EFrdc{(}\EFk{while} \EFrdd{(}\EFo{dired-next-line} ,direction\EFrdd{)}
                 \EFrdd{(}\EFk{when} \EFrda{(}\EFo{image-type-from-file-name}
                        \EFrdb{(}\EFk{setq} filename \EFrdc{(}\EFo{dired-get-filename}\EFrdc{)}\EFrdb{)}\EFrda{)}
                   \EFrda{(}\EFo{throw} \EFhq{'}\EFo{filename} filename\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{goto-char} pt\EFrda{)}\EFrdd{)}
       \EFrdd{(}\EFo{dired-view-file}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{eval-after-load} \EFs{"image-mode"}
  \EFhq{'}\EFrdb{(}progn
    \EFrdc{(}\EFo{define-key} \EFv{image-mode-map} \EFs{"n"} \EFrdd{(}\EFk{image-view} \EFhn{1}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{image-mode-map} \EFs{"p"} \EFrdd{(}\EFk{image-view} \EFhn{-1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;}\EFc{(use-package dired-k}
\EFcd{;}  \EFc{;; use dired-k as alternative to revert buffer. This will refresh git status}
\EFcd{;}  \EFc{:hook (dired-mode . dired-k)}
\EFcd{;}  \EFc{:bind (:map dired-mode-map}
\EFcd{;}              \EFc{("g" . dired-k)))}

\EFrda{(}\EFk{use-package!} diredful
  \EFb{:config} \EFrdb{(}\EFv{diredful-mode} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} dired-git-info
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{dgi-auto-hide-details-p} nil\EFrdb{)}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{dired-after-readin-hook} \EFhq{'}\EFhs{dired-git-info-auto-enable}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{use-package!} async
  \EFb{:init} \EFrdb{(}\EFv{dired-async-mode} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} dired-quick-sort
  \EFb{:config}
  \EFrdb{(}\EFo{dired-quick-sort-setup}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{dired-quick-sort-suppress-setup-warning} t\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} openwith
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{openwith-associations}
        \EFrdc{(}\EFk{cond}
         \EFrdd{(}\EFrda{(}\EFo{string-equal} \EFv{system-type} \EFs{"darwin"}\EFrda{)}
          \EFhq{'}\EFrda{(}\EFrdb{(}\EFs{"\char92{}\char92{}.}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{dmg}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{doc}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{docs}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{xls}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{xlsx}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"}
             \EFs{"open"} \EFrdc{(}file\EFrdc{)}\EFrdb{)}
            \EFrdb{(}\EFs{"\char92{}\char92{}.}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{mp4}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mp3}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{webm}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{avi}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{flv}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mov}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"}
             \EFs{"open"} \EFrdc{(}\EFs{"-a"} \EFs{"VLC"} file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFrda{(}\EFo{string-equal} \EFv{system-type} \EFs{"gnu/linux"}\EFrda{)}
          \EFhq{'}\EFrda{(}\EFrdb{(}\EFs{"\char92{}\char92{}.}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{mp4}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{m4a}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mp3}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mkv}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{webm}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{avi}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{flv}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mov}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{part}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"} \EFcd{;} \EFc{removed \char92{}\char92{}|pdf}
             \EFs{"xdg-open"} \EFrdc{(}file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFv{openwith-mode} t\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{large-file-warning-threshold} \EFhn{3000000000}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{define-key} \EFv{dired-mode-map} \EFrdb{(}\EFo{kbd} \EFs{"<backspace>"}\EFrdb{)} \EFhq{'}\EFhs{dired-up-directory}\EFrda{)}

\EFcd{;;} \EFc{Docview j and k go forward a line which is weird behaviour in a pdf}
\EFcd{;;} \EFc{Paging is prefered to scrolling}
\EFrda{(}\EFk{after!} doc-view-mode
\EFrdb{(}\EFo{define-key} doc-view-mode-map \EFrdc{(}\EFo{kbd} \EFs{"j"}\EFrdc{)} \EFhq{'}\EFhs{doc-view-next-page}\EFrdb{)}
\EFrdb{(}\EFo{define-key} doc-view-mode-map \EFrdc{(}\EFo{kbd} \EFs{"k"}\EFrdc{)} \EFhq{'}\EFhs{doc-view-previous-page}\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{Convert files automatically}
\EFrda{(}\EFk{defun} \EFf{dired-convert-file} \EFrdb{(}\EFrdb{)}
  \EFd{"Converts pptx or docx files to pdf"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{cl-map} \EFhq{'}\EFhs{nil} \EFhq{'}\EFrdc{(}lambda \EFrdd{(}file\EFrdd{)}
                   \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}ext \EFrdc{(}\EFo{file-name-extension} file\EFrdc{)}\EFrdb{)}
                         \EFrdb{(}base-name-sans-ext \EFrdc{(}\EFo{file-name-sans-extension} \EFrdd{(}\EFo{file-name-nondirectory} file\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                     \EFrda{(}\EFk{cond}
                      \EFrdb{(}\EFrdc{(}\EFk{or} \EFrdd{(}\EFo{string-equal} ext \EFs{"pptx"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"ppt"}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{async-shell-command} \EFrdd{(}\EFo{format} \EFs{"libreoffice --headless --invisible --convert-to pdf \char92{}"\%s\char92{}""} file\EFrdd{)}\EFrdc{)}\EFrdb{)}
                      \EFrdb{(}\EFrdc{(}\EFk{or} \EFrdd{(}\EFo{string-equal} ext \EFs{"docx"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"doc"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"epub"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"tex"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} \EFs{"html"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"org"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"txt"}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{async-shell-command} \EFrdd{(}\EFo{format} \EFs{"pandoc -i \char92{}"\%s\char92{}" -o \char92{}"\%s.pdf\char92{}""} file base-name-sans-ext\EFrdd{)}\EFrdc{)}\EFrdb{)}
                      \EFrdb{(}\EFrdc{(}\EFk{or} \EFrdd{(}\EFo{string-equal} ext \EFs{"jpg"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"jpeg"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"png"}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{async-shell-command} \EFrdd{(}\EFo{format} \EFs{"convert \char92{}"\%s\char92{}" -rotate 90 \char92{}"\%s\char92{}""} file file\EFrdd{)}\EFrdc{)}\EFrdb{)}
                      \EFrda{)}\EFrdd{)}\EFrdc{)} \textcolor[HTML]{98be65}{(}\textcolor[HTML]{ECBE7B}{dired-get-marked-files}\textcolor[HTML]{98be65}{)}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}

\EFcd{;;} \EFc{Rotate pdf file}
\EFrda{(}\EFk{defun} \EFf{dired-rotate-pdf} \EFrdb{(}\EFrdb{)}
  \EFd{"Rotate a pdf file in-place"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{cl-map} \EFhq{'}\EFhs{nil} \EFhq{'}\EFrdc{(}lambda \EFrdd{(}file\EFrdd{)}
                   \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}ext \EFrdc{(}\EFo{file-name-extension} file\EFrdc{)}\EFrdb{)}
                         \EFrdb{(}base-name-sans-ext \EFrdc{(}\EFo{file-name-sans-extension} \EFrdd{(}\EFo{file-name-nondirectory} file\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                     \EFrda{(}\EFk{when} \EFrdb{(}\EFo{string-equal} \EFs{"pdf"} ext \EFrdb{)}
                       \EFrdb{(}\EFo{message} file\EFrdb{)}
                       \EFrdb{(}\EFf{async-shell-command-no-window}
                        \EFrdc{(}\EFo{format} \EFs{"mutool draw -R90 -o \char92{}"\%s\char92{}" \char92{}"\%s\char92{}""} file file\EFrdc{)}\EFrdb{)}
                       \EFrda{)}
                \EFrdd{)}\EFrdc{)} \textcolor[HTML]{98be65}{(}\textcolor[HTML]{ECBE7B}{dired-get-marked-files}\textcolor[HTML]{98be65}{)}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}


\EFcd{;;} \EFc{Vertically split pdf file}
\EFrda{(}\EFk{defun} \EFf{dired-split-pdf-vertical} \EFrdb{(}\EFrdb{)}
  \EFd{"Vertically split a pdf file in-place"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{cl-map} \EFhq{'}\EFhs{nil} \EFhq{'}\EFrdc{(}lambda \EFrdd{(}file\EFrdd{)}
                   \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}ext \EFrdc{(}\EFo{file-name-extension} file\EFrdc{)}\EFrdb{)}
                         \EFrdb{(}base-name-sans-ext \EFrdc{(}\EFo{file-name-sans-extension} \EFrdd{(}\EFo{file-name-nondirectory} file\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                     \EFrda{(}\EFk{when} \EFrdb{(}\EFo{string-equal} \EFs{"pdf"} ext \EFrdb{)}
                       \EFrdb{(}\EFo{message} file\EFrdb{)}
                       \EFrdb{(}\EFf{async-shell-command-no-window}
                        \EFrdc{(}\EFo{format} \EFs{"mutool poster -x2 \char92{}"\%s\char92{}" \char92{}"\%s\char92{}""} file file\EFrdc{)}\EFrdb{)}
                       \EFrda{)}
                \EFrdd{)}\EFrdc{)} \textcolor[HTML]{98be65}{(}\textcolor[HTML]{ECBE7B}{dired-get-marked-files}\textcolor[HTML]{98be65}{)}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}

\EFcd{;;} \EFc{Horizontally split pdf file}
\EFrda{(}\EFk{defun} \EFf{dired-split-pdf-horizontal} \EFrdb{(}\EFrdb{)}
  \EFd{"Horizontally split a pdf file in-place"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{cl-map} \EFhq{'}\EFhs{nil} \EFhq{'}\EFrdc{(}lambda \EFrdd{(}file\EFrdd{)}
                   \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}ext \EFrdc{(}\EFo{file-name-extension} file\EFrdc{)}\EFrdb{)}
                         \EFrdb{(}base-name-sans-ext \EFrdc{(}\EFo{file-name-sans-extension} \EFrdd{(}\EFo{file-name-nondirectory} file\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                     \EFrda{(}\EFk{when} \EFrdb{(}\EFo{string-equal} \EFs{"pdf"} ext \EFrdb{)}
                       \EFrdb{(}\EFo{message} file\EFrdb{)}
                       \EFrdb{(}\EFf{async-shell-command-no-window}
                        \EFrdc{(}\EFo{format} \EFs{"mutool poster -y2 \char92{}"\%s\char92{}" \char92{}"\%s\char92{}""} file file\EFrdc{)}\EFrdb{)}
                       \EFrda{)}
                \EFrdd{)}\EFrdc{)} \textcolor[HTML]{98be65}{(}\textcolor[HTML]{ECBE7B}{dired-get-marked-files}\textcolor[HTML]{98be65}{)}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}




\EFcd{;;} \EFc{Toggle youtube-dl-list if in elfeed-youtube buffer, else perform regular load}
\EFrda{(}\EFk{defun} \EFf{dired-load-or-youtube-toggle} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}\EFo{string-equal} \EFrda{(}\EFo{buffer-name}\EFrda{)} \EFs{"elfeed-youtube"}\EFrdd{)}
         \EFrdd{(}\EFf{youtube-dl-list}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}\EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{youtube-dl-list-mode}\EFrdd{)} \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}t \EFrdd{(}\EFo{dired-do-load}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{dired-mode-map}
      \EFcd{;}\EFc{:after dired-mode}
      \EFcd{;}\EFc{:n doom-leader-key nil}
      \EFb{:n} \EFs{"c"} \EFhq{\#'}\EFhs{dired-convert-file}
      \EFb{:n} \EFs{"L"} \EFhq{\#'}\EFhs{dired-load-or-youtube-toggle}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{youtube-dl-list-mode-map}
      \EFb{:n} \EFs{"L"} \EFhq{\#'}\EFhs{dired-load-or-youtube-toggle}
      \EFb{:n} \EFs{"r"} \EFhq{\#'}\EFhs{youtube-dl-failures-reset}\EFrda{)}

\EFcd{;} \EFc{Allow dragging files from dired to other applications}
\EFrda{(}\EFk{setq} \EFv{dired-mouse-drag-files} t\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{dired-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Tab to Expand Subfiles}
\label{sec:org5cc5854}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{tab-to-expand-subfiles}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org5d56a6a}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} dired-subtree\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:orge1a04b9}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{use-package!} dired-subtree
  \EFb{:defer} t
  \EFb{:after} dired
  \EFb{:config}
  \EFrdb{(}\EFk{bind-key} \EFs{"<tab>"} \EFhq{\#'}\EFhs{dired-subtree-toggle} \EFv{dired-mode-map}\EFrdb{)}
  \EFrdb{(}\EFk{bind-key} \EFs{"<backtab>"} \EFhq{\#'}\EFhs{dired-subtree-cycle} \EFv{dired-mode-map}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{tab-to-expand-subfiles}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Narrow by regex dired}
\label{sec:org0af1531}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{narrow-by-regex-dired}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org4e4ed08}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} dired-narrow\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:orgd0fad47}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{provide} \EFhq{'}\EFo{narrow-by-regex-dired}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Ebooks}
\label{sec:orgd5fa62b}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{ebook-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:orga12d2d2}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{ebook-tweaks.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{use-package!} calibredb
  \EFb{:commands} calibredb
  \EFb{:config}
  \EFrdb{(}\EFk{setq} calibredb-root-dir \EFs{"/home/user/sshfs/calibre/"}
        calibredb-db-dir \EFrdc{(}\EFo{expand-file-name} \EFs{"metadata.db"} calibredb-root-dir\EFrdc{)}
        sql-sqlite-program \EFs{"sqlite3"}\EFrdb{)}

\EFrdb{(}\EFk{setq} calibredb-id-width \EFhn{12}\EFrdb{)}
\EFrdb{(}\EFk{setq} calibredb-format-all-the-icons t\EFrdb{)}
\EFrdb{(}\EFk{setq} calibredb-format-icons-in-terminal t\EFrdb{)}
\EFrdb{(}\EFk{setq} calibredb-format-character-icons t\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:map} calibredb-show-mode-map
        \EFb{:ne} \EFs{"?"} \EFhq{\#'}\EFhs{calibredb-entry-dispatch}
        \EFb{:ne} \EFs{"o"} \EFhq{\#'}\EFhs{calibredb-find-file}
        \EFb{:ne} \EFs{"O"} \EFhq{\#'}\EFhs{calibredb-find-file-other-frame}
        \EFb{:ne} \EFs{"V"} \EFhq{\#'}\EFhs{calibredb-open-file-with-default-tool}
        \EFb{:ne} \EFs{"s"} \EFhq{\#'}\EFhs{calibredb-set-metadata-dispatch}
        \EFb{:ne} \EFs{"e"} \EFhq{\#'}\EFhs{calibredb-export-dispatch}
        \EFb{:ne} \EFs{"q"} \EFhq{\#'}\EFhs{calibredb-entry-quit}
        \EFb{:ne} \EFs{"."} \EFhq{\#'}\EFhs{calibredb-open-dired}
        \EFb{:ne} \EFrdc{[}tab\EFrdc{]} \EFhq{\#'}\EFhs{calibredb-toggle-view-at-point}
        \EFb{:ne} \EFs{"M-t"} \EFhq{\#'}\EFhs{calibredb-set-metadata--tags}
        \EFb{:ne} \EFs{"M-a"} \EFhq{\#'}\EFhs{calibredb-set-metadata--author\_sort}
        \EFb{:ne} \EFs{"M-A"} \EFhq{\#'}\EFhs{calibredb-set-metadata--authors}
        \EFb{:ne} \EFs{"M-T"} \EFhq{\#'}\EFhs{calibredb-set-metadata--title}
        \EFb{:ne} \EFs{"M-c"} \EFhq{\#'}\EFhs{calibredb-set-metadata--comments}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:map} calibredb-search-mode-map
        \EFb{:ne} \EFrdc{[}mouse-3\EFrdc{]} \EFhq{\#'}\EFhs{calibredb-search-mouse}
        \EFb{:ne} \EFs{"RET"} \EFhq{\#'}\EFhs{calibredb-find-file}
        \EFb{:ne} \EFs{"?"} \EFhq{\#'}\EFhs{calibredb-dispatch}
        \EFb{:ne} \EFs{"a"} \EFhq{\#'}\EFhs{calibredb-add}
        \EFb{:ne} \EFs{"A"} \EFhq{\#'}\EFhs{calibredb-add-dir}
        \EFb{:ne} \EFs{"c"} \EFhq{\#'}\EFhs{calibredb-clone}
        \EFb{:ne} \EFs{"d"} \EFhq{\#'}\EFhs{calibredb-remove}
        \EFb{:ne} \EFs{"D"} \EFhq{\#'}\EFhs{calibredb-remove-marked-items}
        \EFb{:ne} \EFs{"j"} \EFhq{\#'}\EFhs{calibredb-next-entry}
        \EFb{:ne} \EFs{"k"} \EFhq{\#'}\EFhs{calibredb-previous-entry}
        \EFb{:ne} \EFs{"l"} \EFhq{\#'}\EFhs{calibredb-virtual-library-list}
        \EFb{:ne} \EFs{"L"} \EFhq{\#'}\EFhs{calibredb-library-list}
        \EFb{:ne} \EFs{"n"} \EFhq{\#'}\EFhs{calibredb-virtual-library-next}
        \EFb{:ne} \EFs{"N"} \EFhq{\#'}\EFhs{calibredb-library-next}
        \EFb{:ne} \EFs{"p"} \EFhq{\#'}\EFhs{calibredb-virtual-library-previous}
        \EFb{:ne} \EFs{"P"} \EFhq{\#'}\EFhs{calibredb-library-previous}
        \EFb{:ne} \EFs{"s"} \EFhq{\#'}\EFhs{calibredb-set-metadata-dispatch}
        \EFb{:ne} \EFs{"S"} \EFhq{\#'}\EFhs{calibredb-switch-library}
        \EFb{:ne} \EFs{"o"} \EFhq{\#'}\EFhs{calibredb-find-file}
        \EFb{:ne} \EFs{"O"} \EFhq{\#'}\EFhs{calibredb-find-file-other-frame}
        \EFb{:ne} \EFs{"v"} \EFhq{\#'}\EFhs{calibredb-view}
        \EFb{:ne} \EFs{"V"} \EFhq{\#'}\EFhs{calibredb-open-file-with-default-tool}
        \EFb{:ne} \EFs{"."} \EFhq{\#'}\EFhs{calibredb-open-dired}
        \EFb{:ne} \EFs{"b"} \EFhq{\#'}\EFhs{calibredb-catalog-bib-dispatch}
        \EFb{:ne} \EFs{"e"} \EFhq{\#'}\EFhs{calibredb-export-dispatch}
        \EFb{:ne} \EFs{"r"} \EFhq{\#'}\EFhs{calibredb-search-refresh-and-clear-filter}
        \EFb{:ne} \EFs{"R"} \EFhq{\#'}\EFhs{calibredb-search-clear-filter}
        \EFb{:ne} \EFs{"q"} \EFhq{\#'}\EFhs{calibredb-search-quit}
        \EFb{:ne} \EFs{"m"} \EFhq{\#'}\EFhs{calibredb-mark-and-forward}
        \EFb{:ne} \EFs{"f"} \EFhq{\#'}\EFhs{calibredb-toggle-favorite-at-point}
        \EFb{:ne} \EFs{"x"} \EFhq{\#'}\EFhs{calibredb-toggle-archive-at-point}
        \EFb{:ne} \EFs{"h"} \EFhq{\#'}\EFhs{calibredb-toggle-highlight-at-point}
        \EFb{:ne} \EFs{"u"} \EFhq{\#'}\EFhs{calibredb-unmark-and-forward}
        \EFb{:ne} \EFs{"i"} \EFhq{\#'}\EFhs{calibredb-edit-annotation}
        \EFb{:ne} \EFs{"DEL"} \EFhq{\#'}\EFhs{calibredb-unmark-and-backward}
        \EFb{:ne} \EFrdc{[}backtab\EFrdc{]} \EFhq{\#'}\EFhs{calibredb-toggle-view}
        \EFb{:ne} \EFrdc{[}tab\EFrdc{]} \EFhq{\#'}\EFhs{calibredb-toggle-view-at-point}
        \EFb{:ne} \EFs{"M-n"} \EFhq{\#'}\EFhs{calibredb-show-next-entry}
        \EFb{:ne} \EFs{"M-p"} \EFhq{\#'}\EFhs{calibredb-show-previous-entry}
        \EFb{:ne} \EFs{"/"} \EFhq{\#'}\EFhs{calibredb-search-live-filter}
        \EFb{:ne} \EFs{"M-t"} \EFhq{\#'}\EFhs{calibredb-set-metadata--tags}
        \EFb{:ne} \EFs{"M-a"} \EFhq{\#'}\EFhs{calibredb-set-metadata--author\_sort}
        \EFb{:ne} \EFs{"M-A"} \EFhq{\#'}\EFhs{calibredb-set-metadata--authors}
        \EFb{:ne} \EFs{"M-T"} \EFhq{\#'}\EFhs{calibredb-set-metadata--title}
        \EFb{:ne} \EFs{"M-c"} \EFhq{\#'}\EFhs{calibredb-set-metadata--comments}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} nov
  \EFb{:mode} \EFrdb{(}\EFs{"\char92{}\char92{}.epub\char92{}\char92{}'"} . nov-mode\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{map!} \EFb{:map} \EFv{nov-mode-map}
        \EFb{:n} \EFs{"RET"} \EFhq{\#'}\EFhs{nov-scroll-up}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{doom-modeline-segment--nov-info} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFo{concat}
     \EFs{" "}
     \EFrdd{(}\EFo{propertize}
      \EFrda{(}\EFo{cdr} \EFrdb{(}\EFo{assoc} \EFhq{'}\EFhs{creator} \EFv{nov-metadata}\EFrdb{)}\EFrda{)}
      \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-modeline-project-parent-dir}\EFrdd{)}
     \EFs{" "}
     \EFrdd{(}\EFo{cdr} \EFrda{(}\EFo{assoc} \EFhq{'}\EFhs{title} \EFv{nov-metadata}\EFrda{)}\EFrdd{)}
     \EFs{" "}
     \EFrdd{(}\EFo{propertize}
      \EFrda{(}\EFo{format} \EFs{"\%d/\%d"}
              \EFrdb{(}\EFo{1+} \EFv{nov-documents-index}\EFrdb{)}
              \EFrdb{(}\EFo{length} \EFv{nov-documents}\EFrdb{)}\EFrda{)}
      \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-modeline-info}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFo{advice-add} \EFhq{'}\EFhs{nov-render-title} \EFb{:override} \EFhq{\#'}\EFhs{ignore}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{+nov-mode-setup} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFo{face-remap-add-relative} \EFhq{'}\EFhs{variable-pitch}
                             \EFb{:family} \EFs{"Merriweather"}
                             \EFb{:height} \EFhn{1.4}
                             \EFb{:width} \EFhq{'}\EFhs{semi-expanded}\EFrdc{)}
    \EFrdc{(}\EFo{face-remap-add-relative} \EFhq{'}\EFhs{default} \EFb{:height} \EFhn{0.7}\EFrdc{)}
    \EFrdc{(}\EFk{setq-local} \EFv{line-spacing} \EFhn{0.1}
                \EFv{next-screen-context-lines} \EFhn{4}
                \EFv{shr-use-colors} nil\EFrdc{)}
    \EFrdc{(}\EFo{require} \EFhq{'}\EFo{visual-fill-column} nil t\EFrdc{)}
    \EFrdc{(}\EFk{setq-local} visual-fill-column-center-text t
                visual-fill-column-width \EFhn{81}
                \EFv{nov-text-width} \EFhn{120}\EFrdc{)}
    \EFrdc{(}\EFf{visual-fill-column-mode} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFv{hl-line-mode} \EFhn{-1}\EFrdc{)}

    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{+lookup-definition-functions} \EFhq{\#'}\EFhs{+lookup/dictionary-definition}\EFrdc{)}

    \EFrdc{(}\EFk{setq-local} \EFv{mode-line-format}
                \EFhq{`}\EFrdd{(}\EFrda{(}\EFb{:eval}
                   \EFrdb{(}\EFo{doom-modeline-segment--workspace-name}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFb{:eval}
                   \EFrdb{(}\EFo{doom-modeline-segment--window-number}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFb{:eval}
                   \EFrdb{(}\EFf{doom-modeline-segment--nov-info}\EFrdb{)}\EFrda{)}
                  ,\EFrda{(}\EFo{propertize}
                    \EFs{" \%P "}
                    \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-modeline-buffer-minor-mode}\EFrda{)}
                  ,\EFrda{(}\EFo{propertize}
                    \EFs{" "}
                    \EFhq{'}\EFhs{face} \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{doom-modeline--active}\EFrdc{)} \EFhq{'}\EFhs{mode-line} \EFhq{'}\EFhs{mode-line-inactive}\EFrdb{)}
                    \EFhq{'}\EFhs{display} \EFhq{`}\EFrdb{(}\EFrdc{(}space
                                \EFb{:align-to}
                                \EFrdd{(}\EFo{-} \EFrda{(}\EFo{+} right right-fringe right-margin\EFrda{)}
                                   ,\EFrda{(}\EFo{*} \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}width \EFrda{(}doom-modeline--font-width\EFrda{)}\EFrdd{)}\EFrdc{)}
                                         \EFrdc{(}\EFk{or} \EFrdd{(}\EFk{and} \EFrda{(}\EFo{=} width \EFhn{1}\EFrda{)} \EFhn{1}\EFrdd{)}
                                             \EFrdd{(}\EFo{/} width \EFrda{(}\EFo{frame-char-width}\EFrda{)} \EFhn{1.0}\EFrdd{)}\EFrdc{)}\EFrdb{)}
                                       \EFrdb{(}\EFo{string-width}
                                        \EFrdc{(}\EFo{format-mode-line} \EFrdd{(}\EFo{cons} \EFs{""} \EFhq{'}\EFrda{(}\EFb{:eval} \EFrdb{(}\EFo{doom-modeline-segment--major-mode}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFb{:eval} \EFrdb{(}\EFo{doom-modeline-segment--major-mode}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{nov-mode-hook} \EFhq{\#'}\EFhs{+nov-mode-setup}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{ebook-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Editing}
\label{sec:orge9548c3}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{editing}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org9a79eb3}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} treesit-auto\EFrda{)}
\EFrda{(}\EFk{package!} avy\EFrda{)}
\EFrda{(}\EFk{package!} casual-avy \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"kickingvegas/casual-avy"}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{package!} yasnippet-snippets\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org4a5d02d}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{editing.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{defun} \EFf{which-active-modes} \EFrdb{(}\EFrdb{)}
  \EFd{"Return which minor modes are enabled in the current buffer."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}active-modes\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{mapc} \EFrdd{(}\EFk{lambda} \EFrda{(}mode\EFrda{)} \EFrda{(}\EFk{condition-case} nil
                        \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{symbolp} mode\EFrdd{)} \EFrdd{(}\EFo{symbol-value} mode\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFhs{active-modes} mode\EFrdc{)}\EFrdb{)}
                      \EFrdb{(}\EFo{error} nil\EFrdb{)} \EFrda{)}\EFrdd{)}
          \EFv{minor-mode-list}\EFrdc{)}
    \EFrdc{(}\EFo{format} \EFs{"\%s"} active-modes\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{replace-regexp-entire-buffer} \EFrdb{(}pattern replacement\EFrdb{)}
  \EFd{"Perform regular-expression replacement throughout buffer."}
  \EFrdb{(}\EFk{interactive}
   \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}args \EFrdb{(}\EFo{query-replace-read-args} \EFs{"Replace"} t\EFrdb{)}\EFrda{)}\EFrdd{)}
     \EFrdd{(}\EFo{setcdr} \EFrda{(}\EFo{cdr} args\EFrda{)} nil\EFrdd{)}    \EFcd{;} \EFc{remove third value returned from query---args}
     args\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{while} \EFrdd{(}\EFo{re-search-forward} pattern nil t\EFrdd{)}
      \EFrdd{(}\EFo{replace-match} replacement\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;} \EFc{Casual Avy as menu for avy jumps}
\EFrda{(}\EFk{setq} relative nil\EFrda{)} \EFcd{;} \EFc{workaround for casual-avy bug, needed as long as not in melpa}
\EFrda{(}\EFo{keymap-global-set} \EFs{"M-s"} \EFhq{\#'}\EFhs{casual-avy-tmenu}\EFrda{)}

\EFrda{(}\EFk{setq} toggle-auto-fill-boolean nil
      \EFv{which-key-idle-delay} \EFhn{0.5}
      \EFv{which-key-allow-multiple-replacements} t\EFrda{)}

\EFrda{(}\EFk{after!} which-key
  \EFrdb{(}\EFk{pushnew!}
   \EFv{which-key-replacement-alist}
   \EFhq{'}\EFrdc{(}\EFrdd{(}\EFs{""} . \EFs{"\char92{}\char92{}`+?evil[-:]?}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(?:}}\EFs{a-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{?}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"}\EFrdd{)} . \EFrdd{(}nil . \EFs{"\char92{}\char92{}1"}\EFrdd{)}\EFrdc{)}
   \EFhq{'}\EFrdc{(}\EFrdd{(}\EFs{"\char92{}\char92{}`g s"} . \EFs{"\char92{}\char92{}`evilem--?motion-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"}\EFrdd{)} . \EFrdd{(}nil . \EFs{"\char92{}\char92{}1"}\EFrdd{)}\EFrdc{)}
   \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} company
  \EFrdb{(}\EFk{setq} \EFv{company-idle-delay} \EFhn{0.5}
        \EFv{company-minimum-prefix-length} \EFhn{2}
        \EFv{company-show-numbers} t\EFrdb{)}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{evil-normal-state-entry-hook} \EFhq{\#'}\EFhs{company-abort}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFf{set-company-backend!}
  \EFhq{'}\EFrdb{(}text-mode
    markdown-mode
    gfm-mode\EFrdb{)}
  \EFhq{'}\EFrdb{(}\EFb{:seperate}
    company-ispell
    company-files
    company-yasnippet\EFrdb{)}\EFrda{)}


\EFrda{(}\EFf{set-company-backend!} \EFhq{'}\EFhs{ess-r-mode}
  \EFhq{'}\EFrdb{(}company-R-args company-R-objects company-dabbrev-code \EFb{:separate}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} vlf-setup
  \EFb{:defer-incrementally} vlf-tune vlf-base vlf-write vlf-search vlf-occur vlf-follow vlf-ediff vlf\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{eros-eval-result-prefix} \EFs{" "}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{toggle-auto-fill-on} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{set-fill-column} \EFhn{100}\EFrdb{)} \EFcd{;}\EFc{80}
  \EFrdb{(}\EFo{auto-fill-mode} t\EFrdb{)}
  \EFrdb{(}\EFk{setq} toggle-auto-fill-boolean t\EFrdb{)}
  \EFcd{;}\EFc{(string-match-p "auto-fill-function" (which-active-modes))}
  \EFrdb{(}\EFo{message} \EFs{"auto-fill-mode on"}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{toggle-auto-fill-off} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFf{replace-regexp-entire-buffer} \EFs{"\char92{}n"} \EFs{" "}\EFrdb{)}
  \EFrdb{(}\EFo{auto-fill-mode} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} toggle-auto-fill-boolean nil\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFs{"auto-fill-mode off"}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{toggle-auto-fill} \EFrdb{(}\EFrdb{)}
  \EFd{"Toggle auto fill mode and reset buffer to non-auto-fill."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} toggle-auto-fill-boolean
      \EFrdc{(}\EFf{toggle-auto-fill-off}\EFrdc{)}
    \EFrdc{(}\EFf{toggle-auto-fill-on}\EFrdc{)}
    \EFrdb{)}\EFrda{)}



\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"M-q"}\EFrdb{)} \EFhq{'}\EFhs{evil-mc-make-cursor-move-next-line}\EFrda{)}

\EFrda{(}\EFk{use-package!} aas
  \EFb{:commands} aas-mode\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{yas-triggers-in-field} t\EFrda{)}

\EFrda{(}\EFk{use-package!} string-inflection
  \EFb{:commands} \EFrdb{(}\EFo{string-inflection-all-cycle}
             string-inflection-toggle
             string-inflection-camelcase
             string-inflection-lower-camelcase
             string-inflection-kebab-case
             string-inflection-underscore
             string-inflection-capital-underscore
             string-inflection-upcase\EFrdb{)}
  \EFb{:init}
  \EFrdb{(}\EFk{map!} \EFb{:leader} \EFb{:prefix} \EFrdc{(}\EFs{"c\char126{}"} . \EFs{"naming convention"}\EFrdc{)}
        \EFb{:desc} \EFs{"cycle"} \EFs{"\char126{}"} \EFhq{\#'}\EFhs{string-inflection-all-cycle}
        \EFb{:desc} \EFs{"toggle"} \EFs{"t"} \EFhq{\#'}\EFhs{string-inflection-toggle}
        \EFb{:desc} \EFs{"CamelCase"} \EFs{"c"} \EFhq{\#'}\EFhs{string-inflection-camelcase}
        \EFb{:desc} \EFs{"downCase"} \EFs{"d"} \EFhq{\#'}\EFhs{string-inflection-lower-camelcase}
        \EFb{:desc} \EFs{"kebab-case"} \EFs{"k"} \EFhq{\#'}\EFhs{string-inflection-kebab-case}
        \EFb{:desc} \EFs{"under\_score"} \EFs{"\_"} \EFhq{\#'}\EFhs{string-inflection-underscore}
        \EFb{:desc} \EFs{"Upper\_Score"} \EFs{"u"} \EFhq{\#'}\EFhs{string-inflection-capital-underscore}
        \EFb{:desc} \EFs{"UP\_CASE"} \EFs{"U"} \EFhq{\#'}\EFhs{string-inflection-upcase}\EFrdb{)}
  \EFrdb{(}\EFk{after!} evil
    \EFrdc{(}\EFk{evil-define-operator} \EFf{evil-operator-string-inflection} \EFrdd{(}beg end \_type\EFrdd{)}
      \EFd{"Define a new evil operator that cycles symbol casing."}
      \EFb{:move-point} nil
      \EFrdd{(}\EFk{interactive} \EFs{"<R>"}\EFrdd{)}
      \EFrdd{(}\EFo{string-inflection-all-cycle}\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{evil-repeat-info} \EFhq{'}\EFrda{(}\EFrdb{[}?g ?\char126{}\EFrdb{]}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-normal-state-map} \EFrdd{(}\EFo{kbd} \EFs{"g\char126{}"}\EFrdd{)} \EFhq{'}\EFhs{evil-operator-string-inflection}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-normal-state-map} \EFrdd{(}\EFo{kbd} \EFs{"<remap> <evil-next-line>"}\EFrdd{)} \EFhq{'}\EFhs{evil-next-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-normal-state-map} \EFrdd{(}\EFo{kbd} \EFs{"<remap> <evil-previous-line>"}\EFrdd{)} \EFhq{'}\EFhs{evil-previous-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-motion-state-map} \EFrdd{(}\EFo{kbd} \EFs{"<remap> <evil-next-line>"}\EFrdd{)} \EFhq{'}\EFhs{evil-next-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-motion-state-map} \EFrdd{(}\EFo{kbd} \EFs{"<remap> <evil-previous-line>"}\EFrdd{)} \EFhq{'}\EFhs{evil-previous-visual-line}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{sp-local-pair}
 \EFhq{'}\EFrdb{(}org-mode\EFrdb{)}
 \EFs{"<<"} \EFs{">>"}
 \EFb{:actions} \EFhq{'}\EFrdb{(}insert\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} authinfo-color-mode
  \EFb{:mode} \EFrdb{(}\EFs{"authinfo.gpg\char92{}\char92{}'"} . authinfo-color-mode\EFrdb{)}
  \EFb{:init} \EFrdb{(}\EFo{advice-add} \EFhq{'}\EFhs{authinfo-mode} \EFb{:override} \EFhq{\#'}\EFhs{authinfo-color-mode}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} systemd
  \EFb{:defer} t\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{global-visual-line-mode} t
 \EFv{evil-respect-visual-line-mode} t\EFrda{)}

\EFrda{(}\EFk{use-package} treesit-auto
  \EFb{:demand} t
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{treesit-auto-install} \EFhq{'}\EFhs{prompt}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{treesit-font-lock-level} \EFhn{4}\EFrdb{)} \EFcd{;} \EFc{all the fontlock details}
  \EFrdb{(}\EFv{global-treesit-auto-mode}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{evil-normal-state-map} \EFs{"t t"} \EFhq{'}\EFhs{transpose-chars}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{editing}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Indent Guides}
\label{sec:orgec491ff}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{indent-guide-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org04bffc6}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} indent-bars \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"jdtsmith/indent-bars"}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org8302f92}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{use-package!} indent-bars
  \EFb{:config}
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{indent-bars-ts}\EFrdb{)} 		\EFcd{;} \EFc{not needed with straight}
  \EFb{:custom}
  \EFrdb{(}indent-bars-treesit-support t\EFrdb{)}
  \EFrdb{(}indent-bars-treesit-ignore-blank-lines-types \EFhq{'}\EFrdc{(}\EFs{"module"}\EFrdc{)}\EFrdb{)}
  \EFcd{;;} \EFc{Add other languages as needed}
  \EFrdb{(}indent-bars-treesit-scope \EFhq{'}\EFrdc{(}\EFrdd{(}python function\_definition class\_definition for\_statement
	  if\_statement with\_statement while\_statement\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFcd{;;} \EFc{Note: wrap may not be needed if no-descend-list is enough}
  \EFcd{;;}\EFc{(indent-bars-treesit-wrap '((python argument\_list parameters ; for python, as an example}
  \EFcd{;;}				      \EFc{list list\_comprehension}
  \EFcd{;;}				      \EFc{dictionary dictionary\_comprehension}
  \EFcd{;;}				      \EFc{parenthesized\_expression subscript)))}
  \EFb{:hook} \EFrdb{(}\EFrdc{(}\EFf{python-base-mode} yaml-mode\EFrdc{)} . indent-bars-mode\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{indent-guide-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Elfeed Tweaks}
\label{sec:org7bb05ad}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{elfeed-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orga21275e}
\subsubsection{Code}
\label{sec:org36993da}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{elfeed-tweaks.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} rmh-elfeed-org-files \EFrdb{(}\EFo{cons} \EFrdc{(}\EFo{expand-file-name} \EFs{"ext/elfeed/elfeed.org"} \EFv{doom-private-dir}\EFrdc{)}\EFrdc{(}\EFrdc{)}\EFrdb{)}
      elfeed-db-directory \EFrdb{(}\EFo{expand-file-name} \EFs{"ext/elfeed/db/"} \EFv{doom-private-dir}\EFrdb{)}
      elfeed-thumbnail-dir \EFs{"/tmp/elfeed-thumbnails/"}\EFrda{)}


\EFrda{(}\EFk{map!} \EFb{:map} elfeed-search-mode-map
      \EFb{:after} elfeed-search
                                        \EFcd{;}\EFc{[remap kill-this-buffer] "q"}
                                        \EFcd{;}\EFc{[remap kill-buffer] "q"}
      \EFb{:n} \EFv{doom-leader-key} nil
      \EFb{:n} \EFs{"DEL"} \EFhq{\#'}\EFhs{elfeed-load-summary}
      \EFb{:n} \EFs{"q"} \EFhq{\#'}\EFhs{elfeed-save-summary}
      \EFb{:n} \EFs{"e"} \EFhq{\#'}\EFhs{elfeed-update}
      \EFb{:n} \EFs{"r"} \EFhq{\#'}\EFhs{elfeed-search-untag-all-unread}
      \EFb{:n} \EFs{"u"} \EFhq{\#'}\EFhs{elfeed-search-tag-all-unread}
      \EFb{:n} \EFs{"s"} \EFhq{\#'}\EFhs{elfeed-search-live-filter}
      \EFb{:n} \EFs{"RET"} \EFhq{\#'}\EFhs{elfeed-search-show-entry}
      \EFb{:n} \EFs{"p"} \EFhq{\#'}\EFhs{elfeed-show-pdf}
      \EFb{:n} \EFs{"v"} \EFhq{\#'}\EFhs{elfeed-search-youtube-dl}
      \EFb{:n} \EFs{"L"} \EFhq{\#'}\EFhs{youtube-dl-list}
      \EFb{:n} \EFs{"+"} \EFhq{\#'}\EFhs{elfeed-search-tag-all}
      \EFb{:n} \EFs{"-"} \EFhq{\#'}\EFhs{elfeed-search-untag-all}
      \EFb{:n} \EFs{"S"} \EFhq{\#'}\EFhs{elfeed-search-set-filter}
      \EFb{:n} \EFs{"b"} \EFhq{\#'}\EFhs{elfeed-search-browse-url}
      \EFb{:n} \EFs{"t"} \EFhq{\#'}\EFhs{elfeed-search-thumbnail}
      \EFb{:n} \EFs{"y"} \EFhq{\#'}\EFhs{elfeed-search-yank}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} elfeed-show-mode-map
      \EFb{:after} elfeed-show
                                        \EFcd{;}\EFc{[remap kill-this-buffer] "q"}
                                        \EFcd{;}\EFc{[remap kill-buffer] "q"}
      \EFb{:n} \EFv{doom-leader-key} nil
      \EFb{:nm} \EFs{"q"} \EFhq{\#'}\EFhs{elfeed-save-close}
      \EFb{:nm} \EFs{"o"} \EFhq{\#'}\EFhs{ace-link-elfeed}
      \EFb{:nm} \EFs{"A"} \EFhq{\#'}\EFhs{elfeed-wget-url}
      \EFb{:nm} \EFs{"RET"} \EFhq{\#'}\EFhs{elfeed-tube-mpv-open}
      \EFb{:nm} \EFs{"n"} \EFhq{\#'}\EFhs{elfeed-show-next}
      \EFb{:nm} \EFs{"N"} \EFhq{\#'}\EFhs{elfeed-show-prev}
      \EFb{:nm} \EFs{"p"} \EFhq{\#'}\EFhs{elfeed-show-pdf}
      \EFb{:nm} \EFs{"v"} \EFhq{\#'}\EFhs{elfeed-show-youtube-dl}
      \EFb{:nm} \EFs{"d"} \EFhq{\#'}\EFhs{elfeed-show-download-enclosure}
      \EFb{:nm} \EFs{"D"} \EFhq{\#'}\EFhs{elfeed-show-download-enclosure}
      \EFb{:nm} \EFs{"L"} \EFhq{\#'}\EFhs{youtube-dl-list}
      \EFb{:nm} \EFs{"+"} \EFhq{\#'}\EFhs{elfeed-show-tag}
      \EFb{:nm} \EFs{"-"} \EFhq{\#'}\EFhs{elfeed-show-untag}
      \EFb{:nm} \EFs{"s"} \EFhq{\#'}\EFhs{elfeed-show-new-live-search}
      \EFb{:nm} \EFs{"y"} \EFhq{\#'}\EFhs{elfeed-show-yank}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} elfeed-summary-mode-map
      \EFb{:after} elfeed-summary
      \EFb{:n} \EFs{"L"} \EFhq{\#'}\EFhs{youtube-dl-list}
      \EFb{:n} \EFs{"V"} \EFhq{\#'}\EFhs{open-yt-dl-videos}
      \EFb{:n} \EFs{"R"} \EFhq{\#'}\EFhs{elfeed-summary-load-update}
      \EFb{:n} \EFs{"C-x C-s"} \EFhq{\#'}\EFhs{elfeed-summary-save}
      \EFb{:n} \EFs{"RET"} \EFhq{\#'}\EFhs{elfeed-summary-action-save-location}\EFrda{)}

\EFrda{(}\EFk{after!} elfeed-search
  \EFrdb{(}\EFf{set-evil-initial-state!} \EFhq{'}\EFhs{elfeed-search-mode} \EFhq{'}\EFhs{normal}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{after!} elfeed-show-mode
  \EFrdb{(}\EFf{set-evil-initial-state!} \EFhq{'}\EFhs{elfeed-show-mode}   \EFhq{'}\EFhs{normal}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} evil-snipe
  \EFrdb{(}\EFk{push} \EFhq{'}\EFhs{elfeed-show-mode}   \EFv{evil-snipe-disabled-modes}\EFrdb{)}
  \EFrdb{(}\EFk{push} \EFhq{'}\EFhs{elfeed-search-mode} \EFv{evil-snipe-disabled-modes}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} elfeed
  \EFrdb{(}\EFf{elfeed-org}\EFrdb{)}
  \EFrdb{(}\EFk{use-package!} elfeed-link\EFrdb{)}
  \EFrdb{(}elfeed-db-load\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFcd{;}\EFc{elfeed-search-filter "@1-week-ago +unread"}
   elfeed-search-filter \EFs{"@3-days-ago unread"}
   \EFv{flycheck-global-modes} \EFhq{'}\EFrdc{(}not . \EFrdd{(}elfeed-search-mode\EFrdd{)}\EFrdc{)}
   elfeed-summary--only-unread t
   elfeed-search-print-entry-function \EFhq{'}\EFhs{+rss/elfeed-search-print-entry}
   elfeed-search-title-min-width \EFhn{80}
   elfeed-show-entry-switch \EFhq{\#'}\EFhs{pop-to-buffer}
   elfeed-show-entry-delete \EFhq{\#'}\EFhs{+rss/delete-pane}
   elfeed-show-refresh-function \EFhq{\#'}\EFhs{+rss/elfeed-show-refresh--better-style}
   \EFv{shr-max-image-proportion} \EFhn{0.6}\EFrdb{)}


  \EFrdb{(}\EFk{defun} \EFf{elfeed-eb-garamond} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFo{buffer-face-set} \EFhq{'}\EFrdd{(}\EFb{:family} \EFs{"EB Garamond"} \EFb{:height} \EFhn{120}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{add-hook!} \EFhq{'}\EFhs{elfeed-show-mode-hook} \EFrdc{(}\EFv{hide-mode-line-mode} \EFhn{1}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{add-hook!} \EFhq{'}\EFhs{elfeed-show-mode-hook} \EFrdc{(}elfeed-eb-garamond\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{add-hook!} \EFhq{'}\EFhs{elfeed-search-update-hook} \EFhq{\#'}\EFv{hide-mode-line-mode}\EFrdb{)}

  \EFrdb{(}\EFk{defface} \EFv{elfeed-show-title-face} \EFhq{'}\EFrdc{(}\EFrdd{(}t \EFrda{(}\EFb{:weight} ultrabold \EFb{:slant} italic \EFb{:height} \EFhn{1.5}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFd{"title face in elfeed show buffer"}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}
  \EFrdb{(}\EFk{defface} \EFv{elfeed-show-author-face} \EFhq{`}\EFrdc{(}\EFrdd{(}t \EFrda{(}\EFb{:weight} light\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFd{"title face in elfeed show buffer"}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}
  \EFrdb{(}\EFo{set-face-attribute} \EFhq{'}\EFhs{elfeed-search-title-face} nil
                      \EFb{:foreground} \EFhq{'}\EFhs{nil}
                      \EFb{:weight} \EFhq{'}\EFhs{light}\EFrdb{)}

  \EFrdb{(}\EFk{defadvice!} +rss-elfeed-wrap-h-nicer \EFrdc{(}\EFrdc{)}
    \EFd{"Enhances an elfeed entry's readability by wrapping it to a width of}
\EFd{`}\textcolor[HTML]{a9a1e1}{fill-column}\EFd{' and centering it with `}\textcolor[HTML]{a9a1e1}{visual-fill-column-mode}\EFd{'."}
    \EFb{:override} \EFhq{\#'}\EFhs{+rss-elfeed-wrap-h}
    \EFrdc{(}\EFk{setq-local} \EFv{truncate-lines} nil
                \EFv{shr-width} \EFhn{120}
                visual-fill-column-center-text t
                \EFv{default-text-properties} \EFhq{'}\EFrdd{(}line-height \EFhn{1.1}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{inhibit-read-only} t\EFrda{)}
          \EFrda{(}\EFv{inhibit-modification-hooks} t\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{visual-fill-column-mode} nil\EFrdd{)}
      \EFrdd{(}\EFk{setq-local} \EFv{shr-current-font} \EFhq{'}\EFrda{(}\EFb{:family} \EFs{"Linux Libertine O"} \EFb{:height} \EFhn{1.2}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{set-buffer-modified-p} nil\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{+rss/elfeed-search-print-entry} \EFrdc{(}entry\EFrdc{)}
    \EFd{"Print ENTRY to the buffer."}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}elfeed-goodies/tag-column-width \EFhn{40}\EFrda{)}
           \EFrda{(}elfeed-goodies/feed-source-column-width \EFhn{30}\EFrda{)}
           \EFrda{(}title \EFrdb{(}\EFk{or} \EFrdc{(}elfeed-meta entry \EFb{:title}\EFrdc{)} \EFrdc{(}elfeed-entry-title entry\EFrdc{)} \EFs{""}\EFrdb{)}\EFrda{)}
           \EFrda{(}title-faces \EFrdb{(}elfeed-search--faces \EFrdc{(}elfeed-entry-tags entry\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}feed \EFrdb{(}elfeed-entry-feed entry\EFrdb{)}\EFrda{)}
           \EFrda{(}feed-title
            \EFrdb{(}\EFk{when} feed
              \EFrdc{(}\EFk{or} \EFrdd{(}elfeed-meta feed \EFb{:title}\EFrdd{)} \EFrdd{(}elfeed-feed-title feed\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}tags \EFrdb{(}\EFo{mapcar} \EFhq{\#'}\EFhs{symbol-name} \EFrdc{(}elfeed-entry-tags entry\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}tags-str \EFrdb{(}\EFo{concat} \EFrdc{(}\EFo{mapconcat} \EFhq{'}\EFhs{identity} tags \EFs{","}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}title-width \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{window-width}\EFrdc{)} elfeed-goodies/feed-source-column-width
                           elfeed-goodies/tag-column-width \EFhn{4}\EFrdb{)}\EFrda{)}

           \EFrda{(}tag-column \EFrdb{(}elfeed-format-column
                        tags-str \EFrdc{(}elfeed-clamp \EFrdd{(}\EFo{length} tags-str\EFrdd{)}
                                               elfeed-goodies/tag-column-width
                                               elfeed-goodies/tag-column-width\EFrdc{)}
                        \EFb{:left}\EFrdb{)}\EFrda{)}
           \EFrda{(}feed-column \EFrdb{(}elfeed-format-column
                         feed-title \EFrdc{(}elfeed-clamp elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width\EFrdc{)}
                         \EFb{:left}\EFrdb{)}\EFrda{)}\EFrdd{)}

                                        \EFcd{;}\EFc{(insert (propertize feed-column 'face 'elfeed-search-feed-face) " ")}
                                        \EFcd{;}\EFc{(insert (propertize tag-column 'face 'elfeed-search-tag-face) " ")}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFo{propertize} title \EFhq{'}\EFhs{face} title-faces \EFhq{'}\EFhs{kbd-help} title\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq-local} \EFv{line-spacing} \EFhn{0.2}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{+rss/elfeed-show-refresh--better-style} \EFrdc{(}\EFrdc{)}
    \EFd{"Update the buffer to match the selected entry, using a mail-style."}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}\EFv{inhibit-read-only} t\EFrda{)}
           \EFrda{(}title \EFrdb{(}elfeed-entry-title elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}date \EFrdb{(}\EFo{seconds-to-time} \EFrdc{(}elfeed-entry-date elfeed-show-entry\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}author \EFrdb{(}elfeed-meta elfeed-show-entry \EFb{:author}\EFrdb{)}\EFrda{)}
           \EFrda{(}link \EFrdb{(}elfeed-entry-link elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}tags \EFrdb{(}elfeed-entry-tags elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}tagsstr \EFrdb{(}\EFo{mapconcat} \EFhq{\#'}\EFhs{symbol-name} tags \EFs{", "}\EFrdb{)}\EFrda{)}
           \EFrda{(}nicedate \EFrdb{(}\EFo{format-time-string} \EFs{"\%a, \%e \%b \%Y \%T \%Z"} date\EFrdb{)}\EFrda{)}
           \EFrda{(}content \EFrdb{(}elfeed-deref \EFrdc{(}elfeed-entry-content elfeed-show-entry\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}type \EFrdb{(}elfeed-entry-content-type elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}feed \EFrdb{(}elfeed-entry-feed elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}feed-title \EFrdb{(}elfeed-feed-title feed\EFrdb{)}\EFrda{)}
           \EFrda{(}base \EFrdb{(}\EFk{and} feed \EFrdc{(}elfeed-compute-base \EFrdd{(}elfeed-feed-url feed\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{erase-buffer}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"\char92{}n"}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFo{format} \EFs{"\%s\char92{}n\char92{}n"} \EFrdb{(}\EFo{propertize} title \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-show-title-face}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFo{format} \EFs{"\%s\char92{}t"} \EFrdb{(}\EFo{propertize} feed-title \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-search-feed-face}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFk{and} author elfeed-show-entry-author\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{format} \EFs{"\%s\char92{}n"} \EFrdc{(}\EFo{propertize} author \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-show-author-face}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFo{format} \EFs{"\%s\char92{}n\char92{}n"} \EFrdb{(}\EFo{propertize} nicedate \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-log-date-face}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} tags
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{format} \EFs{"\%s\char92{}n"}
                        \EFrdc{(}\EFo{propertize} tagsstr \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-search-tag-face}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFcd{;;} \EFc{(insert (propertize "Link: " 'face 'message-header-name))}
      \EFcd{;;} \EFc{(elfeed-insert-link link link)}
      \EFcd{;;} \EFc{(insert "\char92{}n")}
      \EFrdd{(}\EFk{cl-loop} for enclosure in \EFrda{(}elfeed-entry-enclosures elfeed-show-entry\EFrda{)}
               do \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{propertize} \EFs{"Enclosure: "} \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{message-header-name}\EFrdb{)}\EFrda{)}
               do \EFrda{(}elfeed-insert-link \EFrdb{(}\EFo{car} enclosure\EFrdb{)}\EFrda{)}
               do \EFrda{(}\EFo{insert} \EFs{"\char92{}n"}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"\char92{}n"}\EFrdd{)}
      \EFrdd{(}\EFk{if} content
          \EFrda{(}\EFk{if} \EFrdb{(}\EFo{eq} type \EFhq{'}\EFhs{html}\EFrdb{)}
              \EFrdb{(}elfeed-insert-html content base\EFrdb{)}
            \EFrdb{(}\EFo{insert} content\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{propertize} \EFs{"(empty)\char92{}n"} \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{italic}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defface} \EFv{elfeed-youtube}
    \EFhq{'}\EFrdc{(}\EFrdd{(}t \EFb{:foreground} \EFs{"purple"}\EFrdd{)}\EFrdc{)}
    \EFd{"Marks YouTube videos in Elfeed."}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}

  \EFrdb{(}\EFk{defface} \EFv{elfeed-religion}
    \EFhq{'}\EFrdc{(}\EFrdd{(}t \EFb{:foreground} \EFs{"gold"}\EFrdd{)}\EFrdc{)}
    \EFd{"Marks YouTube videos in Elfeed."}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}

  \EFrdb{(}\EFk{defface} \EFv{elfeed-tech}
    \EFhq{'}\EFrdc{(}\EFrdd{(}t \EFb{:foreground} \EFs{"LightSteelBlue4"}\EFrdd{)}\EFrdc{)}
    \EFd{"Marks Tech videos in Elfeed."}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}

  \EFrdb{(}\EFk{push} \EFhq{'}\EFrdc{(}youtube elfeed-youtube\EFrdc{)}
        elfeed-search-face-alist\EFrdb{)}
  \EFrdb{(}\EFk{push} \EFhq{'}\EFrdc{(}religion elfeed-religion\EFrdc{)}
        elfeed-search-face-alist\EFrdb{)}
  \EFrdb{(}\EFk{push} \EFhq{'}\EFrdc{(}tech elfeed-tech\EFrdc{)}
        elfeed-search-face-alist\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{after!} elfeed-show
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{url}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{elfeed-show-download-enclosure} \EFrdc{(}\EFrdc{)}
    \EFd{"Download the enclosure to yt-dlp directory"}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{let*}
        \EFrdd{(}\EFrda{(}url-enclosure \EFrdb{(}\EFo{car} \EFrdc{(}\EFo{elt} \EFrdd{(}elfeed-entry-enclosures elfeed-show-entry\EFrdd{)} \EFhn{0}\EFrdc{)}\EFrdb{)}\EFrda{)}
         \EFrda{(}filename \EFrdb{(}\EFo{concat} elfeed-enclosure-default-dir \EFs{"/"} \EFrdc{(}elfeed-entry-title elfeed-show-entry\EFrdc{)} \EFs{".mp3"}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}elfeed--download-enclosure url-enclosure filename\EFrdd{)}
      \EFrdd{(}\EFo{message} \EFrda{(}\EFo{format} \EFs{"Downloading \%s"} filename\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defvar} \EFv{elfeed-pdf-dir}
    \EFrdc{(}\EFo{expand-file-name} \EFs{"pdfs/"}
                      \EFrdd{(}\EFo{file-name-directory} \EFrda{(}\EFo{directory-file-name} elfeed-enclosure-default-dir\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defvar} \EFv{elfeed-link-pdfs}
    \EFhq{'}\EFrdc{(}\EFrdd{(}\EFs{"https://www.jstatsoft.org/index.php/jss/article/view/v0}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{/]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} . \EFs{"https://www.jstatsoft.org/index.php/jss/article/view/v0\char92{}\char92{}1/v\char92{}\char92{}1.pdf"}\EFrdd{)}
      \EFrdd{(}\EFs{"http://arxiv.org/abs/}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{/]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} . \EFs{"https://arxiv.org/pdf/\char92{}\char92{}1.pdf"}\EFrdd{)}\EFrdc{)}
    \EFd{"List of alists of the form (REGEX-FOR-LINK . FORM-FOR-PDF)"}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{elfeed-show-pdf} \EFrdc{(}entry\EFrdc{)}
    \EFrdc{(}\EFk{interactive}
     \EFrdd{(}\EFo{list} \EFrda{(}\EFk{or} elfeed-show-entry \EFrdb{(}elfeed-search-selected \EFb{:ignore-region}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}link \EFrdb{(}elfeed-entry-link entry\EFrdb{)}\EFrda{)}
          \EFrda{(}feed-name \EFrdb{(}\EFo{plist-get} \EFrdc{(}elfeed-feed-meta \EFrdd{(}elfeed-entry-feed entry\EFrdd{)}\EFrdc{)} \EFb{:title}\EFrdb{)}\EFrda{)}
          \EFrda{(}title \EFrdb{(}elfeed-entry-title entry\EFrdb{)}\EFrda{)}
          \EFrda{(}file-view-function
           \EFrdb{(}\EFk{lambda} \EFrdc{(}f\EFrdc{)}
             \EFrdc{(}\EFk{when} elfeed-show-entry
               \EFrdd{(}elfeed-kill-buffer\EFrdd{)}\EFrdc{)}
             \EFrdc{(}\EFo{pop-to-buffer} \EFrdd{(}\EFo{find-file-noselect} f\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
          pdf\EFrdd{)}

      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}file \EFrdc{(}\EFo{expand-file-name}
                   \EFrdd{(}\EFo{concat} \EFrda{(}\EFo{subst-char-in-string} ?/ ?, title\EFrda{)} \EFs{".pdf"}\EFrdd{)}
                   \EFrdd{(}\EFo{expand-file-name} \EFrda{(}\EFo{subst-char-in-string} ?/ ?, feed-name\EFrda{)}
                                     elfeed-pdf-dir\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFo{file-exists-p} file\EFrdb{)}
            \EFrdb{(}\EFo{funcall} file-view-function file\EFrdb{)}
          \EFrdb{(}\EFk{dolist} \EFrdc{(}link-pdf elfeed-link-pdfs\EFrdc{)}
            \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{and} \EFrda{(}\EFf{string-match-p} \EFrdb{(}\EFo{car} link-pdf\EFrdb{)} link\EFrda{)}
                       \EFrda{(}\EFo{not} pdf\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFk{setq} pdf \EFrda{(}\EFo{replace-regexp-in-string} \EFrdb{(}\EFo{car} link-pdf\EFrdb{)} \EFrdb{(}\EFo{cdr} link-pdf\EFrdb{)} link\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{not} pdf\EFrdc{)}
              \EFrdc{(}\EFo{message} \EFs{"No associated PDF for entry"}\EFrdc{)}
            \EFrdc{(}\EFo{message} \EFs{"Fetching \%s"} pdf\EFrdc{)}
            \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{file-exists-p} \EFrda{(}\EFo{file-name-directory} file\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFo{make-directory} \EFrda{(}\EFo{file-name-directory} file\EFrda{)} t\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{url-copy-file} pdf file\EFrdc{)}
            \EFrdc{(}\EFo{funcall} file-view-function file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrda{)}

\EFrda{(}\EFk{after!} elfeed-summary
  \EFrdb{(}\EFf{elfeed-org}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-summary-save} \EFrdb{(}\EFrdb{)}
  \EFd{"Save database"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}elfeed-db-save-safe\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-save-summary} \EFrdb{(}\EFrdb{)}
  \EFd{"Save database and go to summary"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}elfeed-db-save-safe\EFrdb{)}
  \EFcd{;}\EFc{(kill-this-buffer)}
  \EFrdb{(}\EFf{elfeed-summary}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{boundp} \EFhq{'}\EFhs{elfeed-summary--current-pos}\EFrdc{)}
    \EFrdc{(}\EFo{set-window-point} \EFrdd{(}\EFo{get-buffer-window} \EFs{"*elfeed-summary*"}\EFrdd{)} elfeed-summary--current-pos\EFrdc{)}
        \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-save-close} \EFrdb{(}\EFrdb{)}
  \EFd{"Save database and close rss"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}elfeed-db-save-safe\EFrdb{)}
  \EFrdb{(}\EFf{+rss/delete-pane}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-load-summary} \EFrdb{(}\EFrdb{)}
  \EFd{"Load database and go to summary"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{functionp} \EFhq{'}\EFhs{elfeed-db-load}\EFrdd{)} \EFrdd{(}\EFo{not} \EFrda{(}\EFo{get-buffer} \EFs{"*elfeed-summary*"}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{make-thread} \EFrdd{(}elfeed-db-load\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFf{elfeed-summary}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{boundp} \EFhq{'}\EFhs{elfeed-summary--current-pos}\EFrdc{)}
    \EFrdc{(}\EFk{progn}
      \EFrdd{(}\EFo{set-window-point} \EFrda{(}\EFo{get-buffer-window} \EFs{"*elfeed-summary*"}\EFrda{)} elfeed-summary--current-pos\EFrdd{)}
      \EFrdd{(}\EFo{recenter-top-bottom}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFf{buf-move-up}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-summary-load-update} \EFrdb{(}\EFrdb{)}
  \EFd{"Loads the database again before updating"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}elfeed-db-load\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFs{"Refreshing db..."}\EFrdb{)}
  \EFrdb{(}\EFf{ap/elfeed-search-update-save-filter}\EFrdb{)}
  \EFrdb{(}\EFf{elfeed-update}\EFrdb{)}
  \EFrda{)}

                                        \EFcd{;} \EFc{Workaround for slowness while updating. See}
                                        \EFcd{;} \EFc{https://github.com/skeeto/elfeed/issues/293}

\EFrda{(}\EFk{defvar} \EFv{ap/elfeed-update-complete-hook} nil
  \EFd{"Functions called with no arguments when `}\textcolor[HTML]{a9a1e1}{elfeed-update}\EFd{' is finished."}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{ap/elfeed-updates-in-progress} \EFhn{0}
  \EFd{"Number of feed updates in-progress."}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{ap/elfeed-search-update-filter} nil
  \EFd{"The filter when `}\textcolor[HTML]{a9a1e1}{elfeed-update}\EFd{' is called."}\EFrda{)}

\EFrda{(}\EFk{defun} \EFv{ap/elfeed-update-complete-hook} \EFrdb{(}\EFt{\&rest} ignore\EFrdb{)}
  \EFd{"When update queue is empty, run `}\textcolor[HTML]{a9a1e1}{ap/elfeed-update-complete-hook}\EFd{' functions."}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{=} \EFhn{0} \EFv{ap/elfeed-updates-in-progress}\EFrdc{)}
    \EFrdc{(}\EFo{run-hooks} \EFhq{'}\EFv{ap/elfeed-update-complete-hook}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFhs{elfeed-update-hooks} \EFhq{\#'}\EFv{ap/elfeed-update-complete-hook}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ap/elfeed-update-message-completed} \EFrdb{(}\EFt{\&rest} \_ignore\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFs{"Feeds updated"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{ap/elfeed-update-complete-hook} \EFhq{\#'}\EFhs{ap/elfeed-update-message-completed}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ap/elfeed-search-update-restore-filter} \EFrdb{(}\EFt{\&rest} ignore\EFrdb{)}
  \EFd{"Restore filter after feeds update."}
  \EFrdb{(}\EFk{when} \EFv{ap/elfeed-search-update-filter}
    \EFrdc{(}elfeed-search-set-filter \EFv{ap/elfeed-search-update-filter}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{ap/elfeed-search-update-filter} nil\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{ap/elfeed-update-complete-hook} \EFhq{\#'}\EFhs{ap/elfeed-search-update-restore-filter}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ap/elfeed-search-update-save-filter} \EFrdb{(}\EFt{\&rest} ignore\EFrdb{)}
  \EFd{"Save and change the filter while updating."}
  \EFrdb{(}\EFk{setq} \EFv{ap/elfeed-search-update-filter} elfeed-search-filter\EFrdb{)}
  \EFrdb{(}\EFk{setq} elfeed-search-filter \EFs{"\#0"}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{ap/elfeed-update-counter-inc} \EFrdb{(}\EFt{\&rest} ignore\EFrdb{)}
  \EFrdb{(}\EFk{cl-incf} \EFv{ap/elfeed-updates-in-progress}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{advice-add} \EFhq{\#'}\EFhs{elfeed-update-feed} \EFb{:before} \EFhq{\#'}\EFhs{ap/elfeed-update-counter-inc}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ap/elfeed-update-counter-dec} \EFrdb{(}\EFt{\&rest} ignore\EFrdb{)}
  \EFrdb{(}\EFk{cl-decf} \EFv{ap/elfeed-updates-in-progress}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{<} \EFv{ap/elfeed-updates-in-progress} \EFhn{0}\EFrdc{)}
    \EFcd{;;} \EFc{Just in case}
    \EFrdc{(}\EFk{setq} \EFv{ap/elfeed-updates-in-progress} \EFhn{0}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFhs{elfeed-update-hooks} \EFhq{\#'}\EFhs{ap/elfeed-update-counter-dec}\EFrda{)}

\EFrda{(}\EFk{setq} elfeed-summary-settings
      \EFhq{'}\EFrdb{(}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Blogs [Security]"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . \EFrdb{(}\EFk{and} people security\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Blogs [People]"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . \EFrdb{(}\EFk{and} people \EFrdc{(}\EFo{not} security\EFrdc{)}\EFrdb{)}\EFrda{)}
                \EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Religion"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . religion\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Cooking"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . cooking\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"ASMR"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . asmr\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Crafting"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . crafting\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Entertainment"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . entertainment\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Finances"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . finances\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Foreign Places"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . foreign\_places\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Geography"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . geography\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"History"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . history\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Language"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . language\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Math"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . music\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Nature"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . nature\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Philosophy"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . philosophy\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Politics"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . politics\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Science"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . science\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"SCP"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . scp\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Tech"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . tech\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Podcasts"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . podcast\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Pictures"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . picture\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFcd{;;} \EFc{...}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Miscellaneous"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                                        \EFcd{;}\EFc{(group}
                                        \EFcd{;} \EFc{(:title . "Searches")}
                                        \EFcd{;} \EFc{(:elements}
                                        \EFcd{;}  \EFc{(search}
                                        \EFcd{;}   \EFc{(:filter . "@6-months-ago")}
                                        \EFcd{;}   \EFc{(:title . "Unread"))))}
                \EFrda{(}group
                 \EFrdb{(}\EFb{:title} . \EFs{"Ungrouped"}\EFrdb{)}
                 \EFrdb{(}\EFb{:elements} \EFb{:misc}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-e"}\EFrdb{)} \EFhq{'}\EFhs{elfeed-load-summary}\EFrda{)}

                                        \EFcd{;} \EFc{Elfeed Youtube}

                                        \EFcd{;} \EFc{External youtube-dl library}
\EFrda{(}\EFk{when} \EFrdb{(}\EFo{not} \EFrdc{(}\EFo{boundp} \EFhq{'}\EFv{youtube-dl-arguments}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{youtube-dl-arguments} \EFhq{'}\EFrdc{(}\EFrdc{)}\EFrdb{)}
  \EFrda{)}
\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.doom.d/lisp/youtube-dl-emacs"}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{youtube-dl}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{youtube-dl-4k} nil \EFd{"Whether to download in 4k"}\EFrda{)}
                                        \EFcd{;}\EFc{(when (string= (getenv "XFT\_DPI") "192")}
                                        \EFcd{;}  \EFc{(setq youtube-dl-4k t))}

\EFrda{(}\EFk{if} \EFv{youtube-dl-4k}
    \EFrdb{(}\EFk{setq} youtube-dl-format-string \EFs{"bestvideo+bestaudio"}\EFrdb{)}
  \EFrdb{(}\EFk{setq} youtube-dl-format-string \EFs{"bestvideo[height<=1080]+bestaudio/best[height<=1080]"}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{setq} \EFv{youtube-dl-directory} \EFs{"\char126{}/elfeed-youtube"}
      elfeed-enclosure-default-dir \EFv{youtube-dl-directory}
      youtube-dl-temp-directory \EFs{"/tmp/elfeed-youtube"}
      \EFv{youtube-dl-program} \EFs{"yt-dlp"}
      \EFv{youtube-dl-arguments} \EFrdb{(}\EFo{nconc} \EFhq{`}\EFrdc{(}\EFs{"-f"} ,youtube-dl-format-string
                                    \EFs{"--sponsorblock-remove"} \EFs{"default"}
                                    \EFs{"--prefer-free-formats"}
                                    \EFs{"--embed-subs"}
                                    \EFs{"--embed-metadata"}
                                    \EFs{"--embed-chapters"}
                                    \EFs{"--ffmpeg-location"} \EFs{"/home/user/.doom.d/ext/bin/"}
                                    \EFs{"--no-colors"}\EFrdc{)}
                                  \EFv{youtube-dl-arguments}\EFrdb{)}\EFrda{)}
                                        \EFcd{;} \EFc{(setq youtube-dl-arguments nil)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-v"}\EFrdb{)} \EFhq{'}\EFhs{open-yt-dl-videos}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-V"}\EFrdb{)} \EFhq{'}\EFhs{open-yt-dl-temp-videos}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{open-yt-dl-videos} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFv{youtube-dl-directory}\EFrdb{)}
  \EFrdb{(}\EFv{dired-hide-details-mode}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{open-yt-dl-temp-videos} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} youtube-dl-temp-directory\EFrdb{)}
  \EFrdb{(}\EFv{dired-hide-details-mode}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{cl-defun} \EFf{elfeed-show-youtube-dl} \EFrdb{(}\EFt{\&key} slow\EFrdb{)}
  \EFd{"Download the current entry with youtube-dl."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{null} \EFrdd{(}\EFf{youtube-dl} \EFrda{(}elfeed-entry-link elfeed-show-entry\EFrda{)}
                        \EFb{:title} \EFrda{(}elfeed-entry-title elfeed-show-entry\EFrda{)}
                        \EFb{:slow} slow\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFo{message} \EFs{"Entry is not a YouTube link!"}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFs{"Downloading \%s"} \EFrdd{(}elfeed-entry-title elfeed-show-entry\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{cl-defun} \EFf{elfeed-search-youtube-dl} \EFrdb{(}\EFt{\&key} slow\EFrdb{)}
  \EFd{"Download the current entry with youtube-dl."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}entries \EFrda{(}elfeed-search-selected\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}entry entries\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{null} \EFrdb{(}\EFf{youtube-dl} \EFrdc{(}elfeed-entry-link entry\EFrdc{)}
                            \EFb{:title} \EFrdc{(}elfeed-entry-title entry\EFrdc{)}
                            \EFb{:slow} slow\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{message} \EFs{"Entry is not a YouTube link!"}\EFrda{)}
        \EFrda{(}\EFo{message} \EFs{"Downloading \%s"} \EFrdb{(}elfeed-entry-title entry\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}elfeed-untag entry \EFhq{'}\EFhs{unread}\EFrdd{)}
      \EFrdd{(}elfeed-search-update-entry entry\EFrdd{)}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFo{use-region-p}\EFrda{)} \EFrda{(}\EFo{forward-line}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{youtube-dl-list-url} \EFrdb{(}\EFrdb{)}
  \EFd{"Return url of item under point."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}n \EFrda{(}\EFo{1-} \EFrdb{(}\EFo{line-number-at-pos}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}item \EFrda{(}\EFo{nth} n \EFv{youtube-dl-items}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} item
      \EFrdd{(}\EFo{message} \EFrda{(}\EFf{youtube-dl-item-destination} item\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                                        \EFcd{;} \EFc{Faces}

\EFrda{(}\EFk{defun} \EFf{elfeed-summary-action-save-location} \EFrdb{(}pos \EFt{\&optional} event\EFrdb{)}
  \EFrdb{(}\EFk{interactive} \EFs{"@d"}\EFrdb{)}
  \EFrdb{(}\EFk{setq} elfeed-summary--current-pos pos\EFrdb{)}
  \EFrdb{(}elfeed-summary--action pos event\EFrdb{)}
  \EFrda{)}
\EFrda{(}\EFk{defun} \EFf{image-shrink} \EFrdb{(}img-path dimensions callback\EFrdb{)}
  \EFd{"Shrink an image to dimensions (string '}\textcolor[HTML]{a9a1e1}{WxH}\EFd{') aync, then execute callback"}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}output-path \EFrda{(}\EFo{s-replace} \EFs{".jpg"} \EFs{".small.jpg"} img-path\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{file-exists-p} output-path\EFrdd{)}
        \EFrdd{(}\EFo{funcall} callback output-path\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}process
             \EFrdc{(}\EFo{start-process} \EFs{"image-shrinking-proc"} \EFs{"*img-shrnk-buf*"} \EFs{"convert"} img-path \EFs{"-resize"} dimensions output-path\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{set-process-sentinel} process \EFrdb{(}\EFk{lambda} \EFrdc{(}\_process \_event\EFrdc{)} \EFrdc{(}\EFo{funcall} callback output-path\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{get-max-minibuffer-height-px} \EFrdb{(}\EFrdb{)}
  \EFd{"Return maximum height of echo area and minibuffer in pixels"}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{floatp} \EFv{max-mini-window-height}\EFrdc{)} \EFcd{;}\EFc{height is percentage of frame height if float, else number of lines}
      \EFrdc{(}\EFo{truncate} \EFrdd{(}\EFo{*} \EFv{max-mini-window-height} \EFrda{(}\EFo{frame-pixel-height}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{*} \EFv{max-mini-window-height} \EFrdd{(}\EFo{frame-char-height}\EFrdd{)}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{image-popup} \EFrdb{(}img-path\EFrdb{)}
  \EFd{"Display image at output-path as popup"}
  \EFrdb{(}\EFv{tooltip-mode} \EFhn{1}\EFrdb{)} \EFcd{;;} \EFc{tooltip-show doesn't always work}
  \EFrdb{(}\EFf{image-shrink} img-path \EFrdc{(}\EFo{format} \EFs{"x\%s"} \EFrdd{(}\EFf{get-max-minibuffer-height-px}\EFrdd{)}\EFrdc{)}
                \EFhq{'}\EFrdc{(}lambda \EFrdd{(}img-path\EFrdd{)} \EFrdd{(}\EFo{message}
                                     \EFrda{(}\EFo{propertize} \EFs{"Look in minbuffer"}
                                                 \EFhq{'}\EFhs{display} \EFrdb{(}\EFo{create-image} img-path\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
                \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-search-thumbnail} \EFrdb{(}\EFrdb{)}
  \EFd{"Display the thumbnail of the currently selected video"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mkdir} elfeed-thumbnail-dir t\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}buffer \EFrda{(}\EFo{current-buffer}\EFrda{)}\EFrdd{)}
        \EFrdd{(}entries \EFrda{(}elfeed-search-selected\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{cl-loop} for entry in entries
             when \EFrdd{(}elfeed-entry-link entry\EFrdd{)}
             do \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}title \EFrdc{(}\EFo{concat} elfeed-thumbnail-dir \EFrdd{(}\EFo{secure-hash} \EFhq{'}\EFhs{sha224} \EFrda{(}elfeed-entry-title entry\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
                       \EFrdb{(}img-path \EFrdc{(}\EFo{concat} title \EFs{".jpg"}\EFrdc{)}\EFrdb{)}
                       \EFrdb{(}callback \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFt{\&rest} \_args\EFrdd{)} \EFrdd{(}\EFf{image-popup} img-path\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFk{if} \EFrdb{(}\EFo{file-exists-p} img-path\EFrdb{)}
                      \EFrdb{(}\EFo{funcall} callback\EFrdb{)}
                    \EFrdb{(}\EFf{youtube-dl-get-video-thumbnail} it title callback\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} buffer
      \EFrdd{(}\EFo{mapc} \EFhq{\#'}\EFhs{elfeed-search-update-entry} entries\EFrdd{)}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFk{or} elfeed-search-remain-on-entry \EFrdb{(}\EFo{use-region-p}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-wget-url} \EFrdb{(}\EFrdb{)}
  \EFd{"Wgets URL at point to elfeed video dir"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}url \EFrda{(}\EFo{shr-url-at-point} \EFv{current-prefix-arg}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{display-buffer-alist} \EFhq{'}\EFrdd{(}\EFs{"*Async Shell Command*"} display-buffer-no-window \EFrda{(}nil\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{async-shell-command} \EFrdd{(}\EFo{concat} \EFs{"wget -O "} \EFv{youtube-dl-directory} \EFs{"/\char92{}""} \EFrda{(}elfeed-entry-title elfeed-show-entry\EFrda{)} \EFs{"\char92{}".mp3 "} url\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{youtube-dl-move-temp} \EFrdb{(}\EFrdb{)}
  \EFd{"Moves content of elfeed video dir to temporary location"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mkdir} youtube-dl-temp-directory t\EFrdb{)}
  \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{display-buffer-alist} \EFhq{'}\EFrdc{(}\EFs{"*Async Shell Command*"} display-buffer-no-window \EFrdd{(}nil\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{async-shell-command} \EFrdc{(}\EFo{concat} \EFs{"mv "} \EFv{youtube-dl-directory} \EFs{"/* "} youtube-dl-temp-directory \EFs{"/"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{youtube-dl-failures-reset} \EFrdb{(}item\EFrdb{)}
  \EFd{"Reset failures."}
  \EFrdb{(}\EFk{interactive}
   \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}n \EFrdb{(}\EFo{1-} \EFrdc{(}\EFo{line-number-at-pos}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
     \EFrdd{(}\EFo{list} \EFrda{(}\EFo{nth} n \EFv{youtube-dl-items}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} item
    \EFrdc{(}\EFk{setf} \EFrdd{(}\EFf{youtube-dl-item-failures} item\EFrdd{)} \EFhn{0}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFf{youtube-dl--redisplay}\EFrdb{)}
  \EFrdb{(}\EFf{youtube-dl--run}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} elfeed-tube
  \EFb{:after} elfeed
  \EFb{:demand} t
  \EFb{:config}
  \EFcd{;;} \EFc{(setq elfeed-tube-auto-save-p nil) ; default value}
  \EFcd{;;} \EFc{(setq elfeed-tube-auto-fetch-p t)  ; default value}
  \EFrdb{(}elfeed-tube-setup\EFrdb{)}

  \EFb{:bind} \EFrdb{(}\EFb{:map} elfeed-show-mode-map
         \EFrdc{(}\EFs{"F"} . elfeed-tube-fetch\EFrdc{)}
         \EFrdc{(}\EFrdd{[}remap save-buffer\EFrdd{]} . elfeed-tube-save\EFrdc{)}
         \EFb{:map} elfeed-search-mode-map
         \EFrdc{(}\EFs{"F"} . elfeed-tube-fetch\EFrdc{)}
         \EFrdc{(}\EFrdd{[}remap save-buffer\EFrdd{]} . elfeed-tube-save\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} elfeed-tube-mpv
  \EFb{:bind}
  \EFrdb{(}\EFs{"C-c C-f"} . elfeed-tube-mpv-follow-mode\EFrdb{)}
  \EFrdb{(}\EFs{"C-c C-w"} . elfeed-tube-mpv-where\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} elfeed-tube-captions-languages \EFhq{'}\EFrdb{(}\EFs{"en"} \EFs{"de"} \EFs{"la"} \EFs{"english (auto generated)"} \EFs{"german (auto generated)"}\EFrdb{)}
      elfeed-tube-captions-chunk-time \EFhn{60}
      elfeed-tube-thumbnail-size \EFhq{'}\EFhs{large}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-tube-mpv-open} \EFrdb{(}\EFrdb{)}
  \EFd{"Opens selected elfeed tube feed in mpv and activates follow mode"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFf{elfeed-tube-mpv-follow-mode} \EFhn{1}\EFrdb{)}
  \EFrdb{(}\EFf{elfeed-tube-mpv} \EFrdc{(}\EFo{point}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{add-hook!} \EFhq{'}\EFhs{elfeed-show-mode-hook} \EFrdb{(}\EFf{elfeed-tube-mpv-follow-mode} \EFhn{1}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFf{set-popup-rule!} \EFs{"\char94{}\char92{}\char92{}*elfeed"} \EFb{:side} \EFhq{'}\EFhs{left} \EFb{:size} \EFrdb{(}\EFo{/} \EFhn{1.0} \EFhn{3}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{elfeed-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Async Update Script}
\label{sec:orga07d816}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{setq} \EFv{doom-private-dir} \EFs{"\char126{}/.doom.d/"}\EFrda{)}

\EFrda{(}\EFk{setq} rmh-elfeed-org-files \EFrdb{(}\EFo{cons} \EFrdc{(}\EFo{expand-file-name} \EFs{"ext/elfeed/elfeed.org"} \EFv{doom-private-dir}\EFrdc{)}\EFrdc{(}\EFrdc{)}\EFrdb{)}
      elfeed-db-directory \EFrdb{(}\EFo{expand-file-name} \EFs{"ext/elfeed/db/"} \EFv{doom-private-dir}\EFrdb{)}
      elfeed-thumbnail-dir \EFs{"/tmp/elfeed-thumbnails/"}\EFrda{)}

\EFrda{(}\EFo{message} \EFs{"Elfeed-update: \%s"}
         \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.emacs.d/.local/straight/repos/elfeed/"}\EFrdb{)}
         \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.emacs.d/.local/straight/repos/elfeed-summary/"}\EFrdb{)}
         \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.emacs.d/.local/straight/repos/elfeed-org/"}\EFrdb{)}
         \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.emacs.d/.local/straight/repos/dash.el/"}\EFrdb{)}
         \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.emacs.d/.local/straight/repos/s.el/"}\EFrdb{)}
         \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.emacs.d/.local/straight/repos/magit/lisp/"}\EFrdb{)}
         \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.emacs.d/.local/straight/repos/compat/"}\EFrdb{)}
         \EFrdb{(}\EFo{require} \EFhq{'}\EFo{elfeed}\EFrdb{)}
         \EFrdb{(}\EFo{require} \EFhq{'}\EFo{elfeed-summary}\EFrdb{)}
         \EFrdb{(}\EFo{require} \EFhq{'}\EFo{elfeed-org}\EFrdb{)}
         \EFrdb{(}\EFf{elfeed-org}\EFrdb{)}
         \EFrdb{(}elfeed-db-load\EFrdb{)}
         \EFrdb{(}\EFf{elfeed-update}\EFrdb{)}
         \EFrdb{(}elfeed-summary-update\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{defun} \EFf{elfeed-summary-load-async-update} \EFrdb{(}\EFrdb{)}
  \EFd{"Asynchronously update the database, load it and update summary buffer."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{async-start-process} \EFs{"Elfeed Update"} \EFs{"emacs"} \EFhq{'}\EFrdc{(}lambda \EFrdd{(}name\EFrdd{)}
                                                  \EFrdd{(}elfeed-db-load\EFrdd{)}
                                        \EFcd{;}\EFc{(elfeed-summary-update)}
                                                  \EFrdd{(}\EFo{message} \EFs{"-> \%s completed!"} name\EFrdd{)}\EFrdc{)}
                       \EFs{"--script"} \EFrdc{(}\EFo{concat} \EFv{doom-user-dir} \EFs{"ext/elfeed/update.el"}\EFrdc{)}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Interface}
\label{sec:org38b0c2b}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{interface}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgb34c1c8}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} xclip\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org1e78471}
\paragraph{General settings}
\label{sec:orgc4d73e8}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{setq-default}
 \EFv{x-stretch-cursor} t\EFrda{)}
\EFrda{(}\EFv{xclip-mode} t\EFrda{)}
\EFrda{(}\EFv{good-scroll-mode} \EFhn{-1}\EFrda{)}
\EFrda{(}\EFk{setq-default} \EFv{word-wrap} t\EFrda{)}
\EFrda{(}\EFv{context-menu-mode} t\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{undo-limit} \EFhn{80000000}                         \EFcd{;} \EFc{Raise undo-limit to 80Mb}
      \EFv{evil-want-fine-undo} t                       \EFcd{;} \EFc{By default while in insert all changes are one big blob. Be more granular}
      \EFv{truncate-string-ellipsis} \EFs{""}                \EFcd{;} \EFc{Unicode ellispis are nicer than "...", and also save /precious/ space}
      \EFv{password-cache-expiry} nil                   \EFcd{;} \EFc{I can trust my computers ... can't I?}
      \EFv{scroll-margin} \EFhn{2}\EFrda{)}                            \EFcd{;} \EFc{It's nice to maintain a little margin}

\EFrda{(}\EFk{setq} \EFv{display-time-day-and-date} t
      \EFv{display-time-24hr-format} t\EFrda{)}
      \EFrda{(}\EFv{display-time-mode} \EFhn{0}\EFrda{)}                             \EFcd{;} \EFc{Enable time in the mode-line}
      \EFrda{(}\EFv{display-battery-mode} \EFhn{0}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Font}
\label{sec:org53eeb68}
\begin{Code}
\begin{Verbatim}
\color{EFD}
\EFcd{;;;} \EFc{Unicode emojis}
\EFrda{(}\EFk{if} \EFrdb{(}\EFo{>=} \EFv{emacs-major-version} \EFhn{27}\EFrdb{)}
    \EFrdb{(}\EFk{progn}
      \EFrdc{(}\EFv{emojify-mode} nil\EFrdc{)}
    \EFrdc{(}\EFo{set-fontset-font} t \EFhq{'}\EFrdd{(}\EFhn{\#x1f000} . \EFhn{\#x1faff}\EFrdd{)}
                      \EFrdd{(}\EFo{font-spec} \EFb{:family} \EFs{"Apple Color Emoji"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{set-face-attribute}
 \EFhq{'}\EFhs{default} nil \EFb{:stipple} nil \EFb{:height} \EFhn{100} \EFb{:width} \EFhq{'}\EFhs{normal} \EFb{:inverse-video} nil \EFb{:box} nil \EFb{:strike-through} nil \EFb{:overline} nil \EFb{:underline} nil \EFb{:slant} \EFhq{'}\EFhs{normal} \EFb{:weight} \EFhq{'}\EFhs{normal} \EFb{:foundry} \EFs{"outline"} \EFb{:family} \EFs{"Source Code Pro for Powerline"}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{font-garamond} nil \EFd{"Whether EB Garamond font is used"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{toggle-font-eb-garamond} \EFrdb{(}\EFrdb{)}
  \EFd{"Set font to EB Garamond"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{font-garamond} \EFrdc{(}\EFo{not} \EFv{font-garamond}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFv{font-garamond}
    \EFrdc{(}\EFo{set-face-attribute}
 \EFhq{'}\EFhs{default} nil \EFb{:stipple} nil \EFb{:height} \EFhn{100} \EFb{:width} \EFhq{'}\EFhs{normal} \EFb{:inverse-video} nil \EFb{:box} nil \EFb{:strike-through} nil \EFb{:overline} nil \EFb{:underline} nil \EFb{:slant} \EFhq{'}\EFhs{normal} \EFb{:weight} \EFhq{'}\EFhs{normal} \EFb{:foundry} \EFs{"outline"} \EFb{:family} \EFs{"EB Garamond"}\EFrdc{)}
\EFrdc{(}\EFo{set-face-attribute}
 \EFhq{'}\EFhs{default} nil \EFb{:stipple} nil \EFb{:height} \EFhn{100} \EFb{:width} \EFhq{'}\EFhs{normal} \EFb{:inverse-video} nil \EFb{:box} nil \EFb{:strike-through} nil \EFb{:overline} nil \EFb{:underline} nil \EFb{:slant} \EFhq{'}\EFhs{normal} \EFb{:weight} \EFhq{'}\EFhs{normal} \EFb{:foundry} \EFs{"outline"} \EFb{:family} \EFs{"Source Code Pro for Powerline"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{set-fontset-font} \EFs{"fontset-default"} \EFhq{'}\EFhs{tagalog} \EFrdb{(}\EFo{font-spec} \EFb{:family} \EFs{"Noto Sans Tagalog"}\EFrdb{)}\EFrda{)}


\EFcd{;;;;} \EFc{setting up composition functions for emoji modifiers}
\EFcd{;;}\EFc{(dolist (items `(((? . ?) [".[-]+" 0 font-shape-gstring])}
\EFcd{;}                 \EFc{((? . ?) [".[-]*" 0 font-shape-gstring])}
\EFcd{;}                 \EFc{(? ["[\#*0-9]" 2 font-shape-gstring])}
\EFcd{;}                 \EFc{;;} \textcolor[HTML]{ECBE7B}{\textbf{TODO:}} \EFc{I can't make keycap sequences work because I}
\EFcd{;}                 \EFc{;; think they're trying to shape with the wrong font.}
\EFcd{;}                 \EFc{,@(mapcar (lambda (range) (list range [".?[-]?[]*?" 0 font-shape-gstring]))}
\EFcd{;}                           \EFc{(concatenate 'list ""}
\EFcd{;}                                        \EFc{'((? . ?) (? . ?) (? . ?) (? . ?)}
\EFcd{;}                                          \EFc{(? . ?) (? . ?) (? . ?) (? . ?) (? . ?)}
\EFcd{;}                                          \EFc{(? . ?) (? . ?) (? . ?) (? . ?) (? . ?)}
\EFcd{;}                                          \EFc{(? . ?) (? . ?))) )}
\EFcd{;}                 \EFc{(? [".?[-]?[--]*" 0 font-shape-gstring])}
\EFcd{;}                 \EFc{((? . ?) [".?[-]?[--]*" 0 font-shape-gstring])}
\EFcd{;}                 \EFc{,@(mapcar (lambda (str) (list (elt str 0) (vector str 0 'font-shape-gstring)))}
\EFcd{;}                           \EFc{'("" "" "" "" "" "" ""))))}
\EFcd{;}  \EFc{(set-char-table-range}
\EFcd{;}   \EFc{composition-function-table}
\EFcd{;}   \EFc{(car items)}
\EFcd{;}   \EFc{(list (cadr items))))}

\EFrda{(}\EFk{setq} \EFv{emojify-emoji-set} \EFs{"twemoji-v2"}\EFrda{)}

\EFrda{(}\EFo{set-fontset-font} t nil \EFrdb{(}\EFo{font-spec} \EFb{:size} \EFhn{16} \EFb{:name} \EFs{"Symbols Nerd Font"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{emojify--replace-text-with-emoji} \EFrdb{(}orig-fn emoji text buffer start end \EFt{\&optional} target\EFrdb{)}
  \EFd{"Modify `}\textcolor[HTML]{a9a1e1}{emojify--propertize-text-for-emoji}\EFd{' to replace ascii/github emoticons with unicode emojis, on the fly."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{not} \EFv{emoticon-to-emoji}\EFrdd{)} \EFrdd{(}\EFo{=} \EFhn{1} \EFrda{(}\EFo{length} text\EFrda{)}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFo{funcall} orig-fn emoji text buffer start end target\EFrdc{)}
    \EFrdc{(}\EFo{delete-region} start end\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFo{ht-get} emoji \EFs{"unicode"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{define-minor-mode} \EFv{emoticon-to-emoji}
  \EFd{"Write ascii/gh emojis, and have them converted to unicode live."}
  \EFb{:global} nil
  \EFb{:init-value} nil
  \EFrdb{(}\EFk{if} \EFv{emoticon-to-emoji}
      \EFrdc{(}\EFk{progn}
        \EFrdd{(}\EFk{setq-local} \EFv{emojify-emoji-styles} \EFhq{'}\EFrda{(}ascii github unicode\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{advice-add} \EFhq{'}\EFhs{emojify--propertize-text-for-emoji} \EFb{:around} \EFhq{\#'}\EFhs{emojify--replace-text-with-emoji}\EFrdd{)}
        \EFrdd{(}\EFk{unless} \EFv{emojify-mode}
          \EFrda{(}\EFf{emojify-turn-on-emojify-mode}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq-local} \EFv{emojify-emoji-styles} \EFrdd{(}\EFo{default-value} \EFhq{'}\EFv{emojify-emoji-styles}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{advice-remove} \EFhq{'}\EFhs{emojify--propertize-text-for-emoji} \EFhq{\#'}\EFhs{emojify--replace-text-with-emoji}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{add-hook!} \EFhq{'}\EFrdb{(}mu4e-compose-mode org-msg-edit-mode circe-channel-mode org-mode\EFrdb{)} \EFrdb{(}\EFv{emoticon-to-emoji} \EFhn{1}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Other}
\label{sec:org16582ac}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{interface.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"<f5>"}\EFrdb{)} \EFhq{'}\EFhs{revert-buffer}\EFrda{)}

                                        \EFcd{;}\EFc{(unless (string-match-p "\char94{}Power N/A" (battery))   ; On laptops...}
\EFrda{(}\EFv{global-subword-mode} \EFhn{1}\EFrda{)}                           \EFcd{;} \EFc{Iterate through CamelCase words}
\EFrda{(}\EFk{setq} \EFv{battery-mode-line-format} \EFs{"\%t"}\EFrda{)}

\EFrda{(}\EFk{use-package!} selectic-mode
  \EFb{:commands} selectic-mode\EFrda{)}

\EFrda{(}\EFo{set-char-table-range} \EFv{composition-function-table} ?f \EFhq{'}\EFrdb{(}\EFrdc{[}\EFs{"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(?:}}\EFs{ff?[fijlt]}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFhn{0} font-shape-gstring\EFrdc{]}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{set-char-table-range} \EFv{composition-function-table} ?T \EFhq{'}\EFrdb{(}\EFrdc{[}\EFs{"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(?:}}\EFs{Th}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFhn{0} font-shape-gstring\EFrdc{]}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} centaur-tabs
  \EFrdb{(}centaur-tabs-mode \EFhn{-1}\EFrdb{)}
  \EFrdb{(}\EFk{setq} centaur-tabs-height \EFhn{12}
        centaur-tabs-set-icons t
        centaur-tabs-modified-marker \EFs{"o"}
        centaur-tabs-close-button \EFs{""}
        centaur-tabs-set-bar \EFhq{'}\EFhs{above}
        centaur-tabs-gray-out-icons \EFhq{'}\EFhs{buffer}\EFrdb{)}
  \EFrdb{(}centaur-tabs-change-fonts \EFs{"SourceCodePro"} \EFhn{100}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{cleanup-after-init} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{switch-to-buffer} \EFs{"*scratch*"}\EFrdb{)}
  \EFrdb{(}\EFo{delete-other-windows}\EFrdb{)}
  \EFrdb{(}\EFf{kill-unwanted-buffers}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{schedule-cleanup-after-init} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{run-at-time} \EFs{"1 sec"} nil \EFhq{'}\EFhs{cleanup-after-init}\EFrdb{)}\EFrda{)}

                                        \EFcd{;}\EFc{(schedule-cleanup-after-init)}

                                        \EFcd{;}\EFc{(add-hook 'after-init-hook 'schedule-cleanup-after-init)}

\EFrda{(}\EFk{use-package!} info-colors
  \EFb{:commands} \EFrdb{(}\EFo{info-colors-fontify-node}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{Info-selection-hook} \EFhq{'}\EFhs{info-colors-fontify-node}\EFrda{)}

\EFrda{(}\EFk{use-package!} page-break-lines
  \EFb{:commands} page-break-lines-mode
  \EFb{:init}
  \EFrdb{(}\EFo{autoload} \EFhq{'}\EFhs{turn-on-page-break-lines-mode} \EFs{"page-break-lines"}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{setq} page-break-lines-max-width \EFv{fill-column}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:prefix} \EFs{"g"}
        \EFb{:desc} \EFs{"Prev page break"} \EFb{:nv} \EFs{"["} \EFhq{\#'}\EFhs{backward-page}
        \EFb{:desc} \EFs{"Next page break"} \EFb{:nv} \EFs{"]"} \EFhq{\#'}\EFhs{forward-page}\EFrdb{)}\EFrda{)}


\EFcd{;;} \EFc{(use-package! theme-magic}
\EFcd{;;}   \EFc{:commands theme-magic-from-emacs}
\EFcd{;;}   \EFc{:config}
\EFcd{;;}   \EFc{(defadvice! theme-magic--auto-extract-16-doom-colors ()}
\EFcd{;;}     \EFc{:override \#'theme-magic--auto-extract-16-colors}
\EFcd{;;}     \EFc{(list}
\EFcd{;;}      \EFc{(face-attribute 'default :background)}
\EFcd{;;}      \EFc{(doom-color 'error)}
\EFcd{;;}      \EFc{(doom-color 'success)}
\EFcd{;;}      \EFc{(doom-color 'type)}
\EFcd{;;}      \EFc{(doom-color 'keywords)}
\EFcd{;;}      \EFc{(doom-color 'constants)}
\EFcd{;;}      \EFc{(doom-color 'functions)}
\EFcd{;;}      \EFc{(face-attribute 'default :foreground)}
\EFcd{;;}      \EFc{(face-attribute 'shadow :foreground)}
\EFcd{;;}      \EFc{(doom-blend 'base8 'error 0.1)}
\EFcd{;;}      \EFc{(doom-blend 'base8 'success 0.1)}
\EFcd{;;}      \EFc{(doom-blend 'base8 'type 0.1)}
\EFcd{;;}      \EFc{(doom-blend 'base8 'keywords 0.1)}
\EFcd{;;}      \EFc{(doom-blend 'base8 'constants 0.1)}
\EFcd{;;}      \EFc{(doom-blend 'base8 'functions 0.1)}
\EFcd{;;}      \EFc{(face-attribute 'default :foreground))))}

\EFcd{;;} \EFc{(run-with-idle-timer 0.1 nil (lambda () (add-hook 'doom-load-theme-hook 'theme-magic-from-emacs)))}

                                        \EFcd{;} \EFc{Modern org mode}
\EFrda{(}\EFv{global-org-modern-mode} t\EFrda{)}

\EFcd{;;} \EFc{Transparent scratch buffer}
\EFrda{(}\EFk{defun} \EFf{buffer-empty-p} \EFrdb{(}\EFt{\&optional} buffer\EFrdb{)}
  \EFrdb{(}\EFo{=} \EFrdc{(}\EFo{buffer-size} buffer\EFrdc{)} \EFhn{0}\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{Transparent mode}
\EFrda{(}\EFk{defvar} \EFv{transparent-mode} t\EFrda{)}
\EFrda{(}\EFk{setq} transparent-mode--opacity \EFhn{80}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-\_"}\EFrdb{)} \EFhq{'}\EFrdb{(}lambda \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFk{--} transparent-mode--opacity\EFrdc{)} \EFrdc{(}\EFf{frame-trans-off}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-*"}\EFrdb{)} \EFhq{'}\EFrdb{(}lambda \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFk{++} transparent-mode--opacity\EFrdc{)} \EFrdc{(}\EFf{frame-trans-off}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{define-minor-mode} \EFv{transparent-mode}
  \EFd{"Toggle default transparency."}
  \EFb{:lighter} \EFs{""}
  \EFb{:global} t
  \EFrdb{(}\EFo{force-mode-line-update}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{frame-trans-on} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{set-frame-parameter} \EFrdc{(}\EFo{selected-frame}\EFrdc{)} \EFhq{'}\EFhs{alpha-background} \EFhn{0}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{frame-trans-off} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFv{transparent-mode}
      \EFrdc{(}\EFo{set-frame-parameter} \EFrdd{(}\EFo{selected-frame}\EFrdd{)} \EFhq{'}\EFhs{alpha-background} transparent-mode--opacity\EFrdc{)}
  \EFrdc{(}\EFo{set-frame-parameter} \EFrdd{(}\EFo{selected-frame}\EFrdd{)} \EFhq{'}\EFhs{alpha-background} \EFhn{100}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{scratch-trans} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{setq} my-buffer \EFrdc{(}\EFo{get-buffer} \EFs{"*scratch*"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}\EFo{eq} my-buffer \EFrda{(}\EFo{window-buffer} \EFrdb{(}\EFo{selected-window}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFk{if} \EFrda{(}\EFo{=} \EFrdb{(}\EFo{length} \EFrdc{(}\EFo{window-list}\EFrdc{)}\EFrdb{)} \EFhn{1}\EFrda{)} \EFrda{(}\EFf{frame-trans-on}\EFrda{)} \EFrda{(}\EFf{frame-trans-off}\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}\EFrdd{(}\EFo{get-buffer-window} my-buffer\EFrdd{)}
         \EFrdd{(}\EFf{frame-trans-off}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}t
         \EFrdd{(}\EFf{frame-trans-off}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{window-configuration-change-hook} \EFhq{'}\EFhs{scratch-trans}\EFrda{)}

\EFcd{;;} \EFc{Async shell commands without popup buffer}
\EFrda{(}\EFk{defun} \EFf{async-shell-command-no-window}
    \EFrdb{(}command\EFrdb{)}
  \EFd{"Execute async shell command without popup buffer."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let}
      \EFrdc{(}\EFrdd{(}\EFv{display-buffer-alist}
        \EFrda{(}\EFo{list}
         \EFrdb{(}\EFo{cons}
          \EFs{"\char92{}\char92{}*Async Shell Command\char92{}\char92{}*.*"}
          \EFrdc{(}\EFo{cons} \EFhq{\#'}\EFhs{display-buffer-no-window} nil\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{async-shell-command} command\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{interface}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Sync Theme to Zathura}
\label{sec:orga9c1ee2}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{sync-theme-to-zathura}\EFrda{)}
\end{Verbatim}
\end{Code}
\subparagraph{Requirements}
\label{sec:orgdc25fb5}
\subparagraph{Code}
\label{sec:org12dc36e}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{setq} zathura-set-theme-command \EFs{"\char126{}/.scripts/zathura-recolor.sh"}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{enables-sync-theme-to-zathura} t\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{sync-theme-to-zathura} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFv{enables-sync-theme-to-zathura}
   \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}bg \EFrdb{(}\EFo{face-attribute} \EFhq{'}\EFhs{default} \EFb{:background}\EFrdb{)}\EFrda{)}
     \EFrda{(}fg \EFrdb{(}\EFo{face-attribute} \EFhq{'}\EFhs{default} \EFb{:foreground}\EFrdb{)}\EFrda{)}
     \EFrda{(}mbg \EFrdb{(}\EFo{face-attribute} \EFhq{'}\EFhs{mode-line} \EFb{:background}\EFrdb{)}\EFrda{)}
     \EFrda{(}mfg \EFrdb{(}\EFo{face-attribute} \EFhq{'}\EFhs{mode-line} \EFb{:foreground}\EFrdb{)}\EFrda{)}\EFrdd{)}
     \EFrdd{(}\EFo{call-process} zathura-set-theme-command nil nil nil fg bg fg bg\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{consult-theme--maybe-sync-to-zathura} \EFrdb{(}theme\EFrdb{)}
  \EFd{"Disable current themes and enable THEME from `}\textcolor[HTML]{a9a1e1}{consult-themes}\EFd{'.}

\EFd{The command supports previewing the currently selected theme."}
  \EFrdb{(}\EFk{interactive}
   \EFrdc{(}\EFo{list}
    \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}regexp \EFrdc{(}\EFo{consult--regexp-filter}
                    \EFrdd{(}\EFo{mapcar} \EFrda{(}\EFk{lambda} \EFrdb{(}x\EFrdb{)} \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{stringp} x\EFrdc{)} x \EFrdc{(}\EFo{format} \EFs{"\char92{}\char92{}`}\textcolor[HTML]{a9a1e1}{\%s\char92{}\char92{}}\EFs{'"} x\EFrdc{)}\EFrdb{)}\EFrda{)}
                            \EFv{consult-themes}\EFrdd{)}\EFrdc{)}\EFrdb{)}
           \EFrdb{(}avail-themes \EFrdc{(}\EFf{seq-filter}
                          \EFrdd{(}\EFk{lambda} \EFrda{(}x\EFrda{)} \EFrda{(}\EFf{string-match-p} regexp \EFrdb{(}\EFo{symbol-name} x\EFrdb{)}\EFrda{)}\EFrdd{)}
                          \EFrdd{(}\EFo{cons} \EFhq{'}\EFhs{default} \EFrda{(}\EFo{custom-available-themes}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
           \EFrdb{(}saved-theme \EFrdc{(}\EFo{car} \EFv{custom-enabled-themes}\EFrdc{)}\EFrdb{)}\EFrda{)}
      \EFrda{(}\EFo{consult--read}
       \EFrdb{(}\EFo{mapcar} \EFhq{\#'}\EFhs{symbol-name} avail-themes\EFrdb{)}
       \EFb{:prompt} \EFs{"Theme: "}
       \EFb{:require-match} t
       \EFb{:category} \EFhq{'}\EFhs{theme}
       \EFb{:history} \EFhq{'}\EFv{consult--theme-history}
       \EFb{:lookup} \EFrdb{(}\EFk{lambda} \EFrdc{(}selected \EFt{\&rest} \_\EFrdc{)}
                 \EFrdc{(}\EFk{setq} selected \EFrdd{(}\EFk{and} selected \EFrda{(}\EFo{intern-soft} selected\EFrda{)}\EFrdd{)}\EFrdc{)}
                 \EFrdc{(}\EFk{or} \EFrdd{(}\EFk{and} selected \EFrda{(}\EFo{car} \EFrdb{(}\EFo{memq} selected avail-themes\EFrdb{)}\EFrda{)}\EFrdd{)}
                     saved-theme\EFrdc{)}\EFrdb{)}
       \EFb{:state} \EFrdb{(}\EFk{lambda} \EFrdc{(}action theme\EFrdc{)}
                \EFrdc{(}\EFk{pcase} action
                  \EFrdd{(}\EFhq{'}\EFhs{return} \EFrda{(}\EFo{consult-theme} \EFrdb{(}\EFk{or} theme saved-theme\EFrdb{)}\EFrda{)}\EFrdd{)}
                  \EFrdd{(}\EFrda{(}\EFk{and} \EFhq{'}\EFhs{preview} \EFrdb{(}guard theme\EFrdb{)}\EFrda{)} \EFrda{(}\EFo{consult-theme} theme\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
       \EFb{:default} \EFrdb{(}\EFo{symbol-name} \EFrdc{(}\EFk{or} saved-theme \EFhq{'}\EFhs{default}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{eq} theme \EFhq{'}\EFhs{default}\EFrdc{)} \EFrdc{(}\EFk{setq} theme nil\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFrdc{(}\EFo{eq} theme \EFrdd{(}\EFo{car} \EFv{custom-enabled-themes}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{mapc} \EFhq{\#'}\EFhs{disable-theme} \EFv{custom-enabled-themes}\EFrdc{)}
    \EFrdc{(}\EFk{when} theme
      \EFrdd{(}\EFk{if} \EFrda{(}\EFf{custom-theme-p} theme\EFrda{)}
          \EFrda{(}\EFk{progn} \EFrdb{(}\EFo{enable-theme} theme\EFrdb{)} \EFrdb{(}\EFf{sync-theme-to-zathura}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{progn} \EFrdb{(}\EFo{load-theme} theme \EFb{:no-confirm}\EFrdb{)}
           \EFrdb{(}\EFf{sync-theme-to-zathura}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{add-function} \EFb{:override} \EFrdb{(}\EFo{symbol-function} \EFhq{'}\EFhs{consult-theme}\EFrdb{)} \EFhq{\#'}\EFhs{consult-theme--maybe-sync-to-zathura}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{sync-theme-to-zathura}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{EXWM Tweaks}
\label{sec:org57ac2a1}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{exwm-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org22846d2}
\subsubsection{Code}
\label{sec:org6f3a383}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{exwm-tweaks.el -*- lexical-binding: t; -*-}
\EFrda{(}\EFk{use-package!} exwm
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{mouse-autoselect-window} t
        \EFv{focus-follows-mouse} t\EFrdb{)}
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{exwm}\EFrdb{)}
  \EFcd{;}\EFc{(require 'exwm-config) exwm config is deprecated}
  \EFcd{;} \EFc{no need for (exwm-config-example), has unwanted defaults and uses ido}

  \EFrdb{(}\EFo{advice-add} \EFhq{'}\EFhs{exwm-init-remove-error} \EFb{:around} \EFhq{\#'}\EFhs{exwm-init}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{exwm-init-remove-error} \EFrdc{(}orig-function\EFrdc{)}
   \EFrdc{(}\EFk{condition-case} nil
      \EFrdd{(}\EFo{funcall} original-function\EFrdd{)}
    \EFrdd{(}\EFo{error} \EFrda{(}\EFo{message} \EFs{"EXWM retires: Other DE/WM running"}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFv{fringe-mode} \EFhn{-1}\EFrdb{)}
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{exwm-randr}\EFrdb{)}
  \EFcd{;}\EFc{(setq exwm-randr-workspace-monitor-plist '(0 "eDP-1" 1 "DP-2-1" 2 "DP-2-2" 3 "HDMI-2" 4 "HDMI-1"))}

  \EFrdb{(}\EFk{defun} \EFf{exwm-update-monitors} \EFrdc{(}\EFrdc{)}
    \EFd{"Detects connected monitors and sets exwm-randr-workspace-monitor-plist accordingly"}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{exwm-randr-workspace-monitor-plist}
          \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}monitors \EFrdc{(}\EFo{mapcar} \EFrdd{(}\EFk{lambda} \EFrda{(}monitor\EFrda{)} \EFrda{(}\EFo{alist-get} \EFhq{'}\EFhs{name} monitor\EFrda{)}\EFrdd{)} \EFrdd{(}\EFo{display-monitor-attributes-list}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFo{apply} \EFhq{\#'}\EFhs{append} \EFrdb{(}\EFo{cl-mapcar} \EFhq{\#'}\EFhs{list} \EFrdc{(}\EFo{number-sequence} \EFhn{0} \EFrdd{(}\EFo{1-} \EFrda{(}\EFo{length} monitors\EFrda{)}\EFrdd{)}\EFrdc{)} monitors\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFf{exwm-update-monitors}\EFrdb{)}
  \EFcd{;}\EFc{(exwm-randr-enable)}
  \EFcd{;} \textcolor[HTML]{ECBE7B}{\textbf{TODO}} \EFc{FIX THIS}

\EFcd{;;} \EFc{(when (string= (system-name) "astaroth")}
\EFcd{;;}    \EFc{(setq exwm-randr-workspace-monitor-plist '(1 "eDP-1" 2 "DP-2-1" 3 "HDMI-2" 3 "DP-2-2")))}
\EFcd{;;}  \EFc{(when (string= (system-name) "jarvis")}
\EFcd{;;}    \EFc{(setq exwm-randr-workspace-output-plist '(1 "DisplayPort-0" 2 "DVI-0" 3 "HDMI-0" 4 "eDP-1")))}

  \EFrdb{(}\EFk{add-hook!} \EFhq{'}\EFv{exwm-randr-screen-change-hook} \EFhq{'}\EFhs{exwm-update-monitors}\EFrdb{)}

   \EFcd{;;} \EFc{(add-hook 'exwm-randr-screen-change-hook}
   \EFcd{;;}           \EFc{(lambda ()}
   \EFcd{;;}             \EFc{(start-process-shell-command}
   \EFcd{;;}              \EFc{"xrandr" nil "xrandr --output eDP-1 --primary --mode 1920x1080 --pos 0x0 --rotate normal --output DP-1 --off --output HDMI-1 --off --output DP-2 --off --output DP-2-1 --mode 1920x1080 --pos 1920x0 --rotate normal")))}

 \EFcd{;} \EFc{(add-hook 'exwm-randr-screen-change-hook}
 \EFcd{;}     \EFc{(lambda ()}
 \EFcd{;}       \EFc{(start-process-shell-command}
 \EFcd{;}        \EFc{"xrandr" nil "xrandr --output eDP-1 --primary --mode 1920x1080 --pos 0x0 ;--rotate normal --output DP-1 --off --output HDMI-1 --off --output DP-2 --off ;--output HDMI-2 --off --output DP-2-1 --mode 1920x1080 --pos 1920x0 --rotate ;normal --output DP-2-2 --off --output DP-2-3 --off")))}

  \EFcd{;}\EFc{(setq exwm-randr-screen-change-hook nil)}

  \EFrdb{(}\EFv{winner-mode} t\EFrdb{)}
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{exwm-systemtray}\EFrdb{)}
  \EFcd{;}\EFc{(exwm-systemtray-enable) Systray handled by polybar}

  \EFcd{;} \EFc{Normal copy-pasting}
  \EFrdb{(}\EFo{define-key} \EFv{exwm-mode-map} \EFrdc{(}\EFo{kbd} \EFs{"C-c"}\EFrdc{)} nil\EFrdb{)}
  \EFrdb{(}\EFo{define-key} \EFv{exwm-mode-map} \EFrdc{(}\EFo{kbd} \EFs{"C-v"}\EFrdc{)} nil\EFrdb{)}

  \EFrdb{(}\EFk{setq} \EFv{exwm-input-simulation-keys}
        \EFhq{'}\EFrdc{(}\EFrdd{(}\EFrda{[}?\char92{}C-b\EFrda{]} . \EFrda{[}left\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}C-f\EFrda{]} . \EFrda{[}right\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}C-p\EFrda{]} . \EFrda{[}up\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}C-n\EFrda{]} . \EFrda{[}down\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}C-a\EFrda{]} . \EFrda{[}home\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}C-e\EFrda{]} . \EFrda{[}end\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}M-a\EFrda{]} . \EFrda{[}C-a\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}M-v\EFrda{]} . \EFrda{[}prior\EFrda{]}\EFrdd{)}
          \EFcd{;}\EFc{([?\char92{}C-v] . [next])}
          \EFrdd{(}\EFrda{[}?\char92{}C-d\EFrda{]} . \EFrda{[}delete\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}C-k\EFrda{]} . \EFrda{[}S-end delete\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}C-w\EFrda{]} . \EFrda{[}?\char92{}C-x\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}M-w\EFrda{]} . \EFrda{[}?\char92{}C-c\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}C-y\EFrda{]} . \EFrda{[}?\char92{}C-v\EFrda{]}\EFrdd{)}
          \EFcd{;;} \EFc{search}
          \EFrdd{(}\EFrda{[}?\char92{}C-s\EFrda{]} . \EFrda{[}?\char92{}C-f\EFrda{]}\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}M-s\EFrda{]} . \EFrda{[}?\char92{}C-s\EFrda{]}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{exwm-manage-finish-hook} \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)} \EFrdd{(}\EFk{when} \EFrda{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{exwm-mode}\EFrda{)} \EFrda{(}\EFv{evil-local-mode} \EFhn{-1}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{with-eval-after-load} \EFhq{'}\EFhs{ediff-wind}
  \EFrdc{(}\EFk{setq} \EFv{ediff-control-frame-parameters}
        \EFrdd{(}\EFo{cons} \EFhq{'}\EFrda{(}unsplittable . t\EFrda{)} \EFv{ediff-control-frame-parameters}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFo{global-set-key} \EFrdc{(}\EFo{kbd} \EFs{"C-x C-c"}\EFrdc{)} \EFhq{'}\EFhs{save-buffers-kill-emacs}\EFrdb{)}
\EFcd{;}  \EFc{(global-set-key (kbd "C-c m") 'toggle-maximize-buffer)}


  \EFrdb{(}\EFk{defun} \EFf{fullscreen} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{exwm-mode}\EFrdd{)}
      \EFrdd{(}\EFo{call-interactively} \EFhq{'}\EFhs{exwm-layout-toggle-fullscreen}\EFrdd{)}
      \EFrdd{(}\EFf{toggle-maximize-buffer}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}

\EFcd{;;;} \EFc{Make current buffer float}
\EFrdb{(}\EFk{defun} \EFf{toggle-float-buffer} \EFrdc{(}\EFrdc{)}
  \EFrdc{(}\EFk{interactive}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{exwm-mode}\EFrdd{)}
      \EFrdd{(}\EFk{progn}
      \EFrda{(}\EFo{call-interactively} \EFhq{'}\EFhs{exwm-floating-toggle-floating}\EFrda{)}
      \EFrda{(}\EFo{call-interactively} \EFhq{'}\EFhs{exwm-layout-hide-mode-line}\EFrda{)}
      \EFrdd{)}\EFrdc{)}\EFrdb{)}

\EFrdb{(}\EFk{defun} \EFf{exwm-move-window-to-workspace}\EFrdc{(}workspace-number\EFrdc{)}
  \EFrdc{(}\EFk{interactive}\EFrdc{)}
  \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}frame \EFrdb{(}\EFo{exwm-workspace--workspace-from-frame-or-index} workspace-number\EFrdb{)}\EFrda{)}
        \EFrda{(}id \EFrdb{(}\EFf{exwm--buffer->id} \EFrdc{(}\EFo{window-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFo{exwm-workspace-move-window} frame id\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{setq} \EFv{exwm-workspace-number} \EFhn{1}
        \EFv{exwm-workspace-show-all-buffers} t
        \EFv{exwm-layout-show-all-buffers} t
        \EFv{exwm-manage-force-tiling} t\EFrdb{)}

  \EFrdb{(}\EFk{setq} \EFv{exwm-input-global-keys}
        \EFhq{`}\EFrdc{(}\EFrdd{(}\EFrda{[}?\char92{}s-f\EFrda{]} . fullscreen\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}s-r\EFrda{]} . exwm-reset\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}s-F\EFrda{]} . toggle-maximize-buffer\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}s-g\EFrda{]} . toggle-float-buffer\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}s-q\EFrda{]} . kill-curr-buffer\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}s-n\EFrda{]} . switchmonitor-next\EFrdd{)}
          \EFrdd{(}\EFrda{[}?\char92{}s-p\EFrda{]} . switchmonitor-prev\EFrdd{)}
        \EFcd{;}\EFc{((kbd "s-<return>") . switchmonitor-prev)}
        ,@\EFrdd{(}\EFo{mapcar} \EFrda{(}\EFk{lambda} \EFrdb{(}i\EFrdb{)}
                    \EFhq{`}\EFrdb{(},\EFrdc{(}\EFo{kbd} \EFrdd{(}\EFo{format} \EFs{"s-\%d"} \EFrda{(}\EFo{+} i \EFhn{1}\EFrda{)}\EFrdd{)}\EFrdc{)} .
                      \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
                        \EFrdd{(}\EFk{interactive}\EFrdd{)}
                        \EFrdd{(}\EFo{exwm-workspace-switch-create} ,i\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFo{number-sequence} \EFhn{0} \EFhn{8}\EFrda{)}\EFrdd{)}
        ,@\EFrdd{(}\EFo{mapcar} \EFrda{(}\EFk{lambda} \EFrdb{(}i\EFrdb{)}
                    \EFhq{`}\EFrdb{(},\EFrdc{(}\EFo{kbd} \EFrdd{(}\EFo{format} \EFs{"M-s-\%d"} \EFrda{(}\EFo{+} i \EFhn{1}\EFrda{)}\EFrdd{)}\EFrdc{)} .
                      \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
                        \EFrdd{(}\EFk{interactive}\EFrdd{)}
                        \EFrdd{(}\EFf{exwm-move-window-to-workspace} ,i\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFo{number-sequence} \EFhn{0} \EFhn{8}\EFrda{)}\EFrdd{)}

        \EFrdc{)}\EFrdb{)}


  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{exwm-manage-finish-hook}
          \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
            \EFrdd{(}\EFk{if} \EFrda{(}\EFk{and} \EFv{exwm-class-name}
                       \EFrdb{(}\EFo{string=} \EFv{exwm-class-name} \EFs{"St"}\EFrdb{)}\EFrda{)}
              \EFrda{(}\EFk{progn}
                \EFrdb{(}\EFo{exwm-input-release-keyboard}\EFrdb{)}\EFrda{)}
              \EFrda{(}\EFk{progn}\EFrda{)}\EFrdd{)}
            \EFrdd{(}\EFo{exwm-layout-hide-mode-line}\EFrdd{)}\EFrdc{)}\EFrdb{)}

\EFrdb{(}\EFk{setq} \EFv{exwm-input-prefix-keys}
\EFhq{'}\EFrdc{(}?\char92{}C-x ?\char92{}C-u ?\char92{}C-h ?\char92{}M-x ?\char92{}M-\EFhq{`} \EFhs{?}\char92{}M-\& ?\char92{}M-:\EFrdc{)}\EFrdb{)}


\EFrdb{(}\EFo{global-set-key} \EFrdc{(}\EFo{kbd} \EFs{"s-<f4>"}\EFrdc{)} \EFhq{'}\EFhs{go-to-scratch}\EFrdb{)}
\EFrdb{(}\EFo{global-set-key} \EFrdc{(}\EFo{kbd} \EFs{"s-S-<f4>"}\EFrdc{)} \EFhq{'}\EFhs{save-buffer-temp}\EFrdb{)}
\EFrdb{(}\EFo{require} \EFhq{'}\EFo{exwm-edit}\EFrdb{)}
\EFrdb{(}\EFk{defun} \EFf{ag-exwm/on-exwm-edit-compose} \EFrdc{(}\EFrdc{)}
  \EFrdc{(}\EFo{funcall} \EFhq{'}\EFhs{org-mode}\EFrdc{)}\EFrdb{)}
\EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{exwm-edit-compose-hook} \EFhq{'}\EFhs{ag-exwm/on-exwm-edit-compose}\EFrdb{)}


\EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{exwm-update-title-hook}
          \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
              \EFrdd{(}\EFo{exwm-workspace-rename-buffer} \EFv{exwm-title}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{exwm-manage-configurations}
      \EFhq{'}\EFrdb{(}\EFrdc{(}\EFrdd{(}\EFk{or} \EFrda{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"Nm-applet"}\EFrda{)}
             \EFrda{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"Surf"}\EFrda{)}
             \EFrda{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"Steam"}\EFrda{)}
             \EFrda{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"SshAskpass"}\EFrda{)}
             \EFrda{(}\EFo{string-equal} \EFv{exwm-instance-name} \EFs{"Toplevel"}\EFrda{)}
             \EFrda{(}\EFk{and} \EFrdb{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"Thunar"}\EFrdb{)}
                  \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{string-equal} \EFv{exwm-title} \EFs{"File Operation Progress"}\EFrdc{)}
                      \EFrdc{(}\EFo{string-equal} \EFv{exwm-title} \EFs{"Attention"}\EFrdc{)}
                      \EFrdb{)}\EFrda{)}
             \EFrda{(}\EFk{and} \EFrdb{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"Firefox"}\EFrdb{)}
                  \EFrdb{(}\EFo{string-equal} \EFv{exwm-title} \EFs{"Save Image"}\EFrdb{)}\EFrda{)}
             \EFrda{(}\EFk{and} \EFrdb{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"firefox"}\EFrdb{)}
                  \EFrdb{(}\EFo{string-equal} \EFv{exwm-title} \EFs{"Picture-in-Picture"}\EFrdb{)}\EFrda{)}
             \EFrda{(}\EFk{and} \EFrdb{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"KeePassXC"}\EFrdb{)}
                  \EFrdb{(}\EFo{string-equal} \EFv{exwm-title} \EFs{"KeePassXC -  Access Request"}\EFrdb{)}\EFrda{)}
             \EFrda{(}\EFo{not} \EFrdb{(}\EFk{progn}
                    \EFcd{;}\EFc{(message (format "Class: \%s" exwm-class-name))}
                    \EFv{\%}\EFrdc{(}\EFo{message} \EFrdd{(}\EFo{format} \EFs{"Title: \%s"} \EFv{exwm-instance-name}\EFrdd{)}\EFrdc{)}
                    \EFrdb{)}\EFrda{)}
             \EFrda{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"ripdrag"}\EFrda{)}
             \EFrda{(}\EFo{equal} \EFv{exwm-window-type} \EFhq{`}\EFrdb{(},\EFv{xcb:Atom:\_NET\_WM\_WINDOW\_TYPE\_DIALOG}\EFrdb{)}\EFrda{)}
             \EFrda{(}\EFo{equal} \EFv{exwm-window-type} \EFv{xcb:Atom:\_NET\_WM\_WINDOW\_TYPE\_DIALOG}\EFrda{)}
             \EFrda{(}\EFo{member} \EFv{xcb:Atom:\_NET\_WM\_WINDOW\_TYPE\_DIALOG} \EFv{exwm-window-type}\EFrda{)}
             \EFrdd{)}
           floating t
           floating-mode-line nil
\EFcd{;}           \EFc{width 0.4}
\EFcd{;}           \EFc{height 0.4}
           \EFrdc{)}
       \EFrdc{(}\EFrdd{(}\EFk{or} \EFrda{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"kdeconnect.daemon"}\EFrda{)}\EFrdd{)}
        floating t
        fullscreen t
        width \EFhn{0}
        height \EFhn{0}\EFrdc{)}
        \EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{(defun exwm-floating--set-floating (id)}
\EFcd{;;}   \EFc{"Make window ID floating."}
\EFcd{;;}   \EFc{(let ((window (get-buffer-window (exwm--id->buffer id))))}
\EFcd{;;}     \EFc{(when window}
\EFcd{;;}       \EFc{;; Hide the non-floating X window first.}
\EFcd{;;}       \EFc{(set-window-buffer window (other-buffer nil t))))}
\EFcd{;;}   \EFc{(let* ((original-frame (buffer-local-value 'exwm--frame}
\EFcd{;;}                                              \EFc{(exwm--id->buffer id)))}
\EFcd{;;}          \EFc{;; Create new frame}
\EFcd{;;}          \EFc{(frame (with-current-buffer}
\EFcd{;;}                     \EFc{(or (get-buffer "*scratch*")}
\EFcd{;;}                         \EFc{(progn}
\EFcd{;;}                           \EFc{(set-buffer-major-mode}
\EFcd{;;}                            \EFc{(get-buffer-create "*scratch*"))}
\EFcd{;;}                           \EFc{(get-buffer "*scratch*")))}
\EFcd{;;}                   \EFc{(make-frame}
\EFcd{;;}                    \EFc{`((minibuffer . ,(minibuffer-window exwm--frame))}
\EFcd{;;}                      \EFc{(left . ,(* window-min-width -10000))}
\EFcd{;;}                      \EFc{(top . ,(* window-min-height -10000))}
\EFcd{;;}                      \EFc{(width . ,window-min-width)}
\EFcd{;;}                      \EFc{(height . ,window-min-height)}
\EFcd{;;}                      \EFc{(unsplittable . t))))) ;and fix the size later}
\EFcd{;;}          \EFc{(outer-id (string-to-number (frame-parameter frame 'outer-window-id)))}
\EFcd{;;}          \EFc{(window-id (string-to-number (frame-parameter frame 'window-id)))}
\EFcd{;;}          \EFc{(frame-container (xcb:generate-id exwm--connection))}
\EFcd{;;}          \EFc{(window (frame-first-window frame)) ;and it's the only window}
\EFcd{;;}          \EFc{(x (slot-value exwm--geometry 'x))}
\EFcd{;;}          \EFc{(y (slot-value exwm--geometry 'y))}
\EFcd{;;}          \EFc{(width (slot-value exwm--geometry 'width))}
\EFcd{;;}          \EFc{(height (slot-value exwm--geometry 'height)))}
\EFcd{;;}     \EFc{;; Force drawing menu-bar \& tool-bar.}
\EFcd{;;}     \EFc{(redisplay t)}
\EFcd{;;}     \EFc{(exwm-workspace--update-offsets)}
\EFcd{;;}     \EFc{(exwm--log "Floating geometry (original): \%dx\%d\%+d\%+d" width height x y)}
\EFcd{;;}     \EFc{;; Save frame parameters.}
\EFcd{;;}     \EFc{(set-frame-parameter frame 'exwm-outer-id outer-id)}
\EFcd{;;}     \EFc{(set-frame-parameter frame 'exwm-id window-id)}
\EFcd{;;}     \EFc{(set-frame-parameter frame 'exwm-container frame-container)}
\EFcd{;;}     \EFc{(set-frame-parameter frame 'alpha 10)}
\EFcd{;;}     \EFc{;; Fix illegal parameters}
\EFcd{;;}     \EFc{;;} \textcolor[HTML]{ff6c6b}{\textbf{FIXME:}} \EFc{check normal hints restrictions}
\EFcd{;;}     \EFc{(let* ((workarea (elt exwm-workspace--workareas}
\EFcd{;;}                           \EFc{(exwm-workspace--position original-frame)))}
\EFcd{;;}            \EFc{(x* (aref workarea 0))}
\EFcd{;;}            \EFc{(y* (aref workarea 1))}
\EFcd{;;}            \EFc{(width* (aref workarea 2))}
\EFcd{;;}            \EFc{(height* (aref workarea 3)))}
\EFcd{;;}       \EFc{;; Center floating windows}
\EFcd{;;}       \EFc{(when (and (or (= x 0) (= x x*))}
\EFcd{;;}                  \EFc{(or (= y 0) (= y y*)))}
\EFcd{;;}         \EFc{(let ((buffer (exwm--id->buffer exwm-transient-for))}
\EFcd{;;}               \EFc{window edges)}
\EFcd{;;}           \EFc{(when (and buffer (setq window (get-buffer-window buffer)))}
\EFcd{;;}             \EFc{(setq edges (window-inside-absolute-pixel-edges window))}
\EFcd{;;}             \EFc{(unless (and (<= width (- (elt edges 2) (elt edges 0)))}
\EFcd{;;}                          \EFc{(<= height (- (elt edges 3) (elt edges 1))))}
\EFcd{;;}               \EFc{(setq edges nil)))}
\EFcd{;;}           \EFc{(if edges}
\EFcd{;;}               \EFc{;; Put at the center of leading window}
\EFcd{;;}               \EFc{(setq x (+ x* (/ (- (elt edges 2) (elt edges 0) width) 2))}
\EFcd{;;}                     \EFc{y (+ y* (/ (- (elt edges 3) (elt edges 1) height) 2)))}
\EFcd{;;}             \EFc{;; Put at the center of screen}
\EFcd{;;}             \EFc{(setq x (/ (- width* width) 2)}
\EFcd{;;}                   \EFc{y (/ (- height* height) 2)))))}
\EFcd{;;}       \EFc{(if (> width width*)}
\EFcd{;;}           \EFc{;; Too wide}
\EFcd{;;}           \EFc{(progn (setq x x*}
\EFcd{;;}                        \EFc{width width*))}
\EFcd{;;}         \EFc{;; Invalid width}
\EFcd{;;}         \EFc{(when (= 0 width) (setq width (/ width* 2)))}
\EFcd{;;}         \EFc{;; Make sure at least half of the window is visible}
\EFcd{;;}         \EFc{(unless (< x* (+ x (/ width 2)) (+ x* width*))}
\EFcd{;;}           \EFc{(setq x (+ x* (/ (- width* width) 2)))))}
\EFcd{;;}       \EFc{(if (> height height*)}
\EFcd{;;}           \EFc{;; Too tall}
\EFcd{;;}           \EFc{(setq y y*}
\EFcd{;;}                 \EFc{height height*)}
\EFcd{;;}         \EFc{;; Invalid height}
\EFcd{;;}         \EFc{(when (= 0 height) (setq height (/ height* 2)))}
\EFcd{;;}         \EFc{;; Make sure at least half of the window is visible}
\EFcd{;;}         \EFc{(unless (< y* (+ y (/ height 2)) (+ y* height*))}
\EFcd{;;}           \EFc{(setq y (+ y* (/ (- height* height) 2)))))}
\EFcd{;;}       \EFc{;; The geometry can be overridden by user options.}
\EFcd{;;}       \EFc{(let ((x** (plist-get exwm--configurations 'x))}
\EFcd{;;}             \EFc{(y** (plist-get exwm--configurations 'y))}
\EFcd{;;}             \EFc{(width** (plist-get exwm--configurations 'width))}
\EFcd{;;}             \EFc{(height** (plist-get exwm--configurations 'height)))}
\EFcd{;;}         \EFc{(if (integerp x**)}
\EFcd{;;}             \EFc{(setq x (+ x* x**))}
\EFcd{;;}           \EFc{(when (and (floatp x**)}
\EFcd{;;}                      \EFc{(>= 1 x** 0))}
\EFcd{;;}             \EFc{(setq x (+ x* (round (* x** width*))))))}
\EFcd{;;}         \EFc{(if (integerp y**)}
\EFcd{;;}             \EFc{(setq y (+ y* y**))}
\EFcd{;;}           \EFc{(when (and (floatp y**)}
\EFcd{;;}                      \EFc{(>= 1 y** 0))}
\EFcd{;;}             \EFc{(setq y (+ y* (round (* y** height*))))))}
\EFcd{;;}         \EFc{(if (integerp width**)}
\EFcd{;;}             \EFc{(setq width width**)}
\EFcd{;;}           \EFc{(when (and (floatp width**)}
\EFcd{;;}                      \EFc{(> 1 width** 0))}
\EFcd{;;}             \EFc{(setq width (max 1 (round (* width** width*))))))}
\EFcd{;;}         \EFc{(if (integerp height**)}
\EFcd{;;}             \EFc{(setq height height**)}
\EFcd{;;}           \EFc{(when (and (floatp height**)}
\EFcd{;;}                      \EFc{(> 1 height** 0))}
\EFcd{;;}             \EFc{(setq height (max 1 (round (* height** height*))))))))}
\EFcd{;;}     \EFc{(exwm--set-geometry id x y nil nil)}
\EFcd{;;}     \EFc{(xcb:flush exwm--connection)}
\EFcd{;;}     \EFc{(exwm--log "Floating geometry (corrected): \%dx\%d\%+d\%+d" width height x y)}
\EFcd{;;}     \EFc{;; Fit frame to client}
\EFcd{;;}     \EFc{;; It seems we have to make the frame invisible in order to resize it}
\EFcd{;;}     \EFc{;; timely.}
\EFcd{;;}     \EFc{;; The frame will be made visible by `}\textcolor[HTML]{a9a1e1}{select-frame-set-input-focus}\EFc{'.}
\EFcd{;;}     \EFc{(make-frame-invisible frame)}
\EFcd{;;}     \EFc{(let* ((edges (window-inside-pixel-edges window))}
\EFcd{;;}            \EFc{(frame-width (+ width (- (frame-pixel-width frame)}
\EFcd{;;}                                     \EFc{(- (elt edges 2) (elt edges 0)))))}
\EFcd{;;}            \EFc{(frame-height (+ height (- (frame-pixel-height frame)}
\EFcd{;;}                                       \EFc{(- (elt edges 3) (elt edges 1)))}
\EFcd{;;}                             \EFc{;; Use `}\textcolor[HTML]{a9a1e1}{frame-outer-height}\EFc{' in the future.}
\EFcd{;;}                             \EFc{exwm-workspace--frame-y-offset))}
\EFcd{;;}            \EFc{(floating-mode-line (plist-get exwm--configurations}
\EFcd{;;}                                           \EFc{'floating-mode-line))}
\EFcd{;;}            \EFc{(floating-header-line (plist-get exwm--configurations}
\EFcd{;;}                                             \EFc{'floating-header-line))}
\EFcd{;;}            \EFc{(border-pixel (exwm--color->pixel exwm-floating-border-color)))}
\EFcd{;;}       \EFc{(if floating-mode-line}
\EFcd{;;}           \EFc{(setq exwm--mode-line-format (or exwm--mode-line-format}
\EFcd{;;}                                            \EFc{mode-line-format)}
\EFcd{;;}                 \EFc{mode-line-format floating-mode-line)}
\EFcd{;;}         \EFc{(if (and (not (plist-member exwm--configurations 'floating-mode-line))}
\EFcd{;;}                  \EFc{exwm--mwm-hints-decorations)}
\EFcd{;;}             \EFc{(when exwm--mode-line-format}
\EFcd{;;}               \EFc{(setq mode-line-format exwm--mode-line-format))}
\EFcd{;;}           \EFc{;; The mode-line need to be hidden in floating mode.}
\EFcd{;;}           \EFc{(setq frame-height (- frame-height (window-mode-line-height}
\EFcd{;;}                                               \EFc{(frame-root-window frame)))}
\EFcd{;;}                 \EFc{exwm--mode-line-format (or exwm--mode-line-format}
\EFcd{;;}                                            \EFc{mode-line-format)}
\EFcd{;;}                 \EFc{mode-line-format nil)))}
\EFcd{;;}       \EFc{(if floating-header-line}
\EFcd{;;}           \EFc{(setq header-line-format floating-header-line)}
\EFcd{;;}         \EFc{(if (and (not (plist-member exwm--configurations}
\EFcd{;;}                                     \EFc{'floating-header-line))}
\EFcd{;;}                  \EFc{exwm--mwm-hints-decorations)}
\EFcd{;;}             \EFc{(setq header-line-format nil)}
\EFcd{;;}           \EFc{;; The header-line need to be hidden in floating mode.}
\EFcd{;;}           \EFc{(setq frame-height (- frame-height (window-header-line-height}
\EFcd{;;}                                               \EFc{(frame-root-window frame)))}
\EFcd{;;}                 \EFc{header-line-format nil)))}
\EFcd{;;}       \EFc{(set-frame-size frame frame-width frame-height t)}
\EFcd{;;}       \EFc{;; Create the frame container as the parent of the frame.}
\EFcd{;;}       \EFc{(xcb:+request exwm--connection}
\EFcd{;;}           \EFc{(make-instance 'xcb:CreateWindow}
\EFcd{;;}                          \EFc{:depth 0}
\EFcd{;;}                          \EFc{:wid frame-container}
\EFcd{;;}                          \EFc{:parent exwm--root}
\EFcd{;;}                          \EFc{:x x}
\EFcd{;;}                          \EFc{:y (- y exwm-workspace--window-y-offset)}
\EFcd{;;}                          \EFc{:width width}
\EFcd{;;}                          \EFc{:height height}
\EFcd{;;}                          \EFc{:border-width}
\EFcd{;;}                          \EFc{(with-current-buffer (exwm--id->buffer id)}
\EFcd{;;}                            \EFc{(let ((border-witdh (plist-get exwm--configurations}
\EFcd{;;}                                                           \EFc{'border-width)))}
\EFcd{;;}                              \EFc{(if (and (integerp border-witdh)}
\EFcd{;;}                                       \EFc{(>= border-witdh 0))}
\EFcd{;;}                                  \EFc{border-witdh}
\EFcd{;;}                                \EFc{exwm-floating-border-width)))}
\EFcd{;;}                          \EFc{:class xcb:WindowClass:InputOutput}
\EFcd{;;}                          \EFc{:visual 0}
\EFcd{;;}                          \EFc{:value-mask (logior xcb:CW:BackPixmap}
\EFcd{;;}                                              \EFc{(if border-pixel}
\EFcd{;;}                                                  \EFc{xcb:CW:BorderPixel 0)}
\EFcd{;;}                                              \EFc{xcb:CW:OverrideRedirect)}
\EFcd{;;}                          \EFc{:background-pixmap xcb:BackPixmap:ParentRelative}
\EFcd{;;}                          \EFc{:border-pixel border-pixel}
\EFcd{;;}                          \EFc{:override-redirect 1))}
\EFcd{;;}       \EFc{(xcb:+request exwm--connection}
\EFcd{;;}           \EFc{(make-instance 'xcb:ewmh:set-\_NET\_WM\_NAME}
\EFcd{;;}                          \EFc{:window frame-container}
\EFcd{;;}                          \EFc{:data}
\EFcd{;;}                          \EFc{(format "EXWM floating frame container for 0x\%x" id)))}
\EFcd{;;}       \EFc{;; Map it.}
\EFcd{;;}       \EFc{(xcb:+request exwm--connection}
\EFcd{;;}           \EFc{(make-instance 'xcb:MapWindow :window frame-container))}
\EFcd{;;}       \EFc{;; Put the X window right above this frame container.}
\EFcd{;;}       \EFc{(xcb:+request exwm--connection}
\EFcd{;;}           \EFc{(make-instance 'xcb:ConfigureWindow}
\EFcd{;;}                          \EFc{:window id}
\EFcd{;;}                          \EFc{:value-mask (logior xcb:ConfigWindow:Sibling}
\EFcd{;;}                                              \EFc{xcb:ConfigWindow:StackMode)}
\EFcd{;;}                          \EFc{:sibling frame-container}
\EFcd{;;}                          \EFc{:stack-mode xcb:StackMode:Above)))}
\EFcd{;;}     \EFc{;; Reparent this frame to its container.}
\EFcd{;;}     \EFc{(xcb:+request exwm--connection}
\EFcd{;;}         \EFc{(make-instance 'xcb:ReparentWindow}
\EFcd{;;}                        \EFc{:window outer-id :parent frame-container :x 0 :y 0))}
\EFcd{;;}     \EFc{(exwm-floating--set-allowed-actions id nil)}
\EFcd{;;}     \EFc{(xcb:flush exwm--connection)}
\EFcd{;;}     \EFc{;; Set window/buffer}
\EFcd{;;}     \EFc{(with-current-buffer (exwm--id->buffer id)}
\EFcd{;;}       \EFc{(setq window-size-fixed exwm--fixed-size}
\EFcd{;;}             \EFc{exwm--floating-frame frame)}
\EFcd{;;}       \EFc{;; Do the refresh manually.}
\EFcd{;;}       \EFc{(remove-hook 'window-configuration-change-hook \#'exwm-layout--refresh)}
\EFcd{;;}       \EFc{(set-window-buffer window (current-buffer)) ;this changes current buffer}
\EFcd{;;}       \EFc{(add-hook 'window-configuration-change-hook \#'exwm-layout--refresh)}
\EFcd{;;}       \EFc{(set-window-dedicated-p window t)}
\EFcd{;;}       \EFc{(exwm-layout--show id window))}
\EFcd{;;}     \EFc{(with-current-buffer (exwm--id->buffer id)}
\EFcd{;;}       \EFc{(if (exwm-layout--iconic-state-p id)}
\EFcd{;;}           \EFc{;; Hide iconic floating X windows.}
\EFcd{;;}           \EFc{(exwm-floating-hide)}
\EFcd{;;}         \EFc{(with-selected-frame exwm--frame}
\EFcd{;;}           \EFc{(exwm-layout--refresh)))}
\EFcd{;;}       \EFc{(select-frame-set-input-focus frame))}
\EFcd{;;}     \EFc{;;} \textcolor[HTML]{ff6c6b}{\textbf{FIXME:}} \EFc{Strangely, the Emacs frame can move itself at this point}
\EFcd{;;}     \EFc{;;        when there are left/top struts set.  Force resetting its}
\EFcd{;;}     \EFc{;;        position seems working, but it'd better to figure out why.}
\EFcd{;;}     \EFc{;;} \textcolor[HTML]{ff6c6b}{\textbf{FIXME:}} \EFc{This also happens in another case (\#220) where the cause is}
\EFcd{;;}     \EFc{;;        still unclear.}
\EFcd{;;}     \EFc{(exwm--set-geometry outer-id 0 0 nil nil)}
\EFcd{;;}     \EFc{(xcb:flush exwm--connection))}
\EFcd{;;}   \EFc{(with-current-buffer (exwm--id->buffer id)}
\EFcd{;;}     \EFc{(run-hooks 'exwm-floating-setup-hook))}
\EFcd{;;}   \EFc{;; Redraw the frame.}
\EFcd{;;}   \EFc{(redisplay t))}

\EFcd{;;} \EFc{Additional commands that should also work in exwm}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-S-<return>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{+vterm/toggle} nil\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-e"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{elfeed-load-summary}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-v"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{open-yt-dl-videos}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-r"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFk{progn}
  \EFrdd{(}\EFf{+vterm/here} t\EFrdd{)}
  \EFrdd{(}vterm-send-string \EFs{"cd /home/user/dox/install/rosarium \&\& /home/user/dox/install/rosarium/target/release/rosarium \char92{}n"}\EFrdd{)}
\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<f4>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{go-to-scratch}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<left>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{winner-undo}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<right>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{winner-undo}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-a"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{org-agenda-list}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-m"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{mu4e} t\EFrdc{)} \EFrdc{(}\EFf{mu4e--goto-inbox}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-unset-key} \EFrdb{(}\EFo{kbd} \EFs{"S-s-1"}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{keymap-global-set} \EFs{"S-s-1"} \EFhq{\#'}\EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFrdd{(}\EFf{exwm-move-window-to-workspace} \EFhn{1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"S-s-1"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFrdd{(}\EFf{exwm-move-window-to-workspace} \EFhn{1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{exwm-input--update-global-prefix-keys}\EFrda{)}

\EFcd{;;} \EFc{Wallpaper}
\EFrda{(}\EFk{ifdirexists} \EFs{"/home/user/dox/wallpapers"}
             \EFrdb{(}\EFk{setq} \EFv{wallpaper-cycle-directory} dir\EFrdb{)}
             \EFrdb{(}\EFo{wallpaper-set-wallpaper}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{exwm-init}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{exwm-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{EXWM Buffer movements}
\label{sec:org358f9a7}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{exwm-buffer-movements}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgc960519}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} buffer-move\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:orge3468ce}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-h"}\EFrdb{)} \EFhq{'}\EFhs{buf-move-left}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-l"}\EFrdb{)} \EFhq{'}\EFhs{buf-move-right}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-k"}\EFrdb{)} \EFhq{'}\EFhs{buf-move-up}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-j"}\EFrdb{)} \EFhq{'}\EFhs{buf-move-down}\EFrda{)}

\EFcd{;} \EFc{Resize}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<kp-8>"}\EFrdb{)} \EFhq{'}\EFhs{exwm-layout-enlarge-window}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<kp-2>"}\EFrdb{)} \EFhq{'}\EFhs{exwm-layout-shrink-window}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<kp-6>"}\EFrdb{)} \EFhq{'}\EFhs{exwm-layout-enlarge-window-horizontally}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<kp-2>"}\EFrdb{)} \EFhq{'}\EFhs{exwm-layout-shrink-window-horizontally}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<kp-5>"}\EFrdb{)} \EFhq{'}\EFhs{exwm-layout-toggle-mode-line}\EFrda{)}
\EFrda{(}\EFo{exwm-input--update-global-prefix-keys}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{exwm-buffer-movements}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Exwm Gaps}
\label{sec:org2714599}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{exwm-gaps}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:orgb2ff4eb}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} exwm-outer-gaps
  \EFb{:recipe}
  \EFrdb{(}\EFb{:host} github
   \EFb{:repo} \EFs{"lucasgruss/exwm-outer-gaps"}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:org41aaef4}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{use-package!} exwm-outer-gaps
  \EFb{:after} \EFrdb{(}exwm xelb\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFv{exwm-outer-gaps-mode} \EFhn{+1}\EFrdb{)}
  \EFrdb{(}\EFo{exwm-input-set-key} \EFrdc{(}\EFo{kbd} \EFs{"s-+"}\EFrdc{)} \EFhq{'}\EFhs{exwm-outer-gaps-increment}\EFrdb{)}
  \EFrdb{(}\EFo{exwm-input-set-key} \EFrdc{(}\EFo{kbd} \EFs{"s--"}\EFrdc{)} \EFhq{'}\EFhs{exwm-outer-gaps-decrement}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{exwm-gaps}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{General}
\label{sec:org71a6915}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{general}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgb0c5fd0}
\subsubsection{Code}
\label{sec:org8ee6aea}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{general.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} \EFv{mouse-autoselect-window} t
      \EFv{focus-follows-mouse} t\EFrda{)}

\EFcd{;;} \EFc{Disable backup files}
\EFrda{(}\EFk{setq} \EFv{make-backup-files} nil\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{auto-save-default} nil\EFrda{)}

\EFcd{;;} \EFc{Delete selection when pasting}
\EFrda{(}\EFv{delete-selection-mode} \EFhn{1}\EFrda{)}

\EFcd{;;} \EFc{Save the session}
\EFrda{(}\EFv{desktop-save-mode} \EFhn{1}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{desktop-restore-eager} \EFhn{10}\EFrda{)}
\EFcd{;;} \EFc{Save last visited place in files}
\EFrda{(}\EFk{setq-default} \EFv{save-place} t\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{save-place-file} \EFs{"\char126{}/.emacs.d/etc/saveplace"}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{general}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Navigation}
\label{sec:org462d104}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{navigation}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orga2422eb}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} switch-window\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org6def9d4}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{navigation.el -*- lexical-binding: t; -*-}

\EFcd{;;} \EFc{Kill minibuffer when loosing focus}
\EFrda{(}\EFk{defun} \EFf{stop-using-minibuffer} \EFrdb{(}\EFrdb{)}
  \EFd{"kill the minibuffer"}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{>=} \EFrda{(}\EFo{recursion-depth}\EFrda{)} \EFhn{1}\EFrdd{)} \EFrdd{(}\EFo{active-minibuffer-window}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{abort-recursive-edit}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{mouse-leave-buffer-hook} \EFhq{'}\EFhs{stop-using-minibuffer}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{doom-fallback-buffer-name} \EFs{" Doom"}
      \EFv{+doom-dashboard-name} \EFs{" Doom"}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{+doom-dashboard-mode-map}
      \EFb{:ne} \EFs{"f"} \EFhq{\#'}\EFhs{find-file}
      \EFb{:ne} \EFs{"r"} \EFhq{\#'}\EFhs{consult-recent-file}
      \EFb{:ne} \EFs{"p"} \EFhq{\#'}\EFhs{doom/open-private-config}
      \EFb{:ne} \EFs{"c"} \EFrdb{(}\EFk{cmd!} \EFrdc{(}\EFo{find-file} \EFrdd{(}\EFo{expand-file-name} \EFs{"config.org"} \EFv{doom-private-dir}\EFrdd{)}\EFrdc{)}\EFrdb{)}
      \EFb{:ne} \EFs{"."} \EFrdb{(}\EFk{cmd!} \EFrdc{(}\EFf{doom-project-find-file} \EFs{"\char126{}/.config/"}\EFrdc{)}\EFrdb{)} \EFcd{;} \EFc{. for dotfiles}
      \EFb{:ne} \EFs{"b"} \EFhq{\#'}\EFhs{+vertico/switch-workspace-buffer}
      \EFb{:ne} \EFs{"B"} \EFhq{\#'}\EFhs{consult-buffer}
      \EFb{:ne} \EFs{"q"} \EFhq{\#'}\EFhs{save-buffers-kill-terminal}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:n} \EFrdb{[}mouse-8\EFrdb{]} \EFhq{\#'}\EFhs{better-jumper-jump-backward}
      \EFb{:n} \EFrdb{[}mouse-9\EFrdb{]} \EFhq{\#'}\EFhs{better-jumper-jump-forward}\EFrda{)}

\EFcd{;}\EFc{(setq org-roam-directory "") ;; Temporary workaroundA}
\EFcd{;}\EFc{(setq frame-title-format}
\EFcd{;}      \EFc{'(""}
\EFcd{;}        \EFc{(:eval}
\EFcd{;}         \EFc{(if (s-contains-p org-roam-directory (or buffer-file-name ""))}
\EFcd{;}             \EFc{(replace-regexp-in-string}
\EFcd{;}              \EFc{".*/[0-9]*-?" " "}
\EFcd{;}              \EFc{(subst-char-in-string ?\_ ?  buffer-file-name))}
\EFcd{;}           \EFc{"\%b"))}
\EFcd{;}        \EFc{(:eval}
\EFcd{;}         \EFc{(let ((project-name (projectile-project-name)))}
\EFcd{;}           \EFc{(unless (string= "-" project-name)}
\EFcd{;}             \EFc{(format (if (buffer-modified-p)  "  \%s" "  \%s") project-name))))))}

\EFrda{(}\EFk{setq} \EFv{display-line-numbers-type} \EFhq{'}\EFhs{relative}\EFrda{)}

\EFcd{;;;} \EFc{Ace window}
\EFrda{(}\EFk{use-package!} ace-window
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{ace-window-display-mode} nil
        \EFv{aw-keys} \EFhq{'}\EFrdc{(}\EFhn{106} \EFhn{104} \EFhn{103} \EFhn{102} \EFhn{100} \EFhn{115} \EFhn{97} \EFhn{107} \EFhn{108}\EFrdc{)}
        \EFv{aw-scope} \EFhq{'}\EFhs{global}\EFrdb{)}
 \EFcd{;} \EFc{ace window does not work well with exwm, it draws keys underneath the window}
 \EFcd{;} \EFc{:bind}
 \EFcd{;} \EFc{([remap other-window] . ace-window)}
  \EFrda{)}

\EFcd{;;;} \EFc{Switch window}
\EFrda{(}\EFk{use-package} switch-window
  \EFb{:ensure} t
  \EFb{:defer} t
  \EFb{:config}
  \EFrdb{(}\EFk{setq} switch-window-multiple-frames nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} switch-window-input-style \EFhq{'}\EFhs{minibuffer}\EFrdb{)}
  \EFrdb{(}\EFk{setq} switch-window-increase \EFhn{4}\EFrdb{)}
  \EFrdb{(}\EFk{setq} switch-window-threshold \EFhn{2}\EFrdb{)}
  \EFrdb{(}\EFk{setq} switch-window-shortcut-style \EFhq{'}\EFhs{qwerty}\EFrdb{)}
  \EFrdb{(}\EFk{setq} switch-window-qwerty-shortcuts
	\EFhq{'}\EFrdc{(}\EFs{"j"} \EFs{"k"} \EFs{"l"} \EFs{"a"} \EFs{"s"} \EFs{"d"} \EFs{"f"}\EFrdc{)}\EFrdb{)} \EFcd{;} \EFc{ does not work without pressing RET}
  \EFb{:bind}
  \EFrdb{(}\EFrdc{[}remap other-window\EFrdc{]} . switch-window\EFrdb{)}\EFrda{)}

\EFcd{;;;} \EFc{Temporarily maximize current buffer}
\EFrda{(}\EFk{defun} \EFf{toggle-maximize-buffer} \EFrdb{(}\EFrdb{)} \EFd{"Maximize buffer"}
       \EFrdb{(}\EFk{interactive}\EFrdb{)}
       \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{=} \EFhn{1} \EFrdd{(}\EFo{length} \EFrda{(}\EFo{window-list}\EFrda{)}\EFrdd{)}\EFrdc{)}
	   \EFrdc{(}\EFo{jump-to-register} \EFhq{'}\EFhs{\_}\EFrdc{)}
	 \EFrdc{(}\EFk{progn}
	   \EFrdd{(}\EFo{window-configuration-to-register} \EFhq{'}\EFhs{\_}\EFrdd{)}
	   \EFrdd{(}\EFo{delete-other-windows}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{transparent-buffer-advice}
  \EFrdb{(}orig-fun \EFt{\&rest} args\EFrdb{)}
  \EFrdb{(}\EFo{shell-command} \EFs{"transset -p 1"}\EFrdb{)} \EFcd{;} \EFc{0.3}
  \EFrdb{(}\EFk{let}
      \EFrdc{(}\EFrdd{(}res
	\EFrda{(}\EFo{apply} orig-fun args\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{shell-command} \EFs{"transset -p 1"}\EFrdc{)}
    res\EFrdb{)}\EFrda{)}


\EFcd{;;;} \EFc{kill current buffer}
\EFrda{(}\EFk{defun} \EFf{kill-curr-buffer} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{string-equal} \EFrda{(}\EFo{buffer-name} \EFrdb{(}\EFo{current-buffer}\EFrdb{)}\EFrda{)} \EFs{"*scratch*"}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFo{kill-buffer} \EFrdd{(}\EFo{current-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{bury-buffer}\EFrdc{)}
    \EFrdc{(}\EFo{switch-to-buffer} \EFs{"*scratch*"}\EFrdc{)}
  \EFrdb{)}\EFrda{)}

\EFcd{;;;} \EFc{move to start and end of buffer}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"M-n"}\EFrdb{)} \EFhq{'}\EFhs{end-of-buffer}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"M-p"}\EFrdb{)} \EFhq{'}\EFhs{beginning-of-buffer}\EFrda{)}

\EFcd{;;} \EFc{Kill all buffers}
\EFrda{(}\EFk{defun} \EFf{close-all-buffers} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mapc} \EFhq{'}\EFhs{kill-buffer} \EFrdc{(}\EFo{buffer-list}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x C-k k"}\EFrdb{)} \EFhq{'}\EFhs{close-all-buffers}\EFrda{)}

\EFcd{;;} \EFc{Kill unwanted buffers}
\EFrda{(}\EFk{defun} \EFf{kill-if-unwanted} \EFrdb{(}buffer\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}b \EFrda{(}\EFo{buffer-name} buffer\EFrda{)}\EFrdd{)}
	\EFrdd{(}bfn \EFrda{(}\EFv{buffer-file-name} buffer\EFrda{)}\EFrdd{)}
        \EFrdd{(}bmm \EFrda{(}\EFo{buffer-local-value} \EFhq{'}\EFv{major-mode} buffer\EFrda{)}\EFrdd{)}
	\EFrdd{(}unwanted-buffers \EFhq{'}\EFrda{(}
			    \EFs{"*Messages*"}
			    \EFs{"*Backtrace*"}
			    \EFs{"*Help*"}
			    \EFs{"*Warnings*"}
			    \EFs{"*Compile-Log*"}
			    \EFs{"*elfeed-log*"}
			    \EFs{"*system-packages*"}
			    \EFs{"*Async Shell Command*"}
			    \EFs{"*Flycheck errors*"}
			    \EFs{"*Flycheck error messages*"}
			    \EFs{"*Flymake log*"}
			    \EFs{"*Calendar*"}
			    \EFs{"*XELB-DEBUG*"}
			    \EFs{"*Read-Aloud Log*"}
			    \EFs{"*elfeed-search*"}
			    \EFs{"elfeed.org"}
			    \EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{or} \EFrda{(}\EFo{member} b unwanted-buffers\EFrda{)}
	  \EFrda{(}\EFo{member} bfn \EFrdb{(}\EFo{mapcar} \EFhq{'}\EFhs{expand-file-name} \EFv{org-agenda-files}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{eq} \EFhq{'}\EFhs{dired-mode} bmm\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*tramp.*}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.png\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.jpg\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.jpeg\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.gif\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.log\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}\_region\_.tex\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*helpful .*}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*"} b\EFrda{)}
          \EFrda{(}\EFo{string-match} \EFs{"- Thunar"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}magit"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*.*}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*\$"} b\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer} b\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{kill-unwanted-buffers} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mapc} \EFhq{'}\EFhs{kill-if-unwanted} \EFrdc{(}\EFo{buffer-list}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x k"}\EFrdb{)} \EFhq{'}\EFhs{kill-this-buffer}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x x k"}\EFrdb{)} \EFhq{'}\EFhs{kill-unwanted-buffers}\EFrda{)}

\EFcd{;;;} \EFc{Window splitting}
\EFrda{(}\EFk{defun} \EFf{split-and-follow-horizontally} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{split-window-below}\EFrdb{)}
  \EFrdb{(}\EFo{balance-windows}\EFrdb{)}
  \EFrdb{(}\EFo{other-window} \EFhn{1}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x 2"}\EFrdb{)} \EFhq{'}\EFhs{split-and-follow-horizontally}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{split-and-follow-vertically} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{split-window-right}\EFrdb{)}
  \EFrdb{(}\EFo{balance-windows}\EFrdb{)}
  \EFrdb{(}\EFo{other-window} \EFhn{1}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x 3"}\EFrdb{)} \EFhq{'}\EFhs{split-and-follow-vertically}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{kill-and-balance} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{delete-window}\EFrdb{)}
  \EFrdb{(}\EFo{balance-windows}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x 0"}\EFrdb{)} \EFhq{'}\EFhs{kill-and-balance}\EFrda{)}



\EFcd{;;;} \EFc{Subword moving}
\EFrda{(}\EFv{global-subword-mode} \EFhn{1}\EFrda{)}

\EFcd{;;;} \EFc{Cycle though tabs}
\EFcd{;}\EFc{(global-set-key (kbd "C-<tab>") 'next-buffer)}
\EFcd{;}\EFc{(global-set-key (kbd "<C-iso-lefttab>") 'previous-buffer)}

\EFcd{;;;} \EFc{Cycle through workspaces}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-TAB"}\EFrdb{)} \EFhq{'}\EFhs{+workspace/cycle}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-TAB"}\EFrdb{)} \EFhq{'}\EFhs{+workspace/cycle}\EFrda{)}
\EFrda{(}\EFo{exwm-input--update-global-prefix-keys}\EFrda{)}

\EFcd{;;;} \EFc{Winum mode for easy moving through windows}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-="} \EFhq{'}\EFhs{+workspace/switch-to-9}\EFrda{)}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-!"} \EFhq{'}\EFhs{+workspace/switch-to-0}\EFrda{)}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-\char92{}""} \EFhq{'}\EFhs{+workspace/switch-to-1}\EFrda{)}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-"} \EFhq{'}\EFhs{+workspace/switch-to-2}\EFrda{)}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-\$"} \EFhq{'}\EFhs{+workspace/switch-to-3}\EFrda{)}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-\%"} \EFhq{'}\EFhs{+workspace/switch-to-4}\EFrda{)}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-\&"} \EFhq{'}\EFhs{+workspace/switch-to-5}\EFrda{)}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-/"} \EFhq{'}\EFhs{+workspace/switch-to-6}\EFrda{)}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-("} \EFhq{'}\EFhs{+workspace/switch-to-7}\EFrda{)}
	 \EFrda{(}\EFk{bind-key} \EFs{"s-)"} \EFhq{'}\EFhs{+workspace/switch-to-8}\EFrda{)}


\EFrda{(}\EFo{provide} \EFhq{'}\EFo{navigation}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Shortcuts}
\label{sec:org9f1cd56}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{shortcuts}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org35cd201}
\subsubsection{Code}
\label{sec:org4f9e2e7}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{shortcuts.el -*- lexical-binding: t; -*-}

\EFcd{;;;;} \EFc{Copy-whole-line}
\EFrda{(}\EFk{defun} \EFf{copy-whole-line} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{kill-ring-save} \EFrdd{(}\EFo{point-at-bol}\EFrdd{)} \EFrdd{(}\EFo{point-at-eol}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c w l"}\EFrdb{)} \EFhq{'}\EFhs{copy-whole-line}\EFrda{)}

\EFcd{;;;;} \EFc{Copy-line-above and copy-line-below (and paste)}
\EFrda{(}\EFk{defun} \EFf{copy-line-above} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{evil-previous-visual-line}\EFrdc{)}
    \EFrdc{(}\EFf{copy-whole-line}\EFrdc{)}
    \EFrdc{(}\EFo{evil-next-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{evil-paste-after} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c l a"}\EFrdb{)} \EFhq{'}\EFhs{copy-line-above}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{copy-line-below} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{evil-next-visual-line}\EFrdc{)}
    \EFrdc{(}\EFf{copy-whole-line}\EFrdc{)}
    \EFrdc{(}\EFo{evil-previous-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{evil-paste-after} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c l b"}\EFrdb{)} \EFhq{'}\EFhs{copy-line-below}\EFrda{)}

\EFcd{;;;;} \EFc{Duplicate line}
\EFrda{(}\EFk{defun} \EFf{duplicate-line} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{evil-open-below} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFf{copy-line-above}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{evil-next-visual-line}\EFrdb{)}
  \EFrdb{(}\EFo{evil-normal-state}\EFrdb{)}
  \EFrdb{(}\EFo{evil-forward-char}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c l l"}\EFrdb{)} \EFhq{'}\EFhs{duplicate-line}\EFrda{)}

\EFcd{;;;} \EFc{Kill word improved}
\EFcd{;;;} \EFc{normal kill-word kills forward, but not whole word. This fixes that}
\EFrda{(}\EFk{defun} \EFf{kill-whole-word} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{backward-word}\EFrdb{)}
  \EFrdb{(}\EFo{kill-word} \EFhn{1}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c k w"}\EFrdb{)} \EFhq{'}\EFhs{kill-whole-word}\EFrda{)}

\EFcd{;;;} \EFc{File shortcuts}
\EFcd{;;} \EFc{Note taken on [2018-08-03 Fri 18:19]}
\EFrda{(}\EFo{global-unset-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defadvice} \EFf{goto-line} \EFrdb{(}after unfold-tree activate\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFf{outline-invisible-p}\EFrdc{)}
    \EFrdc{(}\EFk{save-excursion}
      \EFrdd{(}\EFo{outline-previous-visible-heading} \EFhn{1}\EFrdd{)}
      \EFrdd{(}\EFo{org-fold-show-subtree}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{agenda-today} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{goto-line} \EFrdc{(}\EFo{string-to-number} \EFrdd{(}\EFo{shell-command-to-string} \EFs{"\char126{}/.scripts/agendatoday"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{org-reveal} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dailyplan}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFrdc{(}\EFo{shell-command-to-string} \EFs{"date +'}\textcolor[HTML]{a9a1e1}{/home/user/dp/dailyplan/\%Y/\%Y-\%m/\%Y-\%m-\%d.org}\EFs{' | tr -d '}\textcolor[HTML]{a9a1e1}{\char92{}n}\EFs{'"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{end-of-buffer}\EFrdb{)}\EFrda{)}

                                        \EFcd{;}\EFc{(add-hook 'find-file-hook 'dailyplan-hook)}
                                        \EFcd{;}\EFc{(defun dailyplan-hook ()}
                                        \EFcd{;}  \EFc{(when (string= (buffer-file-name) "dailyplan.org")}
                                        \EFcd{;}    \EFc{(agenda-today)))}

\EFrda{(}\EFk{defun} \EFf{books}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/books.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{thesis}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/nextcloud/bachelor/thesis/structure.tex"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{projects}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/currprojects.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{movies}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/movies.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{reviews}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/reviews/2018.org"}\EFrdb{)}
  \EFrdb{(}\EFf{split-and-follow-vertically}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/reviews/template.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ceres}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/ssh:user@sermak.xyz:\char126{}"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ceres-root}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/ssh:user@sermak.xyz|sudo:root@sermak.xyz:/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{jarvis}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/ssh:user@sermak.xyz|sudo:root@jarvis:/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{jarvis-root}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/ssh:user@sermak.xyz|ssh:user@jarvis:/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z d"}\EFrdb{)} \EFhq{'}\EFhs{dailyplan}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z b"}\EFrdb{)} \EFhq{'}\EFhs{books}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z m"}\EFrdb{)} \EFhq{'}\EFhs{movies}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z r"}\EFrdb{)} \EFhq{'}\EFhs{reviews}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z p"}\EFrdb{)} \EFhq{'}\EFhs{projects}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z t"}\EFrdb{)} \EFhq{'}\EFhs{thesis}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z e"}\EFrdb{)} \EFhq{'}\EFhs{mu4e}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z s c"}\EFrdb{)} \EFhq{'}\EFhs{ceres}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z s r"}\EFrdb{)} \EFhq{'}\EFhs{ceres-root}\EFrda{)}

\EFcd{;;} \EFc{University}
\EFrda{(}\EFk{setq} uni-base-folder \EFs{"/mnt/server-de/mnt/backup/backups/pre\_master/Uni"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{open-uni-folder} \EFrdb{(}folder\EFrdb{)}
  \EFd{"Mount/Open university folder specified as FOLDER."}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{file-exists-p} uni-base-folder\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{shell-command} \EFs{"sshfs -p2222 sermak.xyz:/ /mnt/server-de"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}dir \EFrda{(}\EFo{f-join} uni-base-folder folder\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{not} \EFrda{(}\EFo{file-exists-p} dir\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{mkdir} dir t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{find-file} \EFrdd{(}\EFo{f-join} uni-base-folder folder\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{uni-folder-shortcut} \EFrdb{(}shortcut folder funcname\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{progn}
     \EFrdc{(}\EFk{defun} ,funcname \EFrdd{(}\EFrdd{)}
       ,\EFrdd{(}\EFo{format} \EFs{"Open Uni/\%s"} folder\EFrdd{)}
       \EFrdd{(}\EFk{interactive}\EFrdd{)}
       \EFrdd{(}\EFf{open-uni-folder} ,folder\EFrdd{)}\EFrdc{)}
     \EFrdc{(}\EFo{global-set-key} \EFrdd{(}\EFo{kbd} \EFrda{(}\EFo{concat} \EFs{"C-c u "} ,shortcut\EFrda{)}\EFrdd{)} \EFhq{'},funcname\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"u"} \EFs{""} uni\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"6"} \EFs{"6"} uni6\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"l 1"} \EFs{"6/Orthodox Liturgy I"} orthodox-liturgy-1\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"l 2"} \EFs{"6/Orthodox Liturgy II"} orthodox-liturgy-2\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"h 1"} \EFs{"6/Orthodox History I"} orthodox-history-1\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"h 2"} \EFs{"6/Orthodox History II"} orthodox-history-2\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"t 1"} \EFs{"6/Orthodox Theology I"} orthodox-theology-1\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"t 2"} \EFs{"6/Orthodox Theology II"} orthodox-theology-2\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"s"} \EFs{"6/Orthodox Scripture"} orthodox-scripture\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"a"} \EFs{"6/Orthodox Anthropology"} orthodox-anthropology\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"w"} \EFs{"6/War and Statesbuilding in Afghanistan"} war-and-statesbuilding\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"e"} \EFs{"6/Exegesis of the Old and New Testament"} exegesis\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"m"} \EFs{"6/Monte Carlo Techniques"} monte-carlo\EFrda{)}

\EFcd{;;} \EFc{Tones}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c -"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{""}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c \char94{}"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{""}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFcd{;;;} \EFc{Chinese tones}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 1"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{""}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 2"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{""}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 3"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{""}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 4"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{""}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFcd{;;;} \EFc{Devanagari anusvara}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 5"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{""}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 6"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{""}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;} \EFc{Rectangle mark mode}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFv{rectangle-mark-mode}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFcd{;;;} \EFc{Sudo-edit}
\EFrda{(}\EFk{use-package!} sudo-edit
  \EFb{:bind} \EFrdb{(}\EFs{"C-c s"} . sudo-edit\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{rededicate-window} \EFrdb{(}\EFrdb{)}
  \EFd{"Toggles window dedication in the selected window."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}dedication \EFrda{(}\EFo{not} \EFrdb{(}\EFo{window-dedicated-p} \EFrdc{(}\EFo{selected-window}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFrdd{(}\EFo{format} \EFs{"\%s"} dedication\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{set-window-dedicated-p} \EFrdd{(}\EFo{selected-window}\EFrdd{)} dedication\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-S-<return>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{+vterm/toggle} nil\EFrdc{)}\EFrdb{)}\EFrda{)}

                                        \EFcd{;} \EFc{Org agenda}

\EFrda{(}\EFk{defun} \EFf{agenda-folder} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/home/user/sync/agenda/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{agenda-daily} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/home/user/sync/agenda/daily.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{agenda-show-daily-habits} \EFrdb{(}\EFrdb{)}
  \EFd{"Open daily habits document as org column"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFf{agenda-daily}\EFrdb{)}
  \EFrdb{(}\EFf{org-columns}\EFrdb{)}
  \EFrdb{(}\EFv{org-modern-mode} \EFhn{-1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{agenda-uni} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/home/user/sync/agenda/uni.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{agenda-personal} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/home/user/sync/agenda/personal.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c a a"}\EFrdb{)} \EFhq{'}\EFhs{agenda-folder}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c a u"}\EFrdb{)} \EFhq{'}\EFhs{agenda-uni}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c a p"}\EFrdb{)} \EFhq{'}\EFhs{agenda-personal}\EFrda{)}
\EFcd{;}\EFc{(global-set-key (kbd "s-t") 'agenda-show-daily-habits)}

                                        \EFcd{;} \EFc{Books}

\EFrda{(}\EFk{defun} \EFf{books} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/home/user/dox/books/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c b"}\EFrdb{)} \EFhq{'}\EFhs{books}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{shortcuts}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Config visit}
\label{sec:org7b105c5}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{config-visit}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org08a2ad2}
\subsubsection{Code}
\label{sec:org8f88c9c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{config.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} module-dir \EFrdb{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"modules/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq-default} \EFv{custom-file} \EFrdb{(}\EFo{expand-file-name} \EFs{".custom.el"} \EFv{doom-private-dir}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{when} \EFrdb{(}\EFo{file-exists-p} \EFv{custom-file}\EFrdb{)}
  \EFrdb{(}\EFo{load} \EFv{custom-file}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{config-visit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFrdc{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"config.org"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{init-visit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFrdc{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"init.el"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{packages-visit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFrdc{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"packages.el"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{module-visit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} module-dir\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{recompile-modules} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{digit-argument} nil\EFrdb{)}
  \EFrdb{(}\EFo{byte-recompile-directory} module-dir \EFhn{0}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{config-reload} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFcd{;;}\EFc{(recompile-modules)}
  \EFrdb{(}\EFo{org-babel-tangle-file} \EFrdc{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"config.org"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{load-file} \EFrdc{(}\EFo{expand-file-name} \EFrdd{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"config.el"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c e c"}\EFrdb{)} \EFhq{'}\EFhs{config-visit}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c e p"}\EFrdb{)} \EFhq{'}\EFhs{packages-visit}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c e i"}\EFrdb{)} \EFhq{'}\EFhs{init-visit}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c e m"}\EFrdb{)} \EFhq{'}\EFhs{module-visit}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c r"}\EFrdb{)} \EFhq{'}\EFhs{config-reload}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{config-visit}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Legacy ivy functions, still needed for vertico icons}
\label{sec:org9fc8419}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{search-ivy}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org4fb344b}
\subsubsection{Code}
\label{sec:orgb0e4599}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{search.el -*- lexical-binding: t; -*-}

\EFcd{;;} \EFc{Swiper / Ivy / Counsel}
\EFcd{;;}  \EFc{Swiper gives us a really efficient incremental search with regular expressions}
\EFcd{;;}  \EFc{and Ivy / Counsel replace a lot of ido or helms completion functionality}

\EFrda{(}\EFk{defun} \EFf{ignore-dired-buffers-ivy} \EFrdb{(}str\EFrdb{)}
  \EFd{"Return non-nil if STR names a Dired buffer.}
\EFd{This function is intended for use with `}\textcolor[HTML]{a9a1e1}{ivy-ignore-buffers}\EFd{'."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}buf \EFrda{(}\EFo{get-buffer} str\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{and} buf \EFrdd{(}\EFo{eq} \EFrda{(}\EFo{buffer-local-value} \EFhq{'}\EFv{major-mode} buf\EFrda{)} \EFhq{'}\EFhs{dired-mode}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ignore-help-buffers-ivy} \EFrdb{(}str\EFrdb{)}
  \EFd{"Return non-nil if STR names a help buffer (buffers starting and ending with *)}
\EFd{This function is intended for use with `}\textcolor[HTML]{a9a1e1}{ivy-ignore-buffers}\EFd{'."}
  \EFrdb{(}\EFk{and}
   \EFrdc{(}\EFo{s-starts-with-p} \EFs{"*"} str\EFrdc{)}
   \EFrdc{(}\EFo{s-ends-with-p} \EFs{"*"} str\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ignore-unwanted-buffers-ivy} \EFrdb{(}str\EFrdb{)}
  \EFd{"Return non-nil if STR names a Dired buffer.}
\EFd{This function is intended for use with `}\textcolor[HTML]{a9a1e1}{ivy-ignore-buffers}\EFd{'."}
  \EFrdb{(}\EFk{or}
   \EFrdc{(}\EFo{string-equal} \EFs{"elfeed.org"} str\EFrdc{)}
   \EFrdc{(}\EFo{member} str \EFrdd{(}\EFo{map} \EFhq{'}\EFhs{list} \EFhq{'}\EFhs{file-name-nondirectory} \EFv{org-agenda-files}\EFrdd{)}\EFrdc{)}
   \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{with-eval-after-load} \EFhq{'}\EFhs{ivy}
  \EFrdb{(}\EFk{progn}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{ivy-ignore-buffers} \EFhq{\#'}\EFhs{ignore-dired-buffers-ivy}\EFrdc{)}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{ivy-ignore-buffers} \EFhq{\#'}\EFhs{ignore-help-buffers-ivy}\EFrdc{)}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{ivy-ignore-buffers} \EFhq{\#'}\EFhs{ignore-unwanted-buffers-ivy}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} counsel
  \EFb{:bind}
  \EFrdb{(}\EFrdc{(}\EFs{"M-y"} . counsel-yank-pop\EFrdc{)}
   \EFb{:map} \EFv{ivy-minibuffer-map}
   \EFrdc{(}\EFs{"M-y"} . ivy-next-line\EFrdc{)}\EFrdb{)}\EFrda{)}

                                        \EFcd{;}\EFc{(use-package! all-the-icons-ibuffer}
                                        \EFcd{;}  \EFc{:init (all-the-icons-ibuffer-mode 1))}

\EFrda{(}\EFk{after!} consult
  \EFrdb{(}\EFk{cl-defmethod} \EFf{nerd-icons-completion-get-icon} \EFrdc{(}cand \EFrdd{(}\_cat \EFrda{(}\EFo{eql} buffer\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFd{"Return the icon for the candidate CAND of completion category buffer."}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}mode \EFrdb{(}\EFo{buffer-local-value} \EFhq{'}\EFv{major-mode} \EFrdc{(}\EFo{get-buffer} cand\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}buffname \EFrdb{(}\EFo{buffer-name} \EFrdc{(}\EFo{get-buffer} cand\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}icon \EFrdb{(}\EFf{nerd-icons-icon-for-mode} mode\EFrdb{)}\EFrda{)}
           \EFrda{(}parent-icon \EFrdb{(}\EFf{nerd-icons-icon-for-mode}
                         \EFrdc{(}\EFo{get} mode \EFhq{'}\EFhs{derived-mode-parent}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{concat}
       \EFrda{(}\EFk{or}
        \EFrdb{(}\EFf{nerd-icons--icon-for-firefox} mode buffname\EFrdb{)}
	\EFrdb{(}\EFf{all-the-icons-ivy--icon-for-tor} mode buffname\EFrdb{)}
	\EFrdb{(}\EFf{all-the-icons-ivy--icon-for-exwm} mode buffname\EFrdb{)}
        \EFrdb{(}\EFf{nerd-icons--icon-for-emacs} mode buffname\EFrdb{)}
        icon
        parent-icon
        \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-sticky\_note\_o"}\EFrdb{)}\EFrda{)}
       \EFs{" "}\EFrdd{)}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{nerd-icons--icon-for-emacs} \EFrdb{(}mode buffname\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}m \EFrda{(}\EFo{format} \EFs{"\%s"} mode\EFrda{)}\EFrdd{)}
        \EFrdd{(}b \EFrda{(}\EFo{format} \EFs{"\%s"} buffname\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{and} \EFrda{(}\EFo{string-equal} m \EFs{"messages-buffer-mode"}\EFrda{)}
               \EFrda{(}\EFo{string-equal} b \EFs{"*Messages*"}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{propertize} \EFrda{(}\EFo{nerd-icons-mdicon} \EFs{"nf-md-message\_text\_outline"}\EFrda{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrda{(}\EFb{:foreground} \EFs{"dim gray"}\EFrda{)}\EFrdd{)}\EFrdc{)}

        \EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{Overwrite some stuff for exwm and icons in Firefox}
\EFrda{(}\EFk{defun} \EFf{nerd-icons--icon-for-firefox} \EFrdb{(}mode buffname\EFrdb{)}
  \EFd{"Get icon for Firefox window in exwm-mode.}
\EFd{Assuming that url is in title like in Keepass Helper extension."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-equal} \EFrdd{(}\EFo{format} \EFs{"\%s"} mode\EFrdd{)} \EFs{"exwm-mode"}\EFrdc{)}
      \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}bnl \EFrdb{(}\EFo{split-string} buffname \EFs{" - "}\EFrdb{)}\EFrda{)}
	     \EFrda{(}fnl \EFrdb{(}\EFo{split-string} buffname \EFs{"  "}\EFrdb{)}\EFrda{)}
	     \EFrda{(}browser \EFrdb{(}\EFo{format} \EFs{"\%s"} \EFrdc{(}\EFo{last} fnl\EFrdc{)}\EFrdb{)}\EFrda{)}
             \EFrda{(}youtube \EFrdb{(}\EFo{format} \EFs{"\%s"} \EFrdc{(}\EFo{last} bnl\EFrdc{)}\EFrdb{)}\EFrda{)}
             \EFrdd{)}
        \EFrdd{(}\EFk{if} \EFrda{(}\EFk{or} \EFrdb{(}\EFo{string-equal} youtube \EFs{"(YouTube  Mozilla Firefox)"}\EFrdb{)}
                \EFrdb{(}\EFo{string-equal} youtube \EFs{"(YouTube  Mozilla Firefox (Private Browsing))"}\EFrdb{)}
                \EFrdb{(}\EFo{string-equal} youtube \EFs{"(YouTube  Mozilla Firefox Private Browsing)"}\EFrdb{)}
                \EFrdb{(}\EFo{string-equal} youtube \EFs{"YouTube  Mozilla Firefox Private Browsing"}\EFrdb{)}
                \EFrdb{(}\EFo{string-equal} youtube \EFs{"YouTube  Mozilla Firefox Private Browsing"}\EFrdb{)}
                \EFrda{)}
            \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-youtube"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"red"} \EFb{:background} \EFs{"white"}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFk{if} \EFrdb{(}\EFk{or}
               \EFrdc{(}\EFo{string-equal} browser \EFs{"(Mozilla Firefox)"}\EFrdc{)}
               \EFrdc{(}\EFo{string-equal} browser \EFs{"(Mozilla Firefox (Private Browsing)"}\EFrdc{)}
               \EFrdc{(}\EFo{string-equal} browser \EFs{"Mozilla Firefox Private Browsing"}\EFrdc{)}
               \EFrdc{(}\EFo{string-equal} browser \EFs{"(Mozilla Firefox Private Browsing"}\EFrdc{)}
               \EFrdc{(}\EFo{string-equal} browser \EFs{"(Mozilla Firefox Private Browsing)"}\EFrdc{)}
               \EFrdb{)}
              \EFrdb{(}\EFo{propertize} \EFrdc{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-firefox"}\EFrdc{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdc{(}\EFb{:foreground} \EFs{"orange red"}\EFrdc{)}\EFrdb{)}
	    \EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{Overwrite some stuff for exwm and icons in Tor Browser}
\EFrda{(}\EFk{defun} \EFf{all-the-icons-ivy--icon-for-tor} \EFrdb{(}mode buffname\EFrdb{)}
  \EFd{"Apply youtube icon on Tor Browser window in exwm-mode.}
\EFd{Not assuming that url is in title like in Keepass Helper extension, for privacy."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-equal} \EFrdd{(}\EFo{format} \EFs{"\%s"} mode\EFrdd{)} \EFs{"exwm-mode"}\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}bnl \EFrdb{(}\EFo{split-string} buffname \EFs{" - "}\EFrdb{)}\EFrda{)}\EFrdd{)}
	\EFrdd{(}\EFk{if} \EFrda{(}\EFo{string-equal} \EFrdb{(}\EFo{format} \EFs{"\%s"} \EFrdc{(}\EFo{last} bnl\EFrdc{)}\EFrdb{)} \EFs{"(Tor Browser)"}\EFrda{)}
	    \EFrda{(}\EFk{if} \EFrdb{(}\EFo{string-equal} \EFrdc{(}\EFo{format} \EFs{"\%s"} \EFrdd{(}\EFo{last} bnl \EFhn{2}\EFrdd{)}\EFrdc{)} \EFs{"(YouTube Tor Browser)"}\EFrdb{)}
		\EFrdb{(}\EFf{nerd-icons-icon-for-url} \EFs{"youtube.com"}\EFrdb{)}
	      \EFrdb{(}\EFo{all-the-icons-faicon} \EFs{"user-secret"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-red}\EFrdb{)}
	      \EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{Overwrite some stuff for exwm}
\EFrda{(}\EFk{defun} \EFf{all-the-icons-ivy--icon-for-exwm} \EFrdb{(}mode buffname\EFrdb{)}
  \EFd{"Hard-code some icons for common programs."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-equal} \EFrdd{(}\EFo{format} \EFs{"\%s"} mode\EFrdd{)} \EFs{"exwm-mode"}\EFrdc{)}
      \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{string-prefix-p} \EFs{"Signal"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-comment"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"deep sky blue"}\EFrdb{)}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-prefix-p} \EFs{"Skype"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-skype"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"light blue"}\EFrdb{)}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-suffix-p} \EFs{" - Discord"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-discord"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"purple"}\EFrdb{)}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-prefix-p} \EFs{"OBS"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-video\_camera"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"dark gray"}\EFrdb{)}\EFrda{)}\EFrdd{)}
            \EFrdd{(}\EFrda{(}\EFo{string-prefix-p} \EFs{"QEMU"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-desktop"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"dark gray"}\EFrdb{)}\EFrda{)}\EFrdd{)}
            \EFrdd{(}\EFrda{(}\EFo{string-prefix-p} \EFs{"Bluetooth Devices"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-bluetooth"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"deep sky blue"}\EFrdb{)}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{file-directory-p} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-folder\_open"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"yellow"}\EFrdb{)}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-suffix-p} \EFs{" - mpv"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-play"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"orange"}\EFrdb{)}\EFrda{)}\EFrdd{)}
            \EFrdd{(}\EFrda{(}\EFo{string-suffix-p} \EFs{" - Mozilla Thunderbird"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-mdicon} \EFs{"nf-md-email"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"sky blue"}\EFrdb{)}\EFrda{)}\EFrdd{)}
            \EFrdd{(}\EFrda{(}\EFf{string-match-p} \EFs{" - Thunar"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-folder\_open"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"yellow"}\EFrdb{)}\EFrda{)}\EFrdd{)}
            \EFrdd{(}\EFrda{(}\EFo{string-suffix-p} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.pdf"} buffname\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-faicon} \EFs{"nf-fa-file\_pdf\_o"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"red"}\EFrdb{)}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFk{or} \EFrdb{(}\EFo{string-equal} \EFs{"st"} buffname\EFrdb{)}
                 \EFrdb{(}\EFo{string-prefix-p} \EFrdc{(}\EFo{concat} \EFrdd{(}\EFv{user-login-name}\EFrdd{)} \EFs{"@"}\EFrdc{)} buffname\EFrdb{)}
                 \EFrdb{(}\EFo{string-prefix-p} \EFs{"root@"} buffname\EFrdb{)}
                 \EFrdb{(}\EFo{string-match} \EFs{"st<[0-9]+>"} buffname\EFrdb{)}\EFrda{)}
             \EFrda{(}\EFo{propertize} \EFrdb{(}\EFo{nerd-icons-octicon} \EFs{"nf-oct-terminal"}\EFrdb{)} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdb{(}\EFb{:foreground} \EFs{"green"}\EFrdb{)}\EFrda{)}\EFrdd{)}
	    \EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFo{provide} \EFhq{'}\EFo{search-ivy}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Search with vertico}
\label{sec:orge303333}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{after!} vertico
   \EFrdb{(}\EFk{load-module} \EFhq{'}\EFhs{search-with-vertico}\EFrdb{)}
\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orga49a6d0}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} swiper\EFrda{)}
\EFrda{(}\EFk{package!} vertico-posframe\EFrda{)}
\EFcd{;;} \EFc{(package! vertico)}
\EFcd{;;} \EFc{(package! vertico :recipe (:files (:defaults "extensions/*") ; Special recipe to load extensions conveniently}
\EFcd{;;}                              \EFc{:includes (vertico-indexed}
\EFcd{;;}                                         \EFc{vertico-flat}
\EFcd{;;}                                         \EFc{vertico-grid}
\EFcd{;;}                                         \EFc{vertico-mouse}
\EFcd{;;}                                         \EFc{vertico-quick}
\EFcd{;;}                                         \EFc{vertico-buffer}
\EFcd{;;}                                         \EFc{vertico-repeat}
\EFcd{;;}                                         \EFc{vertico-reverse}
\EFcd{;;}                                         \EFc{vertico-directory}
\EFcd{;;}                                         \EFc{vertico-multiform}
\EFcd{;;}                                         \EFc{vertico-unobtrusive}
\EFcd{;;}                                         \EFc{)))}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:orgffc9fd8}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{use-package!} marginalia
  \EFb{:general}
  \EFrdb{(}\EFb{:keymaps} \EFhq{'}\EFv{minibuffer-local-map}
            \EFs{"M-A"} \EFhq{'}\EFhs{marginalia-cycle}\EFrdb{)}
  \EFb{:custom}
  \EFrdb{(}\EFv{marginalia-max-relative-age} \EFhn{0}\EFrdb{)}
  \EFrdb{(}\EFv{marginalia-align} \EFhq{'}\EFhs{right}\EFrdb{)}
  \EFb{:init}
  \EFrdb{(}\EFv{marginalia-mode}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-"}\EFrdb{)} \EFhq{'}\EFhs{embark-act}\EFrda{)}

\EFrda{(}\EFo{require} \EFhq{'}\EFo{vertico}\EFrda{)}
\EFrda{(}\EFk{defun} \EFf{consult-buffer-no-auxiliary} \EFrdb{(}\EFrdb{)}
  \EFd{"Consult buffer without buffers starting with *"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFcd{;} \EFc{consult-buffer-filter might not be loaded at startup yet}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{boundp} \EFhq{'}\EFv{consult-buffer-filter}\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{consult-buffer-filter}    \EFrdb{(}\EFo{append} \EFrdc{(}\EFo{mapcar} \EFhq{'}\EFhs{file-name-nondirectory} \EFv{org-agenda-files}\EFrdc{)} \EFrdc{(}\EFo{cons} \EFs{"\char92{}\char92{}*"}       \EFv{consult-buffer-filter}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{consult-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{consult-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} vertico
  \EFb{:demand} t                             \EFcd{;} \EFc{Otherwise won't get loaded immediately}
  \EFb{:general}
  \EFrdb{(}\EFb{:keymaps} \EFhq{'}\EFrdc{(}normal insert visual motion\EFrdc{)}
            \EFs{"M-."} \EFhq{\#'}\EFhs{vertico-repeat}
            \EFrdb{)}
  \EFrdb{(}\EFb{:keymaps} \EFhq{'}\EFv{vertico-map}
            \EFs{"<tab>"} \EFhq{\#'}\EFhs{vertico-insert} \EFcd{;} \EFc{Set manually otherwise setting `}\textcolor[HTML]{a9a1e1}{vertico-quick-insert}\EFc{' overrides this}
            \EFs{"<escape>"} \EFhq{\#'}\EFhs{minibuffer-keyboard-quit}
            \EFs{"?"} \EFhq{\#'}\EFhs{minibuffer-completion-help}
            \EFs{"C-M-n"} \EFhq{\#'}\EFhs{vertico-next-group}
            \EFs{"C-M-p"} \EFhq{\#'}\EFhs{vertico-previous-group}
            \EFcd{;;} \EFc{Multiform toggles}
            \EFs{"<backspace>"} \EFhq{\#'}\EFhs{vertico-directory-delete-char}
            \EFs{"C-w"} \EFhq{\#'}\EFhs{vertico-directory-delete-word}
            \EFs{"C-<backspace>"} \EFhq{\#'}\EFhs{vertico-directory-delete-word}
            \EFs{"RET"} \EFhq{\#'}\EFhs{vertico-directory-enter}
            \EFs{"C-i"} \EFhq{\#'}\EFhs{vertico-quick-insert}
            \EFs{"C-o"} \EFhq{\#'}\EFhs{vertico-quick-exit}
            \EFs{"M-o"} \EFhq{\#'}\EFhs{kb/vertico-quick-embark}
            \EFs{"M-G"} \EFhq{\#'}\EFhs{vertico-multiform-grid}
            \EFs{"M-F"} \EFhq{\#'}\EFhs{vertico-multiform-flat}
            \EFs{"M-R"} \EFhq{\#'}\EFhs{vertico-multiform-reverse}
            \EFs{"M-U"} \EFhq{\#'}\EFhs{vertico-multiform-unobtrusive}
            \EFs{"C-l"} \EFhq{\#'}\EFhs{kb/vertico-multiform-indexed-toggle}
            \EFs{"C-"} \EFhq{\#'}\EFhs{embark-act}
            \EFrdb{)}
  \EFb{:bind} \EFrdb{(}
         \EFrdc{(}\EFs{"C-s"} . consult-line\EFrdc{)}
         \EFrdc{(}\EFs{"C-S"} . consult-line-multi\EFrdc{)}
         \EFrdc{(}\EFs{"C-x C-b"} . consult-buffer-no-auxiliary\EFrdc{)}\EFrdb{)}
  \EFb{:hook} \EFrdb{(}\EFrdc{(}\EFo{rfn-eshadow-update-overlay} . vertico-directory-tidy\EFrdc{)} \EFcd{;} \EFc{Clean up file path when typing}
         \EFrdc{(}minibuffer-setup . vertico-repeat-save\EFrdc{)} \EFcd{;} \EFc{Make sure vertico state is saved}
         \EFrdb{)}
  \EFb{:init}
  \EFcd{;}\EFc{(setq vertico-count 13)}
  \EFrdb{(}\EFk{setq} \EFv{vertico-resize} t\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{vertico-cycle} nil\EFrdb{)}
  \EFcd{;;} \EFc{Extensions}
  \EFrdb{(}\EFk{setq} vertico-grid-separator \EFs{"       "}\EFrdb{)}
  \EFrdb{(}\EFk{setq} vertico-grid-lookahead \EFhn{50}\EFrdb{)}
  \EFrdb{(}\EFk{setq} vertico-buffer-display-action \EFhq{'}\EFrdc{(}display-buffer-reuse-window\EFrdc{)}\EFrdb{)}
  \EFcd{;}\EFc{(setq vertico-multiform-categories}
  \EFcd{;} \EFc{'((file reverse)}
  \EFcd{;}   \EFc{(consult-grep buffer)}
  \EFcd{;}   \EFc{(consult-location)}
  \EFcd{;}   \EFc{(imenu buffer)}
  \EFcd{;}   \EFc{(library reverse indexed)}
  \EFcd{;}   \EFc{(org-roam-node reverse indexed)}
  \EFcd{;}   \EFc{(t reverse)}
  \EFcd{;}\EFc{))}
  \EFcd{;}\EFc{(setq vertico-multiform-commands}
  \EFcd{;} \EFc{'(("flyspell-correct-*" grid reverse)}
  \EFcd{;}   \EFc{(org-refile grid reverse indexed)}
  \EFcd{;}   \EFc{(consult-yank-pop indexed)}
  \EFcd{;}   \EFc{(consult-flycheck)}
  \EFcd{;}   \EFc{(consult-lsp-diagnostics)}
  \EFcd{;}   \EFc{))}
  \EFrdb{(}\EFk{defun} \EFf{kb/vertico-multiform-indexed-toggle} \EFrdc{(}\EFrdc{)}
    \EFd{"Toggle between indexed and reverse."}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}vertico-multiform--display-toggle \EFhq{'}\EFv{vertico-indexed-mode}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFv{vertico-indexed-mode}
        \EFrdd{(}\EFo{vertico-multiform--temporary-mode} \EFhq{'}\EFv{vertico-reverse-mode} \EFhn{-1}\EFrdd{)}
      \EFrdd{(}\EFo{vertico-multiform--temporary-mode} \EFhq{'}\EFv{vertico-reverse-mode} \EFhn{1}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{defun} \EFf{kb/vertico-quick-embark} \EFrdc{(}\EFt{\&optional} arg\EFrdc{)}
    \EFd{"Embark on candidate using quick keys."}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFf{vertico-quick-jump}\EFrdd{)}
      \EFrdd{(}\EFf{embark-act} arg\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFcd{;;} \EFc{Workaround for problem with `}\textcolor[HTML]{a9a1e1}{tramp}\EFc{' hostname completions. This overrides}
  \EFcd{;;} \EFc{the completion style specifically for remote files! See}
  \EFcd{;;} \EFc{https://github.com/minad/vertico\#tramp-hostname-completion}
  \EFrdb{(}\EFk{defun} \EFf{kb/basic-remote-try-completion} \EFrdc{(}\EFo{string} table pred point\EFrdc{)}
    \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{vertico--remote-p} string\EFrdd{)}
         \EFrdd{(}\EFo{completion-basic-try-completion} string table pred point\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{defun} \EFf{kb/basic-remote-all-completions} \EFrdc{(}\EFo{string} table pred point\EFrdc{)}
    \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{vertico--remote-p} string\EFrdd{)}
         \EFrdd{(}\EFo{completion-basic-all-completions} string table pred point\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{completion-styles-alist}
               \EFhq{'}\EFrdc{(}basic-remote           \EFcd{;} \EFc{Name of `}\textcolor[HTML]{a9a1e1}{completion-style}\EFc{'}
                 kb/basic-remote-try-completion kb/basic-remote-all-completions nil\EFrdc{)}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFv{vertico-mode}\EFrdb{)}
  \EFcd{;;} \EFc{Extensions}
  \EFrdb{(}\EFv{vertico-multiform-mode} nil\EFrdb{)}
  \EFcd{;;} \EFc{Needed to move away from ido}
  \EFrdb{(}\EFk{setq} \EFv{completing-read-function} \EFhq{'}\EFhs{completing-read-default}\EFrdb{)}

  \EFcd{;;} \EFc{Prefix the current candidate with  . From}
  \EFcd{;;} \EFc{https://github.com/minad/vertico/wiki\#prefix-current-candidate-with-arrow}
  \EFrdb{(}\EFo{advice-add} \EFhq{\#'}\EFhs{vertico--format-candidate} \EFb{:around}
              \EFrdc{(}\EFk{lambda} \EFrdd{(}orig cand prefix suffix index \_start\EFrdd{)}
                \EFrdd{(}\EFk{setq} cand \EFrda{(}\EFo{funcall} orig cand prefix suffix index \_start\EFrda{)}\EFrdd{)}
                \EFrdd{(}\EFo{concat}
                 \EFrda{(}\EFk{if} \EFrdb{(}\EFo{=} \EFv{vertico--index} index\EFrdb{)}
                     \EFrdb{(}\EFo{propertize} \EFs{" "} \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{vertico-current}\EFrdb{)}
                   \EFs{"  "}\EFrda{)}
                 cand\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{use-package} orderless
  \EFb{:custom}
  \EFrdb{(}\EFv{completion-styles} \EFhq{'}\EFrdc{(}orderless\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFv{completion-category-defaults} nil\EFrdb{)}    \EFcd{;} \EFc{I want to be in control!}
  \EFrdb{(}\EFv{completion-category-overrides}
   \EFhq{'}\EFrdc{(}\EFrdd{(}file \EFrda{(}styles basic-remote \EFcd{;} \EFc{For `}\textcolor[HTML]{a9a1e1}{tramp}\EFc{' hostname completion with `}\textcolor[HTML]{a9a1e1}{vertico}\EFc{'}
                   orderless
                   \EFrda{)}\EFrdd{)}
     \EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFv{orderless-component-separator} \EFhq{'}\EFhs{orderless-escapable-split-on-space}\EFrdb{)}
  \EFrdb{(}\EFv{orderless-matching-styles}
   \EFhq{'}\EFrdc{(}orderless-literal
     orderless-prefixes
     \EFcd{;;}\EFc{orderless-initialism}
     orderless-regexp
     \EFcd{;;}\EFc{orderless-flex ;; Fuzzy finding}
     \EFcd{;;} \EFc{orderless-strict-leading-initialism}
     \EFcd{;;} \EFc{orderless-strict-initialism}
     \EFcd{;;} \EFc{orderless-strict-full-initialism}
     \EFcd{;;} \EFc{orderless-without-literal          ; Recommended for dispatches instead}
     \EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFv{orderless-style-dispatchers}
   \EFhq{'}\EFrdc{(}prot-orderless-literal-dispatcher
     prot-orderless-strict-initialism-dispatcher
     prot-orderless-flex-dispatcher
     \EFrdc{)}\EFrdb{)}
  \EFb{:init}
  \EFrdb{(}\EFk{defun} \EFf{orderless--strict-*-initialism} \EFrdc{(}component \EFt{\&optional} anchored\EFrdc{)}
    \EFd{"Match a COMPONENT as a strict initialism, optionally ANCHORED.}
\EFd{The characters in COMPONENT must occur in the candidate in that}
\EFd{order at the beginning of subsequent words comprised of letters.}
\EFd{Only non-letters can be in between the words that start with the}
\EFd{initials.}

\EFd{If ANCHORED is `}\textcolor[HTML]{a9a1e1}{start}\EFd{' require that the first initial appear in}
\EFd{the first word of the candidate.  If ANCHORED is `}\textcolor[HTML]{a9a1e1}{both}\EFd{' require}
\EFd{that the first and last initials appear in the first and last}
\EFd{words of the candidate, respectively."}
    \EFrdc{(}\EFo{orderless--separated-by}
        \EFhq{'}\EFrdd{(}seq \EFrda{(}zero-or-more alpha\EFrda{)} word-end \EFrda{(}zero-or-more \EFrdb{(}\EFo{not} alpha\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{cl-loop} for char across component collect \EFhq{`}\EFrda{(}seq word-start ,char\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} anchored \EFhq{'}\EFrda{(}seq \EFrdb{(}group buffer-start\EFrdb{)} \EFrdb{(}zero-or-more \EFrdc{(}\EFo{not} alpha\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFo{eq} anchored \EFhq{'}\EFhs{both}\EFrda{)}
        \EFhq{'}\EFrda{(}seq \EFrdb{(}zero-or-more alpha\EFrdb{)} word-end \EFrdb{(}zero-or-more \EFrdc{(}\EFo{not} alpha\EFrdc{)}\EFrdb{)} eol\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{orderless-strict-initialism} \EFrdc{(}component\EFrdc{)}
    \EFd{"Match a COMPONENT as a strict initialism.}
\EFd{This means the characters in COMPONENT must occur in the}
\EFd{candidate in that order at the beginning of subsequent words}
\EFd{comprised of letters.  Only non-letters can be in between the}
\EFd{words that start with the initials."}
    \EFrdc{(}\EFf{orderless--strict-*-initialism} component\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{prot-orderless-literal-dispatcher} \EFrdc{(}pattern \_index \_total\EFrdc{)}
    \EFd{"Literal style dispatcher using the equals sign as a suffix.}
\EFd{It matches PATTERN \_INDEX and \_TOTAL according to how Orderless}
\EFd{parses its input."}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{string-suffix-p} \EFs{"="} pattern\EFrdd{)}
      \EFhq{`}\EFrdd{(}orderless-literal . ,\EFrda{(}\EFo{substring} pattern \EFhn{0} \EFhn{-1}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{prot-orderless-strict-initialism-dispatcher} \EFrdc{(}pattern \_index \_total\EFrdc{)}
    \EFd{"Leading initialism  dispatcher using the comma suffix.}
\EFd{It matches PATTERN \_INDEX and \_TOTAL according to how Orderless}
\EFd{parses its input."}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{string-suffix-p} \EFs{","} pattern\EFrdd{)}
      \EFhq{`}\EFrdd{(}orderless-strict-initialism . ,\EFrda{(}\EFo{substring} pattern \EFhn{0} \EFhn{-1}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{prot-orderless-flex-dispatcher} \EFrdc{(}pattern \_index \_total\EFrdc{)}
    \EFd{"Flex  dispatcher using the tilde suffix.}
\EFd{It matches PATTERN \_INDEX and \_TOTAL according to how Orderless}
\EFd{parses its input."}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{string-suffix-p} \EFs{"."} pattern\EFrdd{)}
      \EFhq{`}\EFrdd{(}orderless-flex . ,\EFrda{(}\EFo{substring} pattern \EFhn{0} \EFhn{-1}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-s"}\EFrdb{)} \EFhq{'}\EFhs{consult-line}\EFrda{)}

\EFcd{;} \EFc{Global vertico posframe mode}
\EFrda{(}\EFv{vertico-posframe-mode} \EFhn{1}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{search-with-vertico}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Reading}
\label{sec:org204592b}
\subsubsection{Read Aloud}
\label{sec:orgc41708c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{read-aloud}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:orgd3369a0}
\paragraph{Code}
\label{sec:orgda7ea41}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{read-aloud.el -*- lexical-binding: t; -*-}

\EFcd{;;;} \EFc{read-aloud.el --- A simple interface to TTS engines  -*- lexical-binding: t; -*-}

\EFcd{;;} \EFc{Author: Alexander Gromnitsky <alexander.gromnitsky@gmail.com>}
\EFcd{;;} \EFc{Version: 0.0.2}
\EFcd{;;} \EFc{Package-Requires: ((emacs "24.4"))}
\EFcd{;;} \EFc{Keywords: multimedia}
\EFcd{;;} \EFc{URL: https://github.com/gromnitsky/read-aloud.el}

\EFcd{;;} \EFc{This file is not part of GNU Emacs.}

\EFcd{;;;} \EFc{License:}

\EFcd{;;} \EFc{MIT}

\EFcd{;;;} \EFc{Commentary:}

\EFcd{;;} \EFc{This package uses an external TTS engine (like flite) to pronounce}
\EFcd{;;} \EFc{the word at or near point, the selected region or a whole buffer.}

\EFcd{;;;} \EFc{Code:}

\EFrda{(}\EFk{defvar} \EFv{read-aloud-engine} \EFs{"speech-dispatcher"}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{read-aloud-engine} \EFs{"flite"}\EFrda{)}
\EFrda{(}\EFk{defvar} \EFv{read-aloud-engines}
  \EFhq{'}\EFrdb{(}\EFs{"speech-dispatcher"}			\EFcd{;} \EFc{Linux/FreeBSD only}
    \EFrdc{(}cmd \EFs{"spd-say"} args \EFrdd{(}\EFs{"-e"} \EFs{"-w"}\EFrdd{)} kill \EFs{"spd-say -S"}\EFrdc{)}
    \EFs{"flite"}				\EFcd{;} \EFc{Cygwin?}
    \EFrdc{(}cmd \EFs{"flite"} args nil\EFrdc{)}
    \EFs{"jampal"}				\EFcd{;} \EFc{Windows}
    \EFrdc{(}cmd \EFs{"cscript"} args \EFrdd{(}\EFs{"C:\char92{}\char92{}Program Files\char92{}\char92{}Jampal\char92{}\char92{}ptts.vbs"} \EFs{"-r"} \EFs{"5"}\EFrdd{)}\EFrdc{)}
    \EFs{"say"}				\EFcd{;} \EFc{macOS}
    \EFrdc{(}cmd \EFs{"say"} args nil\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{read-aloud-max} \EFhn{160}\EFrda{)}		\EFcd{;} \EFc{chars}
\EFrda{(}\EFk{defface} \EFv{read-aloud-text-face} \EFhq{'}\EFrdb{(}\EFrdc{(}t \EFb{:inverse-video} t\EFrdc{)}\EFrdb{)}
  \EFd{"For highlighting the text that is being read"}\EFrda{)}



\EFrda{(}\EFo{require} \EFhq{'}\EFo{cl-lib}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{subr-x}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{read-aloud-word-hist} \EFhq{'}\EFrdb{(}\EFrdb{)}\EFrda{)}	\EFcd{;} \EFc{(*-current-word) uses it}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--logbufname} \EFs{"*Read-Aloud Log*"}\EFrda{)}

\EFcd{;;} \EFc{this should be in cl-defstruct}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-pr} nil\EFrda{)}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-buf} nil\EFrda{)}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-bufpos} nil\EFrda{)}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-locked} nil\EFrda{)}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-overlay} nil\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--log}\EFrdb{(}msg \EFt{\&optional} args\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}buf \EFrda{(}\EFo{get-buffer-create} \EFv{read-aloud--logbufname}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} buf
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert-before-markers} \EFrda{(}\EFo{format} \EFrdb{(}\EFo{concat} msg \EFs{"\char92{}n"}\EFrdb{)} args\EFrda{)}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud-test} \EFrdb{(}\EFrdb{)}
  \EFd{"Open a new tmp buffer, insert a string, try to read it."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}buf \EFrda{(}\EFo{get-buffer-create} \EFs{"*Read-Aloud Test*"}\EFrda{)}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{with-current-buffer} buf
      \EFrdd{(}\EFo{erase-buffer}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"Here lies the body of William Jay,}
\EFs{Who died maintaining his right of way--}
\EFs{He was right, dead right, as he speed along,}
\EFs{But he's just as dead as if he were wrong."}\EFrdd{)}\EFrdc{)}

    \EFcd{;;} \EFc{show our logs}
    \EFrdc{(}\EFo{switch-to-buffer} \EFv{read-aloud--logbufname}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-max}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFf{read-aloud--u-switch-to-buffer} buf\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-buf} buf\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-bufpos} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFf{read-aloud-buf}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{read-aloud-change-engine}\EFrdb{(}\EFrdb{)}
  \EFd{"Select another TTS engine."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud-engine}
	\EFrdc{(}\EFo{ido-completing-read}
	 \EFs{"read aloud with: "}
	 \EFrdd{(}\EFk{cl-loop} for \EFrda{(}key \_\EFrda{)} on \EFv{read-aloud-engines} by \EFhq{'}\EFhs{cddr}
		  collect key\EFrdd{)}
	 nil nil nil nil \EFv{read-aloud-engine}
	 \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--cmd} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{plist-get} \EFrdd{(}\EFo{lax-plist-get} \EFv{read-aloud-engines} \EFv{read-aloud-engine}\EFrdd{)} \EFhq{'}\EFhs{cmd}\EFrdc{)}
      \EFrdc{(}\EFo{user-error} \EFs{"Failed to get the default TTS engine"}\EFrdc{)}\EFrdb{)} \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--args} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{plist-get} \EFrdc{(}\EFo{lax-plist-get} \EFv{read-aloud-engines} \EFv{read-aloud-engine}\EFrdc{)} \EFhq{'}\EFhs{args}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--valid-str-p} \EFrdb{(}str\EFrdb{)}
  \EFrdb{(}\EFk{and} str \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{equal} \EFs{""} \EFrda{(}\EFo{string-trim} str\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--overlay-rm}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFv{read-aloud--c-overlay}
    \EFrdc{(}\EFo{delete-overlay} \EFv{read-aloud--c-overlay}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-overlay} nil\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--overlay-make}\EFrdb{(}beg end\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} beg end\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-overlay} \EFrdd{(}\EFo{make-overlay} beg end\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{overlay-put} \EFv{read-aloud--c-overlay} \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{read-aloud-text-face}\EFrdc{)} \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--reset}\EFrdb{(}\EFrdb{)}
  \EFd{"Reset internal state."}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-pr} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-buf} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-bufpos} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-locked} nil\EFrdb{)}

  \EFrdb{(}\EFf{read-aloud--overlay-rm}\EFrdb{)}
  \EFrdb{(}\EFf{read-aloud--log} \EFs{"RESET"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{cl-defun} \EFf{read-aloud--string}\EFrdb{(}str source\EFrdb{)}
  \EFd{"Open an async process, feed its stdin with STR. SOURCE is an}
\EFd{arbitual string like '}\textcolor[HTML]{a9a1e1}{buffer}\EFd{', '}\textcolor[HTML]{a9a1e1}{word}\EFd{' or '}\textcolor[HTML]{a9a1e1}{selection}\EFd{'."}
  \EFrdb{(}\EFk{unless} \EFrdc{(}\EFf{read-aloud--valid-str-p} str\EFrdc{)} \EFrdc{(}\EFk{cl-return-from} read-aloud--string\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{process-connection-type} nil\EFrdd{)}\EFrdc{)} \EFcd{;} \EFc{(start-process) requires this}

    \EFrdc{(}\EFk{if} \EFv{read-aloud--c-locked} \EFrdd{(}\EFo{error} \EFs{"Read-aloud is LOCKED"}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-locked} source\EFrdc{)}
    \EFrdc{(}\EFk{condition-case} err
	\EFrdd{(}\EFk{setq} \EFv{read-aloud--c-pr}
	      \EFrda{(}\EFo{apply} \EFhq{'}\EFhs{start-process} \EFs{"read-aloud"} nil
		     \EFrdb{(}\EFf{read-aloud--cmd}\EFrdb{)} \EFrdb{(}\EFf{read-aloud--args}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{error}
       \EFrda{(}\EFf{read-aloud--reset}\EFrda{)}
       \EFrda{(}\EFo{user-error} \EFs{"External TTS engine failed to start: \%s"}
		   \EFrdb{(}\EFo{error-message-string} err\EFrdb{)}\EFrda{)}\EFrdd{)} \EFrdc{)}

    \EFrdc{(}\EFo{set-process-sentinel} \EFv{read-aloud--c-pr} \EFhq{'}\EFhs{read-aloud--sentinel}\EFrdc{)}
    \EFrdc{(}\EFk{setq} str \EFrdd{(}\EFo{concat} \EFrda{(}\EFo{string-trim} str\EFrda{)} \EFs{"\char92{}n"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{read-aloud--log} \EFs{"Sending: `\%s`"} str\EFrdc{)}
    \EFrdc{(}\EFo{process-send-string} \EFv{read-aloud--c-pr} str\EFrdc{)}
    \EFrdc{(}\EFo{process-send-eof} \EFv{read-aloud--c-pr}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--sentinel} \EFrdb{(}process event\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}source \EFv{read-aloud--c-locked}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{setq} event \EFrdd{(}\EFo{string-trim} event\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{equal} event \EFs{"finished"}\EFrdd{)}
	\EFrdd{(}\EFk{progn}
	  \EFrda{(}\EFf{read-aloud--overlay-rm}\EFrda{)}
	  \EFrda{(}\EFk{setq} \EFv{read-aloud--c-locked} nil\EFrda{)}
	  \EFrda{(}\EFk{cond}
	   \EFrdb{(}\EFrdc{(}\EFo{equal} source \EFs{"buffer"}\EFrdc{)} \EFrdc{(}\EFf{read-aloud-buf}\EFrdc{)}\EFrdb{)}
	   \EFrdb{(}\EFrdc{(}\EFo{equal} source \EFs{"word"}\EFrdc{)} t\EFrdb{)}	  \EFcd{;} \EFc{do nothing}
	   \EFrdb{(}\EFrdc{(}\EFo{equal} source \EFs{"selection"}\EFrdc{)} t\EFrdb{)} \EFcd{;} \EFc{do nothing}
	   \EFrdb{(}t \EFrdc{(}\EFo{error} \EFs{"Unknown source: \%s"} source\EFrdc{)}\EFrdb{)}\EFrda{)} \EFrdd{)}

      \EFcd{;;} \EFc{else}
      \EFrdd{(}\EFf{read-aloud--reset}\EFrdd{)}
      \EFrdd{(}\EFo{user-error} \EFs{"\%s ended w/ the event: \%s"} process event\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{read-aloud-stop} \EFrdb{(}\EFrdb{)}
  \EFd{"Ask a TTS engine to stop."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{kill-process} \EFv{read-aloud--c-pr}\EFrdb{)}

  \EFcd{;;} \EFc{if a tts engine has a separate step to switch itself off, use it}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}c \EFrda{(}\EFo{plist-get} \EFrdb{(}\EFo{lax-plist-get} \EFv{read-aloud-engines} \EFv{read-aloud-engine}\EFrdb{)} \EFhq{'}\EFhs{kill}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} c
      \EFrdd{(}\EFo{start-process-shell-command} \EFs{"read-aloud-kill"} \EFv{read-aloud--logbufname} c\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFf{read-aloud--log} \EFs{"INTERRUPTED BY USER"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud-reset}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
    \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-buf} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{cl-defun} \EFf{read-aloud-buf}\EFrdb{(}\EFrdb{)}
  \EFd{"Read the current buffer, highlighting words along the}
\EFd{read. Run it again to stop reading."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}

  \EFrdb{(}\EFk{when} \EFv{read-aloud--c-locked}
    \EFrdc{(}\EFf{read-aloud-stop}\EFrdc{)}
    \EFrdc{(}\EFk{cl-return-from} read-aloud-buf\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFv{read-aloud--c-buf} \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-buf} \EFrdd{(}\EFo{current-buffer}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFv{read-aloud--c-bufpos} \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-bufpos} \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{let} \EFrdc{(}tb\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFv{read-aloud--c-buf}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFo{eobp}\EFrda{)}
	\EFrda{(}\EFf{read-aloud--log} \EFs{"END OF BUFFER"}\EFrda{)}
	\EFrda{(}\EFf{read-aloud--reset}\EFrda{)}
	\EFrda{(}\EFk{cl-return-from} read-aloud-buf\EFrda{)}\EFrdd{)}

      \EFrdd{(}\EFk{setq} tb \EFrda{(}\EFf{read-aloud--grab-text} \EFv{read-aloud--c-buf} \EFv{read-aloud--c-bufpos}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{unless} tb
	\EFrda{(}\EFk{progn}
	  \EFrdb{(}\EFf{read-aloud--log} \EFs{"SPACES AT THE END OF BUFFER"}\EFrdb{)}
	  \EFrdb{(}\EFf{read-aloud--reset}\EFrdb{)}
	  \EFrdb{(}\EFk{cl-return-from} read-aloud-buf\EFrdb{)}\EFrda{)}\EFrdd{)}

      \EFcd{;;} \EFc{highlight text}
      \EFrdd{(}\EFf{read-aloud--overlay-make} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{beg}\EFrda{)} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{end}\EFrda{)}\EFrdd{)}

      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{end}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{read-aloud--string} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{text}\EFrda{)} \EFs{"buffer"}\EFrdd{)}

      \EFrdd{(}\EFk{setq} \EFv{read-aloud--c-bufpos} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{end}\EFrda{)}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{cl-defun} \EFf{read-aloud--grab-text}\EFrdb{(}buf point\EFrdb{)}
  \EFd{"Return (text \char92{}"omglol\char92{}" beg 10 end 20) plist or nil on}
\EFd{eof. BUF \& POINT are the starting location for the job."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFo{max} t2 p pstart chunks pchunk\EFrdc{)}

    \EFrdc{(}\EFk{with-current-buffer} buf
      \EFrdd{(}\EFk{save-excursion}
	\EFrda{(}\EFo{goto-char} point\EFrda{)}
	\EFrda{(}\EFo{skip-chars-forward} \EFs{"[\char92{}\char92{}-,.:!;[:space:]\char92{}r\char92{}n]"}\EFrda{)}

	\EFrda{(}\EFk{setq} max \EFrdb{(}\EFo{+} \EFrdc{(}\EFo{point}\EFrdc{)} \EFv{read-aloud-max}\EFrdb{)}\EFrda{)}
	\EFrda{(}\EFk{if} \EFrdb{(}\EFo{>} max \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)} \EFrdb{(}\EFk{setq} max \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}\EFrda{)}
	\EFrda{(}\EFk{setq} t2 \EFrdb{(}\EFo{buffer-substring-no-properties} \EFrdc{(}\EFo{point}\EFrdc{)} max\EFrdb{)}\EFrda{)}

	\EFrda{(}\EFk{if} \EFrdb{(}\EFf{string-empty-p} \EFrdc{(}\EFo{string-trim-right} t2\EFrdc{)}\EFrdb{)}
	    \EFcd{;;} \EFc{we have spaces at the end of buffer, there is nothing to grab}
	    \EFrdb{(}\EFk{cl-return-from} read-aloud--grab-text nil\EFrdb{)}\EFrda{)}

	\EFrda{(}\EFk{setq} pstart \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}

	\EFrda{(}\EFk{unless} \EFrdb{(}\EFo{=} max \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}
	  \EFrdb{(}\EFk{progn}
	    \EFcd{;;} \EFc{look for the 1st non-space in `t` from the end \& cut}
	    \EFcd{;;} \EFc{off that part}
	    \EFrdc{(}\EFk{setq} p \EFrdd{(}\EFo{string-match} \EFs{"[[:space:]\char92{}r\char92{}n]"}
				  \EFrda{(}\EFf{read-aloud--u-str-reverse} t2\EFrda{)}\EFrdd{)} \EFrdc{)}
	    \EFrdc{(}\EFk{if} p \EFrdd{(}\EFk{setq} t2 \EFrda{(}\EFo{substring} t2 \EFhn{0} \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{length} t2\EFrdc{)} p \EFhn{1}\EFrdb{)}\EFrda{)}\EFrdd{)} \EFrdc{)}\EFrdb{)}\EFrda{)}

	\EFrda{(}\EFk{setq} chunks
	      \EFrdb{(}\EFo{split-string} t2 \EFs{"[,.:!;]}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{\char92{}n}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{\char92{}r\char92{}n}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}\{2,\char92{}\char92{}\}"} t\EFrdb{)}\EFrda{)}
	\EFrda{(}\EFk{if} chunks
	    \EFrdb{(}\EFk{progn}
	      \EFrdc{(}\EFo{search-forward} \EFrdd{(}\EFo{car} chunks\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFk{setq} pchunk \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFo{search-backward} \EFrdd{(}\EFo{car} chunks\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFk{setq} pstart \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFk{setq} t2 \EFrdd{(}\EFo{buffer-substring-no-properties} pstart pchunk\EFrdd{)}\EFrdc{)} \EFrdb{)}\EFrda{)}

	\EFrda{(}\EFf{read-aloud--log} \EFs{"text grab: `\%s`"} t2\EFrda{)}
	\EFhq{`}\EFrda{(}text ,t2
	       beg ,pstart
	       end ,\EFrdb{(}\EFo{+} pstart \EFrdc{(}\EFo{length} t2\EFrdc{)}\EFrdb{)}\EFrda{)}
	\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{cl-defun} \EFf{read-aloud--current-word}\EFrdb{(}\EFrdb{)}
  \EFd{"Pronounce a word under the pointer. If under there is rubbish,}
\EFd{ask user for an additional input."}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}cw \EFrda{(}\EFf{read-aloud--u-current-word}\EFrda{)}\EFrdd{)}
	 \EFrdd{(}word \EFrda{(}\EFo{nth} \EFhn{2} cw\EFrda{)}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFk{and} word \EFrda{(}\EFo{string-match} \EFs{"[[:alnum:]]"} word\EFrda{)}\EFrdd{)}
      \EFcd{;;} \EFc{maybe we should share the hist list w/ `wordnut-completion-hist`?}
      \EFrdd{(}\EFk{setq} word \EFrda{(}\EFo{read-string} \EFs{"read aloud: "} word \EFhq{'}\EFv{read-aloud-word-hist}\EFrda{)}\EFrdd{)} \EFrdc{)}

    \EFrdc{(}\EFf{read-aloud--overlay-make} \EFrdd{(}\EFo{nth} \EFhn{0} cw\EFrdd{)} \EFrdd{(}\EFo{nth} \EFhn{1} cw\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{read-aloud--string} word \EFs{"word"}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{cl-defun} \EFf{read-aloud-this}\EFrdb{(}\EFrdb{)}
  \EFd{"Pronounce either the selection or a word under the pointer."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}

  \EFrdb{(}\EFk{when} \EFv{read-aloud--c-locked}
    \EFrdc{(}\EFf{read-aloud-stop}\EFrdc{)}
    \EFrdc{(}\EFk{cl-return-from} read-aloud-selection\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{use-region-p}\EFrdc{)}
      \EFrdc{(}\EFf{read-aloud--string}
       \EFrdd{(}\EFo{buffer-substring-no-properties} \EFrda{(}\EFo{region-beginning}\EFrda{)} \EFrda{(}\EFo{region-end}\EFrda{)}\EFrdd{)}
       \EFs{"selection"}\EFrdc{)}
    \EFrdc{(}\EFf{read-aloud--current-word}\EFrdc{)}\EFrdb{)} \EFrda{)}



\EFrda{(}\EFk{defun} \EFf{read-aloud--u-switch-to-buffer}\EFrdb{(}buf\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFrdc{(}\EFo{eq} \EFrdd{(}\EFo{current-buffer}\EFrdd{)} buf\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{cdr} \EFrda{(}\EFo{window-list}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{split-window-vertically}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{other-window} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFo{switch-to-buffer} buf\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{for emacs < 25}
\EFrda{(}\EFk{defun} \EFf{read-aloud--u-str-reverse} \EFrdb{(}str\EFrdb{)}
  \EFd{"Reverse the STR."}
  \EFrdb{(}\EFo{apply} \EFhq{\#'}\EFhs{string} \EFrdc{(}\EFo{reverse} \EFrdd{(}\EFf{string-to-list} str\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--u-current-word}\EFrdb{(}\EFrdb{)}
  \EFd{"This is a modified (current-word) that doesn't take any args \&}
\EFd{return (beg end word) or nil."}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}oldpoint \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)} \EFrda{(}start \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)} \EFrda{(}end \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}
	   \EFrda{(}syntaxes \EFs{"w\_"}\EFrda{)}
	   \EFrda{(}not-syntaxes \EFrdb{(}\EFo{concat} \EFs{"\char94{}"} syntaxes\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{skip-syntax-backward} syntaxes\EFrdd{)} \EFrdd{(}\EFk{setq} start \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} oldpoint\EFrdd{)}
      \EFrdd{(}\EFo{skip-syntax-forward} syntaxes\EFrdd{)} \EFrdd{(}\EFk{setq} end \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{eq} start oldpoint\EFrdb{)} \EFrdb{(}\EFo{eq} end oldpoint\EFrdb{)}\EFrda{)}
	\EFcd{;;} \EFc{Look for preceding word in same line.}
	\EFrda{(}\EFo{skip-syntax-backward} not-syntaxes \EFrdb{(}\EFo{line-beginning-position}\EFrdb{)}\EFrda{)}
	\EFrda{(}\EFk{if} \EFrdb{(}\EFo{bolp}\EFrdb{)}
	    \EFcd{;;} \EFc{No preceding word in same line.}
	    \EFcd{;;} \EFc{Look for following word in same line.}
	    \EFrdb{(}\EFk{progn}
	      \EFrdc{(}\EFo{skip-syntax-forward} not-syntaxes \EFrdd{(}\EFo{line-end-position}\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFk{setq} start \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFo{skip-syntax-forward} syntaxes\EFrdc{)}
	      \EFrdc{(}\EFk{setq} end \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}\EFrdb{)}
	  \EFrdb{(}\EFk{setq} end \EFrdc{(}\EFo{point}\EFrdc{)}\EFrdb{)}
	  \EFrdb{(}\EFo{skip-syntax-backward} syntaxes\EFrdb{)}
	  \EFrdb{(}\EFk{setq} start \EFrdc{(}\EFo{point}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFcd{;;} \EFc{If we found something nonempty, return it as a list.}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFo{=} start end\EFrda{)}
	\EFrda{(}\EFo{list} start end \EFrdb{(}\EFo{buffer-substring-no-properties} start end\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{read-aloud}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Speed Read}
\label{sec:org8b3e118}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{speed-read}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:orge95711d}
\paragraph{Code}
\label{sec:org52cb0b9}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{read-single.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{use-package!} spray
  \EFb{:commands} spray-mode
  \EFb{:config}
  \EFrdb{(}\EFk{setq} spray-wpm \EFhn{400}
        spray-height \EFhn{300}\EFrdb{)}
  \EFrdb{(}\EFk{defun} \EFf{spray-mode-hide-cursor} \EFrdc{(}\EFrdc{)}
    \EFd{"Hide or unhide the cursor as is appropriate."}
    \EFrdc{(}\EFk{if} spray-mode
        \EFrdd{(}\EFk{setq-local} spray--last-evil-cursor-state \EFv{evil-normal-state-cursor}
                    \EFv{evil-normal-state-cursor} \EFhq{'}\EFrda{(}nil\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq-local} \EFv{evil-normal-state-cursor} spray--last-evil-cursor-state\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFhs{spray-mode-hook} \EFhq{\#'}\EFhs{spray-mode-hide-cursor}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:map} spray-mode-map
        \EFb{:n} \EFs{"<return>"} \EFhq{\#'}\EFhs{spray-start/stop}
        \EFb{:n} \EFs{"SPC"} \EFhq{\#'}\EFhs{spray-start/stop}
        \EFb{:n} \EFs{"f"} \EFhq{\#'}\EFhs{spray-faster}
        \EFb{:n} \EFs{"s"} \EFhq{\#'}\EFhs{spray-slower}
        \EFb{:n} \EFs{"t"} \EFhq{\#'}\EFhs{spray-time}
        \EFb{:n} \EFs{"<right>"} \EFhq{\#'}\EFhs{spray-forward-word}
        \EFb{:n} \EFs{"h"} \EFhq{\#'}\EFhs{spray-forward-word}
        \EFb{:n} \EFs{"<left>"} \EFhq{\#'}\EFhs{spray-backward-word}
        \EFb{:n} \EFs{"l"} \EFhq{\#'}\EFhs{spray-backward-word}
        \EFb{:n} \EFs{"q"} \EFhq{\#'}\EFhs{spray-quit}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{speed-read}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Bionic Reading}
\label{sec:org18565b1}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{bionic-reading}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org4e8c363}
\paragraph{Code}
\label{sec:orga2035f6}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{bionic-reading.el --- Bionic reading             -*- lexical-binding: t; -*-}

\EFcd{;;} \EFc{Copyright (C) 2022  ksqsf}

\EFcd{;;} \EFc{Author: ksqsf <i@ksqsf.moe>}
\EFcd{;;} \EFc{Keywords: convenience}

\EFcd{;;} \EFc{This program is free software; you can redistribute it and/or modify}
\EFcd{;;} \EFc{it under the terms of the GNU General Public License as published by}
\EFcd{;;} \EFc{the Free Software Foundation, either version 3 of the License, or}
\EFcd{;;} \EFc{(at your option) any later version.}

\EFcd{;;} \EFc{This program is distributed in the hope that it will be useful,}
\EFcd{;;} \EFc{but WITHOUT ANY WARRANTY; without even the implied warranty of}
\EFcd{;;} \EFc{MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
\EFcd{;;} \EFc{GNU General Public License for more details.}

\EFcd{;;} \EFc{You should have received a copy of the GNU General Public License}
\EFcd{;;} \EFc{along with this program.  If not, see <https://www.gnu.org/licenses/>.}

\EFcd{;;;} \EFc{Commentary:}

\EFcd{;;} \EFc{This package implements something similar to bionic reading in Emacs.}
\EFcd{;;}
\EFcd{;;} \EFc{Note that bionic reading is patented.}

\EFcd{;;;} \EFc{Code:}

\EFrda{(}\EFk{defvar-local} \EFv{bionic-overlays} nil
  \EFd{"The overlays for bionicification in the current buffer."}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{bionic-word} \EFrdb{(}\EFrdb{)}
  \EFd{"Bionicify the word at point"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}bounds \EFrda{(}\EFo{bounds-of-thing-at-point} \EFhq{'}\EFhs{word}\EFrda{)}\EFrdd{)}
         \EFrdd{(}beg \EFrda{(}\EFo{car} bounds\EFrda{)}\EFrdd{)}
         \EFrdd{(}end \EFrda{(}\EFo{cdr} bounds\EFrda{)}\EFrdd{)}
         \EFrdd{(}whole-len \EFrda{(}\EFo{-} end beg\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{cond}
     \EFrdd{(}\EFrda{(}\EFo{>=} whole-len \EFhn{2}\EFrda{)}
      \EFrda{(}\EFk{let*} \EFrdb{(}\EFrdc{(}half-len \EFrdd{(}\EFo{/} whole-len \EFhn{2}\EFrdd{)}\EFrdc{)}
             \EFrdc{(}real-len \EFrdd{(}\EFk{if} \EFrda{(}\EFk{or} \EFrdb{(}\EFo{>} whole-len \EFhn{6}\EFrdb{)} \EFrdb{(}\EFo{=} whole-len \EFhn{3}\EFrdb{)}\EFrda{)}
                           \EFrda{(}\EFo{+} half-len \EFhn{1}\EFrda{)}
                         half-len\EFrdd{)}\EFrdc{)}
             \EFrdc{(}ov \EFrdd{(}\EFo{make-overlay} beg \EFrda{(}\EFo{+} beg real-len\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
        \EFrdb{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{face} \EFv{bionic-reading-face}\EFrdb{)}
        \EFrdb{(}\EFk{push} ov \EFv{bionic-overlays}\EFrdb{)}\EFrda{)}\EFrdd{)}
     \EFrdd{(}\EFrda{(}\EFo{>} \EFrdb{(}\EFo{-} end beg\EFrdb{)} \EFhn{1}\EFrda{)}
      \EFrda{(}\EFk{let} \EFrdb{(}\EFrdc{(}ov \EFrdd{(}\EFo{make-overlay} beg \EFrda{(}\EFo{+} beg \EFhn{1}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
        \EFrdb{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{face} \EFv{bionic-reading-face}\EFrdb{)}
        \EFrdb{(}\EFk{push} ov \EFv{bionic-overlays}\EFrdb{)}\EFrda{)}\EFrdd{)}
     \EFrdd{(}t nil\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{bionic-buffer} \EFrdb{(}\EFrdb{)}
  \EFd{"Bionicify all the visible parts of the current buffer."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{null} \EFv{bionic-overlays}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFf{bionic-debuffer}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{while} \EFrdd{(}\EFo{not} \EFrda{(}\EFo{=} \EFrdb{(}\EFo{point}\EFrdb{)} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{looking-at} \EFs{"\char92{}\char92{}w"}\EFrda{)}
          \EFrda{(}\EFf{bionic-word}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{forward-to-word} \EFhn{1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{bionic-debuffer} \EFrdb{(}\EFrdb{)}
  \EFd{"Undo the bionicification."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{dolist} \EFrdc{(}ov \EFv{bionic-overlays}\EFrdc{)}
    \EFrdc{(}\EFo{delete-overlay} ov\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;} \EFc{Start of my own code}
\EFcd{;;} \EFc{Bionic reading minor mode}
\EFrda{(}\EFk{defvar} \EFv{bionic-reading-mode} nil\EFrda{)}
\EFrda{(}\EFk{defcustom} \EFv{bionic-reading-face} \EFhq{'}\EFhs{bold} \EFd{"Face to use for bionic reading highlight.}
\EFd{Option: 'bold, 'error, 'warning, 'highlight or any value of M-x list-faces-display"}\EFrda{)}

\EFrda{(}\EFk{define-minor-mode} \EFv{bionic-reading-mode}
  \EFd{"Makes first half of words bold to facilitate faster reading."}
  \EFb{:lighter} \EFs{""}
  \EFb{:global} t
  \EFrdb{(}\EFk{if} \EFv{bionic-reading-mode}
      \EFrdc{(}\EFf{bionic-buffer}\EFrdc{)}
    \EFrdc{(}\EFf{bionic-debuffer}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{force-mode-line-update}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{bionic-reading}\EFrda{)}
\EFcd{;;;} \EFc{bionic-reading.el ends here}
\end{Verbatim}
\end{Code}
\subsection{Spaced Repetition}
\label{sec:orgdf11260}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{pamparam}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{spaced-repetition}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org0020805}
\subsubsection{Code}
\label{sec:orgd7f1810}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{pamparam.el --- Simple and fast flashcards. -*- lexical-binding: t -*-}

\EFcd{;;} \EFc{Copyright (C) 2016-2020 Oleh Krehel}

\EFcd{;;} \EFc{Author: Oleh Krehel <ohwoeowho@gmail.com>}
\EFcd{;;} \EFc{URL: https://github.com/abo-abo/pamparam}
\EFcd{;;} \EFc{Version: 0.1.0}
\EFcd{;;} \EFc{Package-Requires: ((emacs "26.1") (lispy "0.27.0") (worf "0.1.0") (ivy-posframe "0.5.5"))}
\EFcd{;;} \EFc{Keywords: outlines, hypermedia, flashcards, memory}

\EFcd{;;} \EFc{This file is not part of GNU Emacs}

\EFcd{;;} \EFc{This file is free software; you can redistribute it and/or modify}
\EFcd{;;} \EFc{it under the terms of the GNU General Public License as published by}
\EFcd{;;} \EFc{the Free Software Foundation; either version 3, or (at your option)}
\EFcd{;;} \EFc{any later version.}

\EFcd{;;} \EFc{This program is distributed in the hope that it will be useful,}
\EFcd{;;} \EFc{but WITHOUT ANY WARRANTY; without even the implied warranty of}
\EFcd{;;} \EFc{MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
\EFcd{;;} \EFc{GNU General Public License for more details.}

\EFcd{;;} \EFc{For a full copy of the GNU General Public License}
\EFcd{;;} \EFc{see <http://www.gnu.org/licenses/>.}

\EFcd{;;;} \EFc{Commentary:}
\EFcd{;;}
\EFcd{;;} \EFc{An example master file is given in doc/sets/capitals/capitals.org.}
\EFcd{;;} \EFc{Use `}\textcolor[HTML]{a9a1e1}{hydra-pamparam/body}\EFc{' as the entry point.}
\EFcd{;;} \EFc{See README.org for more info.}

\EFcd{;;;} \EFc{Code:}

\EFcd{;;}\EFc{* Requires}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{worf}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{lispy}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{hydra}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{ivy}\EFrda{)}

\EFrda{(}\EFk{defgroup} \EFt{pamparam} nil
  \EFd{"Simple and fast flashcards."}
  \EFb{:group} \EFhq{'}\EFhs{flashcards}\EFrda{)}

\EFcd{;;}\EFc{* Pure}
\EFrda{(}\EFk{defun} \EFf{pamparam-sm2} \EFrdb{(}card-stats q\EFrdb{)}
  \EFd{"Determine the next iteration of CARD-STATS based on Q.}

\EFd{CARD-STATS is (EASE-FACTOR . INTERVALS), the result has the}
\EFd{same shape, with updated values.}

\EFd{EASE-FACTOR - the previous ease factor of the card.  All cards are}
\EFd{initialized with EASE-FACTOR of 2.5.  It will decrease for}
\EFd{difficult cards, but not below 1.3.}

\EFd{INTERVALS - list of integer day intervals between repetitions.}

\EFd{Q - the quality of the answer:}
  \EFd{5 - perfect response}
  \EFd{4 - correct response after a hesitation}
  \EFd{3 - correct response recalled with serious difficulty}
  \EFd{2 - incorrect response; where the correct one seemed easy to recall}
  \EFd{1 - incorrect response; the correct one remembered}
  \EFd{0 - complete blackout"}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}EF \EFrda{(}\EFo{car} card-stats\EFrda{)}\EFrdd{)}
        \EFrdd{(}intervals \EFrda{(}\EFo{cdr} card-stats\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} EF \EFrdd{(}\EFo{max} \EFhn{1.3} \EFrda{(}\EFo{+} EF \EFhn{0.1} \EFrdb{(}\EFo{*} \EFrdc{(}\EFo{-} q \EFhn{5}\EFrdc{)} \EFrdc{(}\EFo{+} \EFhn{0.08} \EFrdd{(}\EFo{*} \EFrda{(}\EFo{-} \EFhn{5} q\EFrda{)} \EFhn{0.02}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{<} q \EFhn{3}\EFrdd{)}
        \EFrdd{(}\EFo{cons} EF \EFrda{(}\EFo{cons} \EFhn{1} intervals\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{cons} EF
            \EFrda{(}\EFo{cons}
             \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}\EFo{null} intervals\EFrdd{)}
                    \EFhn{1}\EFrdc{)}
                   \EFrdc{(}\EFrdd{(}\EFo{=} \EFrda{(}\EFo{car} intervals\EFrda{)} \EFhn{1}\EFrdd{)}
                    \EFhn{6}\EFrdc{)}
                   \EFrdc{(}t
                    \EFrdd{(}\EFo{round} \EFrda{(}\EFo{*} EF \EFrdb{(}\EFo{car} intervals\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
             intervals\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;}\EFc{* Card files}
\EFrda{(}\EFk{defun} \EFf{pamparam-card-insert-score} \EFrdb{(}score actual-answer\EFrdb{)}
  \EFd{"Insert SCORE into the current card file."}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{outline-show-all}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*\char92{}\char92{}* scores"} nil t\EFrdc{)}
      \EFrdc{(}\EFo{outline-end-of-subtree}\EFrdc{)}
    \EFrdc{(}\EFo{forward-line} \EFhn{2}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFs{"** scores\char92{}n"}\EFrdc{)}
    \EFrdc{(}\EFo{backward-char}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} actual-answer
    \EFrdc{(}\EFo{kill-new} actual-answer\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{insert} \EFrdc{(}\EFo{format-time-string} \EFs{"\char92{}n| <\%Y-\%m-\%d> "}\EFrdc{)}
          \EFrdc{(}\EFo{format} \EFs{"| \%d |"} score\EFrdc{)}
          \EFrdc{(}\EFo{format} \EFs{" \%s |"}
                  \EFrdd{(}\EFk{or} actual-answer \EFs{""}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{org-table-align}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-wdiff} \EFrdb{(}actual-answer\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}expected-answer
         \EFrda{(}\EFk{save-excursion}
           \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}
           \EFrdb{(}\EFo{skip-chars-backward} \EFs{"\char92{}n"}\EFrdb{)}
           \EFrdb{(}\EFo{buffer-substring-no-properties}
            \EFrdc{(}\EFo{line-beginning-position}\EFrdc{)}
            \EFrdc{(}\EFo{line-end-position}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{and} actual-answer
               \EFrda{(}\EFo{not} \EFrdb{(}\EFf{pamparam-equal} actual-answer expected-answer\EFrdb{)}\EFrda{)}
               \EFrda{(}\EFo{executable-find} \EFs{"wdiff"}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{message}
       \EFrda{(}\EFo{string-trim}
        \EFrdb{(}\EFo{shell-command-to-string}
         \EFrdc{(}\EFo{format}
          \EFs{"wdiff -i <(echo \char92{}"\%s\char92{}") <(echo \char92{}"\%s\char92{}")"}
          actual-answer
          \EFrdd{(}\EFo{string-trim-right} expected-answer \EFs{"[.?!]"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-read-stats} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*\char92{}\char92{}* stats\char92{}n"} nil t\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}beg \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}
            \EFrda{(}exp1 \EFrdb{(}\EFo{read} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}
            \EFrda{(}exp2 \EFrdb{(}\EFo{read} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}
            ease-factor intervals\EFrdd{)}
        \EFrdd{(}\EFk{if} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{eq} \EFrdc{(}\EFo{nth} \EFhn{0} exp1\EFrdc{)} \EFhq{'}\EFhs{setq}\EFrdb{)}
                 \EFrdb{(}\EFo{eq} \EFrdc{(}\EFo{nth} \EFhn{1} exp1\EFrdc{)} \EFhq{'}\EFhs{ease-factor}\EFrdb{)}
                 \EFrdb{(}\EFo{numberp} \EFrdc{(}\EFo{nth} \EFhn{2} exp1\EFrdc{)}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFk{setq} ease-factor \EFrdb{(}\EFo{nth} \EFhn{2} exp1\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{error} \EFs{"Bad sexp \%S"} exp1\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{if} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{eq} \EFrdc{(}\EFo{nth} \EFhn{0} exp2\EFrdc{)} \EFhq{'}\EFhs{setq}\EFrdb{)}
                 \EFrdb{(}\EFo{eq} \EFrdc{(}\EFo{nth} \EFhn{1} exp2\EFrdc{)} \EFhq{'}\EFhs{intervals}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFk{setq} intervals \EFrdb{(}\EFo{cadr} \EFrdc{(}\EFo{nth} \EFhn{2} exp2\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{error} \EFs{"Bad sexp \%S"} exp2\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{delete-region} beg \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{cons} ease-factor intervals\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*\char92{}\char92{}* scores\char92{}n"} nil t\EFrdd{)}
        \EFrdd{(}\EFk{progn}
          \EFrda{(}\EFo{outline-end-of-subtree}\EFrda{)}
          \EFrda{(}\EFo{insert} \EFs{"\char92{}n** stats\char92{}n"}\EFrda{)}
          \EFrda{(}\EFo{list} \EFhn{2.5}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{error} \EFs{"** scores not found"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-insert-stats} \EFrdb{(}stats\EFrdb{)}
  \EFrdb{(}\EFo{insert} \EFrdc{(}\EFo{format} \EFs{"(setq ease-factor \%f)\char92{}n"} \EFrdd{(}\EFo{car} stats\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{insert} \EFrdc{(}\EFo{format} \EFs{"(setq intervals '\%S)"} \EFrdd{(}\EFo{cdr} stats\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-delete-region} \EFrdb{(}beg end\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}str \EFrda{(}\EFo{buffer-substring-no-properties} beg end\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{delete-region} beg end\EFrdc{)}
    str\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-save-buffer} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{inhibit-message} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{write-file} \EFrdd{(}\EFv{buffer-file-name}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-card-abbreviate}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-abbreviate} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}fname \EFrda{(}\EFo{file-name-nondirectory} \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{>} \EFrda{(}\EFo{length} fname\EFrda{)} \EFhn{60}\EFrdd{)}
      \EFrdd{(}\EFo{rename-buffer}
       \EFrda{(}\EFo{concat} \EFs{"card-"} \EFrdb{(}\EFo{substring} fname \EFhn{0} \EFhn{6}\EFrdb{)} \EFs{".org"}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-score} \EFrdb{(}score \EFt{\&optional} actual-answer\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}card-file \EFrda{(}\EFo{file-name-nondirectory} \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}todo-file \EFrda{(}\EFf{pamparam-todo-file}\EFrda{)}\EFrdd{)}
         \EFrdd{(}state \EFrda{(}\EFk{with-current-buffer} todo-file
                  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
                  \EFrdb{(}\EFo{search-forward} card-file\EFrdb{)}
                  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{+} \EFhn{2} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)}\EFrdc{)}\EFrdb{)}
                  \EFrdb{(}\EFo{buffer-substring-no-properties}
                   \EFrdc{(}\EFo{point}\EFrdc{)}
                   \EFrdc{(}\EFk{progn}
                     \EFrdd{(}\EFo{forward-word}\EFrdd{)}
                     \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFv{save-silently} t\EFrdd{)}
         \EFrdd{(}\EFv{inhibit-read-only} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{string=} state \EFs{"}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\EFs{"}\EFrda{)}
           \EFrda{(}\EFk{with-current-buffer} todo-file
             \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}\EFo{search-forward} card-file\EFrdb{)}
             \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{=} score \EFhn{5}\EFrdd{)}
                     \EFrdd{(}\EFo{=} score \EFhn{4}\EFrdd{)}
                     \EFrdd{(}\EFo{=} score \EFhn{3}\EFrdd{)}\EFrdc{)}
                 \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{org-log-done} nil\EFrda{)}
                       \EFrda{(}\EFv{inhibit-message} t\EFrda{)}\EFrdd{)}
                   \EFrdd{(}\EFo{org-todo} \EFhq{'}\EFhs{done}\EFrdd{)}\EFrdc{)}
               \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}item \EFrdb{(}\EFf{pamparam-delete-region}
                            \EFrdc{(}\EFo{line-beginning-position}\EFrdc{)}
                            \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{line-end-position}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
                 \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
                 \EFrdd{(}\EFo{insert} item\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}\EFf{pamparam-save-buffer}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFf{pamparam-save-buffer}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string=} state \EFs{"DONE"}\EFrda{)}
           \EFrda{(}\EFk{if} \EFrdb{(}\EFo{y-or-n-p} \EFs{"Card already done today.  Re-rate? "}\EFrdb{)}
               \EFrdb{(}\EFf{pamparam--card-score} score t actual-answer\EFrdb{)}
             \EFrdb{(}\EFo{user-error} \EFs{"This card is already done today"}\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string=} state \EFs{"}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{"}\EFrda{)}
           \EFrda{(}\EFf{pamparam--card-score} score nil actual-answer\EFrda{)}\EFrdd{)}
          \EFrdd{(}t
           \EFrda{(}\EFo{user-error} \EFs{"Unexpected state: \%s"} state\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} todo-file
      \EFrdd{(}\EFf{pamparam--recalculate-progress}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{outline-show-all}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-manual-score} \EFrdb{(}\EFrdb{)}
  \EFd{"Score the card 0-5 manually."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{undo}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}score \EFrda{(}\EFo{completing-read} \EFs{"score: "} \EFhq{'}\EFrdb{(}\EFs{"0"} \EFs{"1"} \EFs{"2"} \EFs{"3"} \EFs{"4"} \EFs{"5"}\EFrdb{)} nil t\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-card-score} \EFrdd{(}\EFo{string-to-number} score\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--todo-from-file} \EFrdb{(}card-file\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-match} \EFs{"\char92{}\char92{}`}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{-]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{-"} card-file\EFrdc{)}
      \EFrdc{(}\EFo{format}
       \EFs{"*} \textcolor[HTML]{ECBE7B}{\textbf{TODO}} \EFs{[[file:cards/\%s/\%s][\%s]]\char92{}n"}
       \EFrdd{(}\EFo{substring} card-file \EFhn{0} \EFhn{2}\EFrdd{)}
       card-file
       \EFrdd{(}\EFo{match-string} \EFhn{1} card-file\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{error} \EFs{"Unexpected file name"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--card-score} \EFrdb{(}score \EFt{\&optional} already-done actual-answer\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}card-file \EFrda{(}\EFo{file-name-nondirectory} \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}
        stats
        new-interval\EFrdc{)}
    \EFrdc{(}\EFk{save-excursion}
      \EFrdd{(}\EFf{pamparam-card-insert-score} score actual-answer\EFrdd{)}
      \EFrdd{(}\EFk{setq} stats \EFrda{(}\EFf{pamparam-card-read-stats}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} stats \EFrda{(}\EFf{pamparam-sm2} stats score\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-card-insert-stats} stats\EFrdd{)}
      \EFrdd{(}\EFk{setq} new-interval \EFrda{(}\EFo{nth} \EFhn{1} stats\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{unless} already-done
        \EFrda{(}\EFk{let*} \EFrdb{(}\EFrdc{(}todo-entry \EFrdd{(}\EFf{pamparam--todo-from-file} card-file\EFrdd{)}\EFrdc{)}
               str\EFrdb{)}
          \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFf{pamparam-todo-file}\EFrdc{)}
            \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{search-forward} card-file\EFrdd{)}
              \EFrdd{(}\EFk{if} \EFrda{(}\EFo{memq} score \EFhq{'}\EFrdb{(}\EFhn{4} \EFhn{5}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFk{progn}
                    \EFrdb{(}\EFo{beginning-of-line}\EFrdb{)}
                    \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{looking-at} \EFs{"\char92{}\char92{}*} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"}\EFrdc{)}
                        \EFrdc{(}\EFo{replace-match} \EFs{"DONE"} nil nil nil \EFhn{1}\EFrdc{)}
                      \EFrdc{(}\EFo{error} \EFs{"Unexpected"}\EFrdc{)}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFk{setq} str \EFrdb{(}\EFo{buffer-substring-no-properties}
                           \EFrdc{(}\EFo{+} \EFhn{7} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)}\EFrdc{)}
                           \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{line-end-position}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFo{delete-region}
                 \EFrdb{(}\EFo{line-beginning-position}\EFrdb{)}
                 \EFrdb{(}\EFo{1+} \EFrdc{(}\EFo{line-end-position}\EFrdc{)}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFo{insert} \EFs{"*} \textcolor[HTML]{51afef}{\textbf{REVIEW}} \EFs{"} str\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFf{pamparam-todo-file} new-interval\EFrdc{)}
            \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{search-forward} todo-entry nil t\EFrdd{)}
              \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFo{insert} todo-entry\EFrdd{)}
              \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{kill-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-wdiff} actual-answer\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar-local} \EFv{pamparam-card-answer-validate-p} nil\EFrda{)}

\EFrda{(}\EFk{defcustom} \EFv{pamparam-card-answer-function} \EFhq{\#'}\EFhs{pamparam-card-answer-at-point}
  \EFd{"Select how to answer the card."}
  \EFb{:type} \EFhq{'}\EFrdb{(}choice
          \EFrdc{(}const \EFb{:tag} \EFs{"Answer at point"} pamparam-card-answer-at-point\EFrdc{)}
          \EFrdc{(}const \EFb{:tag} \EFs{"Answer in a child frame"} pamparam-card-answer-posframe\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-answer-at-point} \EFrdb{(}\EFrdb{)}
  \EFd{"Answer the current card.}
\EFd{Enter the answer at point, then press \char92{}".\char92{}" to validate."}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}* m\$"} nil t\EFrdc{)}
    \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{point-min}\EFrdd{)} \EFrdd{(}\EFo{match-beginning} \EFhn{0}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{insert} \EFs{"* \char92{}n"}\EFrdb{)}
  \EFrdb{(}\EFo{goto-char} \EFhn{3}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{pamparam-card-answer-validate-p} t\EFrdb{)}
  \EFrdb{(}\EFo{outline-hide-body}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-posframe-keymap}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFo{map} \EFrda{(}\EFo{make-sparse-keymap}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"C-v"}\EFrdd{)} \EFhq{\#'}\EFhs{pamparam-card-reveal}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"."}\EFrdd{)} \EFhq{\#'}\EFhs{ivy-done}\EFrdc{)}
    map\EFrdb{)}
  \EFd{"The keymap for `}\textcolor[HTML]{a9a1e1}{pamparam-card-answer-posframe}\EFd{'"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-reveal} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFo{ivy-state-buffer} \EFv{ivy-last}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-shifttab}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--ivy-read-posframe} \EFrdb{(}prompt\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}ivy-posframe-state \EFrda{(}\EFk{bound-and-true-p} ivy-posframe-mode\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} ivy-posframe-state
      \EFrdd{(}ivy-posframe-mode \EFhn{1}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unwind-protect}
         \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}\EFv{ivy-add-newline-after-prompt} t\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{ivy-read} prompt nil
                     \EFb{:keymap} \EFv{pamparam-posframe-keymap}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{unless} ivy-posframe-state
        \EFrda{(}ivy-posframe-mode \EFhn{-1}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-answer-posframe} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{outline-hide-body}\EFrdb{)}
  \EFrdb{(}\EFo{read-only-mode} \EFhn{1}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}card-front
          \EFrda{(}\EFk{save-excursion}
            \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}\EFo{zo-down} \EFhn{1}\EFrdb{)}
            \EFrdb{(}\EFo{substring-no-properties} \EFrdc{(}\EFo{org-get-heading}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}answer \EFrda{(}\EFf{pamparam--ivy-read-posframe}
                  \EFrdb{(}\EFo{concat} card-front \EFs{": "}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{string=} answer \EFs{""}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-card-validate} answer \EFrda{(}\EFf{pamparam--card-true-answer}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{remove-overlays} \EFrdd{(}\EFo{point-min}\EFrdd{)} \EFrdd{(}\EFo{point-max}\EFrdd{)} \EFhq{'}\EFhs{invisible} \EFhq{'}\EFhs{outline}\EFrdc{)}
    \EFrdc{(}\EFo{read-only-mode} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-answer} \EFrdb{(}\EFrdb{)}
  \EFd{"Answer the current card."}
  \EFrdb{(}\EFo{funcall} \EFv{pamparam-card-answer-function}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-is-redo} nil\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--card-true-answer} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-max}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{re-search-backward} \EFs{"\char94{}\char92{}\char92{}*"}\EFrdc{)}
    \EFrdc{(}\EFo{beginning-of-line} \EFhn{2}\EFrdc{)}
    \EFrdc{(}\EFo{buffer-substring-no-properties}
     \EFrdd{(}\EFo{point}\EFrdd{)}
     \EFrdd{(}\EFo{1-} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-validate-maybe} \EFrdb{(}\EFt{\&optional} arg\EFrdb{)}
  \EFd{"Validate the given answer and score the current card.}

\EFd{The given answer is the text between the card's first heading and}
\EFd{point."}
  \EFrdb{(}\EFk{interactive} \EFs{"p"}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFv{pamparam-card-answer-validate-p}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}tans \EFrdb{(}\EFf{pamparam--card-true-answer}\EFrdb{)}\EFrda{)}
            \EFrda{(}actual-answer \EFrdb{(}\EFo{buffer-substring-no-properties}
                            \EFrdc{(}\EFo{+} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)} \EFhn{2}\EFrdc{)}
                            \EFrdc{(}\EFo{line-end-position}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{delete-region} \EFrda{(}\EFo{point-min}\EFrda{)}
                       \EFrda{(}\EFo{1+} \EFrdb{(}\EFo{line-end-position}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{setq} \EFv{pamparam-card-answer-validate-p} nil\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-card-validate} actual-answer tans\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{self-insert-command} arg\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-validate} \EFrdb{(}actual-answer correct-answer\EFrdb{)}
  \EFd{"Give a card score, comparing ACTUAL-ANSWER to CORRECT-ANSWER."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFf{pamparam-equal} actual-answer correct-answer\EFrdc{)}
      \EFrdc{(}\EFk{if} \EFrdd{(}\EFk{save-excursion}
            \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFo{re-search-backward} \EFs{"\char94{}\char92{}\char92{}* "}\EFrda{)}
            \EFrda{(}\EFo{overlays-in} \EFrdb{(}\EFo{point}\EFrdb{)} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFk{if} \EFv{pamparam-is-redo}
              \EFrda{(}\EFf{pamparam-card-score} \EFhn{4}\EFrda{)}
            \EFrda{(}\EFf{pamparam-card-score} \EFhn{5}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-card-score} \EFhn{3}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-card-score} \EFhn{0} actual-answer\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;}\EFc{* Equivalence testing}
\EFrda{(}\EFk{defvar} \EFv{pamparam-equiv-hash} \EFrdb{(}\EFo{make-hash-table} \EFb{:test} \EFhq{'}\EFhs{equal}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-equiv-classes} \EFhq{'}\EFrdb{(}\EFrdc{(}\EFs{"we"} \EFs{"wij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"je"} \EFs{"jij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"ze"} \EFs{"zij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"u"} \EFs{"jij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"dichtbij"} \EFs{"vlakbij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"test"} \EFs{"toets"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-make-equivalent} \EFrdb{(}a b\EFrdb{)}
  \EFrdb{(}\EFo{puthash} a b \EFv{pamparam-equiv-hash}\EFrdb{)}
  \EFrdb{(}\EFo{puthash} b b \EFv{pamparam-equiv-hash}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{dolist} \EFrdb{(}c \EFv{pamparam-equiv-classes}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-make-equivalent} \EFrdc{(}\EFo{car} c\EFrdc{)} \EFrdc{(}\EFo{cadr} c\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-equal} \EFrdb{(}sa sb\EFrdb{)}
  \EFd{"Check if the answer SA matches the question SB.}
\EFd{When SB has multiple lines, SA may match one of them."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFf{string-match-p} \EFs{"\char92{}n"} sb\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}sbl \EFrdb{(}\EFo{split-string} sb \EFs{"\char92{}n"} t\EFrdb{)}\EFrda{)}
            res\EFrdd{)}
        \EFrdd{(}\EFk{while} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{null} res\EFrdb{)} \EFrdb{(}\EFk{setq} sb \EFrdc{(}\EFk{pop} sbl\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFk{setq} res \EFrdb{(}\EFf{pamparam-equal-single} sa sb\EFrdb{)}\EFrda{)}\EFrdd{)}
        res\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-equal-single} sa sb\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-equal-single} \EFrdb{(}sa sb\EFrdb{)}
  \EFd{"Check if SA matches SB."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}lista \EFrda{(}\EFf{pamparam-sloppy} sa\EFrda{)}\EFrdd{)}
        \EFrdd{(}listb \EFrda{(}\EFf{pamparam-sloppy} sb\EFrda{)}\EFrdd{)}
        \EFrdd{(}res t\EFrdd{)}
        a b
        ah\EFrdc{)}
    \EFrdc{(}\EFk{while} \EFrdd{(}\EFk{and} res lista\EFrdd{)}
      \EFrdd{(}\EFk{setq} a \EFrda{(}\EFk{pop} lista\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} b \EFrda{(}\EFk{pop} listb\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFk{or} \EFrdb{(}\EFo{string=} a b\EFrdb{)}
                  \EFrdb{(}\EFk{and} \EFrdc{(}\EFk{setq} ah \EFrdd{(}\EFo{gethash} a \EFv{pamparam-equiv-hash}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{equal} ah
                              \EFrdd{(}\EFo{gethash} b \EFv{pamparam-equiv-hash}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{setq} res nil\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{and} res \EFrdd{(}\EFo{null} listb\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-sloppy} \EFrdb{(}str\EFrdb{)}
  \EFrdb{(}\EFo{mapcar} \EFhq{\#'}\EFhs{downcase}
          \EFrdc{(}\EFo{split-string} str \EFs{"[.,?!: ]"} t\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-load-file-name} \EFrdb{(}\EFk{or} \EFv{load-file-name}
                                    \EFrdc{(}\EFv{buffer-file-name}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-path} \EFrdb{(}\EFo{expand-file-name}
                       \EFs{"doc/sets/capitals/capitals.pam"}
                       \EFrdc{(}\EFo{file-name-directory} \EFv{pamparam-load-file-name}\EFrdc{)}\EFrdb{)}
  \EFd{"Point to a default repository. In case you call `}\textcolor[HTML]{a9a1e1}{pamparam-drill}\EFd{'}
\EFd{while not in any repo, this repo will be selected."}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-alist}
  \EFrdb{(}\EFo{list} \EFrdc{(}\EFo{cons} \EFrdd{(}\EFo{expand-file-name} \EFs{"capitals.org"}
                                \EFrda{(}\EFo{file-name-directory} \EFv{pamparam-path}\EFrda{)}\EFrdd{)}
              \EFv{pamparam-path}\EFrdc{)}\EFrdb{)}
  \EFd{"Map a master file to the corresponding repository.}
\EFd{Otherwise, the repository will be in the same directory as the master file."}\EFrda{)}

\EFcd{;;}\EFc{* Schedule files}
\EFrda{(}\EFk{defun} \EFf{pamparam-repo-directory} \EFrdb{(}file\EFrdb{)}
  \EFd{"Return the Git repository that corresponds to FILE."}
  \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{cdr} \EFrdd{(}\EFo{assoc} file \EFv{pamparam-alist}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFk{if} file
          \EFrdd{(}\EFo{expand-file-name}
           \EFrda{(}\EFo{concat}
            \EFrdb{(}\EFo{file-name-sans-extension}
             \EFrdc{(}\EFo{file-name-nondirectory}
              file\EFrdc{)}\EFrdb{)}
            \EFs{".pam/"}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{locate-dominating-file} \EFv{default-directory} \EFs{".git"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-repo-init} \EFrdb{(}repo-dir\EFrdb{)}
  \EFd{"Initialize REPO-DIR Git repository."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{file-exists-p} repo-dir\EFrdc{)}
      \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{file-directory-p} repo-dir\EFrdd{)}
        \EFrdd{(}\EFo{error} \EFs{"\%s must be a directory"} repo-dir\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{make-directory} repo-dir\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{default-directory} repo-dir\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{shell-command} \EFs{"git init"}\EFrdd{)}
      \EFrdd{(}\EFo{make-directory} \EFs{"cards/"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-new-cards-per-day} \EFhn{75}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-delete} \EFrdb{(}file\EFrdb{)}
  \EFd{"Delete the card in FILE.}
\EFd{When called interactively, delete the card in the current buffer."}
  \EFrdb{(}\EFk{interactive} \EFrdc{(}\EFo{list} \EFrdd{(}\EFv{buffer-file-name}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{file-exists-p} file\EFrdd{)}
             \EFrdd{(}\EFo{y-or-n-p}
              \EFrda{(}\EFo{format} \EFs{"Really delete \%s? "}
                      \EFrdb{(}\EFo{file-name-nondirectory} file\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{delete-file} file\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{string=} \EFrda{(}\EFv{buffer-file-name}\EFrda{)} file\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam--update-card}
     \EFrdd{(}\EFo{file-name-nondirectory} file\EFrdd{)}
     nil\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--update-card} \EFrdb{(}prev-file new-entry\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}prev-scheduled \EFrda{(}\EFf{pamparam-cmd-to-list} \EFrdb{(}\EFo{format} \EFs{"git grep \%s"} \EFrdc{(}\EFo{shell-quote-argument} prev-file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFv{save-silently} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}prev prev-scheduled\EFrdd{)}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{:]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{:.*\char92{}\char92{}[\char92{}\char92{}[file:cards/}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}]\char92{}\char92{}[}\textcolor[HTML]{a9a1e1}{.*\char92{}\char92{}}\EFs{]\char92{}\char92{}'"} prev\EFrda{)}
        \EFrda{(}\EFo{user-error} \EFs{"Bad scheduled item: \%s"} prev\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}schedule-file
             \EFrdc{(}\EFo{expand-file-name}
              \EFrdd{(}\EFo{match-string} \EFhn{1} prev\EFrdd{)}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}entry \EFrdc{(}\EFo{match-string} \EFhn{2} prev\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{with-temp-buffer}
          \EFrdb{(}\EFo{insert-file-contents} schedule-file\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{re-search-forward} entry nil t\EFrdc{)}
            \EFrdc{(}\EFk{if} new-entry
                \EFrdd{(}\EFo{replace-match} new-entry\EFrdd{)}
              \EFrdd{(}\EFo{delete-region}
               \EFrda{(}\EFo{line-beginning-position}\EFrda{)}
               \EFrda{(}\EFo{1+} \EFrdb{(}\EFo{line-end-position}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{write-file} schedule-file\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-hash-card-name->file} nil\EFrda{)}
\EFrda{(}\EFk{defvar} \EFv{pamparam-hash-card-body->file} nil\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-cmd-to-list} \EFrdb{(}cmd \EFt{\&optional} directory\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{default-directory} \EFrda{(}\EFk{or} directory \EFv{default-directory}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{split-string}
     \EFrdd{(}\EFo{shell-command-to-string} cmd\EFrdd{)}
     \EFs{"\char92{}n"} t\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-cards} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-cmd-to-list}
   \EFs{"git ls-files cards/"}
   repo-dir\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-visited-cards} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-cmd-to-list}
   \EFs{"git grep --files-with-matches '\char94{}\char92{}\char92{}*\char92{}\char92{}* scores'"}
   repo-dir\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-unvisited-cards} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-cmd-to-list}
   \EFs{"git grep --files-without-match '\char94{}\char92{}\char92{}*\char92{}\char92{}* scores' | grep cards/"}
   repo-dir\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-pile} \EFrdb{(}repo-dir\EFrdb{)}
  \EFd{"Pile up all unvisited cards into a single file."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}unvisited-cards \EFrda{(}\EFf{pamparam-unvisited-cards} repo-dir\EFrda{)}\EFrdd{)}
        \EFrdd{(}schedule-files \EFrda{(}\EFf{pamparam-cmd-to-list} \EFs{"git ls-files --full-name pamparam-*-[0-9][0-9].org"}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFv{save-silently} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}sf schedule-files\EFrdd{)}
      \EFrdd{(}\EFk{with-current-buffer} \EFrda{(}\EFo{find-file} \EFrdb{(}\EFo{expand-file-name} sf repo-dir\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{dolist} \EFrdb{(}card unvisited-cards\EFrdb{)}
          \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{while} \EFrdc{(}\EFo{search-forward} card nil t\EFrdc{)}
            \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)} \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{line-end-position}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFf{pamparam-save-buffer}\EFrda{)}
        \EFrda{(}\EFo{kill-buffer}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFo{find-file} \EFrda{(}\EFo{expand-file-name} \EFs{"pampile.org"} repo-dir\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{delete-region} \EFrda{(}\EFo{point-min}\EFrda{)} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{dolist} \EFrda{(}card unvisited-cards\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFf{pamparam--todo-from-file} \EFrdc{(}\EFo{file-name-nondirectory} card\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-pull} \EFrdb{(}arg \EFt{\&optional} buffer\EFrdb{)}
  \EFd{"Pull ARG cards into BUFFER.}
\EFd{When called interactively, use today's schedule file."}
  \EFrdb{(}\EFk{interactive}
   \EFrdc{(}\EFo{list} \EFrdd{(}\EFo{read-number} \EFs{"how many cards: "}\EFrdd{)}
         \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{save-silently} t\EFrdd{)}
        cards\EFrdc{)}
    \EFrdc{(}\EFk{setq} arg \EFrdd{(}\EFo{min} \EFhn{100} arg\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{switch-to-buffer} buffer\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFo{find-file-noselect}
                          \EFrda{(}\EFo{expand-file-name} \EFs{"pampile.org"}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{end-of-line} arg\EFrdd{)}
      \EFrdd{(}\EFk{setq} cards \EFrda{(}\EFf{pamparam-delete-region} \EFrdb{(}\EFo{point-min}\EFrdb{)}
                                     \EFrdb{(}\EFo{min} \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}
                                          \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-goto-schedule-part}\EFrdc{)}
    \EFrdc{(}\EFo{insert} cards\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-save-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-goto-schedule-part} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*"} nil t\EFrdc{)}
      \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{match-beginning} \EFhn{0}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-max}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--recompute-git-cards} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{pamparam-hash-card-name->file} \EFrdc{(}\EFo{make-hash-table} \EFb{:test} \EFhq{'}\EFhs{equal}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{pamparam-hash-card-body->file} \EFrdc{(}\EFo{make-hash-table} \EFb{:test} \EFhq{'}\EFhs{equal}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}git-files \EFrda{(}\EFf{pamparam-cards} repo-dir\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}gf git-files\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`cards/[0-9a-f]\char92{}\char92{}\{}\textcolor[HTML]{dcaeea}{2\char92{}\char92{}}\EFs{\}/}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{-]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{.]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}.org\char92{}\char92{}'"} gf\EFrda{)}
          \EFrda{(}\EFk{progn}
            \EFrdb{(}\EFo{puthash} \EFrdc{(}\EFo{match-string} \EFhn{1} gf\EFrdc{)} gf \EFv{pamparam-hash-card-name->file}\EFrdb{)}
            \EFrdb{(}\EFo{puthash} \EFrdc{(}\EFo{match-string} \EFhn{2} gf\EFrdc{)} gf \EFv{pamparam-hash-card-body->file}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{error} \EFs{"Unexpected file name \%s"} gf\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--replace-card} \EFrdb{(}\_card-front \_card-body repo-dir card-file prev-file\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}full-name \EFrda{(}\EFo{expand-file-name} prev-file repo-dir\EFrda{)}\EFrdd{)}
         \EFrdd{(}old-metadata
          \EFrda{(}\EFk{with-temp-buffer}
            \EFrdb{(}\EFo{insert-file-contents} full-name\EFrdb{)}
            \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{looking-at} \EFs{"\char92{}\char92{}* m\$"}\EFrdc{)}
              \EFrdc{(}\EFo{outline-end-of-subtree}\EFrdc{)}
              \EFrdc{(}\EFo{buffer-substring-no-properties}
               \EFrdd{(}\EFo{point-min}\EFrdd{)}
               \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-kill-buffer-of-file} full-name\EFrdc{)}
    \EFrdc{(}\EFo{delete-file} full-name\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{default-directory} repo-dir\EFrda{)}
          \EFrda{(}fnn \EFrdb{(}\EFo{file-name-nondirectory} card-file\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam--update-card} prev-file \EFrda{(}\EFo{concat} \EFrdb{(}\EFo{substring} fnn \EFhn{0} \EFhn{2}\EFrdb{)} \EFs{"/"} fnn\EFrda{)}\EFrdd{)}\EFrdc{)}
    old-metadata\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{eval-and-compile}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{eq} \EFv{system-type} \EFhq{'}\EFhs{windows-nt}\EFrdc{)}
      \EFrdc{(}\EFk{defun} \EFf{pamparam-spit} \EFrdd{(}str file\EFrdd{)}
        \EFrdd{(}\EFk{with-current-buffer} \EFrda{(}\EFo{find-file-noselect} file\EFrda{)}
          \EFrda{(}\EFo{erase-buffer}\EFrda{)}
          \EFrda{(}\EFo{insert} str\EFrda{)}
          \EFrda{(}\EFo{save-buffer}\EFrda{)}
          \EFrda{(}\EFo{kill-buffer} \EFrdb{(}\EFo{current-buffer}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{defun} \EFf{pamparam-spit} \EFrdd{(}str file\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}cmd \EFrdc{(}\EFo{format} \EFs{"echo '}\textcolor[HTML]{a9a1e1}{\%s}\EFs{' > \%s"}
                         \EFrdd{(}\EFo{replace-regexp-in-string} \EFs{"'"} \EFs{"'}\textcolor[HTML]{a9a1e1}{\char92{}\char92{}}\EFs{''"} str t t\EFrdd{)}
                         \EFrdd{(}\EFo{shell-quote-argument} file\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{unless} \EFrdb{(}\EFo{=} \EFhn{0} \EFrdc{(}\EFo{call-process-shell-command} cmd\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{error} \EFs{"Command failed: \%s"} cmd\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-slurp} \EFrdb{(}f\EFrdb{)}
  \EFrdb{(}\EFk{with-temp-buffer}
    \EFrdc{(}\EFo{insert-file-contents} f\EFrdc{)}
    \EFrdc{(}\EFo{buffer-string}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-update-card} \EFrdb{(}card-front card-body repo-dir\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}card-front-id \EFrda{(}\EFo{md5} card-front\EFrda{)}\EFrdd{)}
         \EFrdd{(}card-body-id \EFrda{(}\EFo{md5} card-body\EFrda{)}\EFrdd{)}
         \EFrdd{(}prev-file
          \EFrda{(}\EFk{or}
           \EFrdb{(}\EFo{gethash} card-front-id \EFv{pamparam-hash-card-name->file}\EFrdb{)}
           \EFrdb{(}\EFo{gethash} card-body-id \EFv{pamparam-hash-card-body->file}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}subdir \EFrda{(}\EFo{substring} card-front-id \EFhn{0} \EFhn{2}\EFrda{)}\EFrdd{)}
         \EFrdd{(}card-file
          \EFrda{(}\EFo{concat}
           \EFs{"cards/"} subdir \EFs{"/"} card-front-id \EFs{"-"} card-body-id \EFs{".org"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}full-card-file \EFrda{(}\EFo{expand-file-name} card-file repo-dir\EFrda{)}\EFrdd{)}
         \EFrdd{(}metadata nil\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{null} prev-file\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string=} card-file prev-file\EFrda{)}\EFrdd{)}
          \EFrdd{(}t
           \EFrda{(}\EFk{when} \EFrdb{(}\EFo{file-exists-p} \EFrdc{(}\EFo{expand-file-name} prev-file repo-dir\EFrdc{)}\EFrdb{)}
             \EFrdb{(}\EFk{setq} metadata \EFrdc{(}\EFf{pamparam--replace-card}
                             card-front card-body repo-dir card-file prev-file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{file-exists-p} \EFrda{(}\EFo{expand-file-name} card-file repo-dir\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}txt
              \EFrdc{(}\EFo{concat}
               \EFrdd{(}\EFk{or} metadata \EFs{"* m\char92{}n\#+STARTUP: content\char92{}n"}\EFrdd{)}
               \EFrdd{(}\EFo{format} \EFs{"* \%s\char92{}n\%s"} card-front card-body\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{make-directory} \EFrdb{(}\EFo{file-name-directory} full-card-file\EFrdb{)} t\EFrda{)}
        \EFrda{(}\EFf{pamparam-spit} txt full-card-file\EFrda{)}
        \EFrda{(}\EFo{cons} \EFrdb{(}\EFk{if} metadata
                  \EFhq{'}\EFhs{update}
                \EFhq{'}\EFhs{new}\EFrdb{)}
              card-file\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defconst} \EFv{pamparam-card-source-regexp} \EFs{"\char94{}\char92{}\char92{}*+ .*:cards:"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-sync} \EFrdb{(}\EFrdb{)}
  \EFd{"Synchronize the current `}\textcolor[HTML]{a9a1e1}{org-mode}\EFd{' master file to the cards repository.}

\EFd{Create the cards repository if it doesn't exist.}

\EFd{Each card is uniquely identifiable by either its front or its}
\EFd{back.  So if you want to modify both the front and the back, first}
\EFd{modify the front, call `}\textcolor[HTML]{a9a1e1}{pamparam-sync}\EFd{', then modify the back and call}
\EFd{`}\textcolor[HTML]{a9a1e1}{pamparam-sync}\EFd{' again.  Otherwise, there's no way to \char92{}"connect\char92{}" the}
\EFd{new card to the old one, and the old card will remain in the}
\EFd{repository, while the new card will start with empty metadata."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFrdc{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrdc{)}
    \EFrdc{(}\EFo{error} \EFs{"Must be in `}\textcolor[HTML]{a9a1e1}{org-mode}\EFs{' file"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFf{pamparam--cards-available-p}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}repo-dir \EFrdb{(}\EFf{pamparam-repo-directory} \EFrdc{(}\EFv{buffer-file-name}\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFv{make-backup-files} nil\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-repo-init} repo-dir\EFrdd{)}
      \EFrdd{(}\EFf{pamparam--recompute-git-cards} repo-dir\EFrdd{)}
      \EFrdd{(}\EFf{pamparam--sync} repo-dir\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-kill-buffer-of-file} \EFrdb{(}fname\EFrdb{)}
  \EFrdb{(}\EFk{dolist} \EFrdc{(}buf \EFrdd{(}\EFo{buffer-list}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{equal} fname \EFrda{(}\EFv{buffer-file-name} buf\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer} buf\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{org-keyword-properties}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamapram--cards-at-level-one-p} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}alist \EFrda{(}\EFk{if} \EFrdb{(}\EFo{boundp} \EFhq{'}\EFhs{org-file-properties}\EFrdb{)}
                   org-file-properties
                 \EFv{org-keyword-properties}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{assoc-string} \EFs{"pamparam"} alist t\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--cards-available-p} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{or} \EFrdc{(}\EFf{pamapram--cards-at-level-one-p}\EFrdc{)}
      \EFrdc{(}\EFk{save-excursion}
        \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{if} \EFrda{(}\EFo{re-search-forward} \EFv{pamparam-card-source-regexp} nil t\EFrda{)}
            t
          \EFrda{(}\EFo{error} \EFs{"No outlines with the :cards: tag found"}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--sync} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}old-point \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
        \EFrdd{(}processed-headings nil\EFrdd{)}
        \EFrdd{(}new-cards nil\EFrdd{)}
        \EFrdd{(}updated-cards nil\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}cards-at-level-one-p \EFrdb{(}\EFf{pamapram--cards-at-level-one-p}\EFrdb{)}\EFrda{)}
           \EFrda{(}regex \EFrdb{(}\EFk{if} cards-at-level-one-p
                      \EFs{"\char92{}\char92{}*+ .*\$"}
                    \EFv{pamparam-card-source-regexp}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{while} \EFrda{(}\EFo{re-search-forward} regex nil t\EFrda{)}
        \EFrda{(}\EFk{when} cards-at-level-one-p
          \EFrdb{(}\EFo{beginning-of-line}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{lispy-destructuring-setq} \EFrdb{(}processed-headings new-cards updated-cards\EFrdb{)}
            \EFrdb{(}\EFf{pamparam-sync-current-outline}
             processed-headings new-cards updated-cards repo-dir\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} old-point\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{or} new-cards updated-cards\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}pile-fname \EFrdc{(}\EFo{expand-file-name} \EFs{"pampile.org"} repo-dir\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFf{pamparam-kill-buffer-of-file} pile-fname\EFrda{)}
        \EFrda{(}\EFf{pamparam-schedule-today}
         \EFrdb{(}\EFo{mapcar} \EFhq{\#'}\EFhs{pamparam--todo-from-file} new-cards\EFrdb{)}
         \EFrdb{(}\EFo{find-file-noselect} pile-fname\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{shell-command-to-string}
       \EFrda{(}\EFo{format}
        \EFs{"cd \%s \&\& git add . \&\& git commit -m \%s"}
        \EFrdb{(}\EFo{shell-quote-argument} repo-dir\EFrdb{)}
        \EFrdb{(}\EFo{shell-quote-argument}
         \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{null} updated-cards\EFrda{)}
                \EFrda{(}\EFo{format} \EFs{"Add \%d new card(s)"} \EFrdb{(}\EFo{length} new-cards\EFrdb{)}\EFrda{)}\EFrdd{)}
               \EFrdd{(}\EFrda{(}\EFo{null} new-cards\EFrda{)}
                \EFrda{(}\EFo{format} \EFs{"Update \%d card(s)"} \EFrdb{(}\EFo{length} updated-cards\EFrdb{)}\EFrda{)}\EFrdd{)}
               \EFrdd{(}t
                \EFrda{(}\EFo{format} \EFs{"Add \%d new card(s), update \%d cards"}
                        \EFrdb{(}\EFo{length} new-cards\EFrdb{)}
                        \EFrdb{(}\EFo{length} updated-cards\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFs{"\%d new cards, \%d updated, \%d total"}
             \EFrdd{(}\EFo{length} new-cards\EFrdd{)}
             \EFrdd{(}\EFo{length} updated-cards\EFrdd{)}
             \EFrdd{(}\EFo{length} processed-headings\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--card-info} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}bnd \EFrda{(}\EFf{worf--bounds-subtree}\EFrda{)}\EFrdd{)}
         \EFrdd{(}str \EFrda{(}\EFo{lispy--string-dwim} bnd\EFrda{)}\EFrdd{)}
         front back\EFrdc{)}
    \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{string-match} \EFs{"\char94{}\char92{}\char92{}*+ a\char92{}n}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} str\EFrda{)}
           \EFrda{(}\EFk{setq} front \EFrdb{(}\EFo{substring} str \EFhn{0} \EFrdc{(}\EFo{match-beginning} \EFhn{0}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} back \EFrdb{(}\EFo{concat} \EFs{"* a\char92{}n"} \EFrdc{(}\EFo{match-string} \EFhn{1} str\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} front \EFrdb{(}\EFo{string-trim-left} front\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{cdr} bnd\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`\char92{}\char92{}*+} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}n}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{*]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(?:}}\EFs{\char92{}n\char92{}\char92{}*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{?"} str\EFrda{)}
           \EFrda{(}\EFk{setq} front \EFrdb{(}\EFo{match-string} \EFhn{1} str\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} back \EFrdb{(}\EFo{match-string} \EFhn{2} str\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{+} \EFrdc{(}\EFo{car} bnd\EFrdc{)} \EFrdc{(}\EFo{match-end} \EFhn{2}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} back \EFrdb{(}\EFo{string-trim-right} back\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{\char92{}\char92{}*+} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{.*\{}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{\}]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\}.*\char92{}\char92{}'"} str\EFrda{)}
           \EFrda{(}\EFk{setq} front
                 \EFrdb{(}\EFo{concat} \EFrdc{(}\EFo{substring} str \EFrdd{(}\EFo{match-end} \EFhn{1}\EFrdd{)} \EFrdd{(}\EFo{1-} \EFrda{(}\EFo{match-beginning} \EFhn{2}\EFrda{)}\EFrdd{)}\EFrdc{)}
                         \EFs{"[...]"}
                         \EFrdc{(}\EFo{substring} str \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{match-end} \EFhn{2}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} back \EFrdb{(}\EFo{match-string} \EFhn{2} str\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}t
           \EFrda{(}\EFo{error} \EFs{"unexpected"}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{cons} front back\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-sync-current-outline} \EFrdb{(}processed-headings new-cards updated-cards repo-dir\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}end \EFrda{(}\EFk{save-excursion}
               \EFrdb{(}\EFo{outline-end-of-subtree}\EFrdb{)}
               \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{while} \EFrdd{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*+} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"} end t\EFrdd{)}
      \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}card-info \EFrdc{(}\EFf{pamparam--card-info}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}card-front \EFrdc{(}\EFo{car} card-info\EFrdc{)}\EFrdb{)}
             \EFrdb{(}card-body \EFrdc{(}\EFo{cdr} card-info\EFrdc{)}\EFrdb{)}
             card-file\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFo{member} card-front processed-headings\EFrdb{)}
            \EFrdb{(}\EFo{error} \EFs{"Duplicate heading encountered: \%s"} card-front\EFrdb{)}
          \EFrdb{(}\EFk{push} card-front processed-headings\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{when} \EFrdb{(}\EFk{setq} card-info \EFrdc{(}\EFf{pamparam-update-card} card-front card-body repo-dir\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{setq} card-file \EFrdc{(}\EFo{file-name-nondirectory} \EFrdd{(}\EFo{cdr} card-info\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}\EFo{eq} \EFrda{(}\EFo{car} card-info\EFrda{)} \EFhq{'}\EFhs{new}\EFrdd{)}
                 \EFrdd{(}\EFk{push} card-file new-cards\EFrdd{)}\EFrdc{)}
                \EFrdc{(}\EFrdd{(}\EFo{eq} \EFrda{(}\EFo{car} card-info\EFrda{)} \EFhq{'}\EFhs{update}\EFrdd{)}
                 \EFrdd{(}\EFk{push} card-file updated-cards\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{list} processed-headings new-cards updated-cards\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-default-directory} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-match} \EFs{"\char94{}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*\char92{}\char92{}.pam/}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFv{default-directory}\EFrdc{)}
      \EFrdc{(}\EFo{expand-file-name} \EFrdd{(}\EFo{match-string} \EFhn{1} \EFv{default-directory}\EFrdd{)}\EFrdc{)}
    \EFv{pamparam-path}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-kill-buffers} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}pdir \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}cards-dir \EFrda{(}\EFo{expand-file-name} \EFs{"cards/"} pdir\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}b \EFrda{(}\EFo{buffer-list}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFv{buffer-file-name} b\EFrda{)}
        \EFrda{(}\EFk{let} \EFrdb{(}\EFrdc{(}dir \EFrdd{(}\EFo{file-name-directory} \EFrda{(}\EFv{buffer-file-name} b\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{equal} dir cards-dir\EFrdd{)}
                    \EFrdd{(}\EFk{and} \EFrda{(}\EFo{equal} dir pdir\EFrda{)}
                         \EFrda{(}\EFo{not} \EFrdb{(}\EFo{equal} \EFrdc{(}\EFo{file-name-nondirectory}
                                      \EFrdd{(}\EFv{buffer-file-name} b\EFrdd{)}\EFrdc{)}
                                     \EFrdc{(}\EFf{pamparam-schedule-file} \EFrdd{(}\EFo{current-time}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{kill-buffer} b\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-schedule-file} \EFrdb{(}time\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}year \EFrda{(}\EFo{format-time-string} \EFs{"\%Y"} time\EFrda{)}\EFrdd{)}
        \EFrdd{(}current-year \EFrda{(}\EFo{format-time-string} \EFs{"\%Y"} \EFrdb{(}\EFo{current-time}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}base \EFrda{(}\EFo{format-time-string} \EFs{"pam-\%Y-\%m-\%d.org"} time\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{string=} year current-year\EFrdd{)}
        base
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}dir \EFrdc{(}\EFo{expand-file-name}
                  year \EFrdd{(}\EFo{expand-file-name} \EFs{"years"} \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{unless} \EFrdb{(}\EFo{file-exists-p} dir\EFrdb{)}
          \EFrdb{(}\EFo{make-directory} dir t\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{expand-file-name} base dir\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-todo-file} \EFrdb{(}\EFt{\&optional} offset\EFrdb{)}
  \EFrdb{(}\EFk{setq} offset \EFrdc{(}\EFk{or} offset \EFhn{0}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}\EFv{default-directory} \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}todo-file \EFrda{(}\EFo{expand-file-name}
                     \EFrdb{(}\EFf{pamparam-schedule-file}
                      \EFrdc{(}\EFo{time-add}
                       \EFrdd{(}\EFo{current-time}\EFrdd{)}
                       \EFrdd{(}\EFo{days-to-time} offset\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFv{save-silently} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{file-exists-p} todo-file\EFrdd{)}
      \EFrdd{(}\EFk{save-current-buffer}
        \EFrda{(}\EFo{find-file} todo-file\EFrda{)}
        \EFrda{(}\EFo{insert} \EFs{"\#+SEQ\_}\textcolor[HTML]{ECBE7B}{\textbf{TODO:}} \textcolor[HTML]{ECBE7B}{\textbf{TODO}} \textcolor[HTML]{51afef}{\textbf{REVIEW}} \EFs{| DONE\char92{}n"}\EFrda{)}
        \EFrda{(}\EFk{when} \EFrdb{(}\EFo{eq} offset \EFhn{0}\EFrdb{)}
          \EFrdb{(}\EFf{pamparam-pull} \EFhn{10} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{message} \EFs{"Schedule was empty, used `}\textcolor[HTML]{a9a1e1}{pamparam-pull}\EFs{' for 10 cards"}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFf{pamparam-save-buffer}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{find-file-noselect} todo-file\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-last-rechedule} nil\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-schedule-today} \EFrdb{(}cards \EFt{\&optional} buffer\EFrdb{)}
  \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFk{or} buffer \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-goto-schedule-part}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}card cards\EFrdd{)}
      \EFrdd{(}\EFo{insert} card\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{save-silently} t\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar-local} \EFv{pamparam--progress} nil
  \EFd{"Cache the current progress."}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-current-progress} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFf{pamparam-todo-file}\EFrdc{)}
    \EFrdc{(}\EFk{or} \EFv{pamparam--progress}
        \EFrdd{(}\EFf{pamparam--recalculate-progress}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--recalculate-progress} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{pamparam--progress}
        \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}n-done \EFhn{0}\EFrda{)}
              \EFrda{(}n-todo \EFhn{0}\EFrda{)}
              \EFrda{(}n-review \EFhn{0}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFk{save-excursion}
            \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-min}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFk{while} \EFrdb{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{DONE}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} nil t\EFrdb{)}
              \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}ms \EFrda{(}\EFo{match-string} \EFhn{1}\EFrda{)}\EFrdd{)}\EFrdc{)}
                \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{string=} ms \EFs{"}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{"}\EFrda{)}
                       \EFrda{(}\EFk{cl-incf} n-todo\EFrda{)}\EFrdd{)}
                      \EFrdd{(}\EFrda{(}\EFo{string=} ms \EFs{"DONE"}\EFrda{)}
                       \EFrda{(}\EFk{cl-incf} n-done\EFrda{)}\EFrdd{)}
                      \EFrdd{(}\EFrda{(}\EFo{string=} ms \EFs{"}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\EFs{"}\EFrda{)}
                       \EFrda{(}\EFk{cl-incf} n-review\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFo{list} n-done n-todo n-review\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-mode-line} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{cl-destructuring-bind} \EFrdc{(}n-done n-todo n-review\EFrdc{)}
      \EFrdc{(}\EFf{pamparam-current-progress}\EFrdc{)}
    \EFrdc{(}\EFo{format} \EFs{"(pam: \%d/\%d+\%d)"} n-done n-todo n-review\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-day-limit} \EFhn{50}
  \EFd{"Limit for today's repetitions.}
\EFd{All cards above this number that would be scheduled for today}
\EFd{will instead be moved to tomorrow."}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-merge-schedules} \EFrdb{(}from to\EFrdb{)}
  \EFd{"Copy items FROM -> TO. Delete FROM."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}from-lines
         \EFrda{(}\EFo{cl-remove-if-not}
          \EFrdb{(}\EFk{lambda} \EFrdc{(}s\EFrdc{)} \EFrdc{(}\EFf{string-match-p} \EFs{"\char94{}\char92{}\char92{}*"} s\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{split-string} \EFrdc{(}\EFf{pamparam-slurp} from\EFrdc{)} \EFs{"\char92{}n"} t\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}to-lines \EFrda{(}\EFo{split-string} \EFrdb{(}\EFf{pamparam-slurp} to\EFrdb{)} \EFs{"\char92{}n"} t\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-spit}
     \EFrdd{(}\EFo{mapconcat} \EFhq{\#'}\EFhs{identity}
                \EFrda{(}\EFo{append} to-lines from-lines\EFrda{)}
                \EFs{"\char92{}n"}\EFrdd{)}
     to\EFrdc{)}
    \EFrdc{(}\EFo{delete-file} from\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-carryover-year-maybe} \EFrdb{(}\EFrdb{)}
  \EFd{"Move e.g. years/2018/*.org to . if the current year is 2018."}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}today \EFrda{(}\EFo{calendar-current-date}\EFrda{)}\EFrdd{)}
         \EFrdd{(}year \EFrda{(}\EFo{nth} \EFhn{2} today\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFv{default-directory} \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}year-directory \EFrda{(}\EFo{format} \EFs{"years/\%d"} year\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{file-exists-p} year-directory\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}year-files \EFrdc{(}\EFo{directory-files} year-directory nil \EFs{"org\$"}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{dolist} \EFrdb{(}file year-files\EFrdb{)}
          \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}file-from \EFrda{(}\EFo{expand-file-name} file year-directory\EFrda{)}\EFrdd{)}
                \EFrdd{(}file-to \EFrda{(}\EFo{expand-file-name} file\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{file-exists-p} file-to\EFrdd{)}
                \EFrdd{(}\EFf{pamparam-merge-schedules} file-from file-to\EFrdd{)}
              \EFrdd{(}\EFo{rename-file} file-from file-to\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{delete-directory} year-directory\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-check} \EFrdb{(}\EFrdb{)}
  \EFd{"Check the repo for inconsistencies and fix them.}

\EFd{Check that all existing cards are scheduled, and only once.}
\EFd{Check that there are no scheduled unexisting cards."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}\EFv{default-directory} \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}all-cards \EFrda{(}\EFf{pamparam-cards} \EFv{default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}all-schedules \EFrda{(}\EFo{delq} nil
                              \EFrdb{(}\EFo{mapcar}
                               \EFrdc{(}\EFk{lambda} \EFrdd{(}s\EFrdd{)}
                                 \EFrdd{(}\EFk{when} \EFrda{(}\EFo{string-match} \EFs{"file:}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{]]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} s\EFrda{)}
                                   \EFrda{(}\EFo{match-string} \EFhn{1} s\EFrda{)}\EFrdd{)}\EFrdc{)}
                               \EFrdc{(}\EFf{pamparam-cmd-to-list}
                                \EFs{"git grep '\char94{}\char92{}\char92{}* TODO'"}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}unscheduled-cards \EFrda{(}\EFo{cl-set-difference}
                             all-cards
                             all-schedules
                             \EFb{:test} \EFhq{\#'}\EFhs{equal}\EFrda{)}\EFrdd{)}
         \EFrdd{(}unexisting-cards \EFrda{(}\EFo{cl-set-difference}
                            all-schedules
                            all-cards
                            \EFb{:test} \EFhq{\#'}\EFhs{equal}\EFrda{)}\EFrdd{)}
         \EFrdd{(}all-schedules-nodups \EFrda{(}\EFo{delete-dups} \EFrdb{(}\EFo{copy-sequence} all-schedules\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}duplicate-cards \EFrda{(}\EFo{cl-set-difference} all-schedules all-schedules-nodups\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFo{find-file-noselect} \EFs{"pampile.org"}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{dolist} \EFrda{(}card unscheduled-cards\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{format} \EFs{"*} \textcolor[HTML]{ECBE7B}{\textbf{TODO}} \EFs{[[file:\%s][\%s]]\char92{}n"}
                        card \EFrdc{(}\EFo{nth} \EFhn{1} \EFrdd{(}\EFo{split-string} card \EFs{"[-.]"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{save-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}card \EFrda{(}\EFo{append} duplicate-cards unexisting-cards\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}occurences \EFrdc{(}\EFf{pamparam-cmd-to-list} \EFrdd{(}\EFo{format} \EFs{"git grep \%s"} card\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{dolist} \EFrdb{(}occ \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{=} \EFrda{(}\EFo{length} occurences\EFrda{)} \EFhn{1}\EFrdd{)}
                         occurences
                       \EFrdd{(}\EFo{cdr} occurences\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFo{find-file-noselect} \EFrdd{(}\EFo{car} \EFrda{(}\EFo{split-string} occ \EFs{":"}\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{re-search-forward} card\EFrdc{)}
            \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)}
                           \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{line-end-position}\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{save-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-reschedule-maybe} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-carryover-year-maybe}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}today \EFrda{(}\EFo{calendar-current-date}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFk{and} \EFv{pamparam-last-rechedule}
                 \EFrda{(}\EFo{<}
                  \EFrdb{(}\EFf{calendar-absolute-from-gregorian} today\EFrdb{)}
                  \EFrdb{(}\EFf{calendar-absolute-from-gregorian} \EFv{pamparam-last-rechedule}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{pamparam-last-rechedule} today\EFrdd{)}
      \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}today-file \EFrdc{(}\EFf{pamparam-todo-file}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}today-file-name \EFrdc{(}\EFo{file-name-nondirectory}
                               \EFrdd{(}\EFv{buffer-file-name} today-file\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}pdir \EFrdc{(}\EFo{file-name-directory}
                    \EFrdd{(}\EFv{buffer-file-name} today-file\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}all-files \EFrdc{(}\EFo{directory-files} pdir nil \EFs{"org\$"}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}idx \EFrdc{(}\EFo{cl-position} today-file-name all-files
                               \EFb{:test} \EFhq{'}\EFhs{equal}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}old-files \EFrdc{(}\EFo{reverse} \EFrdd{(}\EFo{cl-subseq} all-files \EFhn{0} idx\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{dolist} \EFrdb{(}old-file old-files\EFrdb{)}
          \EFrdb{(}\EFk{setq} old-file \EFrdc{(}\EFo{expand-file-name} old-file pdir\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{let} \EFrdc{(}cards\EFrdc{)}
            \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFo{find-file-noselect} old-file\EFrdd{)}
              \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFk{while} \EFrda{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}} \EFs{"} nil t\EFrda{)}
                \EFrda{(}\EFk{push} \EFrdb{(}\EFo{buffer-substring-no-properties}
                       \EFrdc{(}\EFo{point}\EFrdc{)} \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{line-end-position}\EFrdd{)}\EFrdc{)}\EFrdb{)}
                      cards\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFf{pamparam-schedule-today} \EFrdd{(}\EFo{mapcar} \EFrda{(}\EFk{lambda} \EFrdb{(}s\EFrdb{)} \EFrdb{(}\EFo{concat} \EFs{"*} \textcolor[HTML]{ECBE7B}{\textbf{TODO}} \EFs{"} s\EFrdb{)}\EFrda{)}
                                             \EFrda{(}\EFo{nreverse} cards\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{delete-file} old-file\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{with-current-buffer} today-file
          \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*} \textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{"} nil t \EFv{pamparam-day-limit}\EFrdc{)}
            \EFrdc{(}\EFo{beginning-of-line} \EFhn{2}\EFrdc{)}
            \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}rescheduled \EFrdb{(}\EFo{buffer-substring-no-properties}
                                \EFrdc{(}\EFo{point}\EFrdc{)} \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFo{delete-region} \EFrda{(}\EFo{point}\EFrda{)} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFo{save-buffer}\EFrdd{)}
              \EFrdd{(}\EFk{with-current-buffer} \EFrda{(}\EFf{pamparam-todo-file} \EFhn{1}\EFrda{)}
                \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFo{insert} rescheduled\EFrda{)}
                \EFrda{(}\EFo{save-buffer}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{pamparam-drill} \EFrdb{(}\EFrdb{)}
  \EFd{"Start a learning session.}

\EFd{When `}\textcolor[HTML]{a9a1e1}{default-directory}\EFd{' is in a *.pam repository, use that repository.}
\EFd{Otherwise, use the repository that `}\textcolor[HTML]{a9a1e1}{pamparam-path}\EFd{' points to.}

\EFd{See `}\textcolor[HTML]{a9a1e1}{pamparam-sync}\EFd{' for creating and updating a *.pam repository.}

\EFd{If you have no more cards scheduled for today, use `}\textcolor[HTML]{a9a1e1}{pamparam-pull}\EFd{'."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-reschedule-maybe}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}card-link card-file\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{bound-and-true-p} \EFv{pamparam-card-mode}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFo{buffer-modified-p}\EFrda{)}
        \EFrda{(}\EFf{pamparam-save-buffer}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{delete-other-windows}\EFrdc{)}
    \EFrdc{(}\EFo{split-window-vertically}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-kill-buffers}\EFrdc{)}
    \EFrdc{(}\EFo{switch-to-buffer} \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{re-search-forward} \EFs{"\char94{}*} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}} \EFs{"} nil t\EFrdd{)}
      \EFrdd{(}\EFo{recenter} \EFhn{5}\EFrdd{)}
      \EFrdd{(}\EFk{setq} card-link \EFrda{(}\EFo{buffer-substring-no-properties}
                       \EFrdb{(}\EFo{point}\EFrdb{)} \EFrdb{(}\EFo{line-end-position}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{beginning-of-line}\EFrdd{)}
      \EFrdd{(}\EFo{set-window-point} \EFrda{(}\EFo{selected-window}\EFrda{)} \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{other-window} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{null} card-link\EFrdd{)}
        \EFrdd{(}\EFo{message} \EFs{"\%d cards learned/reviewed today. Well done!"}
                 \EFrda{(}\EFo{cl-count-if}
                  \EFrdb{(}\EFk{lambda} \EFrdc{(}x\EFrdc{)} \EFrdc{(}\EFo{string-match} \EFs{"\char94{}\char92{}\char92{}* DONE"} x\EFrdc{)}\EFrdb{)}
                  \EFrdb{(}\EFo{split-string} \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}
                                  \EFrdd{(}\EFo{buffer-string}\EFrdd{)}\EFrdc{)} \textcolor[HTML]{ECBE7B}{"\char92{}n"}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}\textcolor[HTML]{a9a1e1}{)}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`\char92{}\char92{}[\char92{}\char92{}[file:}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{]]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}]\char92{}\char92{}[}\textcolor[HTML]{a9a1e1}{.*\char92{}\char92{}}\EFs{]\char92{}\char92{}]\char92{}\char92{}'"} card-link\EFrda{)}
        \EFrda{(}\EFo{error} \EFs{"Bad entry in \%s: \%s"} \EFrdb{(}\EFf{pamparam-todo-file}\EFrdb{)} card-link\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} card-file \EFrda{(}\EFo{match-string} \EFhn{1} card-link\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{switch-to-buffer}
       \EFrda{(}\EFo{find-file-noselect}
        \EFrdb{(}\EFo{expand-file-name} card-file \EFrdc{(}\EFf{pamparam-default-directory}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFv{pamparam-card-mode}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-commit} \EFrdb{(}\EFrdb{)}
  \EFd{"Commit the current progress using Git."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}repo-dir \EFrda{(}\EFf{pamparam-repo-directory} \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFv{default-directory} \EFrda{(}\EFk{if} \EFrdb{(}\EFo{file-exists-p} repo-dir\EFrdb{)}
                                repo-dir
                              \EFrdb{(}\EFf{pamparam-default-directory}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}status \EFrda{(}\EFf{pamparam-cmd-to-list} \EFs{"git status"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}card-count
          \EFrda{(}\EFo{cl-count-if}
           \EFrdb{(}\EFk{lambda} \EFrdc{(}s\EFrdc{)}
             \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{string-match} \EFs{"modified.*cards/"} s\EFrdd{)}
                 \EFrdd{(}\EFo{string-match} \EFs{"new file.*cards/"} s\EFrdd{)}\EFrdc{)}\EFrdb{)}
           status\EFrda{)}\EFrdd{)}
         \EFrdd{(}card-str \EFrda{(}\EFk{if} \EFrdb{(}\EFo{=} card-count \EFhn{1}\EFrdb{)}
                       \EFs{"card"}
                     \EFs{"cards"}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message}
     \EFrdd{(}\EFo{replace-regexp-in-string}
      \EFs{"\%"} \EFs{"\%\%"}
      \EFrda{(}\EFo{shell-command-to-string}
       \EFrdb{(}\EFo{format}
        \EFs{"git add . \&\& git commit -m 'Do \%s \%s'"}
        card-count card-str\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-unschedule-card} \EFrdb{(}card-file\EFrdb{)}
  \EFd{"Unschedule CARD-FILE everywhere and schedule it for today."}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}repo-dir \EFrda{(}\EFo{locate-dominating-file} card-file \EFs{".git"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}s-files \EFrda{(}\EFf{pamparam-cmd-to-list} \EFrdb{(}\EFo{format} \EFs{"git add . \&\& git grep --files-with-matches \%s"} \EFrdc{(}\EFo{shell-quote-argument} card-file\EFrdc{)}\EFrdb{)}
                                        repo-dir\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}file s-files\EFrdd{)}
      \EFrdd{(}\EFk{with-current-buffer} \EFrda{(}\EFo{find-file-noselect} \EFrdb{(}\EFo{expand-file-name} file repo-dir\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{save-excursion}
          \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{while} \EFrdc{(}\EFo{re-search-forward} card-file nil t\EFrdc{)}
            \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)}
                           \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{line-end-position}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{save-silently} t\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFf{pamparam-save-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{unless} \EFrdb{(}\EFo{equal} \EFrdc{(}\EFo{current-buffer}\EFrdc{)} \EFrdc{(}\EFf{pamparam-todo-file}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{kill-buffer}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-goto-schedule-part}\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} nil t\EFrda{)}
          \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{match-beginning} \EFhn{0}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFf{pamparam--todo-from-file} card-file\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-redo} \EFrdb{(}\EFrdb{)}
  \EFd{"Redo the current card without penalty."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFf{string-match-p} \EFs{"cards/.*org\char92{}\char92{}'"} \EFrdd{(}\EFv{buffer-file-name}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}fname \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-cmd-to-list} \EFrda{(}\EFo{format} \EFs{"git checkout -- \%s"} \EFrdb{(}\EFo{shell-quote-argument} fname\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{revert-buffer} nil t nil\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-unschedule-card} \EFrda{(}\EFo{file-name-nondirectory} fname\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{setq-local} \EFv{pamparam-is-redo} t\EFrdd{)}
        \EFrdd{(}\EFv{pamparam-card-mode}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{user-error} \EFs{"Applies only to card files"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-shifttab} \EFrdb{(}\EFrdb{)}
  \EFd{"Hide/show everything."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{inhibit-message} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{eq} \EFv{org-cycle-global-status} \EFhq{'}\EFhs{overview}\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{org-cycle-global-status} \EFhq{'}\EFhs{contents}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{this-command} \EFv{last-command}\EFrdc{)}
    \EFrdc{(}\EFo{org-cycle-internal-global}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;}\EFc{* `}\textcolor[HTML]{a9a1e1}{pamparam-card-mode}\EFc{'}
\EFrda{(}\EFk{defvar} \EFv{pamparam-card-mode-map}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFo{map} \EFrda{(}\EFo{make-sparse-keymap}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{worf-define-key} map \EFrdd{(}\EFo{kbd} \EFs{"q"}\EFrdd{)} \EFhq{'}\EFhs{bury-buffer}\EFrdc{)}
    \EFrdc{(}\EFf{worf-define-key} map \EFrdd{(}\EFo{kbd} \EFs{"R"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-card-redo}
                     \EFb{:break} t\EFrdc{)}
    \EFrdc{(}\EFf{worf-define-key} map \EFrdd{(}\EFo{kbd} \EFs{"n"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-drill}
                     \EFb{:break} t\EFrdc{)}
    \EFrdc{(}\EFf{worf-define-key} map \EFrdd{(}\EFo{kbd} \EFs{"D"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-card-delete}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"."}\EFrdd{)} \EFhq{'}\EFhs{pamparam-card-validate-maybe}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"M-m"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-card-manual-score}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"<S-iso-lefttab>"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-shifttab}\EFrdc{)}
    map\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{define-minor-mode} \EFv{pamparam-card-mode}
  \EFd{"Minor mode for Pam cards.}

\EFd{\char92{}\char92{}\{}\textcolor[HTML]{dcaeea}{pamparam-card-mode-map}\EFd{\}"}
  \EFb{:lighter} \EFs{" p"}
  \EFrdb{(}\EFk{when} \EFv{pamparam-card-mode}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrdd{)}
        \EFrdd{(}\EFk{progn}
          \EFrda{(}\EFf{pamparam-card-abbreviate}\EFrda{)}
          \EFrda{(}\EFk{setq-local} \EFv{mode-line-format}
                      \EFhq{`}\EFrdb{(}\EFrdc{(}\EFv{pamparam-card-mode}
                         \EFrdd{(}\EFb{:eval} \EFrda{(}\EFf{pamparam-mode-line}\EFrda{)}\EFrdd{)}\EFrdc{)}
                        ,@\EFrdc{(}\EFo{assq-delete-all}
                           \EFhq{'}\EFv{pamparam-card-mode}
                           \EFrdd{(}\EFo{default-value} \EFhq{'}\EFv{mode-line-format}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{force-mode-line-update} t\EFrda{)}
          \EFrda{(}\EFk{setq} \EFv{org-cycle-global-status} \EFhq{'}\EFhs{contents}\EFrda{)}
          \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-min}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFf{pamparam-card-answer}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFv{pamparam-card-mode} \EFhn{-1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{lispy-raise-minor-mode} \EFhq{'}\EFv{pamparam-card-mode}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{pamparam}\EFrda{)}

\EFcd{;;;} \EFc{pamparam.el ends here}

\end{Verbatim}
\end{Code}
\subsubsection{Tweaks}
\label{sec:org5377414}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{defun} \EFf{pamparam-latin} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/latin/Latin.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-tagalog} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/tagalog/Tagalog.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-drill-latin} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/latin/Latin.pam"}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-drill}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-drill-tagalog} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/tagalog/Tagalog.pam"}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-drill}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-magit-commit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/"}\EFrdb{)}
  \EFrdb{(}\EFf{magit}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-push} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{async-shell-command} \EFs{"cd \char126{}/dox/pamparam/ \&\& \char126{}/dox/pamparam/update.sh"}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{after!} recentf
  \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{recentf-exclude} \EFs{"pamparam.*/cards"}\EFrdb{)}
  \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{recentf-exclude} \EFs{"/pamparam/"}\EFrdb{)}\EFrda{)}

\EFcd{;;}\EFc{* `}\textcolor[HTML]{a9a1e1}{hydra-pamparam}\EFc{'}
\EFrda{(}\EFk{defhydra} hydra-pamparam \EFrdb{(}\EFb{:exit} t\EFrdb{)}
  \EFd{"pam"}
  \EFrdb{(}\EFs{"t"} pamparam-drill-tagalog \EFs{"tagalog"}\EFrdb{)}
  \EFrdb{(}\EFs{"l"} pamparam-drill-latin \EFs{"latin"}\EFrdb{)}
  \EFrdb{(}\EFs{"d"} pamparam-drill \EFs{"drill"}\EFrdb{)}
  \EFrdb{(}\EFs{"s"} pamparam-sync \EFs{"sync"}\EFrdb{)}
  \EFrdb{(}\EFs{"m"} pamparam-pull \EFs{"more cards"}\EFrdb{)}
  \EFrdb{(}\EFs{"p"} pamparam-push \EFs{"push"}\EFrdb{)}
  \EFrdb{(}\EFs{"gl"} pamparam-latin \EFs{"goto latin"}\EFrdb{)}
  \EFrdb{(}\EFs{"gt"} pamparam-tagalog \EFs{"goto tagalog"}\EFrdb{)}
  \EFrdb{(}\EFs{"q"} nil \EFs{"quit"}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{hydra-set-property} \EFhq{'}\EFhs{hydra-pamparam} \EFb{:verbosity} \EFhn{1}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c v"}\EFrdb{)} \EFhq{'}\EFhs{hydra-pamparam/body}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{pamparam-path} \EFs{"/home/user/dox/pamparam/pamparam.pam"}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{spaced-repetition}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Popes}
\label{sec:org0b52805}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{when} home?
  \EFrdb{(}\EFk{load-module} \EFhq{'}\EFhs{popes}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org9d45e19}
\subsubsection{Code}
\label{sec:org74ca30f}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{popes.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{defun} \EFf{get-pope-image} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}
         \EFrdd{(}folder \EFrda{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"/scripts/popes/images/"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}files \EFrda{(}\EFo{directory-files} folder nil \EFs{"\char92{}\char92{}.png\char92{}\char92{}'"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}number-popes \EFrda{(}\EFo{length} files\EFrda{)}\EFrdd{)}
         \EFrdd{(}pope-img \EFrda{(}\EFo{nth} \EFrdb{(}\EFo{random} number-popes\EFrdb{)} files\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} currently-displayed-pope \EFrdd{(}\EFo{replace-regexp-in-string} \EFs{".png"} \EFs{""} pope-img\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} pope-info \EFrdd{(}\EFo{shell-command-to-string} \EFrda{(}\EFo{concat} \EFs{"grep -m1 \char92{}""} currently-displayed-pope \EFs{"\char92{}" "} folder \EFs{"../pope\_info.txt"}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{concat} folder pope-img\EFrdc{)}
    \EFrdb{)}
  \EFrda{)}


\EFrda{(}\EFk{defun} \EFf{psalm} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{shell-command-to-string} \EFs{"\char126{}/.scripts/psalms.sh de"}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{setq} fancy-splash-last-size nil\EFrda{)}
\EFrda{(}\EFk{setq} fancy-splash-last-theme nil\EFrda{)}
\EFrda{(}\EFk{defun} \EFf{set-appropriate-splash} \EFrdb{(}\EFt{\&rest} \_\EFrdb{)}
   \EFrdb{(}\EFk{setq} \EFv{fancy-splash-image} \EFrdc{(}\EFf{get-pope-image}\EFrdc{)}\EFrdb{)}
   \EFrdb{(}\EFk{setq} \EFv{+doom-dashboard-banner-padding} \EFhq{'}\EFrdc{(}\EFhn{5} . \EFhn{5}\EFrdc{)}\EFrdb{)}
   \EFrdb{(}\EFk{setq} fancy-splash-last-theme \EFv{doom-theme}\EFrdb{)}
   \EFrdb{(}\EFf{+doom-dashboard-reload}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{window-size-change-functions} \EFhq{\#'}\EFhs{set-appropriate-splash}\EFrda{)}
\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{doom-load-theme-hook} \EFhq{\#'}\EFhs{set-appropriate-splash}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{doom-dashboard-phrase} \EFrdb{(}\EFrdb{)}
  \EFd{"Get a splash phrase, flow it over multiple lines as needed, and make fontify it."}
  \EFrdb{(}\EFo{mapconcat}
   \EFrdc{(}\EFk{lambda} \EFrdd{(}line\EFrdd{)}
     \EFrdd{(}\EFf{+doom-dashboard--center}
      \EFv{+doom-dashboard--width}
      \EFrda{(}\EFk{with-temp-buffer}
        \EFrdb{(}\EFo{insert-text-button}
         line
         \EFhq{'}\EFhs{action}
         \EFrdc{(}\EFk{lambda} \EFrdd{(}\_\EFrdd{)} \EFrdd{(}\EFf{+doom-dashboard-reload} t\EFrdd{)}\EFrdc{)}
         \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-dashboard-menu-title}
         \EFhq{'}\EFhs{mouse-face} \EFhq{'}\EFhs{doom-dashboard-menu-title}
         \EFhq{'}\EFhs{help-echo} currently-displayed-pope
         \EFhq{'}\EFhs{follow-link} t\EFrdb{)}
        \EFrdb{(}\EFo{buffer-string}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
   \EFrdc{(}\EFo{split-string}
    \EFrdd{(}\EFk{with-temp-buffer}
      \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{concat} \EFs{"Seine Heiligkeit "} currently-displayed-pope \EFs{"\char92{}n\char92{}n"} pope-info \EFs{"\char92{}n"} \EFs{"Heiliger Vater, bete fr uns."} \EFs{"\char92{}n\char92{}n"}\EFrdb{)}\EFrda{)}
      \EFrda{(}\EFk{setq} \EFv{fill-column} \EFrdb{(}\EFo{min} \EFhn{70} \EFrdc{(}\EFo{/} \EFrdd{(}\EFo{*} \EFhn{2} \EFrda{(}\EFo{window-width}\EFrda{)}\EFrdd{)} \EFhn{3}\EFrdc{)}\EFrdb{)}\EFrda{)}
      \EFrda{(}\EFo{fill-region} \EFrdb{(}\EFo{point-min}\EFrdb{)} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}
      \EFrda{(}\EFo{buffer-string}\EFrda{)}\EFrdd{)}
    \EFs{"\char92{}n"}\EFrdc{)}
   \EFs{"\char92{}n"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defadvice!} doom-dashboard-widget-loaded-with-phrase \EFrdb{(}\EFrdb{)}
  \EFb{:override} \EFhq{\#'}\EFhs{doom-dashboard-widget-loaded}
  \EFrdb{(}\EFk{setq} \EFv{line-spacing} \EFhn{0.2}\EFrdb{)}
  \EFrdb{(}\EFo{insert}
   \EFs{"\char92{}n\char92{}n"}
   \EFrdc{(}\EFo{propertize}
    \EFrdd{(}\EFf{+doom-dashboard--center}
     \EFv{+doom-dashboard--width}
     \EFrda{(}\EFf{doom-display-benchmark-h} \EFhq{'}\EFhs{return}\EFrda{)}\EFrdd{)}
    \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-dashboard-loaded}\EFrdc{)}
   \EFs{"\char92{}n"}
   \EFrdc{(}\EFf{doom-dashboard-phrase}\EFrdc{)}
   \EFrdc{(}\EFf{psalm}\EFrdc{)}
   \EFs{"\char92{}n"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{remove-hook} \EFhq{'}\EFv{+doom-dashboard-functions} \EFhq{\#'}\EFhs{doom-dashboard-widget-shortmenu}\EFrda{)}
\EFrda{(}\EFk{add-hook!} \EFhq{'}\EFv{+doom-dashboard-mode-hook} \EFrdb{(}\EFv{hide-mode-line-mode} \EFhn{1}\EFrdb{)} \EFrdb{(}\EFv{hl-line-mode} \EFhn{-1}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{setq-hook!} \EFhq{'}\EFv{+doom-dashboard-mode-hook} \EFv{evil-normal-state-cursor} \EFrdb{(}\EFo{list} nil\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{popes}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Keycast Tweaks}
\label{sec:org4b0f435}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{keycast-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org8601133}
\subsubsection{Code}
\label{sec:org2b14670}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{keycast.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{use-package!} keycast
  \EFb{:commands} keycast-mode
  \EFb{:config}
  \EFrdb{(}\EFk{define-minor-mode} \EFf{keycast-mode}
    \EFd{"Show current command and its key binding in the mode line."}
    \EFb{:global} t
    \EFrdc{(}\EFk{if} keycast-mode
        \EFrdd{(}\EFk{progn}
          \EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{pre-command-hook} \EFhq{'}\EFhs{keycast--update} t\EFrda{)}
          \EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{global-mode-string} \EFhq{'}\EFrdb{(}\EFs{""} mode-line-keycast \EFs{" "}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{remove-hook} \EFhq{'}\EFv{pre-command-hook} \EFhq{'}\EFhs{keycast--update}\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{global-mode-string} \EFrda{(}\EFo{remove} \EFhq{'}\EFrdb{(}\EFs{""} mode-line-keycast \EFs{" "}\EFrdb{)} \EFv{global-mode-string}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{custom-set-faces!}
    \EFhq{'}\EFrdc{(}keycast-command \EFb{:inherit} doom-modeline-debug
                      \EFb{:height} \EFhn{0.9}\EFrdc{)}
    \EFhq{'}\EFrdc{(}keycast-key \EFb{:inherit} custom-modified
                  \EFb{:height} \EFhn{1.1}
                  \EFb{:weight} bold\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{keycast-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Weather}
\label{sec:orge89fd92}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{weather}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org197fa37}
\subsubsection{Code}
\label{sec:org7f189c0}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{wttrin.el --- Emacs frontend for weather web service wttr.in -*- lexical-binding: t; -*-}
\EFcd{;;} \EFc{Copyright (C) 2016 Carl X. Su}

\EFcd{;;} \EFc{Author: Carl X. Su <bcbcarl@gmail.com>}
\EFcd{;;}         \EFc{ono hiroko (kuanyui) <azazabc123@gmail.com>}
\EFcd{;;} \EFc{Version: 0.2.0}
\EFcd{;;} \EFc{Package-Requires: ((emacs "24.4") (xterm-color "1.0"))}
\EFcd{;;} \EFc{Keywords: comm, weather, wttrin}
\EFcd{;;} \EFc{URL: https://github.com/bcbcarl/emacs-wttrin}
\EFcd{;;}
\EFcd{;;} \EFc{Modifications made by @tecosaur}

\EFcd{;;;} \EFc{Commentary:}

\EFcd{;;} \EFc{Provides the weather information from wttr.in based on your query condition.}

\EFcd{;;;} \EFc{Code:}

\EFrda{(}\EFo{require} \EFhq{'}\EFo{url}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{xterm-color}\EFrda{)}

\EFrda{(}\EFk{defgroup} \EFt{wttrin} nil
  \EFd{"Emacs frontend for weather web service wttr.in."}
  \EFb{:prefix} \EFs{"wttrin-"}
  \EFb{:group} \EFhq{'}\EFhs{comm}\EFrda{)}

\EFrda{(}\EFk{defcustom} \EFv{wttrin-default-api-version} \EFhn{1}
  \EFd{"Specifies which version of the wttrin API to use."}
  \EFb{:group} \EFhq{'}\EFhs{wttrn}
  \EFb{:type} \EFhq{'}\EFrdb{(}choice \EFrdc{(}const \EFhn{1}\EFrdc{)} \EFrdc{(}const \EFhn{2}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defcustom} \EFv{wttrin-default-cities} \EFhq{'}\EFrdb{(}\EFs{"Amsterdam"}
                                   \EFs{"Baghdad"}
                                   \EFs{"Beijing"}
                                   \EFs{"Brussels"}
                                   \EFs{"Buenos Aires"}
                                   \EFs{"Cairo"}
                                   \EFs{"Delhi"}
                                   \EFs{"Gurnsey"}
                                   \EFs{"Ho Chi Ming City"}
                                   \EFs{"Hong Kong"}
                                   \EFs{"Istanbul"}
                                   \EFs{"Johannesburg"}
                                   \EFs{"Kln"}
                                   \EFs{"Kuala Lumpur"}
                                   \EFs{"Leipzig"}
                                   \EFs{"Lima"}
                                   \EFs{"London"}
                                   \EFs{"Madrid"}
                                   \EFs{"Manila"}
                                   \EFs{"Mexico City"}
                                   \EFs{"Miami"}
                                   \EFs{"Moscow"}
                                   \EFs{"Mumbai"}
                                   \EFs{"Mnchen"}
                                   \EFs{"New York"}
                                   \EFs{"Nijmegen"}
                                   \EFs{"Paris"}
                                   \EFs{"Seoul"}
                                   \EFs{"Shanghai"}
                                   \EFs{"Singapore"}
                                   \EFs{"Surat"}
                                   \EFs{"Sydney"}
                                   \EFs{"Tokyo"}
                                   \EFs{"Toronto"}
                                   \EFcd{;;} \EFc{and the fun one!}
                                   \EFs{"Moon"}\EFrdb{)}
  \EFd{"Specify default cities list for quick completion."}
  \EFb{:group} \EFhq{'}\EFhs{wttrin}
  \EFb{:type} \EFhq{'}\EFhs{list}\EFrda{)}

\EFrda{(}\EFk{defcustom} \EFv{wttrin-default-accept-language} \EFhq{'}\EFrdb{(}\EFs{"Accept-Language"} . \EFs{"en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4"}\EFrdb{)}
  \EFd{"Specify default HTTP request Header for Accept-Language."}
  \EFb{:group} \EFhq{'}\EFhs{wttrin}
  \EFb{:type} \EFhq{'}\EFrdb{(}list\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{wttrin-fetch-raw-string} \EFrdb{(}query \EFt{\&optional} api-version\EFrdb{)}
  \EFd{"Get the weather information based on your QUERY."}
  \EFrdb{(}\EFk{unless} api-version \EFrdc{(}\EFk{setq} api-version \EFv{wttrin-default-api-version}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{url-user-agent} \EFs{"curl"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{url-request-extra-headers} \EFv{wttrin-default-accept-language}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer}
        \EFrdd{(}\EFo{url-retrieve-synchronously}
         \EFrda{(}\EFo{concat} \EFs{"http://v"} \EFrdb{(}\EFo{number-to-string} api-version\EFrdb{)} \EFs{".wttr.in/"} query\EFrda{)}
         \EFrda{(}\EFk{lambda} \EFrdb{(}status\EFrdb{)} \EFrdb{(}\EFo{switch-to-buffer} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{decode-coding-string} \EFrda{(}\EFo{buffer-string}\EFrda{)} \EFhq{'}\EFhs{utf-8}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{wttrin-exit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{quit-window} t\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{wttrin-query} \EFrdb{(}city-name \EFt{\&optional} api-version\EFrdb{)}
  \EFd{"Query weather of CITY-NAME via wttrin, and display the result in new buffer."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}raw-string \EFrda{(}\EFf{wttrin-fetch-raw-string} city-name api-version\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{string-match} \EFs{"ERROR"} raw-string\EFrdd{)}
        \EFrdd{(}\EFo{message} \EFs{"Cannot get weather data. Maybe you inputed a wrong city name?"}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}buffer \EFrdc{(}\EFo{get-buffer-create} \EFrdd{(}\EFo{format} \EFs{"*wttr.in - \%s*"} city-name\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{switch-to-buffer} buffer\EFrda{)}
        \EFrda{(}\EFk{setq} \EFv{buffer-read-only} nil\EFrda{)}
        \EFrda{(}\EFo{erase-buffer}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{xterm-color-filter} raw-string\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-min}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{save-excursion}
          \EFrdb{(}\EFo{re-search-forward} \EFs{"\char94{}\$"}\EFrdb{)}
          \EFrdb{(}\EFo{delete-region} \EFrdc{(}\EFo{point-min}\EFrdc{)} \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{save-excursion}
          \EFrdb{(}\EFk{while}  \EFrdc{(}\EFo{re-search-forward} \EFs{"(B"} nil t\EFrdc{)}
            \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{match-beginning} \EFhn{0}\EFrdd{)} \EFrdd{(}\EFo{match-end} \EFhn{0}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{use-local-map} \EFrdb{(}\EFo{make-sparse-keymap}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{local-set-key} \EFs{"q"} \EFhq{'}\EFhs{wttrin-exit}\EFrda{)}
        \EFrda{(}\EFo{local-set-key} \EFs{"g"} \EFhq{'}\EFhs{wttrin}\EFrda{)}
        \EFrda{(}\EFk{setq} \EFv{buffer-read-only} t\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{wttrin} \EFrdb{(}city \EFt{\&optional} api-version\EFrdb{)}
  \EFd{"Display weather information for CITY."}
  \EFrdb{(}\EFk{interactive}
   \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{equal} \EFv{current-prefix-arg} nil\EFrda{)}
          \EFrda{(}\EFo{list} \EFs{""} nil\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFrda{(}\EFo{equal} \EFv{current-prefix-arg} \EFhn{1}\EFrda{)}
          \EFrda{(}\EFo{list} \EFs{""} \EFhn{1}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFrda{(}\EFo{equal} \EFv{current-prefix-arg} \EFhn{2}\EFrda{)}
          \EFrda{(}\EFo{list} \EFs{""} \EFhn{2}\EFrda{)}\EFrdd{)}
         \EFrdd{(}t \EFrda{(}\EFo{list}
             \EFrdb{(}\EFo{completing-read} \EFs{"City name: "} \EFv{wttrin-default-cities} nil nil
                              \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{=} \EFrda{(}\EFo{length} \EFv{wttrin-default-cities}\EFrda{)} \EFhn{1}\EFrdd{)}
                                \EFrdd{(}\EFo{car} \EFv{wttrin-default-cities}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFf{wttrin-query} city api-version\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{weather}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Org}
\label{sec:org7a8d1a0}
\subsubsection{Org Protocol}
\label{sec:org8d64adb}
\paragraph{System}
\label{sec:org7dddb78}
\subparagraph{Linux}
\label{sec:org1bcd1ed}
Set up emacsclient as org-protocol scheme-handler
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{mkdir} \EFs{"\char126{}/.local/share/applications/"} t\EFrda{)}
\end{Verbatim}
\end{Code}
\begin{Code}
\begin{Verbatim}
\color{EFD}[\EFt{Desktop Entry}]
\EFv{Name}=org-protocol
\EFv{Comment}=Intercept calls from emacsclient to trigger custom actions
\EFv{Categories}=Other;
\EFv{Keywords}=org-protocol;
\EFv{Icon}=emacs
\EFv{Type}=Application
\EFv{Exec}=emacsclient -- \EFo{\%u}
\EFv{Terminal}=\EFo{false}
\EFv{StartupWMClass}=Emacs
\EFv{MimeType}=x-scheme-handler/org-protocol;
\end{Verbatim}
\end{Code}
Update MIME cache
\begin{Code}
\begin{Verbatim}
\color{EFD}update-desktop-database \char126{}/.local/share/applications/
\end{Verbatim}
\end{Code}
\subparagraph{Windows}
\label{sec:orgb01e47b}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{mkdir} \EFrdb{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"ext/org-protocol/"}\EFrdb{)} t\EFrda{)}
\end{Verbatim}
\end{Code}
\begin{Code}
\begin{Verbatim}
\color{EFD}REGEDIT4

[\EFt{HKEY\_CLASSES\_ROOT\char92{}org-protocol}]
\EFv{@}=\EFs{"URL:Org Protocol"}
\EFs{"URL Protocol"}=\EFs{""}
[\EFt{HKEY\_CLASSES\_ROOT\char92{}org-protocol\char92{}shell}]
[\EFt{HKEY\_CLASSES\_ROOT\char92{}org-protocol\char92{}shell\char92{}open}]
[\EFt{HKEY\_CLASSES\_ROOT\char92{}org-protocol\char92{}shell\char92{}open\char92{}command}]
\EFv{@}=\EFs{"\char92{}"C:\char92{}\char92{}Windows\char92{}\char92{}System32\char92{}\char92{}wsl.exe\char92{}" emacsclient \char92{}"\%1\char92{}""}
\end{Verbatim}
\end{Code}
\subparagraph{JS Bookmarks}
\label{sec:orgd219649}
Replace \texttt{capture} subprotocol with \texttt{store-link} or \texttt{youtube-dl}
\begin{Code}
\begin{Verbatim}
\color{EFD}javascript:location.href=\EFs{'org-protocol://capture?'} +
      \EFk{new} \EFt{URLSearchParams}(\{
            template: \EFs{'x'}, url: window.location.href,
            title: document.title, body: window.getSelection()\});
\end{Verbatim}
\end{Code}
\paragraph{youtube-dl handler}
\label{sec:org122537d}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{require} \EFhq{'}\EFo{org-protocol}\EFrda{)}
\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{org-protocol-protocol-alist}
             \EFhq{'}\EFrdb{(}\EFs{"Download like with youtube-dl"}
               \EFb{:protocol} \EFs{"youtube-dl"}
               \EFb{:function} youtube-dl-protocol-handler\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{youtube-dl-protocol-handler} \EFrdb{(}data\EFrdb{)}
  \EFd{"Add url to youtube-dl download queue."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}url \EFrda{(}\EFo{plist-get} data \EFb{:url}\EFrda{)}\EFrdd{)}
        \EFrdd{(}title \EFrda{(}\EFo{plist-get} data \EFb{:title}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{string=} title \EFs{"about:blank"}\EFrdd{)}
      \EFrdd{(}\EFf{youtube-dl}
       \EFrda{(}\EFo{plist-get} data \EFb{:url}\EFrda{)}
       \EFb{:title} \EFrda{(}\EFo{plist-get} data \EFb{:title}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  nil\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Org-Roam}
\label{sec:orgeff81dc}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-roam-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org772088f}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{unpin!} org-roam\EFrda{)}
\EFrda{(}\EFk{unpin!} websocket\EFrda{)}
\EFrda{(}\EFk{package!} org-roam-ui\EFrda{)}
\EFrda{(}\EFk{package!} org-roam-timestamps\EFrda{)}
\EFrda{(}\EFk{package!} org-roam-bibtex\EFrda{)}
\EFrda{(}\EFk{package!} citar-org-roam\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:orga255882}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{use-package!} websocket
    \EFb{:after} org-roam\EFrda{)}

\EFrda{(}\EFk{use-package!} org-roam-ui
    \EFb{:after} org-roam \EFcd{;;} \EFc{or :after org}
\EFcd{;;}         \EFc{normally we'd recommend hooking orui after org-roam, but since org-roam does not have}
\EFcd{;;}         \EFc{a hookable mode anymore, you're advised to pick something yourself}
\EFcd{;;}         \EFc{if you don't care about startup time, use}
\EFcd{;;}  \EFc{:hook (after-init . org-roam-ui-mode)}
    \EFb{:config}
    \EFrdb{(}\EFk{setq} \EFv{org-roam-ui-sync-theme} t
          \EFv{org-roam-ui-follow} t
          \EFv{org-roam-ui-update-on-save} t
          \EFv{org-roam-ui-open-on-start} t\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{org-roam-directory} \EFs{"\char126{}/sync/org/roam"}\EFrda{)}
\EFrda{(}\EFo{mkdir} \EFv{org-roam-directory} t\EFrda{)}
\EFrda{(}\EFv{org-roam-db-autosync-mode} \EFhn{1}\EFrda{)}

\EFcd{;;} \EFc{Hide the mode line in the org-roam buffer, since it serves no purpose. This}
\EFcd{;;} \EFc{makes it easier to distinguish among other org buffers.}
\EFrda{(}\EFo{add-hook} \EFhq{'}\EFhs{org-roam-buffer-prepare-hook} \EFhq{\#'}\EFv{hide-mode-line-mode}\EFrda{)}

\EFcd{;;} \EFc{Since the org module lazy loads org-protocol (waits until an org URL is}
\EFcd{;;} \EFc{detected), we can safely chain `}\textcolor[HTML]{a9a1e1}{org-roam-protocol}\EFc{' to it.}
\EFrda{(}\EFk{use-package} org-roam-protocol
  \EFb{:after} org-protocol\EFrda{)}


\EFrda{(}\EFk{use-package} org-roam-bibtex
  \EFb{:after} \EFrdb{(}org-roam\EFrdb{)}
  \EFb{:hook} \EFrdb{(}\EFf{org-roam-mode} . \EFv{org-roam-bibtex-mode}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{setq} org-roam-bibtex-preformat-keywords
        \EFhq{'}\EFrdc{(}\EFs{"=key="} \EFs{"title"} \EFs{"url"} \EFs{"file"} \EFs{"author-or-editor"} \EFs{"keywords"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{setq} orb-templates
        \EFhq{'}\EFrdc{(}\EFrdd{(}\EFs{"r"} \EFs{"ref"} plain \EFrda{(}\EFk{function} org-roam-capture--get-point\EFrda{)}
           \EFs{""}
           \EFb{:file-name} \EFs{"\$\{slug\}"}
           \EFb{:head} \EFs{"\#+TITLE: \$\{=key=\}: \$\{title\}\char92{}n\#+ROAM\_KEY: \$\{ref\}}

\EFs{- tags ::}
\EFs{- keywords :: \$\{keywords\}}

\EFs{\char92{}n* \$\{title\}\char92{}n  :PROPERTIES:\char92{}n  :Custom\_ID: \$\{=key=\}\char92{}n  :URL: \$\{url\}\char92{}n  :AUTHOR: \$\{author-or-editor\}\char92{}n  :NOTER\_DOCUMENT: \%(orb-process-file-field \char92{}"\$\{=key=\}\char92{}")\char92{}n  :NOTER\_PAGE: \char92{}n  :END:\char92{}n\char92{}n"}

           \EFb{:unnarrowed} t\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{Actually start using templates}
\EFcd{;}\EFc{(after! org-capture}
  \EFcd{;;} \EFc{For browser capture}
  \EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{org-capture-templates}
               \EFhq{'}\EFrdb{(}\EFs{"P"} \EFs{"Protocol"} entry \EFcd{;} \EFc{key, name, type}
                 \EFrdc{(}file+headline \EFv{+org-capture-notes-file} \EFs{"Inbox"}\EFrdc{)} \EFcd{;} \EFc{target}
                 \EFs{"* \%\char94{}\{Title\}\char92{}nSource: \%u, \%c\char92{}n \#+BEGIN\_QUOTE\char92{}n\%i\char92{}n\#+END\_QUOTE\char92{}n\char92{}n\char92{}n\%?"}
                 \EFb{:prepend} t \EFcd{;} \EFc{properties}
                 \EFb{:kill-buffer} t\EFrdb{)}\EFrda{)}
  \EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{org-capture-templates}
               \EFhq{'}\EFrdb{(}\EFs{"L"} \EFs{"Protocol Link"} entry
                 \EFrdc{(}file+headline \EFv{+org-capture-notes-file} \EFs{"Inbox"}\EFrdc{)}
                 \EFs{"* \%? [[\%:link][\%(transform-square-brackets-to-round-ones \char92{}"\%:description\char92{}")]]\char92{}n"}
                 \EFb{:prepend} t
                 \EFb{:kill-buffer} t\EFrdb{)}\EFrda{)}

\EFcd{;}  \EFc{)}
\EFrda{(}\EFk{map!} \EFb{:map} \EFv{evil-org-mode-map}
        \EFb{:leader}
        \EFrdb{(}\EFb{:prefix} \EFrdc{(}\EFs{"R"}\EFrdc{)}
         \EFb{:desc} \EFs{"Insert node"}
         \EFs{"i"} \EFhq{\#'}\EFhs{org-roam-node-insert}
         \EFb{:desc} \EFs{"Find node"}
         \EFs{"f"} \EFhq{\#'}\EFhs{org-roam-node-find}
         \EFb{:desc} \EFs{"Capture to node"}
         \EFs{"c"} \EFhq{\#'}\EFhs{org-roam-capture}
         \EFb{:desc} \EFs{"Toggle roam buffer"}
         \EFs{"b"} \EFhq{\#'}\EFhs{org-roam-buffer-toggle}
         \EFb{:desc} \EFs{"Open random note"}
         \EFs{"r"} \EFhq{\#'}\EFhs{org-roam-node-random}
         \EFb{:desc} \EFs{"Visit node"}
         \EFs{"v"} \EFhq{\#'}\EFhs{org-roam-node-visit}
         \EFb{:desc} \EFs{"Open ORUI"}
         \EFs{"u"} \EFhq{\#'}\EFhs{org-roam-ui-open}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} org-roam-bibtex
  \EFb{:after} org-roam\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-noter-roam-init} \EFrdb{(}ref\EFrdb{)}
  \EFd{"Initialize org-roam notes file for org-noter use.}
  \EFd{Insert citation, create notes headline, add org-noter document property"}
  \EFrdb{(}\EFk{interactive} \EFrdc{(}\EFo{list} \EFrdd{(}\EFf{citar-select-ref}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{end-of-buffer}\EFrdb{)}
  \EFrdb{(}\EFk{let*}
      \EFrdc{(}\EFrdd{(}files
        \EFrda{(}\EFf{citar-get-files}
         \EFrdb{(}\EFo{list} ref\EFrdb{)}\EFrda{)}\EFrdd{)}
       \EFrdd{(}file
        \EFrda{(}\EFo{car}
         \EFrdb{(}\EFo{gethash} ref files\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{citar-insert-citation}
     \EFrdd{(}\EFo{list} ref\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{newline}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFs{"* "}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFf{citar-get-value} \EFs{"title"} ref\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{newline}\EFrdc{)}
    \EFrdc{(}\EFf{org-roam-ref-add}
     \EFrdd{(}\EFo{concat} \EFs{"@"} ref\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{org-set-property} \EFs{"NOTER\_DOCUMENT"} file\EFrdc{)}
    \EFrdc{(}\EFo{org-set-property} \EFs{"NOTER\_PAGE"} \EFs{"1"}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-roam-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Org Tweaks}
\label{sec:org979bdf2}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org80773e1}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} engrave-faces\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:orgf9b50ed}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{org-tweaks.el -*- lexical-binding: t; -*-}
\EFcd{;;;} \EFc{Code:}
\EFrda{(}\EFk{after!} org
  \EFrdb{(}\EFk{ifdirexists} \EFs{"\char126{}/sync/org/"}
               \EFrdc{(}\EFk{setq} \EFv{org-directory} dir\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{ifdirexists} \EFs{"\char126{}/sync/agenda"}
               \EFrdc{(}\EFk{setq} \EFv{org-agenda-files} \EFrdd{(}\EFo{directory-files} \EFs{"\char126{}/sync/agenda/"} t \EFrda{(}\EFk{rx} \EFs{".org"} eos\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{org-todo-keywords} \EFhq{'}\EFrdc{(}\EFrdd{(}sequence \EFs{"}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{(t)"} \EFs{"LECT(l)"} \EFs{"EXAM(e)"} \EFs{"MEET(m)"} \EFs{"PROJ(p)"} \EFs{"LOOP(L)"} \EFs{"START(s)"} \EFs{"WAIT(w)"} \EFs{"HOLD(h)"} \EFs{"IDEA(i)"} \EFs{"????(?)"} \EFs{"INPRO(n)"} \EFs{"OPT(o)"} \EFs{"READ(r)"} \EFs{"|"} \EFs{"DONE(d)"} \EFs{"KILL(k)"}\EFrdd{)}
                            \EFrdd{(}sequence \EFs{"[ ](T)"} \EFs{"[-](S)"} \EFs{"[?](W)"} \EFs{"|"} \EFs{"[X](D)"}\EFrdd{)}
                            \EFrdd{(}sequence \EFs{"|"} \EFs{"OKAY(O)"} \EFs{"YES(Y)"} \EFs{"NO(N)"}\EFrdd{)}\EFrdc{)}
        \EFv{org-startup-folded} t
        \EFv{org-log-done} \EFhq{'}\EFhs{time}
        \EFv{org-log-reschedule} \EFhq{'}\EFhs{time}
        \EFv{initial-major-mode} \EFhq{'}\EFhs{org-mode}
        \EFv{org-export-async-init-file} \EFs{"/home/user/.doom.d/ext/export/org-export-init.el"}
        \EFv{org-latex-src-block-backend} \EFhq{'}\EFhs{engraved}\EFrdb{)}

  \EFcd{;;;} \EFc{Add org mode to txt and archive files}
  \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{auto-mode-alist} \EFhq{'}\EFrdc{(}\EFs{"\char92{}\char92{}.}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{org}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{org\_archive}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{txt}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"} . org-mode\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFv{mixed-pitch-mode} \EFhn{1}\EFrdb{)}

  \EFcd{;;} \EFc{Org Babel}
  \EFrdb{(}\EFk{setq} \EFv{org-confirm-babel-evaluate} nil
        \EFv{org-src-fontify-natively} t
        \EFv{org-src-tab-acts-natively} t
        \EFv{org-auto-tangle-default} t\EFrdb{)}
  \EFcd{;;} \EFc{Auto tangle}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{org-mode-hook} \EFhq{'}\EFv{org-auto-tangle-mode}\EFrdb{)}
\EFrda{)}

\EFrda{(}\EFk{setq} beancount-remote-file \EFs{"/media/user/keychain/finances/wallet.beancount"}
      beancount-local-file \EFs{"\char126{}/dox/finances/wallet.beancount"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{beancount-open-local} \EFrdb{(}\EFrdb{)}
  \EFd{"Open local beancount wallet."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} beancount-local-file\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{Capture}
\EFrda{(}\EFk{setq} \EFv{org-default-notes-file} \EFs{"\char126{}/dox/notes/notes.org"}\EFrda{)}
\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{org-capture-templates}
             \EFhq{'}\EFrdb{(}\EFs{"b"} \EFs{"Beancount Entry"} plain
               \EFrdc{(}file beancount-local-file\EFrdc{)}
               \EFs{"bc\%?"} \EFb{:empty-lines-before} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-agenda-export-to-ics} \EFrdb{(}\EFrdb{)}
  \EFd{"Exports current org agenda buffer to ics, treating DEADLINES as dates"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{with-temp-buffer}
    \EFrdc{(}\EFo{cl-map} \EFhq{'}\EFhs{nil} \EFhq{\#'}\EFhs{insert-file-contents} \EFv{org-agenda-files}\EFrdc{)}
    \EFrdc{(}\EFf{replace-regexp-entire-buffer} \EFs{"<.*>} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{<.*>}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFs{"\char92{}\char92{}1"}\EFrdc{)}
    \EFrdc{(}\EFf{replace-regexp-entire-buffer} \EFs{"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{<.*>}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}} \EFs{<.*>"} \EFs{"\char92{}\char92{}1"}\EFrdc{)}
    \EFrdc{(}\EFf{replace-regexp-entire-buffer} \EFs{"SCHEDULED:} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{<.*>}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFs{"\char92{}\char92{}1"}\EFrdc{)}
    \EFrdc{(}\EFf{replace-regexp-entire-buffer} \EFs{"DEADLINE:} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{<.*>}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFs{"\char92{}\char92{}1"}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFrdd{(}\EFo{org-icalendar-export-to-ics}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Org Functions}
\label{sec:orga93c175}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-functions}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:orge45737b}
\paragraph{Copy subtree without heading or children}
\label{sec:org9f0ea91}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{defun} \EFf{org-copy-subtree-only} \EFrdb{(}\EFrdb{)}
  \EFd{"Copy the current subtree excluding heading and children into clipboard."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{org-before-first-heading-p}\EFrdc{)}
      \EFrdc{(}\EFo{message} \EFs{"Not in or on an org heading"}\EFrdc{)}
    \EFrdc{(}\EFk{save-excursion}
      \EFcd{;;} \EFc{If inside heading contents, move the point back to the heading}
      \EFcd{;;} \EFc{otherwise `}\textcolor[HTML]{a9a1e1}{org-agenda-get-some-entry-text}\EFc{' won't work.}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFo{org-on-heading-p}\EFrda{)} \EFrda{(}\EFo{org-previous-visible-heading} \EFhn{1}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}contents \EFrdc{(}\EFo{substring-no-properties}
                       \EFrdd{(}\EFo{org-agenda-get-some-entry-text}
                        \EFrda{(}\EFo{point-marker}\EFrda{)}
                        \EFv{most-positive-fixnum}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{message} \EFs{"Copied \%d chars"} \EFrdb{(}\EFo{length} contents\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{kill-new} contents\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Adds filename prefixes to counsel-org-goto-all}
\label{sec:orgbf093c2}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{defun} \EFf{add-filename-to-counsel-outline-candidates} \EFrdb{(}candidates\EFrdb{)}
  \EFd{"Add the filename at the beginning for CANDIDATES from `}\textcolor[HTML]{a9a1e1}{counsel-outline-candidates}\EFd{'."}
  \EFrdb{(}\EFo{mapcar}
   \EFrdc{(}\EFk{lambda} \EFrdd{(}candidate\EFrdd{)}
     \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}marker \EFrdc{(}\EFo{cdr} candidate\EFrdc{)}\EFrdb{)}
            \EFrdb{(}filename \EFrdc{(}\EFv{buffer-file-name} \EFrdd{(}\EFo{marker-buffer} marker\EFrdd{)}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}filename-abbreviated \EFrdc{(}\EFk{when} filename \EFrdd{(}\EFo{concat} \EFrda{(}\EFo{abbreviate-file-name} filename\EFrda{)} \EFs{" "}\EFrdd{)}\EFrdc{)}\EFrdb{)}
            \EFcd{;;} \EFc{Use this if you want the buffer name. It's a bit shorter.}
            \EFcd{;;} \EFc{(buffername (buffer-name (marker-buffer (cdr candidate))))}
            \EFrda{)}
       \EFrda{(}\EFo{cons} \EFrdb{(}\EFo{concat} filename-abbreviated \EFrdc{(}\EFo{car} candidate\EFrdc{)}\EFrdb{)} marker\EFrda{)}\EFrdd{)}\EFrdc{)}
   candidates\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{advice-add} \EFhq{'}\EFhs{counsel-outline-candidates} \EFb{:filter-return} \EFhq{\#'}\EFhs{add-filename-to-counsel-outline-candidates}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Add text to any org headline}
\label{sec:orga1f9925}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{require} \EFhq{'}\EFo{counsel}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{s}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-get-headline-path} \EFrdb{(}prompt\EFrdb{)}
  \EFd{"Select a headline in any open org file and return marker to it."}
  \EFrdb{(}\EFk{let} \EFrdc{(}entries\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}b \EFrda{(}\EFo{buffer-list}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{with-current-buffer} b
        \EFrda{(}\EFk{when} \EFrdb{(}\EFo{derived-mode-p} \EFhq{'}\EFhs{org-mode}\EFrdb{)}
          \EFrdb{(}\EFk{setq} entries
                \EFrdc{(}\EFo{nconc} entries
                       \EFrdd{(}\EFo{counsel-outline-candidates}
                        \EFrda{(}\EFo{cdr} \EFrdb{(}\EFo{assq} \EFhq{'}\EFhs{org-mode} \EFv{counsel-outline-settings}\EFrdb{)}\EFrda{)}
                        \EFrda{(}\EFo{counsel-org-goto-all--outline-path-prefix}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let*}
        \EFrdd{(}\EFrda{(}sel
          \EFrdb{(}\EFo{completing-read} prompt entries nil t nil
                           \EFhq{'}\EFhs{counsel-org-goto-history}
                           \EFrdb{)}\EFrda{)}
         \EFrda{(}split \EFrdb{(}\EFo{s-split-up-to} \EFs{" "} sel \EFhn{1}\EFrdb{)}\EFrda{)}
         \EFrda{(}filename \EFrdb{(}\EFo{car} split\EFrdb{)}\EFrda{)}
         \EFrda{(}path \EFrdb{(}\EFo{apply} \EFhq{'}\EFhs{s-split} \EFs{"/"} \EFrdc{(}\EFo{cdr} split\EFrdc{)}\EFrdb{)}\EFrda{)}
         \EFrdd{)}
      \EFrdd{(}\EFo{org-find-olp} \EFhq{`}\EFrda{(},filename ,@path\EFrda{)}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-goto-headline} \EFrdb{(}\EFrdb{)}
  \EFd{"Go to any open org headline."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{org-goto-marker-or-bmk} \EFrdc{(}\EFf{org-get-headline-path} \EFs{"Goto: "}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{org-insert-under-headline} \EFrdb{(}\EFrdb{)}
  \EFd{"Insert yanked text as last line under selected org headline."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-window-excursion}
    \EFrdc{(}\EFo{org-goto-marker-or-bmk}
     \EFrdd{(}\EFf{org-get-headline-path} \EFs{"Insert under: "}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{outline-next-heading}\EFrdc{)}
    \EFrdc{(}\EFo{counsel-yank-pop}\EFrdc{)}
    \EFrdc{(}\EFo{newline}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-config-new-block} \EFrdb{(}\EFrdb{)}
  \EFd{"Create a new code block belonging to specific module."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}current-headline
         \EFrda{(}\EFf{string-inflection-title-to-lisp-case-function} \EFrdb{(}\EFo{nth} \EFhn{4} \EFrdc{(}\EFo{org-heading-components}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFo{concat} \EFs{"*** Description\char92{}n\#+begin\_src emacs-lisp :tangle modules/"} current-headline \EFs{".el\char92{}n\char92{}n\#+end\_src"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{evil-previous-visual-line}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-functions}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Org Citations}
\label{sec:org18bde93}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-citations}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:orgd1d0795}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;}\EFc{(package! citar-capf :recipe (:host github :repo "mclear-tools/citar-capf"))}
\EFrda{(}\EFk{package!} zotra\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:org7fa49ed}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{use-package!} citar-embark
  \EFb{:after} citar embark
  \EFb{:config} \EFrdb{(}\EFv{citar-embark-mode}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} citar
  \EFb{:custom}
  \EFrdb{(}\EFv{org-cite-insert-processor} \EFhq{'}\EFhs{citar}\EFrdb{)}
  \EFrdb{(}\EFv{org-cite-follow-processor} \EFhq{'}\EFhs{citar}\EFrdb{)}
  \EFrdb{(}\EFv{org-cite-activate-processor} \EFhq{'}\EFhs{citar}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{after!} citar
\EFrdb{(}\EFk{setq} \EFv{citar-templates}
      \EFhq{'}\EFrdc{(}\EFrdd{(}main . \EFs{"\$\{author editor:30\}     \$\{date year issued:4\}     \$\{title:80\}"}\EFrdd{)}
        \EFrdd{(}suffix . \EFs{"          \$\{=key= id:15\}    \$\{=type=:10\}    \$\{tags keywords:*\}"}\EFrdd{)}
        \EFrdd{(}preview . \EFs{"\$\{author editor\} (\$\{year issued date\}) \$\{title\}, \$\{journal journaltitle publisher container-title collection-title\}.\char92{}n"}\EFrdd{)}
        \EFrdd{(}note . \EFs{"Notes on \$\{author editor\}, \$\{title\}"}\EFrdd{)}\EFrdc{)}\EFrdb{)}

\EFrdb{(}\EFk{setq} \EFv{citar-symbols}
      \EFhq{`}\EFrdc{(}\EFrdd{(}file ,\EFrda{(}\EFo{all-the-icons-faicon} \EFs{"file-o"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-green} \EFb{:v-adjust} \EFhn{-0.1}\EFrda{)} . \EFs{" "}\EFrdd{)}
        \EFrdd{(}note ,\EFrda{(}\EFo{all-the-icons-material} \EFs{"speaker\_notes"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-blue} \EFb{:v-adjust} \EFhn{-0.3}\EFrda{)} . \EFs{" "}\EFrdd{)}
        \EFrdd{(}link ,\EFrda{(}\EFo{all-the-icons-octicon} \EFs{"link"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-orange} \EFb{:v-adjust} \EFhn{0.01}\EFrda{)} . \EFs{" "}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{citar-symbol-separator} \EFs{" "}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ex/search-pdf-contents} \EFrdb{(}keys-entries \EFt{\&optional} str\EFrdb{)}
  \EFd{"Search pdfs."}
  \EFrdb{(}\EFk{interactive} \EFrdc{(}\EFo{list} \EFrdd{(}\EFf{citar-select-refs}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}files \EFrda{(}\EFf{hash-table-to-value-list}
                \EFrdb{(}\EFf{citar-get-files}
                 keys-entries\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}search-str \EFrda{(}\EFk{or} str \EFrdb{(}\EFo{read-string} \EFs{"Search string: "}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{pdf-occur-search} files search-str t\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{hash-table-to-value-list} \EFrdb{(}hashtable\EFrdb{)}
  \EFd{"Convert a hash table to a list of values"}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}vlist \EFhq{'}\EFrda{(}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{maphash} \EFhq{'}\EFrdd{(}lambda \EFrda{(}key value\EFrda{)} \EFrda{(}\EFk{push} value vlist\EFrda{)}\EFrdd{)} hashtable\EFrdc{)}
    \EFrdc{(}\EFo{flatten-list} vlist\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{with this, you can exploit embark's multitarget actions, so that you can run `embark-act-all`}
\EFrda{(}\EFk{after!} embark
  \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFhs{embark-multitarget-actions} \EFhq{\#'}\EFhs{ex/search-pdf-contents}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} zotra-cli-command \EFhq{'}\EFrdb{(}\EFs{"node"} \EFs{"/home/user/dox/install/zotra-cli/index.js"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-citations}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Org Links}
\label{sec:orga174782}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-links}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org2ae4347}
\paragraph{Code}
\label{sec:org62ab8f4}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{ol-man.el - Support for links to man pages in Org mode}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{ol}\EFrda{)}

\EFrda{(}\EFo{org-link-set-parameters} \EFs{"b"}
                         \EFb{:follow} \EFhq{\#'}\EFhs{org-b-open}
                         \EFb{:export} \EFhq{\#'}\EFhs{org-b-export}
                         \EFb{:store} \EFhq{\#'}\EFhs{org-b-store-link}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-b-open} \EFrdb{(}verse \_\EFrdb{)}
  \EFd{"Visit the verse."}
  \EFrdb{(}\EFo{funcall} org-b-command path\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-b-store-link} \EFrdb{(}\EFrdb{)}
  \EFd{"Store a link to a man page."}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{memq} \EFv{major-mode} \EFhq{'}\EFrdd{(}Man-mode woman-mode\EFrdd{)}\EFrdc{)}
    \EFcd{;;} \EFc{This is a man page, we do make this link.}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}page \EFrdb{(}\EFf{org-man-get-page-name}\EFrdb{)}\EFrda{)}
           \EFrda{(}link \EFrdb{(}\EFo{concat} \EFs{"b:"} page\EFrdb{)}\EFrda{)}
           \EFrda{(}description \EFrdb{(}\EFo{format} \EFs{"B page for \%s"} page\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{org-link-store-props}
       \EFb{:type} \EFs{"b"}
       \EFb{:link} link
       \EFb{:description} description\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-man-get-page-name} \EFrdb{(}\EFrdb{)}
  \EFd{"Extract the page name from the buffer name."}
  \EFcd{;;} \EFc{This works for both `}\textcolor[HTML]{a9a1e1}{Man-mode}\EFc{' and `}\textcolor[HTML]{a9a1e1}{woman-mode}\EFc{'.}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-match} \EFs{"} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{\char92{}\char92{}S-+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}*"} \EFrdd{(}\EFo{buffer-name}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFo{error} \EFs{"Cannot create link to this man page"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-b-export} \EFrdb{(}link description format \_\EFrdb{)}
  \EFd{"Export a man page link from Org files."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}path \EFrda{(}\EFo{format} \EFs{"http://man.he.net/?topic=\%s\&section=all"} link\EFrda{)}\EFrdd{)}
        \EFrdd{(}desc \EFrda{(}\EFk{or} description link\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{pcase} format
      \EFrdd{(}\EFhq{`}\EFhs{html} \EFrda{(}\EFo{format} \EFs{"<a target=\char92{}"\_blank\char92{}" href=\char92{}"\%s\char92{}">\%s</a>"} path desc\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFhq{`}\EFhs{latex} \EFrda{(}\EFo{format} \EFs{"\char92{}\char92{}href\{\%s\}\{\%s\}"} path desc\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFhq{`}\EFhs{texinfo} \EFrda{(}\EFo{format} \EFs{"@uref\{\%s,\%s\}"} path desc\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFhq{`}\EFhs{ascii} \EFrda{(}\EFo{format} \EFs{"\%s (\%s)"} desc path\EFrda{)}\EFrdd{)}
      \EFrdd{(}t path\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-links}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Org Capture}
\label{sec:org6b6e281}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-capture-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org0a408d2}
\paragraph{Code}
\label{sec:org0ec7f24}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{setq} \EFv{+org-capture-todo-file} \EFs{"/home/user/sync/agenda/todo.org"}
      \EFv{+org-capture-notes-file} \EFs{"/home/user/sync/agenda/notes.org"}
      \EFv{+org-capture-journal-file} \EFs{"/home/user/sync/agenda/journal.org"}\EFrda{)}

\EFcd{;} \EFc{Handled by Doom Emacs}
  \EFcd{;;} \EFc{(add-to-list 'org-capture-templates}
  \EFcd{;;}              \EFc{'("" "Todo" entry ; key, name, type}
  \EFcd{;;}                \EFc{(file+olp+datetree +org-capture-todo-file) ; target}
  \EFcd{;;}                \EFc{"*} \textcolor[HTML]{ECBE7B}{\textbf{TODO}} \EFc{\%\char94{}\{Title\}\char92{}n\%T \%?"}
  \EFcd{;;}                \EFc{:prepend t ; properties}
  \EFcd{;;}                \EFc{:kill-buffer t))}

  \EFcd{;;} \EFc{(add-to-list 'org-capture-templates}
  \EFcd{;;}              \EFc{'("" "Note" entry ; key, name, type}
  \EFcd{;;}                \EFc{(file+olp+datetree +org-capture-notes-file) ; target}
  \EFcd{;;}                \EFc{"* \%\char94{}\{Title\} \%\char94{}G\char92{}n\%T \%?"}
  \EFcd{;;}                \EFc{:prepend t ; properties}
  \EFcd{;;}                \EFc{:kill-buffer t))}


\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-capture-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Org Appear}
\label{sec:org9b43618}
\subsubsection{Requirements}
\label{sec:org99fac0f}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} org-appear \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"awth13/org-appear"}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org573df5c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{org-mode-hook} \EFhq{'}\EFv{org-appear-mode}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Languages}
\label{sec:orgde335fe}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{languages}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org0920a22}
\subsubsection{Code}
\label{sec:org82f8ce6}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{languages.el -*- lexical-binding: t; -*-}

\EFcd{;;} \EFc{CANoe/CAPL}
\EFrda{(}\EFk{define-derived-mode} \EFf{capl-mode}
  c-mode \EFs{"CAPL"}
  \EFd{"Major mode for CANoe/CAPL."}
  \EFrdb{(}\EFv{flycheck-mode} \EFhn{0}\EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{Rust}
\EFrda{(}\EFk{setq} rustic-format-trigger \EFhq{'}\EFhs{on-save}
      rustic-format-on-save t\EFrda{)}

\EFcd{;;} \EFc{Latin}
\EFcd{;;}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{define-minor-mode} \EFv{latin-minor-mode}
  \EFd{"Minor mode for writing Church Latin"}
  \EFb{:lighter} \EFs{" "}
  \EFb{:global} t\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{latin-minor-mode--insert-ae} \EFrdb{(}\EFrdb{)}
  \EFd{"Replace ae with "}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{bound-and-true-p} \EFv{latin-minor-mode}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFrda{(}\EFo{char-before}\EFrda{)} ?a\EFrdd{)}
      \EFrdd{(}\EFk{progn}
        \EFrda{(}\EFo{backward-delete-char} \EFhn{1}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFs{""}\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFk{if} \EFrda{(}\EFo{eq} \EFrdb{(}\EFo{char-before}\EFrdb{)} ?A\EFrda{)}
        \EFrda{(}\EFk{progn}
          \EFrdb{(}\EFo{backward-delete-char} \EFhn{1}\EFrdb{)}
          \EFrdb{(}\EFo{insert} \EFs{""}\EFrdb{)}
          \EFrda{)}
      \EFrda{(}\EFo{insert} \EFs{"e"}\EFrda{)}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{self-insert-command} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{latin-minor-mode--insert-versicle} \EFrdb{(}\EFrdb{)}
  \EFd{"Replace VV with "}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{bound-and-true-p} \EFv{latin-minor-mode}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFrda{(}\EFo{char-before}\EFrda{)} ?V\EFrdd{)}
      \EFrdd{(}\EFk{progn}
        \EFrda{(}\EFo{backward-delete-char} \EFhn{1}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFs{""}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"V"}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{self-insert-command} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{latin-minor-mode--insert-response} \EFrdb{(}\EFrdb{)}
  \EFd{"Replace RR with "}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{bound-and-true-p} \EFv{latin-minor-mode}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFrda{(}\EFo{char-before}\EFrda{)} ?R\EFrdd{)}
      \EFrdd{(}\EFk{progn}
        \EFrda{(}\EFo{backward-delete-char} \EFhn{1}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFs{""}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"R"}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{self-insert-command} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}



\EFrda{(}\EFk{map!} \EFb{:map} latin-minor-mode-map
      \EFb{:n} \EFs{"e"} \EFhq{\#'}\EFhs{latin-minor-mode--insert-ae}
      \EFb{:n} \EFs{"R"} \EFhq{\#'}\EFhs{latin-minor-mode--insert-response}
      \EFb{:n} \EFs{"V"} \EFhq{\#'}\EFhs{latin-minor-mode--insert-versicle}\EFrda{)}

\EFcd{;;} \EFc{For some reason, that doesn't work...}
\EFcd{;;}\EFc{(progn}
\EFcd{;;}  \EFc{(global-set-key (kbd "e") 'latin-minor-mode--insert-ae)}
\EFcd{;;}  \EFc{(global-set-key (kbd "R") 'latin-minor-mode--insert-response)}
\EFcd{;;}  \EFc{(global-set-key (kbd "V") 'latin-minor-mode--insert-versicle))}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{languages}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Human languages}
\label{sec:org780d977}
\subsubsection{Language Baybayin}
\label{sec:org3ae3090}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{language-baybayin}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org36d2441}
\paragraph{Code}
\label{sec:orgf27ac07}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{quail-define-package}
 \EFs{"baybayin"} \EFs{"UTF-8"} \EFs{""} t
 \EFs{"Baybayin input method."}
 nil t nil nil nil nil nil nil nil nil t\EFrda{)}

\EFrda{(}\EFk{quail-define-rules}
 \EFrdb{(}\EFs{"a"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"b"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ba"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"be"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"bi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"bu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"bo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"c"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ca"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ce"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ci"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"cu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"co"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"d"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"da"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"de"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"di"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"du"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"do"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"e"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"f"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"fa"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"fe"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"fi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"fu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"fo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"g"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ga"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ge"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"gi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"gu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"go"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"h"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ha"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"he"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"hi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"hu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ho"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"i"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"j"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ja"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"je"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ji"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ju"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"jo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"k"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ka"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ke"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ki"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ku"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ko"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"l"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"la"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"le"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"li"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"lu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"lo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"m"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ma"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"me"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"mi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"mu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"mo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"n"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"na"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ne"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ni"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"nu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"no"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ng"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"nga"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"nge"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ngi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ngu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ngo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"o"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"p"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"pa"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"pe"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"pi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"pu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"po"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"q"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"qa"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"qe"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"qi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"qu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"qo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFcd{;;} \EFc{("r" [""])}
 \EFcd{;;} \EFc{("ra" [""])}
 \EFcd{;;} \EFc{("re" [""])}
 \EFcd{;;} \EFc{("ri" [""])}
 \EFcd{;;} \EFc{("ru" [""])}
 \EFcd{;;} \EFc{("ro" [""])}
 \EFrdb{(}\EFs{"r"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ra"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"re"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ri"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ru"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ro"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"s"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"sa"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"se"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"si"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"su"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"so"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"t"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ta"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"te"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ti"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"tu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"to"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"u"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"v"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"va"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ve"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"vi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"vu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"vo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"w"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"wa"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"we"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"wi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"wu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"wo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"x"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"xa"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"xe"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"xi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"xu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"xo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"y"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ya"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ye"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"yi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"yu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"yo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"z"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"za"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ze"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"zi"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"zu"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"zo"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{","} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"."} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{tagalog-font-doctrina} nil \EFd{"Whether Doctrina 1593 Tagalog font is used"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{toggle-tagalog-font-doctrina} \EFrdb{(}\EFrdb{)}
  \EFd{"Set Tagalog font to Doctrina 1593"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{tagalog-font-doctrina} \EFrdc{(}\EFo{not} \EFv{tagalog-font-doctrina}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFv{tagalog-font-doctrina}
    \EFrdc{(}\EFo{set-fontset-font} \EFs{"fontset-default"} \EFhq{'}\EFhs{tagalog} \EFrdd{(}\EFo{font-spec} \EFb{:family} \EFs{"Tagalog Doctrina 1593"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{set-fontset-font} \EFs{"fontset-default"} \EFhq{'}\EFhs{tagalog} \EFrdd{(}\EFo{font-spec} \EFb{:family} \EFs{"Noto Sans Tagalog"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{set-fontset-font} \EFs{"fontset-default"} \EFhq{'}\EFhs{tagalog} \EFrdb{(}\EFo{font-spec} \EFb{:family} \EFs{"Noto Sans Tagalog"}\EFrdb{)}\EFrda{)}
\EFcd{;;} \EFc{ is for some reason not in Source Code Pro Semibold}
\EFcd{;;} \EFc{(set-fontset-font "fontset-default" '(\#x1700 . \#x1700) (font-spec :family "Tagalog Doctrina 159"))}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{language-baybayin}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Language Arabic}
\label{sec:org2031213}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{language-arabic}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org575892f}
\paragraph{Code}
\label{sec:org2cb51ba}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{quail-define-package}
 \EFs{"phonetic arabic"} \EFs{"UTF-8"} \EFs{""} t
 \EFs{"Phonetic input method."}
 nil t nil nil nil nil nil nil nil nil t\EFrda{)}

\EFrda{(}\EFk{quail-define-rules}
 \EFrdb{(}\EFs{"0"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"1"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"2"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"3"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"4"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"5"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"6"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"7"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"8"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"9"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ah"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"aa"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"aaa"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ae"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ai"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ao"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"au"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"b"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"t"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"th"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"j"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"H"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"kh"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"d"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"dh"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"r"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"z"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"s"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"sh"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"S"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"D"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"T"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"Z"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"E"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"gh"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"f"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"q"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"k"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"l"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"m"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"n"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"h"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"w"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"y"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"p"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"v"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"g"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"ch"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"zh"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"a"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"i"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"u"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"n"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"e"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrdb{(}\EFs{"o"} \EFrdc{[}\EFs{""}\EFrdc{]}\EFrdb{)}
 \EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{language-arabic}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Email}
\label{sec:org1999f15}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module-if} \EFhq{'}\EFhs{mu4e} \EFhq{'}\EFhs{email}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org0249fb9}
\subsubsection{Code}
\label{sec:orgc37efc1}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{email.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} \EFv{mu4e-mu-binary} \EFs{"/bin/mu"}\EFrda{)}

\EFcd{;;;} \EFc{mu4e reindexing when tmp file exists}
\EFrda{(}\EFk{after!} mu4e
  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request-file} \EFs{"/tmp/mu\_reindex\_now"}
    \EFd{"Location of the reindex request, signaled by existance"}\EFrdb{)}
  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request-min-seperation} \EFhn{5.0}
    \EFd{"Don't refresh again until this many second have elapsed.}
\EFd{Prevents a series of redisplays from being called (when set to an appropriate value)"}\EFrdb{)}

  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request--file-watcher} nil\EFrdb{)}
  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request--file-just-deleted} nil\EFrdb{)}
  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request--last-time} \EFhn{0}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{mu4e-reindex-request--add-watcher} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{mu4e-reindex-request--file-just-deleted} nil\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{mu4e-reindex-request--file-watcher}
          \EFrdd{(}\EFo{file-notify-add-watch} \EFv{mu4e-reindex-request-file}
                                 \EFhq{'}\EFrda{(}change\EFrda{)}
                                 \EFhq{\#'}\EFhs{mu4e-file-reindex-request}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defadvice!} mu4e-stop-watching-for-reindex-request \EFrdc{(}\EFrdc{)}
    \EFb{:after} \EFhq{\#'}\EFhs{mu4e\char126{}proc-kill}
    \EFrdc{(}\EFk{if} \EFv{mu4e-reindex-request--file-watcher}
        \EFrdd{(}\EFo{file-notify-rm-watch} \EFv{mu4e-reindex-request--file-watcher}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defadvice!} mu4e-watch-for-reindex-request \EFrdc{(}\EFrdc{)}
    \EFb{:after} \EFhq{\#'}\EFhs{mu4e\char126{}proc-start}
    \EFrdc{(}\EFf{mu4e-stop-watching-for-reindex-request}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{file-exists-p} \EFv{mu4e-reindex-request-file}\EFrdd{)}
      \EFrdd{(}\EFo{delete-file} \EFv{mu4e-reindex-request-file}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{mu4e-reindex-request--add-watcher}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{mu4e-file-reindex-request} \EFrdc{(}event\EFrdc{)}
    \EFd{"Act based on the existance of `}\textcolor[HTML]{a9a1e1}{mu4e-reindex-request-file}\EFd{'"}
    \EFrdc{(}\EFk{if} \EFv{mu4e-reindex-request--file-just-deleted}
        \EFrdd{(}\EFf{mu4e-reindex-request--add-watcher}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFo{equal} \EFrdb{(}\EFo{nth} \EFhn{1} event\EFrdb{)} \EFhq{'}\EFhs{created}\EFrda{)}
        \EFrda{(}\EFo{delete-file} \EFv{mu4e-reindex-request-file}\EFrda{)}
        \EFrda{(}\EFk{setq} \EFv{mu4e-reindex-request--file-just-deleted} t\EFrda{)}
        \EFrda{(}\EFf{mu4e-reindex-maybe} t\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{mu4e-reindex-maybe} \EFrdc{(}\EFt{\&optional} new-request\EFrdc{)}
    \EFd{"Run `}\textcolor[HTML]{a9a1e1}{mu4e\char126{}proc-index}\EFd{' if it's been more than}
\EFd{`}\textcolor[HTML]{a9a1e1}{mu4e-reindex-request-min-seperation}\EFd{'seconds since the last request,"}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}time-since-last-request \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{float-time}\EFrdc{)}
                                      \EFv{mu4e-reindex-request--last-time}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} new-request
        \EFrda{(}\EFk{setq} \EFv{mu4e-reindex-request--last-time} \EFrdb{(}\EFo{float-time}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{>} time-since-last-request \EFv{mu4e-reindex-request-min-seperation}\EFrda{)}
          \EFrda{(}mu4e\char126{}proc-index nil t\EFrda{)}
        \EFrda{(}\EFk{when} new-request
          \EFrdb{(}\EFo{run-at-time} \EFrdc{(}\EFo{*} \EFhn{1.1} \EFv{mu4e-reindex-request-min-seperation}\EFrdc{)} nil
                       \EFhq{\#'}\EFhs{mu4e-reindex-maybe}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{mu4e-notification-support} t\EFrda{)}
\EFrda{(}\EFk{after!} mu4e-alert
  \EFrdb{(}\EFf{mu4e-alert-enable-notifications}\EFrdb{)}
  \EFrdb{(}\EFf{mu4e-alert-set-default-style} \EFhq{'}\EFhs{libnotify}\EFrdb{)}
  \EFrdb{(}\EFk{setq} +mu4e-alert-bell-cmd \EFhq{'}\EFrdc{(}\EFs{"mail-alert.sh"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{mu4e-update-mail-and-index} \EFhn{1}\EFrdb{)}\EFrda{)} \EFcd{;} \EFc{fetch emails in background)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{email}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{mail-alert.sh}
\label{sec:org9b429a8}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{\#}\EFc{!/bin/}\EFk{env} \EFc{sh}

\EFcd{\#}\EFc{paplay "/usr/share/sounds/freedesktop/stereo/message.oga"}

\EFf{mu\_find\_cmd}\EFrda{(}\EFrda{)} \EFrda{\{}
    mu \EFt{find} --sortfield=\EFt{date} --reverse --maxnum=\EFhn{1} --fields \EFs{\char92{}"}\$\EFhn{1}\EFs{\char92{}"} flag:unread | tr -d \EFs{'"'}
\EFrda{\}}

\EFv{SENDER}=\$\EFrda{(}mu\_find\_cmd \EFs{"f"}\EFrda{)}
\EFv{SUBJECT}=\$\EFrda{(}mu\_find\_cmd \EFs{"s"}\EFrda{)}

dunstify -h string:x-dunst-stack-tag:email -i \EFs{"/home/user/dox/icons/mail-unread-symbolic.svg"} \EFs{"}\textcolor[HTML]{a9a1e1}{\$}\textcolor[HTML]{dcaeea}{SENDER}\EFs{"} \EFs{"}\textcolor[HTML]{a9a1e1}{\$}\textcolor[HTML]{dcaeea}{SUBJECT}\EFs{"}
\end{Verbatim}
\end{Code}
\subsubsection{Email Config}
\label{sec:org4bbbec9}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module-if} \EFhq{'}\EFhs{mu4e} \EFhq{'}\EFhs{email-config}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org0f4a059}
\paragraph{Code}
\label{sec:orgbec5933}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{email-config.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFo{require} \EFhq{'}\EFo{mu4e}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{smtpmail}\EFrda{)}
\EFrda{(}\EFo{define-key} \EFv{mu4e-view-mode-map} \EFrdb{(}\EFo{kbd} \EFs{"f"}\EFrdb{)} \EFhq{'}\EFhs{mu4e-view-go-to-url}\EFrda{)}

\EFrda{(}\EFk{setq} mu4e-root-maildir \EFs{"\char126{}/mail"}
      \EFcd{;}\EFc{mu4e-get-mail-command "offlineimap -q -f INBOX"}
      \EFv{mu4e-get-mail-command} \EFs{"mbsync -a || true"}
      \EFv{mu4e-update-interval} \EFhn{300} \EFcd{;;} \EFc{second}
      mu4e-compose-signature-auto-include nil
      mu4e-view-show-images t
      mu4e-view-prefer-html t
      mu4e-html2text-command \EFs{"iconv -c -t utf-8 | pandoc -f html -t plain"}
      \EFv{mu4e-headers-auto-update} t
      \EFv{mu4e-compose-format-flowed} t
      \EFv{sendmail-program} \EFs{"/usr/bin/msmtp"}
      \EFv{smtpmail-stream-type} \EFhq{'}\EFhs{starttls}
      \EFv{message-sendmail-f-is-evil} t
      \EFv{message-sendmail-extra-arguments} \EFhq{'}\EFrdb{(}\EFs{"--read-envelope-from"}\EFrdb{)}
\EFcd{;}      \EFc{message-send-mail-function 'smtpmail-send-it}
      \EFv{message-send-mail-function} \EFhq{'}\EFhs{message-send-mail-with-sendmail}
      mu4e-view-show-addresses t
      \EFv{mu4e-split-view} \EFhq{'}\EFhs{single-window} \EFcd{;;} \EFc{horizontal (default), vertical}
      \EFv{mu4e-attachment-dir} \EFs{"\char126{}/Downloads"}
      \EFv{smtpmail-queue-mail} nil
      \EFv{smtpmail-queue-dir} \EFs{"\char126{}/mail/queue/cur"}
      \EFv{mu4e-compose-in-new-frame} nil
      mu4e-compose-dont-reply-to-self t
      \EFv{mu4e-headers-date-format} \EFs{"\%Y-\%m-\%d \%H:\%M"}
      \EFv{message-kill-buffer-on-exit} nil
      \EFv{mu4e-confirm-quit} nil
      \EFv{mu4e-context-policy} \EFhq{'}\EFhs{ask-if-none}
      \EFv{mu4e-compose-context-policy} \EFhq{'}\EFhs{always-ask}
      \EFv{mu4e-headers-results-limit} \EFhn{500}
      \EFv{mu4e-use-fancy-chars} t\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{mu4e--view-quit-and-back} \EFrdb{(}\EFrdb{)}
  \EFd{"Quit mu4e view buffer and go back to mu4e"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mu4e-view-quit}\EFrdb{)}
  \EFrdb{(}\EFf{mu4e--goto-inbox}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{mu4e--goto-inbox} \EFrdb{(}\EFrdb{)}
  \EFd{"Goto mu4e inbox"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mu4e\char126{}headers-jump-to-maildir} \EFs{"/gmail/INBOX"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{mu4e-view-mode-map}
      \EFb{:after} mu4e-view
      \EFb{:n} \EFs{"<backspace>"} \EFhq{'}\EFhs{mu4e--view-quit-and-back}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-m"}\EFrdb{)} \EFhq{'}\EFhs{mu4e--goto-inbox}\EFrda{)}

\EFrda{(}\EFk{when} \EFrdb{(}\EFo{fboundp} \EFhq{'}\EFhs{imagemagick-register-types}\EFrdb{)}
  \EFrdb{(}\EFo{imagemagick-register-types}\EFrdb{)}\EFrda{)}

\EFcd{;} \EFc{Make sure doom doesn't move mu4e article buffer into popup}
\EFcd{;} \EFc{Show it in same window}
\EFrda{(}\EFk{after!} mu4e
  \EFrdb{(}\EFf{set-popup-rule!} \EFs{"*mu4e-article*"} \EFb{:ignore} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFcd{;}\EFc{(require 'org-mu4e)}
\EFcd{;}\EFc{(setq org-mu4e-convert-to-html t}
\EFcd{;}\EFc{org-mu4e-link-query-in-headers-mode nil)}

\EFrda{(}\EFo{require} \EFhq{'}\EFo{org-mime}\EFrda{)}

\EFcd{;;} \EFc{this seems to fix the babel file saving thing}
\EFrda{(}\EFk{defun} \EFf{org\char126{}mu4e-mime-replace-images} \EFrdb{(}str current-file\EFrdb{)}
\EFd{"Replace images in html files with cid links."}
\EFrdb{(}\EFk{let} \EFrdc{(}html-images\EFrdc{)}
\EFrdc{(}\EFo{cons}
\EFrdd{(}\EFo{replace-regexp-in-string} \EFcd{;;} \EFc{replace images in html}
\EFs{"src=\char92{}"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{\char92{}"]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}""}
\EFrda{(}\EFk{lambda} \EFrdb{(}text\EFrdb{)}
\EFrdb{(}\EFo{format}
        \EFs{"src=\char92{}"./:\%s\char92{}""}
        \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}url \EFrdb{(}\EFk{and} \EFrdc{(}\EFo{string-match} \EFs{"src=\char92{}"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{\char92{}"]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}""} text\EFrdc{)}
                        \EFrdc{(}\EFo{match-string} \EFhn{1} text\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}path \EFrdb{(}\EFo{expand-file-name}
                url \EFrdc{(}\EFo{file-name-directory} current-file\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}ext \EFrdb{(}\EFo{file-name-extension} path\EFrdb{)}\EFrda{)}
        \EFrda{(}id \EFrdb{(}\EFo{replace-regexp-in-string} \EFs{"[}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{/\char92{}\char92{}\char92{}\char92{}]"} \EFs{"\_"} path\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{add-to-list} \EFhq{'}\EFhs{html-images}
                \EFrda{(}org\char126{}mu4e-mime-file
                \EFrdb{(}\EFo{concat} \EFs{"image/"} ext\EFrdb{)} path id\EFrda{)}\EFrdd{)}
        id\EFrdc{)}\EFrdb{)}\EFrda{)}
str\EFrdd{)}
html-images\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{mu4e-view-actions}
\EFhq{'}\EFrdb{(}\EFs{"ViewInBrowser"} . mu4e-action-view-in-browser\EFrdb{)} t\EFrda{)}

\EFcd{;} \EFc{Ignore popup rules to make sure emails are shown in same window}
\EFrda{(}\EFk{after!} mu4e
  \EFrdb{(}\EFf{set-popup-rule!} \EFs{"\char94{}\char92{}\char92{}*mu4e-headers\char92{}\char92{}*"} \EFb{:ignore} t\EFrdb{)}
  \EFrdb{(}\EFf{set-popup-rule!} \EFs{"\char94{}\char92{}\char92{}*mu4e-view\char92{}\char92{}*"} \EFb{:ignore} t\EFrdb{)}\EFrda{)}


\EFrda{(}\EFo{provide} \EFhq{'}\EFo{email-config}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Email Accounts}
\label{sec:orged6797b}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module-if} \EFhq{'}\EFhs{mu4e} \EFhq{'}\EFhs{email-accounts}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:orgc985881}
\paragraph{Code}
\label{sec:org8b0102b}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;} \EFc{Email Accounts}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{email-refile}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{smtpmail}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{+mu4e-gmail-accounts} \EFhq{'}\EFrdb{(}\EFrdc{(}\EFs{"e.p.mysliwietz@gmail.com"} . \EFs{"/gmail"}\EFrdc{)}\EFrdb{)}
      \EFv{mu4e-contexts}
      \EFhq{`}\EFrdb{(}
       ,\EFrdc{(}\EFo{make-mu4e-context}
	  \EFb{:name} \EFs{"gmail"}
	  \EFb{:enter-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}\EFo{mu4e-message} \EFs{"Switching to gmail context"}\EFrda{)}\EFrdd{)}
	  \EFb{:leave-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}\EFo{mu4e-message} \EFs{"Leaving gmail context"}\EFrda{)}\EFrdd{)}
	  \EFb{:vars} \EFhq{'}\EFrdd{(}
		  \EFrda{(} \EFv{user-full-name}	             . \EFs{"Egidius Mysliwietz"} \EFrda{)}
		  \EFrda{(} \EFv{user-mail-address}	         . \EFs{"e.p.mysliwietz@gmail.com"} \EFrda{)}
		  \EFrda{(} \EFv{mu4e-drafts-folder}           . \EFs{"/gmail/[Gmail]/Entw\&APw-rfe"} \EFrda{)}
                  \EFrda{(} \EFv{mu4e-sent-folder}             . \EFs{"/gmail/[Gmail]/Gesendet"} \EFrda{)}
		  \EFrda{(} \EFv{mu4e-trash-folder}            . \EFs{"/gmail/[Gmail]/Papierkorb"} \EFrda{)}
		  \EFrda{(} \EFv{mu4e-refile-folder}           . gmail-refile \EFrda{)}
		  \EFrdd{)}\EFrdc{)}
        ,\EFrdc{(}\EFo{make-mu4e-context}
	  \EFb{:name} \EFs{"emysliwietz"}
	  \EFb{:enter-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}\EFo{mu4e-message} \EFs{"Switching to emysliwietz context"}\EFrda{)}\EFrdd{)}
          \EFb{:leave-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}\EFo{mu4e-message} \EFs{"Leaving emysliwietz context"}\EFrda{)}\EFrdd{)}
	  \EFcd{;;} \EFc{we match based on the contact-fields of the message}
	  \EFb{:vars} \EFhq{'}\EFrdd{(}
		  \EFrda{(} \EFv{user-full-name}               . \EFs{"Egidius Mysliwietz"} \EFrda{)}
		  \EFrda{(} \EFv{user-mail-address}	         . \EFs{"egidius@mysliwietz.de"}  \EFrda{)}
		  \EFrda{(} mu4e-archive-folder          . \EFs{"/emysliwietz/Archive"} \EFrda{)}
		  \EFrda{(} \EFv{mu4e-drafts-folder}           . \EFs{"/emysliwietz/Drafts"} \EFrda{)}
                  \EFrda{(} \EFv{mu4e-sent-folder}             . \EFs{"/emysliwietz/Sent"} \EFrda{)}
		  \EFrda{(} \EFv{mu4e-trash-folder}            . \EFs{"/emysliwietz/Trash"} \EFrda{)}
		  \EFrda{(} \EFv{mu4e-refile-folder}           . gmail-refile \EFrda{)}
		  \EFrdd{)}\EFrdc{)}
      \EFcd{;}\EFc{,(make-mu4e-context}
	  \EFcd{;}\EFc{:name "xgmx"}
	  \EFcd{;}\EFc{:enter-func (lambda () (mu4e-message "Switching to gmx context"))}
	  \EFcd{;}\EFc{:leave-func (lambda () (mu4e-message "Leaving gmx context"))}
	  \EFcd{;}\EFc{:vars '(}
		  \EFcd{;}\EFc{( user-full-name	         . "Egidius Mysliwietz" )}
		  \EFcd{;}\EFc{( user-mail-address	         . "egidius.mysliwietz@gmx.de" )}
                  \EFcd{;}\EFc{( smtpmail-mail-address        . "egidius.mysliwietz@gmx.de")}
		  \EFcd{;}\EFc{( smtpmail-smtp-user           . "egidius.mysliwietz@gmx.de")}
		  \EFcd{;}\EFc{( mu4e-archive-folder          . "/gmx/Archiv" )}
		  \EFcd{;}\EFc{( mu4e-drafts-folder           . "/gmx/Entwrfe" )}
                  \EFcd{;}\EFc{( mu4e-sent-folder             . "/gmx/Gesendet" )}
		  \EFcd{;}\EFc{( mu4e-trash-folder            . "/gmx/Gelscht" )}
                  \EFcd{;}\EFc{( smtpmail-default-smtp-server . "mail.gmx.net" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-server         . "mail.gmx.net" )}
		  \EFcd{;}\EFc{( smtpmail-local-domain        . "gmx.net" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-service        . 465 )}
		  \EFcd{;}\EFc{))}
       ,\EFrdc{(}\EFo{make-mu4e-context}
	  \EFb{:name} \EFs{"ru"}
	  \EFb{:enter-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}\EFo{mu4e-message} \EFs{"Switch to ru context"}\EFrda{)}\EFrdd{)}
	  \EFb{:leave-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}\EFo{mu4e-message} \EFs{"Leaving ru context"}\EFrda{)}\EFrdd{)}
	  \EFb{:vars} \EFhq{'}\EFrdd{(}
		  \EFrda{(} \EFv{user-full-name}	             . \EFs{"Egidius Mysliwietz"} \EFrda{)}
		  \EFrda{(} \EFv{user-mail-address}	         . \EFs{"egidius.mysliwietz@ru.nl"} \EFrda{)}
		  \EFrda{(} \EFv{mu4e-drafts-folder}           . \EFs{"/ru/Drafts"} \EFrda{)}
                  \EFrda{(} \EFv{mu4e-sent-folder}             . \EFs{"/ru/Sent Items"} \EFrda{)}
		  \EFrda{(} \EFv{mu4e-trash-folder}            . \EFs{"/ru/Deleted Items"} \EFrda{)}
          		  \EFrda{(} mu4e-archive-folder          . \EFs{"/ru/Archive"} \EFrda{)}
		  \EFrdd{)}\EFrdc{)}
       \EFcd{;}\EFc{,(make-mu4e-context}
	  \EFcd{;}\EFc{:name "eindhoven"}
	  \EFcd{;}\EFc{:enter-func (lambda () (mu4e-message "Switch to eindhoven context"))}
	  \EFcd{;}\EFc{:leave-func (lambda () (mu4e-message "Leaving eindhoven context"))}
	  \EFcd{;}\EFc{:vars '(}
		  \EFcd{;}\EFc{( user-full-name	         . "Egidius Mysliwietz" )}
		  \EFcd{;}\EFc{( user-mail-address	         . "e.p.j.mysliwietz@student.tue.nl" )}
                  \EFcd{;}\EFc{( smtpmail-mail-address        . "e.p.j.mysliwietz@student.tue.nl")}
		  \EFcd{;}\EFc{( smtpmail-smtp-user           . "e.p.j.mysliwietz@student.tue.nl")}
                  \EFcd{;}\EFc{( mu4e-archive-folder          . "/eindhoven/Archive" )}
		  \EFcd{;}\EFc{( mu4e-drafts-folder           . "/eindhoven/Drafts" )}
                  \EFcd{;}\EFc{( mu4e-sent-folder             . "/eindhoven/Sent Items" )}
		  \EFcd{;}\EFc{( mu4e-trash-folder            . "/eindhoven/Trash" )}
                  \EFcd{;}\EFc{( smtpmail-default-smtp-server . "smtp.office365.com" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-server         . "smtp.office365.com" )}
		  \EFcd{;}\EFc{( smtpmail-local-domain        . "office365.com" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-service        . 587 )}
		  \EFcd{;}\EFc{))}
       \EFcd{;}\EFc{,(make-mu4e-context}
	  \EFcd{;}\EFc{:name "ntu"}
	  \EFcd{;}\EFc{:enter-func (lambda () (mu4e-message "Switch to ntu context"))}
	  \EFcd{;}\EFc{:leave-func (lambda () (mu4e-message "Leaving ntu context"))}
	  \EFcd{;}\EFc{:vars '(}
		  \EFcd{;}\EFc{( user-full-name	         . "Egidius Mysliwietz" )}
		  \EFcd{;}\EFc{( user-mail-address	         . "n1903483e@e.ntu.edu.sg" )}
                  \EFcd{;}\EFc{( smtpmail-mail-address        . "n1903483e@e.ntu.edu.sg")}
		  \EFcd{;}\EFc{( smtpmail-smtp-user           . "n1903483e@e.ntu.edu.sg")}
                  \EFcd{;}\EFc{( mu4e-archive-folder          . "/ntu/Archive" )}
		  \EFcd{;}\EFc{( mu4e-drafts-folder           . "/ntu/Drafts" )}
                  \EFcd{;}\EFc{( mu4e-sent-folder             . "/ntu/Sent Items" )}
		  \EFcd{;}\EFc{( mu4e-trash-folder            . "/ntu/Trash" )}
                  \EFcd{;}\EFc{( smtpmail-default-smtp-server . "smtp.office365.com" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-server         . "smtp.office365.com" )}
		  \EFcd{;}\EFc{( smtpmail-local-domain        . "office365.com" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-service        . 587 )}
		  \EFcd{;}\EFc{))}
       \EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{email-accounts}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{mbsync config}
\label{sec:org61ea342}
\paragraph{RU}
\label{sec:org0a15bab}
\begin{Code}
\begin{Verbatim}
\color{EFD}
IMAPAccount ru
Host smtp.office365.com
User egidius.mysliwietz@ru.nl
PassCmd \EFs{"secret-tool lookup mail-mbsync ru"}
Port \EFhn{993}
SSLType IMAPS
AuthMechs XOAUTH2
CertificateFile /etc/ssl/certs/ca-certificates.crt

IMAPStore ru-remote
Account ru

MaildirStore ru-local
Path \char126{}/mail/ru/
Inbox \char126{}/mail/ru/INBOX
Subfolders Verbatim

Channel ru
Far :ru-remote:
Near :ru-local:
Create Both
Expunge Both
Sync All
Patterns *
SyncState *

\EFcd{\#} \EFc{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Verbatim}
\end{Code}
\paragraph{Strato}
\label{sec:org71fbea8}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

IMAPAccount emysliwietz
Host imap.strato.de
User egidius@mysliwietz.de
PassCmd \EFs{"secret-tool lookup mail-mbsync emysliwietz"}
\EFcd{\#}\EFc{Port 993}
SSLType IMAPS
AuthMechs Login
CertificateFile /etc/ssl/certs/ca-certificates.crt

IMAPStore emysliwietz-remote
Account emysliwietz

MaildirStore emysliwietz-local
Path \char126{}/mail/emysliwietz/
Inbox \char126{}/mail/emysliwietz/INBOX
Subfolders Verbatim

Channel emysliwietz
Far :emysliwietz-remote:
Near :emysliwietz-local:
Create Both
Expunge Both
Sync All
Patterns *
SyncState *

\EFcd{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Verbatim}
\end{Code}
\paragraph{gmail}
\label{sec:org958317d}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{\#} \EFc{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
IMAPAccount gmail
Host imap.gmail.com
User e.p.mysliwietz@gmail.com
PassCmd \EFs{"secret-tool lookup mail-mbsync gmail"}
Port \EFhn{993}
SSLType IMAPS
AuthMechs Login
CertificateFile /etc/ssl/certs/ca-certificates.crt

IMAPStore gmail-remote
Account gmail

MaildirStore gmail-local
Path \char126{}/mail/gmail/
Inbox \char126{}/mail/gmail/INBOX
Subfolders Verbatim

Channel gmail
Far :gmail-remote:
Near :gmail-local:
Create Both
Expunge Both
Sync All
Patterns *
SyncState *

\EFcd{\#} \EFc{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Verbatim}
\end{Code}
\paragraph{mu init}
\label{sec:orgd076f48}
\begin{Code}
\begin{Verbatim}
\color{EFD}mu init --maildir \char126{}/mail --my-address=\EFs{"e.p.mysliwietz@gmail.com"} --my-address=\EFs{"egidius@mysliwietz.de"} --my-address=\EFs{"egidius.mysliwietz@gmx.de"}
mu index
\end{Verbatim}
\end{Code}
\subsubsection{msmtprc - Sending mails}
\label{sec:orgfe6f0b1}
\paragraph{default settings}
\label{sec:orgace7177}
\begin{Code}
\begin{Verbatim}
\color{EFD}defaults
auth	on
tls	on
tls\_trust\_file	/etc/ssl/certs/ca-certificates.crt
logfile /home/user/.config/msmtp/msmtp.log

\end{Verbatim}
\end{Code}
\paragraph{gmail}
\label{sec:org49f1804}
\begin{Code}
\begin{Verbatim}
\color{EFD}account gmail
host smtp.gmail.com
from e.p.mysliwietz@gmail.com
user e.p.mysliwietz@gmail.com
passwordeval \EFs{"secret-tool lookup mail-mbsync gmail"}

\end{Verbatim}
\end{Code}
\paragraph{strato}
\label{sec:org08ef52d}
\begin{Code}
\begin{Verbatim}
\color{EFD}account emysliwietz
host smtp.strato.de
port \EFhn{587}
from egidius@mysliwietz.de
user egidius@mysliwietz.de
passwordeval \EFs{"secret-tool lookup mail-mbsync emysliwietz"}

\end{Verbatim}
\end{Code}
\paragraph{ru}
\label{sec:org744e601}
\begin{Code}
\begin{Verbatim}
\color{EFD}account ru
host smtp.office365.com
port \EFhn{587}
auth xoauth2
from egidius.mysliwietz@ru.nl
user egidius.mysliwietz@ru.nl
passwordeval \EFs{"secret-tool lookup mail-mbsync ru"}

\end{Verbatim}
\end{Code}
\paragraph{default account}
\label{sec:org90efce7}
\begin{Code}
\begin{Verbatim}
\color{EFD}account default : emysliwietz
\end{Verbatim}
\end{Code}
\subsection{Latex Tweaks}
\label{sec:org6596c67}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{latex-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgd845442}
\subsubsection{Code}
\label{sec:orge6b4d1d}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{latex.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} \EFv{TeX-command-extra-options} \EFs{"--shell-escape"}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{TeX-view-program-selection}
      \EFhq{'}\EFrdb{(}\EFrdc{(}output-pdf \EFs{"Zathura"}\EFrdc{)}
        \EFrdc{(}output-pdf \EFs{"Evince"}\EFrdc{)}
        \EFrdc{(}output-pdf \EFs{"PDF Tools"}\EFrdc{)}
        \EFrdc{(}\EFrdd{(}output-dvi has-no-display-manager\EFrdd{)}
         \EFs{"dvi2tty"}\EFrdc{)}
        \EFrdc{(}\EFrdd{(}output-dvi style-pstricks\EFrdd{)}
         \EFs{"dvips and gv"}\EFrdc{)}
        \EFrdc{(}output-dvi \EFs{"xdvi"}\EFrdc{)}
        \EFrdc{(}output-html \EFs{"xdg-open"}\EFrdc{)}
        \EFrdc{(}output-pdf \EFs{"preview-pane"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{TeX-engine} \EFhq{'}\EFhs{luatex}\EFrda{)}
\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{org-mode-hook}
          \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)}
            \EFrdc{(}\EFo{local-set-key} \EFrdd{(}\EFo{kbd} \EFs{"<f6>"}\EFrdd{)}
                           \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}\EFk{interactive}\EFrda{)} \EFrda{(}\EFo{org-latex-export-to-pdf} t\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{force-compile} \EFrdb{(}\EFrdb{)}
  \EFd{"Set the file modification times on the current file, then call}
\EFd{TeX-command-sequence.}
\EFd{This forces a complete recompilation of the document, even if the source}
\EFd{(.tex) is older than any existing outputs (.pdf etc)."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{set-buffer-modified-p} t\EFrdb{)} \EFcd{;;} \EFc{sets mod time to current time}
  \EFrdb{(}\EFo{save-buffer}\EFrdb{)}
  \EFrdb{(}\EFo{TeX-command-sequence} t t\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{backup-copy-pdf-after-compilation} \EFrdb{(}pdf-file\EFrdb{)}
  \EFd{"Copy the newly created PDF file to the same directory as the source TeX file with a '}\textcolor[HTML]{a9a1e1}{.backup.pdf}\EFd{' suffix."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{source-directory} \EFrda{(}\EFo{file-name-directory} pdf-file\EFrda{)}\EFrdd{)}
        \EFrdd{(}pdf-file-name \EFrda{(}\EFo{file-name-nondirectory} pdf-file\EFrda{)}\EFrdd{)}
        \EFrdd{(}backup-pdf-file \EFrda{(}\EFo{concat} \EFrdb{(}\EFo{file-name-sans-extension} pdf-file\EFrdb{)} \EFs{".backup.pdf"}\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFcd{;}\EFc{(message backup-pdf-file)}
    \EFrdc{(}\EFo{copy-file} pdf-file \EFrdd{(}\EFo{concat} \EFs{""} backup-pdf-file\EFrdd{)} t\EFrdc{)}\EFrdb{)}\EFrda{)} \EFcd{;}\EFc{source-directory}


\EFcd{;} \EFc{Create backup copy of pdf after successful compilation}
\EFcd{;} \EFc{This way, you can read the pfd even while the new version is compiling}
\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{TeX-after-compilation-finished-functions} \EFhq{\#'}\EFhs{backup-copy-pdf-after-compilation}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{auto-async-export} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}keywords \EFrda{(}\EFo{org-collect-keywords} \EFhq{'}\EFrdb{(}\EFs{"auto\_async\_export"}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{and} keywords
               \EFrda{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrda{)}
               \EFrda{(}\EFo{string-equal} \EFs{"t"} \EFrdb{(}\EFk{pop} \EFrdc{(}\EFo{cdr} \EFrdd{(}\EFo{car} keywords\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{message} \EFs{"Exporting to pdf..."}\EFrdd{)}
      \EFrdd{(}\EFo{org-latex-export-to-pdf} t\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{latex-mode}\EFrda{)}
        \EFrda{(}\EFf{force-compile}\EFrda{)}\EFrdd{)}
      \EFrdc{)}
    \EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-after-save-cmd} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrdc{)}
  \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}cmd \EFrdb{(}\EFo{cdr} \EFrdc{(}\EFo{car} \EFrdd{(}\EFo{org-collect-keywords} \EFhq{'}\EFrda{(}\EFs{"on\_save\_cmd"}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{when} cmd
  \EFrda{(}\EFf{async-shell-command-no-window} \EFrdb{(}\EFk{pop} cmd\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{password-cache} t \EFcd{;} \EFc{enable password caching}
      \EFv{password-cache-expiry} \EFhn{36000}\EFrda{)} \EFcd{;} \EFc{for ten hours (time in secs)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{after-save-hook} \EFhq{'}\EFhs{auto-async-export}\EFrda{)}
\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{after-save-hook} \EFhq{'}\EFhs{org-after-save-cmd}\EFrda{)}
                                        \EFcd{;}\EFc{(global-set-key [f6] (lambda () (interactive) (org-latex-export-to-pdf t)))}
\EFrda{(}\EFk{setq} \EFv{org-latex-compiler} \EFs{"lualatex"}\EFrda{)}
\EFcd{;}\EFc{(setq-default TeX-master nil)}
\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{org-latex-packages-alist}
             \EFhq{'}\EFrdb{(}\EFs{"AUTO"} \EFs{"polyglossia"} t \EFrdc{(}\EFs{"xelatex"} \EFs{"lualatex"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{latex-word-count} \EFrdb{(}\EFrdb{)}
  \EFd{"Return latex word count using texlive"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}file-name \EFrda{(}\EFk{if} \EFrdb{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{latex-mode}\EFrdb{)}
                       \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}
                     \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrdc{)}
                         \EFrdc{(}\EFo{file-name-with-extension} \EFrdd{(}\EFv{buffer-file-name}\EFrdd{)} \EFs{"tex"}\EFrdc{)}
                       \EFrdc{(}\EFv{buffer-file-name}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{message} \EFrdd{(}\EFo{shell-command-to-string} \EFrda{(}\EFo{format} \EFs{"texcount -1 -merge -template=\{1\} \%s"} file-name\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFhs{TeX-language-en-hook}
          \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFo{ispell-change-dictionary} \EFs{"english"}\EFrdc{)}
            \EFrdc{(}\EFk{setq} \EFv{TeX-quote-language} \EFhq{`}\EFrdd{(}\EFs{"german"} \EFs{"\char92{}\char92{}enquote\{"} \EFs{"\}"} ,\EFv{TeX-quote-after-quote}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFhs{TeX-language-de-hook}
          \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFo{ispell-change-dictionary} \EFs{"german"}\EFrdc{)}
            \EFrdc{(}\EFk{setq} \EFv{TeX-quote-language} \EFhq{`}\EFrdd{(}\EFs{"german"} \EFs{"\char92{}\char92{}enquote\{"} \EFs{"\}"} ,\EFv{TeX-quote-after-quote}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


  \EFcd{;;} \EFc{Latex classes}
  \EFrda{(}\EFk{setq} \EFv{org-latex-subtitle-separate} t
        \EFv{org-latex-subtitle-format} \EFs{"\char92{}\char92{}subtitle\{\%s\}"}\EFrda{)}
  \EFrda{(}\EFk{setq} \EFv{org-latex-classes} \EFhq{'}\EFrdb{(}\EFrdc{(}\EFs{"article"} \EFs{"\char92{}\char92{}documentclass[a4wide,10pt]\{article\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}paragraph\{\%s\}"} . \EFs{"\char92{}\char92{}paragraph*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subparagraph\{\%s\}"} . \EFs{"\char92{}\char92{}subparagraph*\{\%s\}"}\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFs{"report"} \EFs{"\char92{}\char92{}documentclass[11pt]\{report\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}part\{\%s\}"} . \EFs{"\char92{}\char92{}part*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}chapter\{\%s\}"} . \EFs{"\char92{}\char92{}chapter*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFs{"artikel"} \EFs{"\char92{}\char92{}documentclass[fancy, modern, twocolumn, titlepage=head, paper=a4, 12pt]\{artikel\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}paragraph\{\%s\}"} . \EFs{"\char92{}\char92{}paragraph*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subparagraph\{\%s\}"} . \EFs{"\char92{}\char92{}subparagraph*\{\%s\}"}\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFs{"thesis"} \EFs{"\char92{}\char92{}documentclass[fancy, modern, twocolumn, titlepage=thesis, paper=a4, 12pt]\{artikel\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}paragraph\{\%s\}"} . \EFs{"\char92{}\char92{}paragraph*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subparagraph\{\%s\}"} . \EFs{"\char92{}\char92{}subparagraph*\{\%s\}"}\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFs{"book"} \EFs{"\char92{}\char92{}documentclass[11pt]\{book\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}part\{\%s\}"} . \EFs{"\char92{}\char92{}part*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}chapter\{\%s\}"} . \EFs{"\char92{}\char92{}chapter*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{org-export-headline-levels} \EFhn{5}\EFrda{)}

\EFcd{;} \EFc{Allow headlines, but not content, to not be exported (used for structuring org files)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{ox-extra}\EFrda{)}
\EFrda{(}\EFo{ox-extras-activate} \EFhq{'}\EFrdb{(}ignore-headlines\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{deft-recursive} t
      \EFv{deft-use-filename-as-title} t\EFrda{)}
\EFrda{(}\EFk{let*} \EFrdb{(}\EFrdc{(}base-dir \EFs{"/home/user/dox/bib/"}\EFrdc{)}
        \EFrdc{(}bibfile \EFrdd{(}\EFo{concat} base-dir \EFs{"bib.bib"}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}notes-dir \EFrdd{(}\EFo{concat} base-dir \EFs{"notes/"}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}roam-notes-dir \EFrdd{(}\EFo{concat} \EFv{org-roam-directory} \EFs{"/"}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}lib-dir \EFrdd{(}\EFo{concat} base-dir \EFs{"papers/"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{bibtex-completion-bibliography} bibfile
        \EFv{bibtex-completion-library-path} \EFhq{`}\EFrdc{(},lib-dir\EFrdc{)}
        \EFv{bibtex-completion-notes-path} roam-notes-dir
        \EFv{bibtex-completion-pdf-field} \EFs{"file"}
        \EFv{citar-bibliography} \EFhq{`}\EFrdc{(},bibfile\EFrdc{)}
        \EFv{citar-library-paths} \EFhq{`}\EFrdc{(},lib-dir\EFrdc{)}
        \EFv{citar-notes-paths} \EFhq{`}\EFrdc{(},roam-notes-dir\EFrdc{)}
        \EFv{deft-directory} roam-notes-dir
        \EFv{deft-default-extension} \EFs{"org"}
        \EFv{org-noter-notes-search-path} \EFhq{`}\EFrdc{(},roam-notes-dir\EFrdc{)}
        \EFv{org-cite-global-bibliography} \EFhq{`}\EFrdc{(},bibfile\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{bibtex-completion-notes-template-multiple-files}
      \EFrdb{(}\EFo{concat}
       \EFs{"\#+TITLE: \$\{title\}\char92{}n"}
       \EFs{"\#+ROAM\_KEY: cite:\$\{=key=\}\char92{}n"}
       \EFs{"*} \textcolor[HTML]{ECBE7B}{\textbf{TODO}} \EFs{Notes\char92{}n"}
       \EFs{":PROPERTIES:\char92{}n"}
       \EFs{":Custom\_ID: \$\{=key=\}\char92{}n"}
       \EFs{":NOTER\_DOCUMENT: \%(orb-process-file-field \char92{}"\$\{=key=\}\char92{}")\char92{}n"}
       \EFs{":AUTHOR: \$\{author-abbrev\}\char92{}n"}
       \EFs{":JOURNAL: \$\{journaltitle\}\char92{}n"}
       \EFs{":DATE: \$\{date\}\char92{}n"}
       \EFs{":YEAR: \$\{year\}\char92{}n"}
       \EFs{":DOI: \$\{doi\}\char92{}n"}
       \EFs{":URL: \$\{url\}\char92{}n"}
       \EFs{":END:\char92{}n\char92{}n"}
       \EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{setq} \EFv{org-export-with-sub-superscripts} \EFs{"\{\}"}
      \EFv{org-export-with-smart-quotes} nil\EFrda{)}

\EFcd{;} \textcolor[HTML]{ECBE7B}{\textbf{TODO}} \EFc{workaround for emacs <30, remove in emacs 30}
\EFrda{(}\EFk{setq} \EFv{major-mode-remap-alist} \EFv{major-mode-remap-defaults}\EFrda{)}

\EFrda{(}\EFk{after!} latex
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{engrave-faces}\EFrdb{)}
  \EFrdb{(}\EFo{engrave-faces-use-theme} \EFhq{'}\EFhs{doom-one}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{org-preview-latex-process-alist}
   \EFhq{'}\EFrdb{(}\EFrdc{(}dvipng \EFb{:programs}
      \EFrdd{(}\EFs{"dvilualatex"} \EFs{"dvipng"}\EFrdd{)}
      \EFb{:description} \EFs{"dvi > png"} \EFb{:message} \EFs{"you need to install the programs: dvilualatex and dvipng."} \EFb{:image-input-type} \EFs{"dvi"} \EFb{:image-output-type} \EFs{"png"} \EFb{:image-size-adjust}
      \EFrdd{(}\EFhn{1.0} . \EFhn{1.0}
\EFrdd{)}
      \EFb{:latex-compiler}
      \EFrdd{(}\EFs{"dvilualatex -interaction nonstopmode -output-directory \%o \%f"}\EFrdd{)}
      \EFb{:image-converter}
      \EFrdd{(}\EFs{"dvipng -D \%D -T tight -o \%O \%f"}\EFrdd{)}
      \EFb{:transparent-image-converter}
      \EFrdd{(}\EFs{"dvipng -D \%D -T tight -bg Transparent -o \%O \%f"}\EFrdd{)}\EFrdc{)}
     \EFrdc{(}dvisvgm \EFb{:programs}
      \EFrdd{(}\EFs{"lualatex"} \EFs{"dvisvgm"}\EFrdd{)}
      \EFb{:description} \EFs{"dvi > svg"} \EFb{:message} \EFs{"you need to install the programs: lualatex and dvisvgm."} \EFb{:image-input-type} \EFs{"dvi"} \EFb{:image-output-type} \EFs{"svg"} \EFb{:image-size-adjust}
      \EFrdd{(}\EFhn{1.7} . \EFhn{1.5}\EFrdd{)}
      \EFb{:latex-compiler}
      \EFrdd{(}\EFs{"lualatex -interaction nonstopmode -output-directory \%o \%f"}\EFrdd{)}
      \EFb{:image-converter}
      \EFrdd{(}\EFs{"dvisvgm \%f -n -b min -c \%S -o \%O"}\EFrdd{)}\EFrdc{)}
     \EFrdc{(}imagemagick \EFb{:programs}
      \EFrdd{(}\EFs{"lualatex"} \EFs{"convert"}\EFrdd{)}
      \EFb{:description} \EFs{"pdf > png"} \EFb{:message} \EFs{"you need to install the programs: lualatex and imagemagick."} \EFb{:image-input-type} \EFs{"pdf"} \EFb{:image-output-type} \EFs{"png"} \EFb{:image-size-adjust}
      \EFrdd{(}\EFhn{1.0} . \EFhn{1.0}\EFrdd{)}
      \EFb{:latex-compiler}
      \EFrdd{(}\EFs{"lualatex -interaction nonstopmode -output-directory \%o \%f"}\EFrdd{)}
      \EFb{:image-converter}
      \EFrdd{(}\EFs{"convert -density \%D -trim -antialias \%f -quality 100 \%O"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{latex-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{PDF and Annotation Tweaks}
\label{sec:org8406366}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{pdf-and-annotation-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org6368b13}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} org-noter\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org7ee8973}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{use-package!} org-noter
  \EFb{:after} \EFrdb{(}\EFb{:any} org pdf-view\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{setq}
   \EFcd{;;} \EFc{Please stop opening frames}
   \EFv{org-noter-always-create-frame} nil
   \EFv{org-noter-notes-window-location} \EFhq{'}\EFhs{horizontal-split}
   \EFcd{;;} \EFc{I want to see the whole file}
   \EFv{org-noter-hide-other} nil
   \EFv{org-noter-auto-save-last-location} t
   \EFv{org-noter-suggest-from-attachments} t
   \EFv{org-noter-doc-split-percentage} \EFhq{'}\EFrdc{(}\EFhn{0.7} . \EFhn{0.3}\EFrdc{)}
   \EFv{org-noter-doc-split-fraction} \EFhq{'}\EFrdc{(}\EFhn{0.7} . \EFhn{0.3}\EFrdc{)}
   \EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{org-noter-insert-short-note} \EFrdc{(}\EFrdc{)}
    \EFd{"Insert note and switch focus back to pdf."}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{save-window-excursion}
    \EFrdd{(}\EFo{org-noter-insert-note}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{citar-noter-resume} \EFrdc{(}\EFrdc{)}
    \EFd{"Open notes to a document and resume editing"}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFo{call-interactively} \EFhq{'}\EFhs{citar-open-notes}\EFrdc{)}
    \EFrdc{(}\EFo{evil-goto-line}\EFrdc{)}
    \EFrdc{(}\EFo{org-noter}\EFrdc{)}
    \EFrdc{(}\EFf{pdf-view-noter-keymap-load}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{pdf-view-high-contrast-theme} \EFrdc{(}\EFrdc{)}
    \EFd{"Sets black and white high contrast theme"}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFv{pdf-view-themed-minor-mode} \EFhn{-1}\EFrdc{)}
    \EFrdc{(}\EFk{setq} old-pdf-view-midnight-colors \EFv{pdf-view-midnight-colors}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{pdf-view-midnight-colors} \EFhq{'}\EFrdd{(}\EFs{"\#ffeeee"} . \EFs{"\#000000"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFv{pdf-view-midnight-minor-mode} \EFhn{1}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{pdf-view-undo-high-contrast-theme} \EFrdc{(}\EFrdc{)}
    \EFd{"Unsets black and white high contrast theme"}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFv{pdf-view-themed-minor-mode} \EFhn{-1}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{pdf-view-midnight-colors} old-pdf-view-midnight-colors\EFrdc{)}
    \EFrdc{(}\EFv{pdf-view-midnight-minor-mode} \EFhn{1}\EFrdc{)}\EFrdb{)}



  \EFrdb{(}\EFk{defun} \EFf{pdf-view-theme-cycle} \EFrdc{(}\EFrdc{)}
    \EFd{"Cycle between emacs, midnight and white theme"}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{cond}
     \EFrdd{(}\EFrda{(}\EFk{bound-and-true-p} \EFv{pdf-view-themed-minor-mode}\EFrda{)}
      \EFrda{(}\EFk{progn}
        \EFrdb{(}\EFv{pdf-view-themed-minor-mode} \EFhn{-1}\EFrdb{)}
        \EFrdb{(}\EFv{pdf-view-midnight-minor-mode} \EFhn{1}\EFrdb{)}\EFrda{)}\EFrdd{)}
     \EFrdd{(}\EFrda{(}\EFk{bound-and-true-p} \EFv{pdf-view-midnight-minor-mode}\EFrda{)}
      \EFrda{(}\EFk{progn}
        \EFrdb{(}\EFv{pdf-view-midnight-minor-mode} \EFhn{-1}\EFrdb{)}
        \EFrdb{(}\EFv{pdf-view-themed-minor-mode} \EFhn{-1}\EFrdb{)}\EFrda{)}\EFrdd{)}
     \EFrdd{(}t \EFrda{(}\EFk{progn}
          \EFrdb{(}\EFv{pdf-view-midnight-minor-mode} \EFhn{-1}\EFrdb{)}
          \EFrdb{(}\EFv{pdf-view-themed-minor-mode} \EFhn{1}\EFrdb{)}
          \EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-noter-new-heading} \EFrdb{(}\EFrdb{)}
  \EFd{"DOES NOT WORK: Copy the current heading and the next visible heading."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{org-noter--with-valid-session}
  \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}headline \EFrdb{(}\EFo{completing-read} \EFs{"New chapter title: "} nil\EFrdb{)}\EFrda{)}
        \EFrda{(}page \EFrdb{(}\EFo{format} \EFs{"\%s"} \EFrdc{(}\EFo{org-noter--get-location-page} \EFrdd{(}\EFo{org-noter--doc-approx-location}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrdd{)}
   \EFrdd{(}\EFk{save-excursion}
     \EFrda{(}\EFo{switch-to-buffer} \EFrdb{(}\EFo{org-noter--session-notes-buffer} session\EFrdb{)}\EFrda{)}
    \EFrda{(}\EFk{save-excursion}
      \EFcd{;;} \EFc{Move up to the top-level heading}
      \EFrdb{(}\EFo{org-up-heading-all} \EFhn{10}\EFrdb{)}
      \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}start \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFcd{;;} \EFc{Move to the next visible heading}
        \EFrdc{(}\EFo{org-next-visible-heading} \EFhn{1}\EFrdc{)}
        \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}end \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFcd{;;} \EFc{Copy the region from start to end}
          \EFrdd{(}\EFo{kill-ring-save} start end\EFrdd{)}
          \EFrdc{)}\EFrdb{)}\EFrda{)}
    \EFrda{(}\EFo{yank}\EFrda{)}
    \EFrda{(}\EFk{save-excursion}
      \EFrdb{(}\EFo{org-edit-headline} headline\EFrdb{)}
      \EFrdb{(}\EFo{org-set-property} \EFs{"NOTER\_PAGE"} page\EFrdb{)}
    \EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pdf-view-noter-keymap-load} \EFrdb{(}\EFrdb{)}
  \EFd{"Load org noter keymap for pdf-view"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:after} pdf-view
       \EFb{:map} \EFv{pdf-view-mode-map}
       \EFb{:n} \EFs{"n"} \EFhq{'}\EFhs{org-noter-insert-short-note}
       \EFb{:n} \EFs{"N"} \EFhq{'}\EFhs{org-noter-insert-note}
       \EFb{:n} \EFs{"r"} \EFhq{'}\EFhs{pdf-view-rotate}
       \EFb{:n} \EFs{"i"} \EFhq{'}\EFhs{pdf-view-theme-cycle}
       \EFb{:n} \EFs{"I"} \EFhq{'}\EFhs{pdf-view-high-contrast-theme}
       \EFb{:n} \EFs{"c"} \EFhq{'}\EFhs{org-noter-new-heading}
       \EFb{:ne} \EFs{"<down-mouse-1>"} \EFhq{'}\EFhs{ignore} \EFcd{;} \EFc{Because marking would reset rotation}
       \EFb{:n} \EFs{"+"} \EFhq{'}\EFhs{pdf-view-enlarge}
       \EFb{:n} \EFs{"-"} \EFhq{'}\EFhs{pdf-view-shrink}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFf{pdf-view-noter-keymap-load}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{pdf-view-resize-factor} \EFrdb{(}\EFo{/} \EFhn{5} \EFhn{3.0}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pdf-shrink} \EFrdb{(}\EFrdb{)}
  \EFd{"Shrink a pdf in pdf-view.}
\EFd{I'm not sure why pdf-view-resize-factor isn't consistent in both directions, so I need two seperate factors."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{pdf-view-enlarge} \EFhn{0.6}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pdf-enlarge} \EFrdb{(}\EFrdb{)}
  \EFd{"Enlarge a pdf in pdf-view.}
\EFd{I'm not sure why pdf-view-resize-factor isn't consistent in both directions, so I need two seperate factors."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{pdf-view-enlarge} \EFhn{0.8}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} pdf-view
  \EFrdb{(}\EFk{bind-key} \EFrdc{(}\EFo{kbd} \EFs{"C-s"}\EFrdc{)} \EFhq{'}\EFhs{pdf-occur} \EFv{pdf-view-mode-map}\EFrdb{)}
  \EFrdb{(}\EFk{bind-key} \EFrdc{(}\EFo{kbd} \EFs{"<C-mouse-4>"}\EFrdc{)} \EFhq{'}\EFhs{pdf-enlarge} \EFv{pdf-view-mode-map}\EFrdb{)}
  \EFrdb{(}\EFk{bind-key} \EFrdc{(}\EFo{kbd} \EFs{"<C-mouse-5>"}\EFrdc{)} \EFhq{'}\EFhs{pdf-shrink} \EFv{pdf-view-mode-map}\EFrdb{)}

  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFhs{pdf-view-hook} \EFhq{'}\EFv{pdf-view-themed-minor-mode}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{pdf-and-annotation-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Tolino}
\label{sec:orgfa5a8a1}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{tolino}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgf498802}
\subsubsection{Code}
\label{sec:org2a14b23}
\begin{Code}
\begin{Verbatim}
\color{EFD}
\EFrda{(}\EFk{setq} tolino-dir \EFs{"/home/user/dox/tolino/"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{citar-move-to-tolino} \EFrdb{(}keys-entries \EFt{\&optional} str\EFrdb{)}
  \EFd{"Search pdfs."}
  \EFrdb{(}\EFk{interactive} \EFrdc{(}\EFo{list} \EFrdd{(}\EFf{citar-select-refs}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}files \EFrda{(}\EFf{hash-table-to-value-list}
                \EFrdb{(}\EFf{citar-get-files}
                 keys-entries\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{cl-map} \EFhq{'}\EFhs{vector} \EFhq{\#'}\EFrdd{(}\EFk{lambda} \EFrda{(}f\EFrda{)} \EFrda{(}\EFo{copy-file} f tolino-dir \EFhn{1} t\EFrda{)}\EFrdd{)} files\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{tolino}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Secret Service Tweaks}
\label{sec:orgac448a5}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{secret-service-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org1ab011e}
\subsubsection{Code}
\label{sec:org56039fd}
\begin{Code}
\begin{Verbatim}
\color{EFD}  \EFcd{;;} \EFc{Load and patch secrets}
  \EFrda{(}\EFk{use-package!} secrets
    \EFb{:commands} \EFrdb{(}\EFo{secrets-search-items}
               secrets-get-secret
               secrets-get-attributes\EFrdb{)}
    \EFb{:config}
    \EFcd{;;} \EFc{Adds a patch to fix behavior with KeepassXC}
    \EFrdb{(}\EFk{defun} \EFf{secrets-unlock-item} \EFrdc{(}collection item\EFrdc{)}
      \EFd{"Unlock item labeled ITEM from collection labeled COLLECTION.}
    \EFd{If successful, return the object path of the item."}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}item-path \EFrdb{(}\EFo{secrets-item-path} collection item\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{unless} \EFrda{(}\EFv{secrets-empty-path} item-path\EFrda{)}
          \EFrda{(}\EFo{secrets-prompt}
           \EFrdb{(}\EFo{cadr}
            \EFrdc{(}\EFo{dbus-call-method}
             \EFb{:session} \EFv{secrets-service} \EFv{secrets-path} \EFv{secrets-interface-service}
             \EFs{"Unlock"} \EFhq{`}\EFrdd{(}\EFb{:array} \EFb{:object-path} ,item-path\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        item-path\EFrdc{)}\EFrdb{)}

    \EFcd{;;} \EFc{Adds a patch to fix behavior with KeepassXC}
    \EFrdb{(}\EFk{defun} \EFf{secrets-get-secret} \EFrdc{(}collection item\EFrdc{)}
      \EFd{"Return the secret of item labeled ITEM in COLLECTION.}
    \EFd{If there are several items labeled ITEM, it is undefined which}
    \EFd{one is returned.  If there is no such item, return nil.}

    \EFd{ITEM can also be an object path, which is used if contained in COLLECTION."}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}item-path \EFrdb{(}\EFf{secrets-unlock-item} collection item\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{unless} \EFrda{(}\EFv{secrets-empty-path} item-path\EFrda{)}
          \EFrda{(}\EFo{dbus-byte-array-to-string}
           \EFrdb{(}\EFo{nth} \EFhn{2}
                \EFrdc{(}\EFo{dbus-call-method}
                 \EFb{:session} \EFv{secrets-service} item-path \EFv{secrets-interface-item}
                 \EFs{"GetSecret"} \EFb{:object-path} \EFv{secrets-session-path}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{require} \EFhq{'}\EFo{async}\EFrda{)}
\EFrda{(}\EFk{defun} \EFf{secrets-get-secret-async} \EFrdb{(}db-name password-name variable\EFrdb{)}
  \EFrdb{(}\EFo{async-start}
   \EFcd{;} \EFc{Async function}
   \EFhq{`}\EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
      \EFrdd{(}\EFo{require} \EFhq{'}\EFo{secrets}\EFrdd{)}
      \EFrdd{(}\EFf{secrets-get-secret} ,db-name ,password-name\EFrdd{)}
      \EFrdc{)}

   \EFcd{;} \EFc{Callback}
   \EFhq{`}\EFrdc{(}\EFk{lambda} \EFrdd{(}result\EFrdd{)}
      \EFrdd{(}\EFk{setq} ,variable result\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrda{)}


\EFrda{(}\EFo{provide} \EFhq{'}\EFo{secret-service-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{AI Assistants}
\label{sec:org74b3bab}
\subsubsection{GPT.el Tweaks}
\label{sec:orgdf5ecab}
ChatGPT no longer useful because of API limits
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{gpt-el-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org820e373}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} gptel \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"karthink/gptel"}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:org63881d7}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{use-package!} gptel
  \EFb{:defer} t
  \EFb{:config}
  \EFcd{;}\EFc{(secrets-get-secret-async "Passwords" "ChatGPT API Key" 'gptel-api-key)}
  \EFrdb{(}\EFo{async-start}
   \EFcd{;} \EFc{Async function}
   \EFhq{`}\EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
      \EFrdd{(}\EFo{require} \EFhq{'}\EFo{secrets}\EFrdd{)}
      \EFrdd{(}\EFf{secrets-get-secret} \EFs{"Passwords"} \EFs{"Gemini API Key"}\EFrdd{)}
      \EFrdc{)}

   \EFcd{;} \EFc{Callback}
   \EFhq{`}\EFrdc{(}\EFk{lambda} \EFrdd{(}result\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{gptel-backend} \EFrda{(}\EFf{gptel-make-gemini} \EFs{"Gemini"} \EFb{:key} result \EFb{:stream} t\EFrda{)}
            \EFv{gptel--system-message} \EFs{""}
            \EFv{gptel-model} \EFhq{'}\EFhs{gemini-1.5-pro-latest}
    \EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{gpt-el-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Calendar Tweaks}
\label{sec:org48a42c0}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{calendar-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgef8d244}
\subsubsection{Code}
\label{sec:orgcf20393}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;} \EFc{deutsche Feiertage}
\EFcd{;;} \EFc{Show holidays in Org Agenda}
\EFrda{(}\EFk{setq} \EFv{org-agenda-include-diary} t\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{calendar-week-start-day} \EFhn{1}
      calendar-time-display-form \EFhq{'}\EFrdb{(}24-hours \EFs{":"} minutes\EFrdb{)}
      \EFv{calendar-date-style} \EFhq{'}\EFhs{european}
      \EFv{calendar-day-name-array} \EFrdb{[}\EFs{"Sonntag"} \EFs{"Montag"} \EFs{"Dienstag"} \EFs{"Mittwoch"}
                               \EFs{"Donnerstag"} \EFs{"Freitag"} \EFs{"Samstag"}\EFrdb{]}
      \EFv{calendar-month-name-array} \EFrdb{[}\EFs{"Januar"} \EFs{"Februar"} \EFs{"Mrz"} \EFs{"April"} \EFs{"Mai"}
                                 \EFs{"Juni"} \EFs{"Juli"} \EFs{"August"} \EFs{"September"}
                                 \EFs{"Oktober"} \EFs{"November"} \EFs{"Dezember"}\EFrdb{]}\EFrda{)}

\EFrda{(}\EFk{setq} solar-n-hemi-seasons
      \EFhq{'}\EFrdb{(}\EFs{"Frhlingsanfang"} \EFs{"Sommeranfang"} \EFs{"Herbstanfang"} \EFs{"Winteranfang"}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{setq} holiday-german-general-holidays
      \EFhq{'}\EFrdb{(}\EFrdc{(}holiday-fixed \EFhn{1} \EFhn{1} \EFs{"Neujahr"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{5} \EFhn{1} \EFs{"1. Mai"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{10} \EFhn{3} \EFs{"Tag der Deutschen Einheit"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} holiday-german-christian-holidays
      \EFhq{'}\EFrdb{(}\EFrdc{(}holiday-float \EFhn{12} \EFhn{0} \EFhn{-4} \EFs{"1. Advent"} \EFhn{24}\EFrdc{)}
        \EFrdc{(}holiday-float \EFhn{12} \EFhn{0} \EFhn{-3} \EFs{"2. Advent"} \EFhn{24}\EFrdc{)}
        \EFrdc{(}holiday-float \EFhn{12} \EFhn{0} \EFhn{-2} \EFs{"3. Advent"} \EFhn{24}\EFrdc{)}
        \EFrdc{(}holiday-float \EFhn{12} \EFhn{0} \EFhn{-1} \EFs{"4. Advent"} \EFhn{24}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{12} \EFhn{25} \EFs{"1. Weihnachtstag"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{12} \EFhn{26} \EFs{"2. Weihnachtstag"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{1} \EFhn{6} \EFs{"Heilige Drei Knige"}\EFrdc{)}
        \EFrdc{(}holiday-easter-etc \EFhn{-48} \EFs{"Rosenmontag"}\EFrdc{)}
        \EFrdc{(}holiday-easter-etc \EFhn{-3} \EFs{"Grndonnerstag"}\EFrdc{)}
        \EFrdc{(}holiday-easter-etc  \EFhn{-2} \EFs{"Karfreitag"}\EFrdc{)}
        \EFrdc{(}holiday-easter-etc   \EFhn{0} \EFs{"Ostersonntag"}\EFrdc{)}
        \EFrdc{(}holiday-easter-etc  \EFhn{+1} \EFs{"Ostermontag"}\EFrdc{)}
        \EFrdc{(}holiday-easter-etc \EFhn{+39} \EFs{"Christi Himmelfahrt"}\EFrdc{)}
        \EFrdc{(}holiday-easter-etc \EFhn{+49} \EFs{"Pfingstsonntag"}\EFrdc{)}
        \EFrdc{(}holiday-easter-etc \EFhn{+50} \EFs{"Pfingstmontag"}\EFrdc{)}
        \EFrdc{(}holiday-easter-etc \EFhn{+60} \EFs{"Fronleichnam"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{8} \EFhn{15} \EFs{"Mari Himmelfahrt"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{11} \EFhn{1} \EFs{"Allerheiligen"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{11} \EFhn{2} \EFs{"Allerseelen"}\EFrdc{)}
        \EFrdc{(}holiday-float \EFhn{11} \EFhn{3} \EFhn{1} \EFs{"Bu- und Bettag"} \EFhn{16}\EFrdc{)}
        \EFrdc{(}holiday-float \EFhn{11} \EFhn{0} \EFhn{1} \EFs{"Totensonntag"} \EFhn{20}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} holiday-filipino-general-holidays
      \EFhq{'}\EFrdb{(}\EFrdc{(}holiday-fixed \EFhn{1} \EFhn{23} \EFs{"1st Philippine Republic Day"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{4} \EFhn{9} \EFs{"Araw ng Kagitingan"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{6} \EFhn{12} \EFs{"Filipino Independence Day"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{8} \EFhn{21} \EFs{"Ninoy Aquino Day"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{9} \EFhn{3} \EFs{"Surrender of Tomoyuki Yamashita"}\EFrdc{)}
        \EFrdc{(}holiday-float \EFhn{8} \EFhn{1} \EFhn{-1} \EFs{"National Heros of the Philippines"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{12} \EFhn{30} \EFs{"Jose Rizal Day"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} holiday-filipino-christian-holidays
      \EFhq{'}\EFrdb{(}\EFrdc{(}holiday-fixed \EFhn{9} \EFhn{8} \EFs{"Feast of the Nativity of Mary"}\EFrdc{)}
        \EFrdc{(}holiday-fixed \EFhn{11} \EFhn{30} \EFs{"Bonifacio Day"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} holiday-us-elections
      \EFhq{'}\EFrdb{(}\EFrdc{(}holiday-sexp
       \EFhq{'}\EFrdd{(}if \EFrda{(}\EFo{zerop} \EFrdb{(}\EFv{\%} year \EFhn{4}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{calendar-gregorian-from-absolute}
             \EFrdb{(}\EFo{1+} \EFrdc{(}\EFo{calendar-dayname-on-or-before}
                   \EFhn{1} \EFrdd{(}\EFo{+} \EFhn{6} \EFrda{(}\EFf{calendar-absolute-from-gregorian}
                            \EFrdb{(}\EFo{list} \EFhn{11} \EFhn{1} year\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
       \EFs{"US Presidential Election"}\EFrdc{)}
\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{calendar-christian-all-holidays-flag} t
      \EFv{calendar-islamic-all-holidays-flag} t\EFrda{)}

\EFrda{(}\EFk{setq} calendar-holidays
      \EFrdb{(}\EFo{append} \EFv{holiday-general-holidays} \EFv{holiday-local-holidays} \EFv{holiday-other-holidays}
	      \EFv{holiday-solar-holidays} \EFv{holiday-christian-holidays} holiday-german-general-holidays holiday-german-christian-holidays holiday-us-elections \EFv{holiday-hebrew-holidays} \EFv{holiday-islamic-holidays} \EFv{holiday-oriental-holidays} holiday-filipino-general-holidays holiday-filipino-christian-holidays\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{=calendar-no-evil} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFf{=calendar}\EFrdb{)}
  \EFrdb{(}\EFv{evil-local-mode} nil\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-c"}\EFrdb{)} \EFhq{'}\EFhs{=calendar-no-evil}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{calendar-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Org GCal tweaks}
\label{sec:org62a08fc}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-g-cal-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Requirements}
\label{sec:org088638c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} org-gcal\EFrda{)}
\EFrda{(}\EFk{package!} request\EFrda{)}
\EFrda{(}\EFk{package!} alert\EFrda{)}
\EFrda{(}\EFk{package!} persist\EFrda{)}
\EFrda{(}\EFk{package!} aio\EFrda{)}
\EFrda{(}\EFk{package!} oauth2-auto\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:org84f01ff}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{require} \EFhq{'}\EFo{async}\EFrda{)}

\EFrda{(}\EFo{async-start}
 \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)}
   \EFrdc{(}\EFo{require} \EFhq{'}\EFo{secrets}\EFrdc{)}
   \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}cal1 \EFrdb{(}\EFf{secrets-get-secret} \EFs{"Passwords"} \EFs{"Org GCal Calendar 1"}\EFrdb{)}\EFrda{)}
         \EFrda{(}cal2 \EFrdb{(}\EFf{secrets-get-secret} \EFs{"Passwords"} \EFs{"Org GCal Calendar 2"}\EFrdb{)}\EFrda{)}\EFrdd{)}
     \EFhq{`}\EFrdd{(}
       \EFrda{(},cal1 .  \EFs{"\char126{}/sync/agenda/gcal.org"}\EFrda{)}
       \EFrda{(},cal2 .  \EFs{"\char126{}/sync/agenda/gcal.org"}\EFrda{)}
       \EFrdd{)}\EFrdc{)}\EFrdb{)}
 \EFrdb{(}\EFk{lambda} \EFrdc{(}result\EFrdc{)}
   \EFrdc{(}\EFk{setq} org-gcal-fetch-file-alist result\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} org-gcal-notify-p t
      plstore-cache-passphrase-for-symmetric-encryption t\EFrda{)}


\EFrda{(}\EFo{async-start}
 \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)}
   \EFrdc{(}\EFo{require} \EFhq{'}\EFo{secrets}\EFrdc{)}
   \EFhq{`}\EFrdc{(},\EFrdd{(}\EFf{secrets-get-secret} \EFs{"Passwords"} \EFs{"Org GCal Client ID"}\EFrdd{)}
     ,\EFrdd{(}\EFf{secrets-get-secret} \EFs{"Passwords"} \EFs{"Org GCal Client Secret"}\EFrdd{)}\EFrdc{)}
   \EFrdb{)}
 \EFrdb{(}\EFk{lambda} \EFrdc{(}result\EFrdc{)}
   \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}id \EFrdb{(}\EFo{nth} \EFhn{0} result\EFrdb{)}\EFrda{)}
         \EFrda{(}sc \EFrdb{(}\EFo{nth} \EFhn{1} result\EFrdb{)}\EFrda{)}
         \EFrdd{)}
     \EFrdd{(}\EFk{setq} org-gcal-client-id id
           org-gcal-client-secret sc\EFrdd{)}
     \EFrdd{(}org-gcal-reload-client-id-secret\EFrdd{)}
     \EFrdd{(}\EFo{require} \EFhq{'}\EFo{oauth2-auto}\EFrdd{)}
     \EFrdd{(}\EFo{require} \EFhq{'}\EFo{plstore}\EFrdd{)}
     \EFrdd{(}\EFo{require} \EFhq{'}\EFo{org-gcal}\EFrdd{)}
     \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-g-cal-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Thinkpad Tweaks}
\label{sec:org6458aba}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;}\EFc{(load-module 'thinkpad-tweaks)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org9191522}
\subsubsection{/etc/systemd/system/battery-threshold.service}
\label{sec:orge290ebb}
\begin{Code}
\begin{Verbatim}
\color{EFD}[\EFt{Unit}]
\EFv{Description}=Set battery charge control start and end thresholds

[\EFt{Service}]
\EFv{Type}=oneshot
\EFv{ExecStart}=/bin/bash -c \EFs{'[ -d /sys/class/power\_supply/BAT0 ] \&\& echo 40 > /sys/class/power\_supply/BAT0/charge\_control\_start\_threshold'}
\EFv{ExecStart}=/bin/bash -c \EFs{'[ -d /sys/class/power\_supply/BAT0 ] \&\& echo 60 > /sys/class/power\_supply/BAT0/charge\_control\_end\_threshold'}
\EFv{ExecStart}=/bin/bash -c \EFs{'[ -d /sys/class/power\_supply/BAT1 ] \&\& echo 40 > /sys/class/power\_supply/BAT1/charge\_control\_start\_threshold'}
\EFv{ExecStart}=/bin/bash -c \EFs{'[ -d /sys/class/power\_supply/BAT1 ] \&\& echo 60 > /sys/class/power\_supply/BAT1/charge\_control\_end\_threshold'}
\EFv{User}=root
\end{Verbatim}
\end{Code}
\subsubsection{/etc/systemd/system/battery-threshold.timer}
\label{sec:org4becde7}
\begin{Code}
\begin{Verbatim}
\color{EFD}[\EFt{Unit}]
\EFv{Description}=Run battery-threshold at startup

[\EFt{Timer}]
\EFv{OnStartupSec}=5min

[\EFt{Install}]
\EFv{WantedBy}=timers.target
\end{Verbatim}
\end{Code}
\subsubsection{Full Battery script}
\label{sec:org4704441}
Charges battery to 100\% full by undoing service, active until restart
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{\#}\EFc{!/bin/}\EFk{env} \EFc{sh}
\EFcd{\#} \EFc{Undoes battery-threshold.service and charges battery to 100\% until restart}
\EFcd{\#} \EFc{Run as root}

/bin/bash -c \EFs{'[ -d /sys/class/power\_supply/BAT0 ] \&\&} \textcolor[HTML]{98be65}{echo} \EFs{0 > /sys/class/power\_supply/BAT0/charge\_control\_start\_threshold'}
/bin/bash -c \EFs{'[ -d /sys/class/power\_supply/BAT0 ] \&\&} \textcolor[HTML]{98be65}{echo} \EFs{100 > /sys/class/power\_supply/BAT0/charge\_control\_end\_threshold'}
/bin/bash -c \EFs{'[ -d /sys/class/power\_supply/BAT1 ] \&\&} \textcolor[HTML]{98be65}{echo} \EFs{0 > /sys/class/power\_supply/BAT1/charge\_control\_start\_threshold'}
/bin/bash -c \EFs{'[ -d /sys/class/power\_supply/BAT1 ] \&\&} \textcolor[HTML]{98be65}{echo} \EFs{100 > /sys/class/power\_supply/BAT1/charge\_control\_end\_threshold'}
\end{Verbatim}
\end{Code}
\subsection{Nano Tweaks}
\label{sec:org98040be}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;}\EFc{(load-module 'nano-tweaks)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org5c24e18}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} nano \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"rougier/nano-emacs"}\EFrdb{)}\EFrda{)}
\EFcd{;}\EFc{(package! nano-theme :recipe (:host github :repo "rougier/nano-theme"))}
\EFrda{(}\EFk{package!} mu4e-dashboard \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"rougier/mu4e-dashboard"}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{package!} svg-tag-mode\EFrda{)}
\EFrda{(}\EFk{package!} ts\EFrda{)}
\EFrda{(}\EFk{package!} nano-sidebar \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"rougier/nano-sidebar"}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org6551a4e}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{require} \EFhq{'}\EFo{nano-base-colors}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{nano-faces}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{nano-help}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{nano-sidebar}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{nano-mu4e}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{mu4e-headers-sender-subject} \EFrdb{(}msg\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}thread  \EFrda{(}\EFf{mu4e-message-field} msg \EFb{:thread}\EFrda{)}\EFrdd{)}
         \EFrdd{(}level \EFrda{(}\EFo{plist-get} thread \EFb{:level}\EFrda{)}\EFrdd{)}
         \EFrdd{(}empty-parent \EFrda{(}\EFk{and} thread \EFrdb{(}\EFo{plist-get} thread \EFb{:empty-parent}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}child   \EFrda{(}\EFk{and} thread \EFrdb{(}\EFo{>} \EFrdc{(}\EFo{plist-get} thread \EFb{:level}\EFrdc{)} \EFhn{0}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}flagged \EFrda{(}\EFo{memq} \EFhq{'}\EFhs{flagged}  \EFrdb{(}\EFf{mu4e-message-field} msg \EFb{:flags}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}unread  \EFrda{(}\EFo{memq} \EFhq{'}\EFhs{unread}  \EFrdb{(}\EFf{mu4e-message-field} msg \EFb{:flags}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}replied \EFrda{(}\EFo{memq} \EFhq{'}\EFhs{replied} \EFrdb{(}\EFf{mu4e-message-field} msg \EFb{:flags}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}maildir \EFrda{(}mu4e-get-maildir msg\EFrda{)}\EFrdd{)}
         \EFrdd{(}inbox   \EFrda{(}\EFo{string=} maildir \EFs{"inbox"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}attachment \EFrda{(}\EFo{memq} \EFhq{'}\EFhs{attach} \EFrdb{(}\EFf{mu4e-message-field} msg \EFb{:flags}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}sent    \EFrda{(}\EFo{string=} maildir \EFs{"sent"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}tags    \EFrda{(}\EFf{mu4e-message-field} msg \EFb{:tags}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFo{list}    \EFrda{(}\EFf{mu4e-message-field} msg \EFb{:mailing-list}\EFrda{)}\EFrdd{)}
         \EFrdd{(}sender-name     \EFrda{(}\EFk{or} \EFrdb{(}\EFf{mu4e-message-field} \EFrdc{(}\EFo{car} \EFrdd{(}\EFf{mu4e-message-field} msg \EFb{:from}\EFrdd{)}\EFrdc{)} \EFb{:name}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}sender-address  \EFrda{(}\EFk{or} \EFrdb{(}\EFo{car} \EFrdc{(}\EFo{cdr} \EFrdd{(}\EFo{car} \EFrda{(}\EFf{mu4e-message-field} msg \EFb{:from}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}subject \EFrda{(}\EFf{mu4e-message-field} msg \EFb{:subject}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} messagemsg msg\EFrdc{)}
    \EFrdc{(}\EFo{concat}
     \EFrdd{(}\EFk{if} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{not} empty-parent\EFrdb{)} child\EFrda{)}
     \EFcd{;;} \EFc{(if (> level 0)}
         \EFrda{(}\EFo{propertize} \EFs{" "} \EFhq{'}\EFhs{face} \EFhq{`}\EFrdb{(}\EFb{:foreground} ,nano-color-subtle \EFb{:height} \EFhn{100}\EFrdb{)}\EFrda{)}\EFrdd{)}

     \EFrdd{(}mu4e-headers-button
      \EFrda{(}\EFo{string-pad} \EFrdb{(}\EFk{or} sender-name sender-address \EFs{"Unknown"}\EFrdb{)} \EFhn{40}\EFrda{)}
      \EFrda{(}\EFk{cond}  \EFrdb{(}\EFrdc{(}\EFk{and} child unread\EFrdc{)} \EFhq{'}\EFhs{nano-face-default}\EFrdb{)}
             \EFrdb{(}child              \EFhq{'}\EFhs{nano-face-faded}\EFrdb{)}
             \EFrdb{(}unread             \EFhq{'}\EFhs{nano-face-strong}\EFrdb{)}
             \EFrdb{(}t                  \EFhq{'}\EFhs{nano-face-strong}\EFrdb{)}\EFrda{)}

      \EFrda{(}\EFo{format} \EFs{"Mails from \%s"} sender-address\EFrda{)}
      \EFrda{(}\EFo{format} \EFs{"from:\%s"} sender-address\EFrda{)}\EFrdd{)}

     \EFrdd{(}\EFk{cond} \EFrda{(}unread \EFcd{;;}\EFc{(propertize "  " 'face 'nano-face-default))}
            \EFrdb{(}\EFo{propertize} \EFs{"  "} \EFhq{'}\EFhs{face} \EFhq{'}\EFrdc{(}\EFb{:height} \EFhn{100}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}inbox
            \EFrdb{(}\EFo{propertize} \EFs{"  "} \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{nano-face-faded}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFrdb{(}\EFk{or} \EFrdc{(}\EFo{not} child\EFrdc{)} empty-parent tags\EFrdb{)}
            \EFrdb{(}\EFo{propertize} \EFs{"  "} \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{nano-face-faded}\EFrdb{)}\EFrda{)}\EFrdd{)}


     \EFrdd{(}\EFk{if} \EFrda{(}\EFk{or} \EFrdb{(}\EFo{not} \EFv{mu4e-headers-show-threads}\EFrdb{)} \EFrdb{(}\EFo{not} child\EFrdb{)}\EFrda{)}
         \EFrda{(}\EFk{if} list \EFrdb{(}\EFo{concat} \EFrdc{(}mu4e-headers-button
                           \EFs{"[LIST]"}
                           \EFhq{'}\EFrdd{(}\EFb{:inherit} nano-face-faded\EFrdd{)}
                           \EFrdd{(}\EFo{format} \EFs{"Mails from/to \%s"} list\EFrdd{)}
                           \EFrdd{(}\EFo{format} \EFs{"list:\%s"} list\EFrdd{)}\EFrdc{)} \textcolor[HTML]{ECBE7B}{" "}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}\textcolor[HTML]{a9a1e1}{)}

     \EFrdd{(}\EFk{if} tags \EFrda{(}\EFo{concat}
               \EFrdb{(}\EFo{mapconcat}
                \EFrdc{(}\EFk{function} \EFrdd{(}\EFk{lambda} \EFrda{(}tag\EFrda{)}
                            \EFrda{(}mu4e-headers-button
                             \EFrdb{(}\EFo{format} \EFs{"[\%s]"} tag\EFrdb{)}
                             \EFhq{'}\EFrdb{(}\EFb{:inherit} \EFrdc{(}nano-face-salient nano-face-strong\EFrdc{)}\EFrdb{)}
                             \EFrdb{(}\EFo{format} \EFs{"Mails with tag \%s"} tag\EFrdb{)}
                             \EFrdb{(}\EFo{concat} \EFs{"tag:"} tag\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}  \EFwr{tags} \textcolor[HTML]{ECBE7B}{" "}\textcolor[HTML]{c678dd}{)} \textcolor[HTML]{ECBE7B}{" "}\textcolor[HTML]{51afef}{)}\textcolor[HTML]{a9a1e1}{)}

     \EFrdd{(}\EFk{if} \EFrda{(}\EFk{or} \EFrdb{(}\EFo{not} child\EFrdb{)} empty-parent\EFrda{)}
     \EFcd{;;} \EFc{(if (= level 0)}
         \EFrda{(}\EFo{propertize} subject \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{nano-face-default}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;}\EFc{(keymapp mu4e-headers-mode-map)}
\EFcd{;}\EFc{(keymapp "f")}


\EFrda{(}\EFk{defun} \EFf{mu4e-headers-button} \EFrdb{(}text face help query\EFrdb{)}
  \EFd{"Make a clickable button with specified FACE displaying TEXT.}
   \EFd{When hovered, HELP is displayed. When clicked, mu4e QUERY is executed."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFo{map} \EFrda{(}\EFo{make-sparse-keymap}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{set-keymap-parent} map \EFv{mu4e-headers-mode-map}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{[}mouse-1\EFrdd{]} \EFhq{`}\EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)}
                                 \EFrda{(}\EFk{interactive}\EFrda{)} \EFrda{(}\EFo{mu4e-headers-search} ,query\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{propertize} text
                \EFhq{'}\EFhs{face} face
                \EFhq{'}\EFhs{mouse-face} \EFhq{`}\EFrdd{(}\EFb{:foreground} ,nano-color-background
                              \EFb{:background} ,nano-color-faded\EFrdd{)}
                \EFhq{'}\EFhs{local-map} map
                \EFhq{'}\EFhs{help-echo} \EFhq{`}\EFrdd{(}\EFk{lambda} \EFrda{(}window \_object \_point\EFrda{)}
                              \EFrda{(}\EFk{let} \EFrdb{(}\EFv{message-log-max}\EFrdb{)} \EFrdb{(}\EFo{message} ,help\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{mu4e-headers-date-button} \EFrdb{(}date face\EFrdb{)}
  \EFrdb{(}\EFo{concat}
 \EFrdc{(}mu4e-headers-button \EFrdd{(}\EFo{format-time-string} \EFs{"\%Y"} date\EFrdd{)}
                        face
                        \EFrdd{(}\EFo{format-time-string} \EFs{"Mails from \%Y"} date\EFrdd{)}
                        \EFrdd{(}\EFo{format-time-string} \EFs{"date:\%Y"} date\EFrdd{)}\EFrdc{)}
   \EFrdc{(}\EFo{propertize} \EFs{"/"} \EFhq{'}\EFhs{face} face\EFrdc{)}
   \EFrdc{(}mu4e-headers-button \EFrdd{(}\EFo{format-time-string} \EFs{"\%m"} date\EFrdd{)}
                        face
                        \EFrdd{(}\EFo{format-time-string} \EFs{"Mails from \%B \%Y"} date\EFrdd{)}
                        \EFrdd{(}\EFo{format-time-string} \EFs{"date:\%Y\%m"} date\EFrdd{)}\EFrdc{)}
   \EFrdc{(}\EFo{propertize} \EFs{"/"} \EFhq{'}\EFhs{face} face\EFrdc{)}
   \EFrdc{(}mu4e-headers-button \EFrdd{(}\EFo{format-time-string} \EFs{"\%d"} date\EFrdd{)}
                        face
                        \EFrdd{(}\EFo{format-time-string} \EFs{"Mails from \%d \%B \%Y"} date\EFrdd{)}
                        \EFrdd{(}\EFo{format-time-string} \EFs{"date:\%Y\%m\%d"} date\EFrdd{)}\EFrdc{)}
     \EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{(setq package-install-upgrade-built-in t)}
\EFcd{;;} \EFc{(setq nano-font-size 10}
\EFcd{;;}       \EFc{nano-font-family-monospaced "Source Code Pro Semibold"}
\EFcd{;;}       \EFc{nano-modeline-position 'mode-line}
\EFcd{;;}       \EFc{nano-modeline-style '(3d accented)}
\EFcd{;;}       \EFc{doom-one-brighter-comments t)}

\EFcd{;;} \EFc{;;Default layout (optional)}
\EFcd{;;} \EFc{(require 'nano-layout)}

\EFcd{;;} \EFc{;; Theme}
\EFcd{;;} \EFc{(require 'nano-faces)}
\EFcd{;;} \EFc{(require 'nano-theme)}
\EFcd{;;} \EFc{(require 'nano-theme-dark)}
\EFcd{;;} \EFc{(require 'nano-theme-light)}

\EFcd{;;} \EFc{(set-face-attribute 'default nil :family "Source Code Pro" :weight 'semibold)}
\EFcd{;;} \EFc{(set-face-attribute 'bold nil :family "Source Code Pro" :weight 'black)}
\EFcd{;;} \EFc{(require 'nano-writer)}

\EFcd{;;} \EFc{(nano-theme-set-dark)}
\EFcd{;;} \EFc{(call-interactively 'nano-refresh-theme)}
\EFcd{;;} \EFc{(load-theme doom-theme)}

\EFcd{;;} \EFc{;; Nano session saving (optional)}
\EFcd{;;} \EFc{;(require 'nano-session)}

\EFcd{;;} \EFc{;; Nano header \& mode lines (optional)}
\EFcd{;;} \EFc{;(require 'nano-modeline)}

\EFcd{;;} \EFc{;(setq widget-image-enable nil)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{nano-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{External Tui}
\label{sec:orgf279e50}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{external-tui}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org4cb04ca}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} eee
      \EFb{:recipe}
      \EFrdb{(}\EFb{:host} github
       \EFb{:repo} \EFs{"eval-exec/eee.el"}
       \EFb{:files} \EFrdc{(}\EFb{:defaults} \EFs{"*.el"} \EFs{"*.sh"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org12c594f}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;}\EFc{(setq ee-terminal-command "wezterm")}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{eee}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{ee-terminal-command} \EFs{"kitty"}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-S-SPC"}\EFrdb{)} \EFhq{'}\EFhs{ee-yazi}\EFrda{)}
\EFrda{(}\EFk{map!} \EFb{:leader} \EFs{"y"} \EFhq{'}\EFhs{ee-yazi}\EFrda{)}
\EFcd{;}\EFc{(exwm-input--update-global-prefix-keys)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{external-tui}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Bible}
\label{sec:org0b78451}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{bible}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org8b201ea}
\subsubsection{Code}
\label{sec:orgd47e3df}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;;} \EFc{bible.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{defun} \EFf{bible-books-long} \EFrdb{(}binary\EFrdb{)}
  \EFd{"Return list of books of the Bible"}
  \EFrdb{(}\EFo{split-string-and-unquote} \EFrdc{(}\EFo{shell-command-to-string} \EFrdd{(}\EFo{format} \EFs{"\%s -l | awk 'NF\{NF--\}; 1' | sed '}\textcolor[HTML]{a9a1e1}{1s/\char94{}\char92{}xEF\char92{}xBB\char92{}xBF//}\EFs{'"} binary\EFrdd{)}\EFrdc{)} \EFs{"\char92{}n"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-books-short} \EFrdb{(}binary\EFrdb{)}
  \EFd{"Return list of abbreviated books of the Bible"}
  \EFrdb{(}\EFo{split-string-and-unquote} \EFrdc{(}\EFo{shell-command-to-string} \EFrdd{(}\EFo{format} \EFs{"\%s -l | awk '\{print \$(NF)\}' | sed 's/\char94{}}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{(//;s/}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{)\$//;1s/\char94{}\char92{}xEF\char92{}xBB\char92{}xBF//'"} binary\EFrdd{)}\EFrdc{)} \EFs{"\char92{}n"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-text} \EFrdb{(}binary book-chapter-and-verse\EFrdb{)}
  \EFd{"Return text of Bible binary at specified book, chapter and verse"}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}bcv1 \EFrda{(}\EFo{string-replace} \EFs{"."} \EFs{""} book-chapter-and-verse\EFrda{)}\EFrdd{)}
         \EFrdd{(}bcv \EFrda{(}\EFo{string-replace} \EFs{","} \EFs{":"} bcv1\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{shell-command-to-string} \EFrdd{(}\EFo{format} \EFs{"\%s \%s | sed '}\textcolor[HTML]{a9a1e1}{s/\char92{}r//g}\EFs{'"} binary \EFrda{(}\EFo{replace-regexp-in-string} \EFs{"\char92{}n"} \EFs{""} bcv\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} bible-minor-mode--last-book \EFs{""}
      bible-minor-mode--last-chapter-and-verse \EFs{""}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-select-internal} \EFrdb{(}binary\EFrdb{)}
  \EFd{"Ask user to select bible verse using kjv-like binary"}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}book \EFrda{(}\EFo{ivy-read} \EFs{"Select Book: "} \EFrdb{(}\EFf{bible-books-long} binary\EFrdb{)} \EFb{:preselect} bible-minor-mode--last-book\EFrda{)}\EFrdd{)}
         \EFrdd{(}chapter-and-verse \EFrda{(}\EFo{ivy-read} \EFrdb{(}\EFo{format} \EFs{"Choose Chapter and Verse of \%s: "} book\EFrdb{)} \EFhq{'}\EFrdb{(}\EFrdb{)} \EFb{:initial-input} bible-minor-mode--last-chapter-and-verse\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} bible-minor-mode--last-book book
          bible-minor-mode--last-chapter-and-verse chapter-and-verse\EFrdc{)}
    \EFhq{`}\EFrdc{(},book ,chapter-and-verse\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{bible-select} \EFrdb{(}binary\EFrdb{)}
  \EFd{"Ask user to select bible verse using kjv-like binary"}
 \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}pair \EFrda{(}\EFf{bible-select-internal} binary\EFrda{)}\EFrdd{)}
       \EFrdd{(}book \EFrda{(}\EFo{car} pair\EFrda{)}\EFrdd{)}
       \EFrdd{(}chapter-and-verse \EFrda{(}\EFo{car} \EFrdb{(}\EFo{cdr} pair\EFrdb{)}\EFrda{)}\EFrdd{)}
       \EFrdc{)}
    \EFrdc{(}\EFo{format} \EFs{"\%s \%s"} book chapter-and-verse\EFrdc{)}\EFrdb{)}\EFrda{)}



\EFrda{(}\EFk{defun} \EFf{bible-insert} \EFrdb{(}\EFt{\&optional} verse\EFrdb{)}
  \EFd{"Inserts text of the Bible of selected verse"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} verse
      \EFrdc{(}\EFo{insert} \EFrdd{(}\EFf{bible-text} \EFrda{(}\EFf{bible-minor-mode--default-bible-binary}\EFrda{)} verse\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFf{bible-text} \EFrda{(}\EFf{bible-minor-mode--default-bible-binary}\EFrda{)} \EFrda{(}\EFf{bible-select} \EFrdb{(}\EFf{bible-minor-mode--default-bible-binary}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{kjv} \EFrdb{(}\EFrdb{)}
  \EFd{"Insert Bible Verse from the King James Version"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}bin \EFs{"kjv"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFf{bible-text} bin \EFrda{(}\EFf{bible-select} bin\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{menge} \EFrdb{(}\EFrdb{)}
  \EFd{"Insert Bible Verse from the Menge Bible"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}bin \EFs{"menge"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFf{bible-text} bin \EFrda{(}\EFf{bible-select} bin\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{vul} \EFrdb{(}\EFrdb{)}
  \EFd{"Insert Bible Verse from the Vulgate"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}bin \EFs{"vul"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFf{bible-text} bin \EFrda{(}\EFf{bible-select} bin\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{sxx} \EFrdb{(}\EFrdb{)}
  \EFd{"Insert Bible Verse from the Septuagint"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}bin \EFs{"grb"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFf{bible-text} bin \EFrda{(}\EFf{bible-select} bin\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{grb} \EFrdb{(}\EFrdb{)}
  \EFd{"Insert Bible Verse from the Septuagint"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFf{sxx}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} bible-minor-mode--bible-binary-list \EFhq{'}\EFrdb{(}\EFs{"menge"} \EFs{"kjv"} \EFs{"vul"} \EFs{"grb"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-minor-mode--default-bible-binary} \EFrdb{(}\EFrdb{)}
  \EFd{"Default bible binary to use"}
  \EFrdb{(}\EFo{car} bible-minor-mode--bible-binary-list\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{set-bible-version} \EFrdb{(}\EFrdb{)}
  \EFd{"Change the version of the bible"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}s
         \EFrda{(}\EFo{ivy-read} \EFs{"Select bible version: "} bible-minor-mode--bible-binary-list \EFb{:require-match} t \EFb{:preselect} \EFrdb{(}\EFf{bible-minor-mode--default-bible-binary}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} bible-minor-mode--bible-binary-list \EFrdd{(}\EFo{append} \EFhq{`}\EFrda{(},s\EFrda{)} \EFrda{(}\EFo{delete} s bible-minor-mode--bible-binary-list\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFrdd{(}\EFf{bible-minor-mode--default-bible-binary}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{cycle-bible-version} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{setq} bible-minor-mode--bible-binary-list \EFrdc{(}\EFo{append} \EFrdd{(}\EFo{cdr-safe} bible-minor-mode--bible-binary-list\EFrdd{)} \EFhq{`}\EFrdd{(},\EFrda{(}\EFo{car} bible-minor-mode--bible-binary-list\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;} \EFc{Bible Mode}

\EFrda{(}\EFk{defun} \EFf{bible-mode--current-verse} \EFrdb{(}\EFrdb{)}
  \EFd{"Current Verse at point"}
  \EFrdb{(}\EFo{message}
   \EFrdc{(}\EFk{save-excursion}
     \EFrdd{(}\EFo{car} \EFrda{(}\EFo{s-split-up-to} \EFs{"\char92{}t"} \EFrdb{(}\EFo{thing-at-point} \EFhq{'}\EFhs{line}\EFrdb{)} \EFhn{1}\EFrda{)}\EFrdd{)}
     \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-mode--goto-verse} \EFrdb{(}verse\EFrdb{)}
  \EFrdb{(}\EFo{goto-char} \EFhn{0}\EFrdb{)}
  \EFrdb{(}\EFo{search-forward} verse\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{define-derived-mode} \EFf{bible-mode} text-mode \EFrdb{(}\EFf{bible-minor-mode--default-bible-binary}\EFrdb{)} \EFd{"Major mode for reading the Bible."}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{bible-mode-map}
      \EFb{:n} \EFs{"x"} \EFhq{\#'}\EFhs{bible-mode--cycle-version}\EFrda{)}

\EFcd{;;;} \EFc{Bible Minor Mode}
\EFrda{(}\EFk{defun} \EFf{bible-tooltip} \EFrdb{(}window object pos\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}verse \EFrda{(}\EFf{bible-mode--current-verse}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFv{tooltip-mode} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFk{setq} bible-minor-mode--last-verse verse\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}bible-verse \EFrdb{(}\EFf{bible-text} \EFrdc{(}\EFf{bible-minor-mode--default-bible-binary}\EFrdc{)} verse\EFrdb{)}\EFrda{)}\EFrdd{)}
                                        \EFcd{;}\EFc{(message bible-verse)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{>} \EFrdb{(}\EFo{length} bible-verse\EFrdb{)} \EFhn{2000}\EFrda{)}
          \EFrda{(}\EFo{substring} bible-verse \EFhn{0} \EFhn{2000}\EFrda{)}
        bible-verse\EFrdd{)}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-show-verse} \EFrdb{(}\EFrdb{)}
  \EFd{"Shows tooltip for verse at point"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{setq} bible-minor-mode--last-verse nil\EFrdb{)}
  \EFrdb{(}\EFo{tooltip-show} \EFrdc{(}\EFf{bible-tooltip} nil nil \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-minor-mode-highlight} \EFrdb{(}\EFrdb{)}
  \EFd{"Highlight bible verses"}
  \EFrdb{(}\EFo{font-lock-add-keywords} nil \EFhq{`}\EFrdc{(}\EFrdd{(},bible-minor-mode--bible-verse-regex \EFhn{0} \EFhq{'}\EFrda{(}face \EFv{font-lock-keyword-face} help-echo bible-tooltip\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{font-lock-flush}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-minor-mode-revert} \EFrdb{(}\EFrdb{)}
  \EFd{"Undo highlight bible verses"}
  \EFrdb{(}\EFo{font-lock-remove-keywords} nil \EFhq{`}\EFrdc{(}\EFrdd{(},bible-minor-mode--bible-verse-regex \EFhn{0} \EFhq{'}\EFrda{(}face \EFv{font-lock-keyword-face} help-echo bible-tooltip\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{font-lock-flush}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{define-minor-mode} \EFv{bible-minor-mode}
  \EFd{"Highlight bible verses and provide tooltips for them"}
  \EFb{:lighter} \EFs{" "}
  \EFb{:global} nil
  \EFrdb{(}\EFk{if} \EFv{bible-minor-mode}
      \EFrdc{(}\EFf{bible-minor-mode-highlight}\EFrdc{)}
    \EFrdc{(}\EFf{bible-minor-mode-revert}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{org-mode-hook} \EFhq{'}\EFv{bible-minor-mode}\EFrda{)}

\EFrda{(}\EFk{setq} bible-books-short-manual-additions \EFhq{'}\EFrdb{(}\EFs{"Gen"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-books-regex} \EFrdb{(}\EFrdb{)}
  \EFd{"Combines all bible books into a partial regex"}
  \EFrdb{(}\EFf{string-join} \EFrdc{(}\EFo{append} \EFrdd{(}\EFf{bible-books-short} \EFs{"kjv"}\EFrdd{)}
                       \EFrdd{(}\EFf{bible-books-long} \EFs{"kjv"}\EFrdd{)}
                       \EFrdd{(}\EFf{bible-books-short} \EFs{"menge"}\EFrdd{)}
                       \EFrdd{(}\EFf{bible-books-long} \EFs{"menge"}\EFrdd{)}
                       bible-books-short-manual-additions\EFrdc{)}
               \EFs{"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{"}\EFrdb{)}\EFrda{)}


\EFs{"Creates a regex for verses of all bible books"}
\EFrda{(}\EFk{when} \EFrdb{(}\EFo{not} \EFrdc{(}\EFo{boundp} \EFhq{'}\EFhs{bible-minor-mode--bible-verse-regex}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{setq} bible-minor-mode--bible-verse-regex
        \EFrdc{(}\EFo{format}
         \EFs{"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{\%s}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[[:digit:]]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{\char92{}\char92{}:}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{\char92{}\char92{},}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{[[:digit:]]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{?}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{-[[:digit:]]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{\char92{}\char92{}:}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{\char92{}\char92{},}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{[[:digit:]]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{?}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{?"}
         \EFrdd{(}\EFf{bible-books-regex}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                                        \EFcd{;}\EFc{bible-minor-mode--bible-verse-regex)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{bible}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{org-link-bible}
\label{sec:org4d6d823}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{ol-bible}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org8f02f3a}
\subsubsection{Code}
\label{sec:org5845a86}
\begin{Code}
\begin{Verbatim}
\color{EFD}                                        \EFcd{;} \EFc{Implements a link to a bible section or verse}
                                        \EFcd{;} \EFc{[[bible:Gen 1:1][Genesis 1:1]]}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{bible}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{ol}\EFrda{)}

\EFrda{(}\EFo{org-link-set-parameters} \EFs{"bible"}
                         \EFb{:follow} \EFhq{\#'}\EFhs{org-bible-open}
                         \EFb{:export} \EFhq{\#'}\EFhs{org-bible-export}
                         \EFb{:store} \EFhq{\#'}\EFhs{org-bible-store-link}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-bible-store-link} \EFrdb{(}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{define-derived-mode} \EFf{bible-view-mode} org-mode \EFrdb{(}\EFf{bible-minor-mode--default-bible-binary}\EFrdb{)}
  \EFd{"A mode to view the bible in."}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{bible-view-mode-map}
      \EFb{:nvi} \EFs{""} \EFhq{\#'}\EFhs{bible-view-cycle-language}
      \EFb{:nvi} \EFs{"x"} \EFhq{\#'}\EFhs{bible-view-cycle-language}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-view-cycle-language} \EFrdb{(}\EFrdb{)}
  \EFd{"Cycle the language in a bible view buffer."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFf{cycle-bible-version}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}pos \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{erase-buffer}\EFrdc{)}
    \EFrdc{(}\EFf{bible-insert} \EFrdd{(}\EFf{org-bible-get-chapter-verse}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} pos\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-view} \EFrdb{(}\EFrdb{)}
  \EFd{"View a passage of the Bible"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFf{org-bible-open} \EFrdc{(}\EFf{bible-select} \EFrdd{(}\EFf{bible-minor-mode--default-bible-binary}\EFrdd{)}\EFrdc{)} nil\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{org-bible-open} \EFrdb{(}chapter-verse \_\EFrdb{)}
  \EFd{"Visit the bible page on CHAPTER-VERSE."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}buf \EFrda{(}\EFo{get-buffer-create} \EFrdb{(}\EFo{format} \EFs{"*Bible: \%s*"} chapter-verse\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} buf
      \EFrdd{(}\EFo{erase-buffer}\EFrdd{)}
      \EFrdd{(}\EFf{bible-view-mode}\EFrdd{)}
      \EFrdd{(}\EFf{bible-insert} chapter-verse\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFhn{0}\EFrdd{)}
                                        \EFcd{;}\EFc{(bible-mode 1)}
      \EFrdc{)}
    \EFrdc{(}\EFo{display-buffer} buf \EFhq{'}\EFrdd{(}\EFrda{(}\EFo{display-buffer-pop-up-window}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFcd{;;} \EFc{(defun org-man-store-link (\&optional \_interactive?)}
\EFcd{;;}   \EFc{"Store a link to a bible page."}
\EFcd{;;}   \EFc{(when (memq major-mode '(bible-mode))}
\EFcd{;;}     \EFc{;; This is a man page, we do make this link.}
\EFcd{;;}     \EFc{(let* ((page (org-man-get-page-name))}
\EFcd{;;}            \EFc{(link (concat "man:" page))}
\EFcd{;;}            \EFc{(description (format "Man page for \%s" page)))}
\EFcd{;;}       \EFc{(org-link-store-props}
\EFcd{;;}        \EFc{:type "man"}
\EFcd{;;}        \EFc{:link link}
\EFcd{;;}        \EFc{:description description))))}

\EFrda{(}\EFk{defun} \EFf{org-bible-get-chapter-verse} \EFrdb{(}\EFrdb{)}
  \EFd{"Extract the bible chapter and verse from the buffer name."}
  \EFcd{;;} \EFc{This works for `}\textcolor[HTML]{a9a1e1}{bible-view-mode}\EFc{'.}
  \EFrdb{(}\EFk{if}
      \EFrdc{(}\EFo{string-match} \EFs{"\char92{}\char92{}*Bible:} \textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}*"} \EFrdd{(}\EFo{buffer-name}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFo{match-string} \EFhn{1} \EFrdd{(}\EFo{buffer-name}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{error} \EFs{"Cannot find bible chapter"}\EFrdc{)}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{bible-book-normalize} \EFrdb{(}book-name\EFrdb{)}
  \EFd{"Normalizes the name of Bible books"}
  \EFrdb{(}\EFk{let*} \EFrdc{(}
        \EFrdd{(}book-names \EFhq{'}\EFrda{(}\EFs{"Ge"} \EFs{"Prv"} \EFs{"1Chr"} \EFs{"2Chr"} \EFs{"1Sm"} \EFs{"2Sm"} \EFs{"1Cor"} \EFs{"2Cor"} \EFs{"1Pet"} \EFs{"2Pet"} \EFs{"1Jn"} \EFs{"2Jn"}\EFrda{)}\EFrdd{)}
        \EFrdd{(}book-names-normal \EFhq{'}\EFrda{(}\EFs{"Gen"} \EFs{"Pro"} \EFs{"IChr"} \EFs{"IIChr"} \EFs{"ISam"} \EFs{"IISam"} \EFs{"ICor"} \EFs{"IICor"} \EFs{"IPet"} \EFs{"IIPet"} \EFs{"IJn"}, \EFs{"IIJn"}\EFrda{)}\EFrdd{)}
        \EFrdd{(}bn \EFrda{(}\EFf{get-corresponding-element} book-name book-names book-names-normal\EFrda{)}\EFrdd{)}
        \EFrdc{)}
    \EFrdc{(}\EFk{if} bn bn book-name\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-bible-export} \EFrdb{(}link description format \_\EFrdb{)}
  \EFd{"Export a bible link from Org files."}
  \EFrdb{(}\EFk{let*} \EFrdc{(}
         \EFrdd{(}short link\EFrdd{)}
         \EFrdd{(}long description\EFrdd{)}
         \EFrdd{(}s \EFrda{(}\EFo{split-string} short\EFrda{)}\EFrdd{)}
         \EFrdd{(}verse \EFrda{(}\EFo{car} \EFrdb{(}\EFo{last} s\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}bs \EFrda{(}\EFo{mapconcat} \EFhq{\#'}\EFrdb{(}\EFk{lambda} \EFrdc{(}a\EFrdc{)} \EFrdc{(}\EFo{format} \EFs{"\%s"} a\EFrdc{)}\EFrdb{)} \EFrdb{(}\EFo{butlast} s\EFrdb{)} \EFs{" "}\EFrda{)}\EFrdd{)}
         \EFrdd{(}book-short \EFrda{(}\EFf{bible-book-normalize} bs\EFrda{)}\EFrdd{)}
         \EFrdd{(}s2 \EFrda{(}\EFo{split-string} long\EFrda{)}\EFrdd{)}
         \EFrdd{(}bl \EFrda{(}\EFo{mapconcat} \EFhq{\#'}\EFrdb{(}\EFk{lambda} \EFrdc{(}a\EFrdc{)} \EFrdc{(}\EFo{format} \EFs{"\%s"} a\EFrdc{)}\EFrdb{)} \EFrdb{(}\EFo{butlast} s2\EFrdb{)} \EFs{" "}\EFrda{)}\EFrdd{)}
         \EFrdd{(}bl2 \EFrda{(}\EFf{get-corresponding-element} bs \EFrdb{(}\EFf{bible-books-short}\EFrdb{)} \EFrdb{(}\EFf{bible-books-long}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}book-long \EFrda{(}\EFf{bible-book-normalize} bl\EFrda{)}\EFrdd{)}
         \EFrdd{(}bbh \EFrda{(}\EFo{format} \EFs{"https://biblehub.com/\%s/\%s.htm"} \EFrdb{(}\EFo{downcase} \EFrdc{(}\EFo{string-replace} \EFs{" "} \EFs{"\_"} bl2\EFrdc{)}\EFrdb{)} \EFrdb{(}\EFo{string-replace} \EFs{":"} \EFs{"-"} \EFrdc{(}\EFo{car} \EFrdd{(}\EFo{split-string} verse \EFs{"-"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}desc \EFrda{(}\EFk{or} description link\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} bbh\EFrdc{)}
    \EFrdc{(}\EFk{pcase} format
      \EFrdd{(}\EFhq{`}\EFhs{html} \EFrda{(}\EFo{format} \EFs{"<a target=\char92{}"\_blank\char92{}" href=\char92{}"\%s\char92{}">\%s</a>"} path desc\EFrda{)}\EFrdd{)}
      \EFcd{;}\EFc{(`latex (format "\char92{}\char92{}textbv\{\%s\}\{\%s\} " book-short verse))}
      \EFrdd{(}\EFhq{`}\EFhs{latex} \EFrda{(}\EFo{format} \EFs{"\char92{}\char92{}href\{\%s\}\{\char92{}\char92{}englishverse\{\%s\}\{\%s\}\}"} bbh book-short verse\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFhq{`}\EFhs{texinfo} \EFrda{(}\EFo{format} \EFs{"@uref\{\%s,\%s\}"} path desc\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFhq{`}\EFhs{ascii} \EFrda{(}\EFo{format} \EFs{"\%s (\%s)"} desc path\EFrda{)}\EFrdd{)}
      \EFrdd{(}\_ path\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{get-corresponding-element} \EFrdb{(}element list1 list2\EFrdb{)}
  \EFd{"Return the corresponding element in LIST2 for ELEMENT in LIST1."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}index \EFrda{(}\EFo{cl-position} element list1 \EFb{:test} \EFhq{'}\EFhs{equal}\EFrda{)}\EFrdd{)}\EFrdc{)}  \EFcd{;} \EFc{Find the index of ELEMENT in LIST1}
    \EFrdc{(}\EFk{if} index
        \EFrdd{(}\EFo{nth} index list2\EFrdd{)}  \EFcd{;} \EFc{Return the corresponding element from LIST2}
      nil\EFrdc{)}\EFrdb{)}\EFrda{)}  \EFcd{;} \EFc{Return nil if ELEMENT is not found}



\EFrda{(}\EFk{defun} \EFf{org-bible-insert} \EFrdb{(}\EFrdb{)}
  \EFd{"Insert a link to a bible chapter and verse."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}

  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}bb \EFrda{(}\EFf{bible-minor-mode--default-bible-binary}\EFrda{)}\EFrdd{)}
         \EFrdd{(}pair \EFrda{(}\EFf{bible-select-internal} bb\EFrda{)}\EFrdd{)}
         \EFrdd{(}book-long \EFrda{(}\EFo{car} pair\EFrda{)}\EFrdd{)}
         \EFrdd{(}cv \EFrda{(}\EFo{car} \EFrdb{(}\EFo{cdr} pair\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}book-short \EFrda{(}\EFf{get-corresponding-element} book-long \EFrdb{(}\EFf{bible-books-long} bb\EFrdb{)} \EFrdb{(}\EFf{bible-books-short} bb\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFo{format} \EFs{"[[bible:\%s \%s][\%s \%s]]"} book-short cv book-long cv\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{ol-bible}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Workarounds}
\label{sec:org420b92f}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{workarounds}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgfca44cc}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;} \EFc{Temporary workaround, remove at emacs 29}
\EFrda{(}\EFk{package!} transient
      \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"magit/transient"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{package!} with-editor
          \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"magit/with-editor"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{unpin!} magit\EFrda{)}

\EFrda{(}\EFk{package!} diff-hl \EFb{:disable} t\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org57be451}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;}\EFc{(global-diff-hl-mode -1)}
\EFcd{;}\EFc{(remove-hook 'dired-mode-hook '+vc-gutter-enable-maybe-h)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{workarounds}\EFrda{)}
\end{Verbatim}
\end{Code}
\end{document}
