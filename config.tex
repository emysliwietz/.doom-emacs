% Created 2023-02-10 Fri 16:12
% Intended LaTeX compiler: lualatex
\documentclass[a4wide,10pt]{article}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\usepackage{polyglossia}
\setmainlanguage[variant=usmax]{english}
\author{Egidius Mysliwietz}
\date{\today}
\title{Emacs config}
\hypersetup{
 pdfauthor={Egidius Mysliwietz},
 pdftitle={Emacs config},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 28.2 (Org mode 9.6)}, 
 pdflang={English}}

% Setup for code blocks [1/2]

\usepackage{fvextra}

\fvset{%
  commandchars=\\\{\},
  highlightcolor=white!95!black!80!blue,
  breaklines=true,
  breaksymbol=\color{white!60!black}\tiny\ensuremath{\hookrightarrow}}

% Make line numbers smaller and grey.
\renewcommand\theFancyVerbLine{\footnotesize\color{black!40!white}\arabic{FancyVerbLine}}

\usepackage{xcolor}

% In case engrave-faces-latex-gen-preamble has not been run.
\providecolor{EfD}{HTML}{f7f7f7}
\providecolor{EFD}{HTML}{28292e}

% Define a Code environment to prettily wrap the fontified code.
\usepackage[breakable,xparse]{tcolorbox}
\DeclareTColorBox[]{Code}{o}%
{colback=EfD!98!EFD, colframe=EfD!95!EFD,
  fontupper=\footnotesize\setlength{\fboxsep}{0pt},
  colupper=EFD,
  IfNoValueTF={#1}%
  {boxsep=2pt, arc=2.5pt, outer arc=2.5pt,
    boxrule=0.5pt, left=2pt}%
  {boxsep=2.5pt, arc=0pt, outer arc=0pt,
    boxrule=0pt, leftrule=1.5pt, left=0.5pt},
  right=2pt, top=1pt, bottom=0.5pt,
  breakable}

% Support listings with captions
\usepackage{float}
\floatstyle{plain}
\newfloat{listing}{htbp}{lst}
\newcommand{\listingsname}{Listing}
\floatname{listing}{\listingsname}
\newcommand{\listoflistingsname}{List of Listings}
\providecommand{\listoflistings}{\listof{listing}{\listoflistingsname}}


% Setup for code blocks [2/2]: syntax highlighting colors

\newcommand\efstrut{\vrule height 2.1ex depth 0.8ex width 0pt}
\definecolor{EFD}{HTML}{bbc2cf}
\definecolor{EfD}{HTML}{282c34}
\newcommand{\EFD}[1]{\textcolor{EFD}{#1}} % default
\definecolor{EFh}{HTML}{5B6268}
\newcommand{\EFh}[1]{\textcolor{EFh}{#1}} % shadow
\definecolor{EFsc}{HTML}{98be65}
\newcommand{\EFsc}[1]{\textcolor{EFsc}{#1}} % success
\definecolor{EFw}{HTML}{ECBE7B}
\newcommand{\EFw}[1]{\textcolor{EFw}{#1}} % warning
\definecolor{EFe}{HTML}{ff6c6b}
\newcommand{\EFe}[1]{\textcolor{EFe}{#1}} % error
\definecolor{EFc}{HTML}{5B6268}
\newcommand{\EFc}[1]{\textcolor{EFc}{#1}} % font-lock-comment-face
\definecolor{EFcd}{HTML}{5B6268}
\newcommand{\EFcd}[1]{\textcolor{EFcd}{#1}} % font-lock-comment-delimiter-face
\definecolor{EFs}{HTML}{98be65}
\newcommand{\EFs}[1]{\textcolor{EFs}{#1}} % font-lock-string-face
\definecolor{EFd}{HTML}{83898d}
\newcommand{\EFd}[1]{\textcolor{EFd}{#1}} % font-lock-doc-face
\definecolor{EFm}{HTML}{a9a1e1}
\newcommand{\EFm}[1]{\textcolor{EFm}{#1}} % font-lock-doc-markup-face
\definecolor{EFk}{HTML}{51afef}
\newcommand{\EFk}[1]{\textcolor{EFk}{#1}} % font-lock-keyword-face
\definecolor{EFb}{HTML}{c678dd}
\newcommand{\EFb}[1]{\textcolor{EFb}{#1}} % font-lock-builtin-face
\definecolor{EFf}{HTML}{c678dd}
\newcommand{\EFf}[1]{\textcolor{EFf}{#1}} % font-lock-function-name-face
\definecolor{EFv}{HTML}{dcaeea}
\newcommand{\EFv}[1]{\textcolor{EFv}{#1}} % font-lock-variable-name-face
\definecolor{EFt}{HTML}{ECBE7B}
\newcommand{\EFt}[1]{\textcolor{EFt}{#1}} % font-lock-type-face
\definecolor{EFo}{HTML}{a9a1e1}
\newcommand{\EFo}[1]{\textcolor{EFo}{#1}} % font-lock-constant-face
\definecolor{EFwr}{HTML}{ECBE7B}
\newcommand{\EFwr}[1]{\textcolor{EFwr}{#1}} % font-lock-warning-face
\definecolor{EFnc}{HTML}{51afef}
\newcommand{\EFnc}[1]{\textcolor{EFnc}{\textbf{#1}}} % font-lock-negation-char-face
\definecolor{EFpp}{HTML}{51afef}
\newcommand{\EFpp}[1]{\textcolor{EFpp}{\textbf{#1}}} % font-lock-preprocessor-face
\definecolor{EFrc}{HTML}{51afef}
\newcommand{\EFrc}[1]{\textcolor{EFrc}{\textbf{#1}}} % font-lock-regexp-grouping-construct
\definecolor{EFrb}{HTML}{51afef}
\newcommand{\EFrb}[1]{\textcolor{EFrb}{\textbf{#1}}} % font-lock-regexp-grouping-backslash
\definecolor{Efob}{HTML}{23272e}
\newcommand{\EFob}[1]{\colorbox{Efob}{\efstrut{}#1}} % org-block
\definecolor{EFhn}{HTML}{da8548}
\newcommand{\EFhn}[1]{\textcolor{EFhn}{\textbf{#1}}} % highlight-numbers-number
\definecolor{EFhq}{HTML}{51afef}
\newcommand{\EFhq}[1]{\textcolor{EFhq}{#1}} % highlight-quoted-quote
\definecolor{EFhs}{HTML}{ECBE7B}
\newcommand{\EFhs}[1]{\textcolor{EFhs}{#1}} % highlight-quoted-symbol
\definecolor{EFrda}{HTML}{51afef}
\newcommand{\EFrda}[1]{\textcolor{EFrda}{#1}} % rainbow-delimiters-depth-1-face
\definecolor{EFrdb}{HTML}{c678dd}
\newcommand{\EFrdb}[1]{\textcolor{EFrdb}{#1}} % rainbow-delimiters-depth-2-face
\definecolor{EFrdc}{HTML}{98be65}
\newcommand{\EFrdc}[1]{\textcolor{EFrdc}{#1}} % rainbow-delimiters-depth-3-face
\definecolor{EFrdd}{HTML}{a9a1e1}
\newcommand{\EFrdd}[1]{\textcolor{EFrdd}{#1}} % rainbow-delimiters-depth-4-face
\definecolor{EFrde}{HTML}{4db5bd}
\newcommand{\EFrde}[1]{\textcolor{EFrde}{#1}} % rainbow-delimiters-depth-5-face
\definecolor{EFrdf}{HTML}{51afef}
\newcommand{\EFrdf}[1]{\textcolor{EFrdf}{#1}} % rainbow-delimiters-depth-6-face
\definecolor{EFrdg}{HTML}{c678dd}
\newcommand{\EFrdg}[1]{\textcolor{EFrdg}{#1}} % rainbow-delimiters-depth-7-face
\definecolor{EFrdh}{HTML}{98be65}
\newcommand{\EFrdh}[1]{\textcolor{EFrdh}{#1}} % rainbow-delimiters-depth-8-face
\definecolor{EFrdi}{HTML}{a9a1e1}
\newcommand{\EFrdi}[1]{\textcolor{EFrdi}{#1}} % rainbow-delimiters-depth-9-face
\usepackage{biblatex}
\addbibresource{/home/user/dox/bib/bib.bib}
\begin{document}

\maketitle
\tableofcontents


\section{Config}
\label{sec:org00a1e10}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{\$DOOMDIR/config.el -*- lexical-binding: t; -*-}

\EFcd{;; }\EFc{Place your private configuration here! Remember, you do not need to run 'doom}
\EFcd{;; }\EFc{sync' after modifying this file!}


\EFcd{;; }\EFc{Some functionality uses this to identify you, e.g. GPG configuration, email}
\EFcd{;; }\EFc{clients, file templates and snippets.}
\EFrda{(}\EFk{setq} \EFv{user-full-name} \EFs{"Egidius Mysliwietz"}
      \EFv{user-mail-address} \EFs{"egidius@mysliwietz.de"}
      \EFv{auth-sources} \EFhq{'}\EFrdb{(}\EFs{"\char126{}/.authinfo"}\EFrdb{)}
      \EFv{auth-source-cache-expiry} nil\EFrda{)}

\EFcd{;; }\EFc{Doom exposes five (optional) variables for controlling fonts in Doom. Here}
\EFcd{;; }\EFc{are the three important ones:}
\EFcd{;;}
\EFcd{;; }\EFc{+ `}\textcolor[HTML]{a9a1e1}{doom-font}\EFc{'}
\EFcd{;; }\EFc{+ `}\textcolor[HTML]{a9a1e1}{doom-variable-pitch-font}\EFc{'}
\EFcd{;; }\EFc{+ `}\textcolor[HTML]{a9a1e1}{doom-big-font}\EFc{' -- used for `}\textcolor[HTML]{a9a1e1}{doom-big-font-mode}\EFc{'; use this for}
\EFcd{;;   }\EFc{presentations or streaming.}
\EFcd{;;}
\EFcd{;; }\EFc{They all accept either a font-spec, font string ("Input Mono-12"), or xlfd}
\EFcd{;; }\EFc{font string. You generally only need these two:}
\EFcd{;; }\EFc{(setq doom-font (font-spec :family "monospace" :size 12 :weight 'semi-light)}
\EFcd{;;       }\EFc{doom-variable-pitch-font (font-spec :family "sans" :size 13))}

\EFcd{;; }\EFc{There are two ways to load a theme. Both assume the theme is installed and}
\EFcd{;; }\EFc{available. You can either set `}\textcolor[HTML]{a9a1e1}{doom-theme}\EFc{' or manually load a theme with the}
\EFcd{;; }\EFc{`}\textcolor[HTML]{a9a1e1}{load-theme}\EFc{' function. This is the default:}
\EFrda{(}\EFk{setq} \EFv{doom-theme} \EFhq{'}\EFhs{doom-one}\EFrda{)}
\EFrda{(}\EFk{custom-set-faces!}
  \EFhq{'}\EFrdb{(}doom-modeline-buffer-modified \EFb{:foreground} \EFs{"orange"}\EFrdb{)}
  \EFhq{'}\EFrdb{(}org-cite \EFb{:foreground} \EFs{"purple"}\EFrdb{)}
  \EFhq{'}\EFrdb{(}org-cite-key \EFb{:foreground} \EFs{"MediumPurple1"} \EFb{:slant} italic\EFrdb{)}\EFrda{)}


\EFcd{;; }\EFc{If you use `}\textcolor[HTML]{a9a1e1}{org}\EFc{' and don't want your org files in the default location below,}
\EFcd{;; }\EFc{change `}\textcolor[HTML]{a9a1e1}{org-directory}\EFc{'. It must be set before org loads!}
\EFrda{(}\EFk{setq} \EFv{org-directory} \EFs{"\char126{}/org/"}\EFrda{)}

\EFcd{;; }\EFc{This determines the style of line numbers in effect. If set to `}\textcolor[HTML]{a9a1e1}{nil}\EFc{', line}
\EFcd{;; }\EFc{numbers are disabled. For relative line numbers, set this to `}\textcolor[HTML]{a9a1e1}{relative}\EFc{'.}
\EFrda{(}\EFk{setq} \EFv{display-line-numbers-type} t\EFrda{)}


\EFcd{;; }\EFc{Here are some additional functions/macros that could help you configure Doom:}
\EFcd{;;}
\EFcd{;; }\EFc{- `}\textcolor[HTML]{a9a1e1}{load!}\EFc{' for loading external *.el files relative to this one}
\EFcd{;; }\EFc{- `}\textcolor[HTML]{a9a1e1}{use-package!}\EFc{' for configuring packages}
\EFcd{;; }\EFc{- `}\textcolor[HTML]{a9a1e1}{after!}\EFc{' for running code after a package has loaded}
\EFcd{;; }\EFc{- `}\textcolor[HTML]{a9a1e1}{add-load-path!}\EFc{' for adding directories to the `}\textcolor[HTML]{a9a1e1}{load-path}\EFc{', relative to}
\EFcd{;;   }\EFc{this file. Emacs searches the `}\textcolor[HTML]{a9a1e1}{load-path}\EFc{' when you load packages with}
\EFcd{;;   }\EFc{`}\textcolor[HTML]{a9a1e1}{require}\EFc{' or `}\textcolor[HTML]{a9a1e1}{use-package}\EFc{'.}
\EFcd{;; }\EFc{- `}\textcolor[HTML]{a9a1e1}{map!}\EFc{' for binding new keys}
\EFcd{;;}
\EFcd{;; }\EFc{To get information about any of these functions/macros, move the cursor over}
\EFcd{;; }\EFc{the highlighted symbol at press '}\textcolor[HTML]{a9a1e1}{K}\EFc{' (non-evil users must press 'C-c c k').}
\EFcd{;; }\EFc{This will open documentation for it, including demos of how they are used.}
\EFcd{;;}
\EFcd{;; }\EFc{You can also try '}\textcolor[HTML]{a9a1e1}{gd}\EFc{' (or 'C-c c d') to jump to their definition and see how}
\EFcd{;; }\EFc{they are implemented.}

\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.doom.d/modules"}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{--} \EFrdb{(}var\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{when} ,var
    \EFrdc{(}\EFk{setq} ,var \EFrdd{(}\EFo{-} ,var \EFhn{1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{++} \EFrdb{(}var\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{when} ,var
    \EFrdc{(}\EFk{setq} ,var \EFrdd{(}\EFo{+} ,var \EFhn{1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFcd{;}\EFc{(when (or (not debug-my-config) (> debug-my-config 0)) (dec debug-my-config) (message "a"))}

\EFrda{(}\EFk{setq} \EFv{use-package-verbose} t\EFrda{)}
\EFrda{(}\EFv{async-bytecomp-package-mode} \EFhn{1}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{after-startup} \EFrdb{(}func\EFrdb{)}
  \EFrdb{(}\EFk{unless} debug-my-config \EFrdc{(}\EFk{add-hook!} after-startup-hook
                             \EFrdd{(}\EFk{load-module} func\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{mkdir} \EFrdb{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"modules"}\EFrdb{)} t\EFrda{)}

\EFcd{;; }\EFc{Variable to determine how many modules are loaded, for debugging}
\EFcd{;; }\EFc{Any number is number of modules}
\EFcd{;; }\EFc{nil means all}
\EFrda{(}\EFk{setq} debug-my-config nil\EFrda{)}
\EFrda{(}\EFk{defmacro} \EFf{load-module} \EFrdb{(}module\EFrdb{)}
   \EFhq{`}\EFrdb{(}\EFk{when} \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{not} debug-my-config\EFrdd{)} \EFrdd{(}\EFo{>} debug-my-config \EFhn{0}\EFrdd{)}\EFrdc{)} \EFrdc{(}\EFk{--} debug-my-config\EFrdc{)} \EFrdc{(}\EFo{make-thread}
   \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}time \EFrdc{(}\EFo{current-time}\EFrdc{)}\EFrdb{)}\EFrda{)}
     \EFcd{;}\EFc{(message (format "Loading \%s." func-name))}
     \EFrda{(}\EFo{require} ,module\EFrda{)}
     \EFrda{(}\EFo{message} \EFrdb{(}\EFo{format} \EFs{"Loaded \%s in \%.06f."} ,module \EFrdc{(}\EFo{float-time} \EFrdd{(}\EFo{time-since} time\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;; }\EFc{Load a module only if dependency could successfully be loaded}
\EFrda{(}\EFk{defmacro} \EFf{load-module-if} \EFrdb{(}dependency module\EFrdb{)}
\EFhq{`}\EFrdb{(}\EFk{when} \EFrdc{(}\EFo{require} ,dependency nil \EFhq{'}\EFhs{noerror}\EFrdc{)}
   \EFrdc{(}\EFk{load-module} ,module\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{cl}\EFrda{)} \EFcd{; }\EFc{Still a requirement for ivy}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{exwm-tweaks}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{general}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{navigation}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{shortcuts}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{private-config}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{search}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{read-aloud}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{read-single}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{pamparam}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{beancount-tweaks}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{popes}\EFrda{)}
\EFcd{;}\EFc{(load-module '(require 'bible))}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{keycast-tweaks}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{wttrin}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-tweaks}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{languages}\EFrda{)}
\EFrda{(}\EFk{when} \EFrdb{(}\EFo{require} \EFhq{'}\EFo{mu4e} nil \EFhq{'}\EFhs{noerror}\EFrdb{)}
  \EFrdb{(}\EFk{load-module} \EFhq{'}\EFhs{email}\EFrdb{)}
  \EFrdb{(}\EFk{load-module} \EFhq{'}\EFhs{email-config}\EFrdb{)}
  \EFrdb{(}\EFk{load-module} \EFhq{'}\EFhs{email-accounts}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{latex-tweaks}\EFrda{)}
\EFcd{; }\EFc{Unsorted}
\EFrda{(}\EFk{setq} \EFv{doom-modeline-enable-word-count} t\EFrda{)}
\EFcd{;}\EFc{(doom/quickload-session)}

\EFrda{(}\EFk{defun} \EFf{doom--get-modules} \EFrdb{(}file\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFrdc{(}\EFo{file-exists-p} file\EFrdc{)}
    \EFrdc{(}\EFo{user-error} \EFs{"\%s does not exist"} file\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{with-temp-buffer}
    \EFrdc{(}\EFo{insert-file-contents} file\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{re-search-forward} \EFs{"(doom! "} nil t\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{match-beginning} \EFhn{0}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{cdr} \EFrda{(}\EFo{sexp-at-point}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{doom--put-modules} \EFrdb{(}tmpfile modules\EFrdb{)}
  \EFrdb{(}\EFk{with-temp-file} tmpfile
    \EFrdc{(}\EFv{delay-mode-hooks} \EFrdd{(}\EFo{emacs-lisp-mode}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFo{replace-regexp-in-string} \EFs{" "} \EFs{"\char92{}n"} \EFrda{(}\EFo{prin1-to-string} modules\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{indent-region} \EFrdd{(}\EFo{point-min}\EFrdd{)} \EFrdd{(}\EFo{point-max}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{doom/what-has-changed} \EFrdb{(}\EFrdb{)}
  \EFd{"Open an ediff session to compare the module list in
\char126{}/.emacs.d/init.example.el and \char126{}/.doom.d/init.el."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}old-modules \EFrda{(}\EFf{doom--get-modules} \EFrdb{(}\EFo{expand-file-name} \EFrdc{(}\EFo{concat} \EFv{doom-emacs-dir} \EFs{"templates/init.example.el"}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}new-modules \EFrda{(}\EFf{doom--get-modules} \EFrdb{(}\EFo{expand-file-name} \EFs{"init.el"} \EFv{doom-private-dir}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}example-init-el \EFs{"/tmp/doom-init.example.el"}\EFrdd{)}
        \EFrdd{(}private-init-el \EFs{"/tmp/doom-private-init.el"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{doom--put-modules} example-init-el old-modules\EFrdc{)}
    \EFrdc{(}\EFf{doom--put-modules} private-init-el new-modules\EFrdc{)}
    \EFrdc{(}\EFf{ediff} private-init-el example-init-el\EFrdc{)}\EFrdb{)}\EFrda{)}

\end{Verbatim}
\end{Code}

\section{Packages}
\label{sec:org7946494}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;; }\EFc{-*- no-byte-compile: t; -*-}
\EFcd{;;; }\EFc{\$DOOMDIR/packages.el}

\EFcd{;; }\EFc{To install a package with Doom you must declare them here and run 'doom sync'}
\EFcd{;; }\EFc{on the command line, then restart Emacs for the changes to take effect -- or}
\EFcd{;; }\EFc{use 'M-x doom/reload'.}


\EFcd{;; }\EFc{To install SOME-PACKAGE from MELPA, ELPA or emacsmirror:}
\EFcd{;}\EFc{(package! some-package)}

\EFcd{;; }\EFc{To install a package directly from a remote git repo, you must specify a}
\EFcd{;; }\EFc{`}\textcolor[HTML]{a9a1e1}{:recipe}\EFc{'. You'll find documentation on what `}\textcolor[HTML]{a9a1e1}{:recipe}\EFc{' accepts here:}
\EFcd{;; }\EFc{https://github.com/raxod502/straight.el\#the-recipe-format}
\EFcd{;}\EFc{(package! another-package}
\EFcd{;  }\EFc{:recipe (:host github :repo "username/repo"))}

\EFcd{;; }\EFc{If the package you are trying to install does not contain a PACKAGENAME.el}
\EFcd{;; }\EFc{file, or is located in a subdirectory of the repo, you'll need to specify}
\EFcd{;; }\EFc{`}\textcolor[HTML]{a9a1e1}{:files}\EFc{' in the `}\textcolor[HTML]{a9a1e1}{:recipe}\EFc{':}
\EFcd{;}\EFc{(package! this-package}
\EFcd{;  }\EFc{:recipe (:host github :repo "username/repo"}
\EFcd{;           }\EFc{:files ("some-file.el" "src/lisp/*.el")))}

\EFcd{;; }\EFc{If you'd like to disable a package included with Doom, you can do so here}
\EFcd{;; }\EFc{with the `}\textcolor[HTML]{a9a1e1}{:disable}\EFc{' property:}
\EFcd{;}\EFc{(package! builtin-package :disable t)}

\EFcd{;; }\EFc{You can override the recipe of a built in package without having to specify}
\EFcd{;; }\EFc{all the properties for `}\textcolor[HTML]{a9a1e1}{:recipe}\EFc{'. These will inherit the rest of its recipe}
\EFcd{;; }\EFc{from Doom or MELPA/ELPA/Emacsmirror:}
\EFcd{;}\EFc{(package! builtin-package :recipe (:nonrecursive t))}
\EFcd{;}\EFc{(package! builtin-package-2 :recipe (:repo "myfork/package"))}

\EFcd{;; }\EFc{Specify a `}\textcolor[HTML]{a9a1e1}{:branch}\EFc{' to install a package from a particular branch or tag.}
\EFcd{;; }\EFc{This is required for some packages whose default branch isn't '}\textcolor[HTML]{a9a1e1}{master}\EFc{' (which}
\EFcd{;; }\EFc{our package manager can't deal with; see raxod502/straight.el\#279)}
\EFcd{;}\EFc{(package! builtin-package :recipe (:branch "develop"))}

\EFcd{;; }\EFc{Use `}\textcolor[HTML]{a9a1e1}{:pin}\EFc{' to specify a particular commit to install.}
\EFcd{;}\EFc{(package! builtin-package :pin "1a2b3c4d5e")}


\EFcd{;; }\EFc{Doom's packages are pinned to a specific commit and updated from release to}
\EFcd{;; }\EFc{release. The `}\textcolor[HTML]{a9a1e1}{unpin!}\EFc{' macro allows you to unpin single packages...}
\EFcd{;}\EFc{(unpin! pinned-package)}
\EFcd{;; }\EFc{...or multiple packages}
\EFcd{;}\EFc{(unpin! pinned-package another-pinned-package)}
\EFcd{;; }\EFc{...Or *all* packages (NOT RECOMMENDED; will likely break things)}
\EFcd{;}\EFc{(unpin! t)}

\EFrda{(}\EFk{package!} xelb\EFrda{)}
\EFrda{(}\EFk{package!} exwm\EFrda{)}
\EFrda{(}\EFk{package!} winum\EFrda{)}
\EFrda{(}\EFk{package!} switch-window\EFrda{)}
\EFrda{(}\EFk{package!} try\EFrda{)}
\EFrda{(}\EFk{package!} counsel\EFrda{)}
\EFrda{(}\EFk{package!} ivy\EFrda{)}
\EFrda{(}\EFk{package!} all-the-icons-ibuffer\EFrda{)}
\EFrda{(}\EFk{package!} all-the-icons-ivy\EFrda{)}
\EFrda{(}\EFk{package!} swiper\EFrda{)}
\EFrda{(}\EFk{package!} \EFv{ido-vertical-mode}\EFrda{)}
\EFrda{(}\EFk{package!} amx\EFrda{)}
\EFrda{(}\EFk{package!} diredfl\EFrda{)}
\EFrda{(}\EFk{package!} all-the-icons-dired\EFrda{)}
\EFrda{(}\EFk{package!} diredful\EFrda{)}
\EFrda{(}\EFk{package!} dired-git-info\EFrda{)}
\EFrda{(}\EFk{package!} async\EFrda{)}
\EFrda{(}\EFk{package!} dired-quick-sort\EFrda{)}
\EFrda{(}\EFk{package!} openwith\EFrda{)}
\EFrda{(}\EFk{package!} lispy\EFrda{)}
\EFrda{(}\EFk{package!} hydra\EFrda{)}
\EFrda{(}\EFk{package!} ace-link\EFrda{)}
\EFrda{(}\EFk{package!} sudo-edit\EFrda{)}
\EFrda{(}\EFk{package!} beancount \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"beancount/beancount-mode"}\EFrdb{)}
  \EFb{:pin} \EFs{"ea8257881b7e276e8d170d724e3b2e179f25cb77"}\EFrda{)}
\EFrda{(}\EFk{package!} rotate\EFrda{)}
\EFrda{(}\EFk{package!} vlf\EFrda{)}
\EFrda{(}\EFk{package!} evil-escape \EFb{:disable} t\EFrda{)}

\EFcd{; }\EFc{Auto Activating Snippets}
\EFrda{(}\EFk{package!} aas \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"ymarco/auto-activating-snippets"}\EFrdb{)}
  \EFb{:pin} \EFs{"1699bec4d244a1f62af29fe4eb8b79b6d2fccf7d"}\EFrda{)}

\EFrda{(}\EFk{package!} string-inflection \EFb{:pin} \EFs{"fd7926ac17293e9124b31f706a4e8f38f6a9b855"}\EFrda{)}

\EFrda{(}\EFk{package!} info-colors \EFb{:pin} \EFs{"47ee73cc19b1049eef32c9f3e264ea7ef2aaf8a5"}\EFrda{)}
\EFrda{(}\EFk{package!} modus-themes \EFb{:pin} \EFs{"392ebb115b07f8052d512ec847619387d109edd6"}\EFrda{)}
\EFrda{(}\EFk{package!} theme-magic \EFb{:pin} \EFs{"844c4311bd26ebafd4b6a1d72ddcc65d87f074e3"}\EFrda{)}
\EFrda{(}\EFk{package!} keycast \EFb{:pin} \EFs{"04ba7519f34421c235bac458f0192c130f732f12"}\EFrda{)}
\EFrda{(}\EFk{package!} page-break-lines \EFb{:recipe} \EFrdb{(}\EFb{:host} github \EFb{:repo} \EFs{"purcell/page-break-lines"}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{package!} spray \EFb{:pin} \EFs{"74d9dcfa2e8b38f96a43de9ab0eb13364300cb46"}\EFrda{)}
\EFcd{;}\EFc{(package! authinfo-color-mode}
\EFcd{;  }\EFc{:recipe (:repo "lisp/authinfo-color-mode"))}
\EFrda{(}\EFk{package!} systemd \EFb{:pin} \EFs{"b6ae63a236605b1c5e1069f7d3afe06ae32a7bae"}\EFrda{)}
\EFcd{; }\EFc{Ebooks}
\EFrda{(}\EFk{package!} calibredb \EFb{:pin} \EFs{"cb93563d0ec9e0c653210bc574f9546d1e7db437"}\EFrda{)}
\EFrda{(}\EFk{package!} nov \EFb{:pin} \EFs{"b3c7cc28e95fe25ce7b443e5f49e2e45360944a3"}\EFrda{)}
\EFcd{; }\EFc{Email}
\EFrda{(}\EFk{package!} org-mime\EFrda{)}
\EFrda{(}\EFk{package!} org-auto-tangle\EFrda{)}
\EFrda{(}\EFk{package!} mu4e-alert\EFrda{)}
\EFrda{(}\EFk{package!} outline-minor-faces\EFrda{)}
\EFrda{(}\EFk{package!} mu4e-conversation\EFrda{)}
\EFrda{(}\EFk{package!} elfeed-summary\EFrda{)}
\EFrda{(}\EFk{package!} org-modern\EFrda{)}
\EFrda{(}\EFk{package!} good-scroll\EFrda{)}
\EFrda{(}\EFk{package!} desktop-environment\EFrda{)}
\EFrda{(}\EFk{package!} emms\EFrda{)}
\EFrda{(}\EFk{package!} elfeed-tube\EFrda{)}
\EFrda{(}\EFk{package!} mpv\EFrda{)}
\EFrda{(}\EFk{package!} elfeed-tube-mpv\EFrda{)}
\EFrda{(}\EFk{package!} spell-fu\EFrda{)}
\EFrda{(}\EFk{package!} wallpaper\EFrda{)}
\end{Verbatim}
\end{Code}
\section{Secrets\hfill{}\textsc{crypt}}
\label{sec:org63fc93c}
-----BEGIN PGP MESSAGE-----

jA0ECQMCpaa2IHWz/qX/0ncB5MHYMuE7woX9lpKqkvubmgY7wy3/6LCoYMn6XYRY
sY2v9BQxlfFkz+rwgWnsdRYeGLR8Yd8mpHGeGg4jrvC8v5eiOhaqCKpyNiAcMpOv
age95IpQjrQoIy0CPDtiouDWKNrXrTSQctareltEAkkB+p48HdVkKg==
=z0qj
-----END PGP MESSAGE-----
\section{Modules}
\label{sec:orgd2c78e6}
\subsection{Utility functions}
\label{sec:org7406286}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{utility-functions}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org35430c6}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFo{require} \EFhq{'}\EFo{string-inflection}\EFrda{)}
\EFrda{(}\EFk{defun} \EFf{string-inflection-title-to-lisp-case-function} \EFrdb{(}title-str\EFrdb{)}
  \EFd{"Title String for Something => title-string-for-something"}
  \EFrdb{(}\EFo{string-inflection-kebab-case-function} \EFrdc{(}\EFo{s-replace-all} \EFhq{'}\EFrdd{(}\EFrda{(}\EFs{" "} . \EFs{"-"}\EFrda{)}\EFrdd{)} title-str\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{utility-functions}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Autocorrect}
\label{sec:org194b9a9}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{auto-correct}\EFrda{)}
\end{Verbatim}
\end{Code}

\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{auto-correct.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFo{define-key} \EFv{ctl-x-map} \EFs{"\char92{}C-i"}
  \EFhq{\#'}\EFhs{endless/ispell-word-then-abbrev}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{endless/simple-get-word} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{car-safe} \EFrdc{(}\EFk{save-excursion} \EFrdd{(}\EFo{ispell-get-word} nil\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{endless/ispell-word-then-abbrev} \EFrdb{(}p\EFrdb{)}
  \EFd{"Call `}\textcolor[HTML]{a9a1e1}{ispell-word}\EFd{', then create an abbrev for it.
With prefix P, create local abbrev. Otherwise it will
be global.
If there's nothing wrong with the word at point, keep
looking for a typo until the beginning of buffer. You can
skip typos you don't want to fix with `}\textcolor[HTML]{a9a1e1}{SPC}\EFd{', and you can
abort completely with `}\textcolor[HTML]{a9a1e1}{C-g}\EFd{'."}
  \EFrdb{(}\EFk{interactive} \EFs{"P"}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}bef aft\EFrdc{)}
    \EFrdc{(}\EFk{save-excursion}
      \EFrdd{(}\EFk{while} \EFrda{(}\EFk{if} \EFrdb{(}\EFk{setq} bef \EFrdc{(}\EFf{endless/simple-get-word}\EFrdc{)}\EFrdb{)}
                 \EFcd{;; }\EFc{Word was corrected or used quit.}
                 \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{ispell-word} nil \EFhq{'}\EFhs{quiet}\EFrdc{)}
                     nil \EFcd{; }\EFc{End the loop.}
                   \EFcd{;; }\EFc{Also end if we reach `}\textcolor[HTML]{a9a1e1}{bob}\EFc{'.}
                   \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{bobp}\EFrdd{)}\EFrdc{)}\EFrdb{)}
               \EFcd{;; }\EFc{If there's no word at point, keep looking}
               \EFcd{;; }\EFc{until `}\textcolor[HTML]{a9a1e1}{bob}\EFc{'.}
               \EFrdb{(}\EFo{not} \EFrdc{(}\EFo{bobp}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{backward-word}\EFrda{)}
        \EFrda{(}\EFo{backward-char}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} aft \EFrda{(}\EFf{endless/simple-get-word}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFk{and} aft bef \EFrda{(}\EFo{not} \EFrdb{(}\EFo{equal} aft bef\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}aft \EFrdc{(}\EFo{downcase} aft\EFrdc{)}\EFrdb{)}
              \EFrdb{(}bef \EFrdc{(}\EFo{downcase} bef\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{define-abbrev}
            \EFrdb{(}\EFk{if} p \EFv{local-abbrev-table} \EFv{global-abbrev-table}\EFrdb{)}
            bef aft\EFrda{)}
          \EFrda{(}\EFo{message} \EFs{"\char92{}"\%s\char92{}" now expands to \char92{}"\%s\char92{}" \%sally"}
                   bef aft \EFrdb{(}\EFk{if} p \EFs{"loc"} \EFs{"glob"}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{user-error} \EFs{"No typo at or before point"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{save-abbrevs} \EFhq{'}\EFhs{silently}\EFrda{)}
\EFrda{(}\EFk{setq-default} \EFv{abbrev-mode} t\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{auto-correct}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Beancount}
\label{sec:orgc6f3002}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{beancount-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{beancount.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{use-package!} beancount
  \EFb{:mode} \EFrdb{(}\EFs{"\char92{}\char92{}.beancount\char92{}\char92{}'"} . beancount-mode\EFrdb{)}
  \EFb{:init}
  \EFrdb{(}\EFk{after!} all-the-icons
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{all-the-icons-icon-alist}
                 \EFhq{'}\EFrdd{(}\EFs{"\char92{}\char92{}.beancount\char92{}\char92{}'"} all-the-icons-material \EFs{"attach\_money"} \EFb{:face} all-the-icons-lblue\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{all-the-icons-mode-icon-alist}
                 \EFhq{'}\EFrdd{(}beancount-mode all-the-icons-material \EFs{"attach\_money"} \EFb{:face} all-the-icons-lblue\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{setq} beancount-electric-currency t\EFrdb{)}
  \EFrdb{(}\EFk{defun} \EFf{beancount-bal} \EFrdc{(}\EFrdc{)}
    \EFd{"Run bean-report bal."}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{compilation-read-command} nil\EFrda{)}\EFrdd{)}
      \EFrdd{(}beancount--run \EFs{"bean-report"}
                      \EFrda{(}\EFo{file-relative-name} \EFv{buffer-file-name}\EFrda{)} \EFs{"bal"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:map} beancount-mode-map
        \EFb{:n} \EFs{"TAB"} \EFhq{\#'}\EFhs{beancount-align-to-previous-number}
        \EFb{:i} \EFs{"RET"} \EFrdc{(}\EFk{cmd!} \EFrdd{(}\EFo{newline-and-indent}\EFrdd{)} \EFrdd{(}beancount-align-to-previous-number\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{beancount-tweaks}\EFrda{)}

\end{Verbatim}
\end{Code}
\subsection{Dired}
\label{sec:org205c180}
\subsubsection{Dired Inline images}
\label{sec:org68a8be8}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{dired-inline-images}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:orge121f3e}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{dired-inline-images.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{defun} \EFf{dired-preview--dired-line-is-previewable} \EFrdb{(}\EFrdb{)}
  \EFd{"Return non-nil if line under point is previewable"}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}fname \EFrda{(}\EFo{dired-get-filename} nil\EFrda{)}\EFrdd{)}
         \EFrdd{(}ext \EFrda{(}\EFo{upcase} \EFrdb{(}\EFo{file-name-extension} fname\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}allowed-extensions \EFhq{'}\EFrda{(}\EFs{"PBM"} \EFs{"XBM"} \EFs{"XPM"} \EFs{"GIF"} \EFs{"JPEG"} \EFs{"JPG"} \EFs{"TIFF"} \EFs{"TIF"} \EFs{"PNG"} \EFs{"SVG"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}search-fun \EFrda{(}\EFo{apply-partially} \EFrdb{(}\EFk{lambda} \EFrdc{(}a b\EFrdc{)} \EFrdc{(}\EFo{string=} a b\EFrdc{)}\EFrdb{)} ext\EFrda{)}\EFrdd{)}
         \EFrdd{(}is-ext-allowed \EFrda{(}\EFf{seq-find} search-fun allowed-extensions nil\EFrda{)}\EFrdd{)}\EFrdc{)}
    is-ext-allowed\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dired-preview--readin} \EFrdb{(}filename\EFrdb{)}
  \EFd{"Read in the file.

Return a string suitable for insertion in `}\textcolor[HTML]{a9a1e1}{dired}\EFd{' buffer."}
    \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}preview-image \EFrda{(}\EFo{create-image} filename \EFhq{'}\EFhs{imagemagick} nil \EFb{:height} \EFhn{200}\EFrda{)}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFk{with-temp-buffer}
        \EFrdd{(}\EFo{insert-image} preview-image\EFrdd{)}
        \EFrdd{(}\EFo{insert} \EFs{"\char92{}n"}\EFrdd{)}
        \EFrdd{(}\EFo{buffer-string}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dired-preview-insert} \EFrdb{(}\EFrdb{)}          \EFcd{;; }\EFc{Copied more or less directly from dired-subtree}
  \EFd{"Insert preview under this file."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFf{dired-preview--dired-line-is-previewable}\EFrdd{)}
             \EFrdd{(}\EFo{not} \EFrda{(}dired-subtree--is-expanded-p\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}filename \EFrdb{(}\EFo{dired-get-filename} nil\EFrdb{)}\EFrda{)}
           \EFrda{(}listing \EFrdb{(}\EFf{dired-preview--readin} filename\EFrdb{)}\EFrda{)}
           beg end\EFrdd{)}
      \EFrdd{(}\EFo{read-only-mode} \EFhn{-1}\EFrdd{)}
      \EFrdd{(}\EFo{move-end-of-line} \EFhn{1}\EFrdd{)}
      \EFcd{;; }\EFc{this is pretty ugly, I'm sure it can be done better}
      \EFrdd{(}\EFk{save-excursion}
        \EFrda{(}\EFo{insert} listing\EFrda{)}
        \EFrda{(}\EFk{setq} end \EFrdb{(}\EFo{+} \EFrdc{(}\EFo{point}\EFrdc{)} \EFhn{2}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{newline}\EFrdd{)}
      \EFrdd{(}\EFk{setq} beg \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}\EFv{inhibit-read-only} t\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{remove-text-properties} \EFrdb{(}\EFo{1-} beg\EFrdb{)} beg \EFhq{'}\EFrdb{(}dired-filename\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}ov \EFrdc{(}\EFo{make-overlay} beg end\EFrdc{)}\EFrdb{)}
             \EFrdb{(}parent \EFrdc{(}dired-subtree--get-ov \EFrdd{(}\EFo{1-} beg\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}depth \EFrdc{(}\EFk{or} \EFrdd{(}\EFk{and} parent \EFrda{(}\EFo{+} \EFhn{2} \EFrdb{(}\EFo{overlay-get} parent \EFhq{'}\EFhs{dired-subtree-depth}\EFrdb{)}\EFrda{)}\EFrdd{)}
                        \EFhn{2}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}face \EFrdc{(}\EFo{intern} \EFrdd{(}\EFo{format} \EFs{"dired-subtree-depth-\%d-face"} depth\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{when} dired-subtree-use-backgrounds
          \EFrdb{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{face} face\EFrdb{)}\EFrda{)}
        \EFcd{;; }\EFc{refactor this to some function}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFv{line-prefix}
                     \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{stringp} dired-subtree-line-prefix\EFrdc{)}
                         \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{not} dired-subtree-use-backgrounds\EFrdd{)}
                             \EFrdd{(}\EFo{apply} \EFhq{'}\EFhs{concat} \EFrda{(}\EFo{-repeat} depth dired-subtree-line-prefix\EFrda{)}\EFrdd{)}
                           \EFrdd{(}\EFk{cond}
                            \EFrda{(}\EFrdb{(}\EFo{eq} nil dired-subtree-line-prefix-face\EFrdb{)}
                             \EFrdb{(}\EFo{apply} \EFhq{'}\EFhs{concat}
                                    \EFrdc{(}\EFo{-repeat} depth dired-subtree-line-prefix\EFrdc{)}\EFrdb{)}\EFrda{)}
                            \EFrda{(}\EFrdb{(}\EFo{eq} \EFhq{'}\EFhs{subtree} dired-subtree-line-prefix-face\EFrdb{)}
                             \EFrdb{(}\EFo{concat}
                              dired-subtree-line-prefix
                              \EFrdc{(}\EFo{propertize}
                               \EFrdd{(}\EFo{apply} \EFhq{'}\EFhs{concat}
                                      \EFrda{(}\EFo{-repeat} \EFrdb{(}\EFo{1-} depth\EFrdb{)} dired-subtree-line-prefix\EFrda{)}\EFrdd{)}
                               \EFhq{'}\EFhs{face} face\EFrdc{)}\EFrdb{)}\EFrda{)}
                            \EFrda{(}\EFrdb{(}\EFo{eq} \EFhq{'}\EFhs{parents} dired-subtree-line-prefix-face\EFrdb{)}
                             \EFrdb{(}\EFo{concat}
                              dired-subtree-line-prefix
                              \EFrdc{(}\EFo{apply} \EFhq{'}\EFhs{concat}
                                     \EFrdd{(}\EFk{--map}
                                      \EFrda{(}\EFo{propertize} dired-subtree-line-prefix
                                                  \EFhq{'}\EFhs{face}
                                                  \EFrdb{(}\EFo{intern} \EFrdc{(}\EFo{format} \EFs{"dired-subtree-depth-\%d-face"} it\EFrdc{)}\EFrdb{)}\EFrda{)}
                                      \EFrda{(}\EFo{number-sequence} \EFhn{1} \EFrdb{(}\EFo{1-} depth\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{funcall} dired-subtree-line-prefix depth\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{dired-subtree-name} filename\EFrda{)}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{dired-subtree-parent} parent\EFrda{)}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{dired-subtree-depth} depth\EFrda{)}
        \EFrda{(}\EFo{overlay-put} ov \EFhq{'}\EFhs{evaporate} t\EFrda{)}
        \EFrda{(}\EFk{push} ov dired-subtree-overlays\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{-} beg \EFhn{1}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{dired-move-to-filename}\EFrdd{)}
      \EFrdd{(}\EFo{read-only-mode} \EFhn{1}\EFrdd{)}
      \EFrdd{(}\EFo{run-hooks} \EFhq{'}\EFhs{dired-subtree-after-insert-hook}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dired-preview-insert-preview-or-subtree} \EFrdb{(}orig-fun\EFrdb{)}
  \EFd{"Call the right insert function for a preview or a subtree"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}dired-subtree--dired-line-is-directory-or-link-p\EFrdd{)} \EFrdd{(}\EFo{apply} orig-fun nil\EFrdd{)}\EFrdc{)}
        \EFrdc{(}\EFrdd{(}\EFf{dired-preview--dired-line-is-previewable}\EFrdd{)} \EFrdd{(}\EFf{dired-preview-insert}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{advice-add} \EFhq{'}\EFhs{dired-subtree-insert} \EFb{:around} \EFhq{\#'}\EFhs{dired-preview-insert-preview-or-subtree}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{dired-inline-images}\EFrda{)}

\end{Verbatim}
\end{Code}

\subsubsection{Dired Tweaks}
\label{sec:org7c7fd41}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{dired-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Code}
\label{sec:org71e8d94}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{dired-tweaks.el -*- lexical-binding: t; -*-}

\EFcd{;; }\EFc{Dired}
\EFcd{;;; }\EFc{Colourful dired}
\EFrda{(}\EFk{use-package!} diredfl
  \EFb{:init} \EFrdb{(}\EFv{diredfl-global-mode} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} all-the-icons-dired
  \EFb{:config}
  \EFcd{;}\EFc{(all-the-icons-dired-mode 1)}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{dired-mode-hook} \EFhq{'}\EFv{all-the-icons-dired-mode}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dired-open-file} \EFrdb{(}\EFrdb{)}
  \EFd{"In dired, open the file named on this line."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}file \EFrda{(}\EFo{dired-get-filename} nil t\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFs{"Opening \%s..."} file\EFrdc{)}
    \EFrdc{(}\EFo{call-process} \EFs{"xdg-open"} nil \EFhn{0} nil file\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{define-minor-mode} \EFv{dired-follow-mode}
  \EFd{"Diplay file at point in dired after a move."}
  \EFb{:lighter} \EFs{" dired-f"}
  \EFb{:global} t
  \EFrdb{(}\EFk{if} \EFv{dired-follow-mode}
      \EFrdc{(}\EFo{advice-add} \EFhq{'}\EFhs{dired-next-line} \EFb{:after} \EFrdd{(}\EFk{lambda} \EFrda{(}arg\EFrda{)} \EFrda{(}\EFo{dired-display-file}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{advice-remove} \EFhq{'}\EFhs{dired-next-line} \EFrdd{(}\EFk{lambda} \EFrda{(}arg\EFrda{)} \EFrda{(}\EFo{dired-display-file}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{vc-follow-symlinks} t
      \EFv{dired-listing-switches} \EFs{"-ahlt"}
      diredp-toggle-find-file-reuse-dir \EFhn{1}
      image-dired-thumb-size \EFhn{100}
      diredp-image-preview-in-tooltip \EFhn{100}
      \EFv{dired-auto-revert-buffer} t
      diredp-hide-details-initially-flag nil
      \EFv{dired-hide-details-mode} \EFhn{0}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{image-view} \EFrdb{(}direction\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)}
     \EFrdc{(}\EFk{interactive}\EFrdc{)}
     \EFrdc{(}\EFo{quit-window}\EFrdc{)}
     \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}pt \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}
           filename\EFrdd{)}
       \EFrdd{(}\EFk{or} \EFrda{(}\EFk{ignore-errors}
             \EFrdb{(}\EFk{catch} \EFhq{'}\EFo{filename}
               \EFrdc{(}\EFk{while} \EFrdd{(}\EFo{dired-next-line} ,direction\EFrdd{)}
                 \EFrdd{(}\EFk{when} \EFrda{(}\EFo{image-type-from-file-name}
                        \EFrdb{(}\EFk{setq} filename \EFrdc{(}\EFo{dired-get-filename}\EFrdc{)}\EFrdb{)}\EFrda{)}
                   \EFrda{(}\EFo{throw} \EFhq{'}\EFo{filename} filename\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{goto-char} pt\EFrda{)}\EFrdd{)}
       \EFrdd{(}\EFo{dired-view-file}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{eval-after-load} \EFs{"image-mode"}
  \EFhq{'}\EFrdb{(}progn
    \EFrdc{(}\EFo{define-key} image-mode-map \EFs{"n"} \EFrdd{(}\EFk{image-view} \EFhn{1}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} image-mode-map \EFs{"p"} \EFrdd{(}\EFk{image-view} \EFhn{-1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;}\EFc{(use-package dired-k}
\EFcd{;  }\EFc{;; use dired-k as alternative to revert buffer. This will refresh git status}
\EFcd{;  }\EFc{:hook (dired-mode . dired-k)}
\EFcd{;  }\EFc{:bind (:map dired-mode-map}
\EFcd{;              }\EFc{("g" . dired-k)))}

\EFrda{(}\EFk{use-package!} diredful
  \EFb{:config} \EFrdb{(}\EFv{diredful-mode} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFcd{; }\EFc{I don't like colors that much, icons already do everything}
\EFcd{;}\EFc{(use-package dired-rainbow}
\EFcd{;}
\EFcd{;  }\EFc{:defer t}
\EFcd{;  }\EFc{:config}
\EFcd{;  }\EFc{(progn}
\EFcd{;    }\EFc{(dired-rainbow-define-chmod directory "\#6cb2eb" "d.*")}
\EFcd{;    }\EFc{(dired-rainbow-define html "\#eb5286" ("css" "less" "sass" "scss" "htm" "html" "jhtm" "mht" "eml" "mustache" "xhtml"))}
\EFcd{;    }\EFc{(dired-rainbow-define xml "\#f2d024" ("xml" "xsd" "xsl" "xslt" "wsdl" "bib" "json" "msg" "pgn" "rss" "yaml" "yml" "rdata"))}
\EFcd{;    }\EFc{(dired-rainbow-define document "\#9561e2" ("docm" "doc" "docx" "odb" "odt" "pdb" "pdf" "ps" "rtf" "djvu" "epub" "odp" "ppt" "pptx"))}
\EFcd{;    }\EFc{(dired-rainbow-define markdown "\#ffed4a" ("org" "etx" "info" "markdown" "md" "mkd" "nfo" "pod" "rst" "tex" "textfile" "txt"))}
\EFcd{;    }\EFc{(dired-rainbow-define database "\#6574cd" ("xlsx" "xls" "csv" "accdb" "db" "mdb" "sqlite" "nc"))}
\EFcd{;    }\EFc{(dired-rainbow-define media "\#de751f" ("mp3" "mp4" "MP3" "MP4" "avi" "mpeg" "mpg" "flv" "ogg" "mov" "mid" "midi" "wav" "aiff" "flac"))}
\EFcd{;    }\EFc{(dired-rainbow-define image "\#f66d9b" ("tiff" "tif" "cdr" "gif" "ico" "jpeg" "jpg" "png" "psd" "eps" "svg"))}
\EFcd{;    }\EFc{(dired-rainbow-define log "\#c17d11" ("log"))}
\EFcd{;    }\EFc{(dired-rainbow-define shell "\#f6993f" ("awk" "bash" "bat" "sed" "sh" "zsh" "vim"))}
\EFcd{;    }\EFc{(dired-rainbow-define interpreted "\#38c172" ("py" "ipynb" "rb" "pl" "t" "msql" "mysql" "pgsql" "sql" "r" "clj" "cljs" "scala" "js"))}
\EFcd{;    }\EFc{(dired-rainbow-define compiled "\#4dc0b5" ("asm" "cl" "lisp" "el" "c" "h" "c++" "h++" "hpp" "hxx" "m" "cc" "cs" "cp" "cpp" "go" "f" "for" "ftn" "f90" "f95" "f03" "f08" "s" "rs" "hi" "hs" "pyc" ".java"))}
\EFcd{;    }\EFc{(dired-rainbow-define executable "\#8cc4ff" ("exe" "msi"))}
\EFcd{;    }\EFc{(dired-rainbow-define compressed "\#51d88a" ("7z" "zip" "bz2" "tgz" "txz" "gz" "xz" "z" "Z" "jar" "war" "ear" "rar" "sar" "xpi" "apk" "xz" "tar"))}
\EFcd{;    }\EFc{(dired-rainbow-define packaged "\#faad63" ("deb" "rpm" "apk" "jad" "jar" "cab" "pak" "pk3" "vdf" "vpk" "bsp"))}
\EFcd{;    }\EFc{(dired-rainbow-define encrypted "\#ffed4a" ("gpg" "pgp" "asc" "bfe" "enc" "signature" "sig" "p12" "pem"))}
\EFcd{;    }\EFc{(dired-rainbow-define fonts "\#6cb2eb" ("afm" "fon" "fnt" "pfb" "pfm" "ttf" "otf"))}
\EFcd{;    }\EFc{(dired-rainbow-define partition "\#e3342f" ("dmg" "iso" "bin" "nrg" "qcow" "toast" "vcd" "vmdk" "bak"))}
\EFcd{;    }\EFc{(dired-rainbow-define vc "\#0074d9" ("git" "gitignore" "gitattributes" "gitmodules"))}
\EFcd{;    }\EFc{(dired-rainbow-define-chmod executable-unix "\#38c172" "-.*x.*")}
\EFcd{;    }\EFc{))}

\EFrda{(}\EFk{use-package!} dired-git-info
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{dgi-auto-hide-details-p} nil\EFrdb{)}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{dired-after-readin-hook} \EFhq{'}\EFhs{dired-git-info-auto-enable}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{use-package!} async
  \EFb{:init} \EFrdb{(}\EFv{dired-async-mode} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} dired-quick-sort
  \EFb{:config}
  \EFrdb{(}\EFo{dired-quick-sort-setup}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{dired-quick-sort-suppress-setup-warning} t\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} openwith
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{openwith-associations}
        \EFrdc{(}\EFk{cond}
         \EFrdd{(}\EFrda{(}\EFo{string-equal} \EFv{system-type} \EFs{"darwin"}\EFrda{)}
          \EFhq{'}\EFrda{(}\EFrdb{(}\EFs{"\char92{}\char92{}.}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{dmg}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{doc}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{docs}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{xls}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{xlsx}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"}
             \EFs{"open"} \EFrdc{(}file\EFrdc{)}\EFrdb{)}
            \EFrdb{(}\EFs{"\char92{}\char92{}.}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{mp4}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mp3}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{webm}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{avi}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{flv}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mov}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"}
             \EFs{"open"} \EFrdc{(}\EFs{"-a"} \EFs{"VLC"} file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFrda{(}\EFo{string-equal} \EFv{system-type} \EFs{"gnu/linux"}\EFrda{)}
          \EFhq{'}\EFrda{(}\EFrdb{(}\EFs{"\char92{}\char92{}.}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{mp4}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{m4a}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mp3}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mkv}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{webm}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{avi}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{flv}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{mov}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{pdf}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{part}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"}
             \EFs{"xdg-open"} \EFrdc{(}file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFv{openwith-mode} t\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{large-file-warning-threshold} \EFhn{3000000000}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{define-key} \EFv{dired-mode-map} \EFrdb{(}\EFo{kbd} \EFs{"<backspace>"}\EFrdb{)} \EFhq{'}\EFhs{dired-up-directory}\EFrda{)}

\EFcd{;; }\EFc{Docview j and k go forward a line which is weird behaviour in a pdf}
\EFcd{;; }\EFc{Paging is prefered to scrolling}
\EFrda{(}\EFk{after!} doc-view-mode
\EFrdb{(}\EFo{define-key} doc-view-mode-map \EFrdc{(}\EFo{kbd} \EFs{"j"}\EFrdc{)} \EFhq{'}\EFhs{doc-view-next-page}\EFrdb{)}
\EFrdb{(}\EFo{define-key} doc-view-mode-map \EFrdc{(}\EFo{kbd} \EFs{"k"}\EFrdc{)} \EFhq{'}\EFhs{doc-view-previous-page}\EFrdb{)}
  \EFrda{)}

\EFcd{;; }\EFc{Convert files automatically}
\EFrda{(}\EFk{defun} \EFf{dired-convert-file} \EFrdb{(}\EFrdb{)}
  \EFd{"Converts pptx or docx files to pdf"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{cl-map} \EFhq{'}\EFhs{nil} \EFhq{'}\EFrdc{(}lambda \EFrdd{(}file\EFrdd{)}
                   \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}ext \EFrdc{(}\EFo{file-name-extension} file\EFrdc{)}\EFrdb{)}
                         \EFrdb{(}base-name-sans-ext \EFrdc{(}\EFo{file-name-sans-extension} \EFrdd{(}\EFo{file-name-nondirectory} file\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                     \EFrda{(}\EFk{cond}
                      \EFrdb{(}\EFrdc{(}\EFk{or} \EFrdd{(}\EFo{string-equal} ext \EFs{"pptx"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"ppt"}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{async-shell-command} \EFrdd{(}\EFo{format} \EFs{"libreoffice --headless --invisible --convert-to pdf \char92{}"\%s\char92{}""} file\EFrdd{)}\EFrdc{)}\EFrdb{)}
                      \EFrdb{(}\EFrdc{(}\EFk{or} \EFrdd{(}\EFo{string-equal} ext \EFs{"docx"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"doc"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"epub"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"tex"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} \EFs{"html"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"org"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"txt"}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{async-shell-command} \EFrdd{(}\EFo{format} \EFs{"pandoc -i \char92{}"\%s\char92{}" -o \char92{}"\%s.pdf\char92{}""} file base-name-sans-ext\EFrdd{)}\EFrdc{)}\EFrdb{)}
                      \EFrdb{(}\EFrdc{(}\EFk{or} \EFrdd{(}\EFo{string-equal} ext \EFs{"jpg"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"jpeg"}\EFrdd{)} \EFrdd{(}\EFo{string-equal} ext \EFs{"png"}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{async-shell-command} \EFrdd{(}\EFo{format} \EFs{"convert \char92{}"\%s\char92{}" -rotate 90 \char92{}"\%s\char92{}""} file file\EFrdd{)}\EFrdc{)}\EFrdb{)}
                      \EFrda{)}\EFrdd{)}\EFrdc{)} \textcolor[HTML]{98be65}{(}\textcolor[HTML]{ECBE7B}{dired-get-marked-files}\textcolor[HTML]{98be65}{)}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}

\EFcd{;; }\EFc{Toggle youtube-dl-list if in elfeed-youtube buffer, else perform regular load}
\EFrda{(}\EFk{defun} \EFf{dired-load-or-youtube-toggle} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}\EFo{string-equal} \EFrda{(}\EFo{buffer-name}\EFrda{)} \EFs{"elfeed-youtube"}\EFrdd{)}
         \EFrdd{(}\EFf{youtube-dl-list}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}\EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{youtube-dl-list-mode}\EFrdd{)} \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}t \EFrdd{(}\EFo{dired-do-load}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{dired-mode-map}
      \EFcd{;}\EFc{:after dired-mode}
      \EFcd{;}\EFc{:n doom-leader-key nil}
      \EFb{:n} \EFs{"c"} \EFhq{\#'}\EFhs{dired-convert-file}
      \EFb{:n} \EFs{"L"} \EFhq{\#'}\EFhs{dired-load-or-youtube-toggle}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{youtube-dl-list-mode-map}
      \EFb{:n} \EFs{"L"} \EFhq{\#'}\EFhs{dired-load-or-youtube-toggle}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{dired-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Ebooks}
\label{sec:org0d1a7c6}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{ebook-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:org720e8b8}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{ebook-tweaks.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{use-package!} calibredb
  \EFb{:commands} calibredb
  \EFb{:config}
  \EFrdb{(}\EFk{setq} calibredb-root-dir \EFs{"/home/user/sshfs/calibre/"}
        calibredb-db-dir \EFrdc{(}\EFo{expand-file-name} \EFs{"metadata.db"} calibredb-root-dir\EFrdc{)}
        sql-sqlite-program \EFs{"sqlite3"}\EFrdb{)}

\EFrdb{(}\EFk{setq} calibredb-id-width \EFhn{12}\EFrdb{)}
\EFrdb{(}\EFk{setq} calibredb-format-all-the-icons t\EFrdb{)}
\EFrdb{(}\EFk{setq} calibredb-format-icons-in-terminal t\EFrdb{)}
\EFrdb{(}\EFk{setq} calibredb-format-character-icons t\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:map} calibredb-show-mode-map
        \EFb{:ne} \EFs{"?"} \EFhq{\#'}\EFhs{calibredb-entry-dispatch}
        \EFb{:ne} \EFs{"o"} \EFhq{\#'}\EFhs{calibredb-find-file}
        \EFb{:ne} \EFs{"O"} \EFhq{\#'}\EFhs{calibredb-find-file-other-frame}
        \EFb{:ne} \EFs{"V"} \EFhq{\#'}\EFhs{calibredb-open-file-with-default-tool}
        \EFb{:ne} \EFs{"s"} \EFhq{\#'}\EFhs{calibredb-set-metadata-dispatch}
        \EFb{:ne} \EFs{"e"} \EFhq{\#'}\EFhs{calibredb-export-dispatch}
        \EFb{:ne} \EFs{"q"} \EFhq{\#'}\EFhs{calibredb-entry-quit}
        \EFb{:ne} \EFs{"."} \EFhq{\#'}\EFhs{calibredb-open-dired}
        \EFb{:ne} \EFrdc{[}tab\EFrdc{]} \EFhq{\#'}\EFhs{calibredb-toggle-view-at-point}
        \EFb{:ne} \EFs{"M-t"} \EFhq{\#'}\EFhs{calibredb-set-metadata--tags}
        \EFb{:ne} \EFs{"M-a"} \EFhq{\#'}\EFhs{calibredb-set-metadata--author\_sort}
        \EFb{:ne} \EFs{"M-A"} \EFhq{\#'}\EFhs{calibredb-set-metadata--authors}
        \EFb{:ne} \EFs{"M-T"} \EFhq{\#'}\EFhs{calibredb-set-metadata--title}
        \EFb{:ne} \EFs{"M-c"} \EFhq{\#'}\EFhs{calibredb-set-metadata--comments}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:map} calibredb-search-mode-map
        \EFb{:ne} \EFrdc{[}mouse-3\EFrdc{]} \EFhq{\#'}\EFhs{calibredb-search-mouse}
        \EFb{:ne} \EFs{"RET"} \EFhq{\#'}\EFhs{calibredb-find-file}
        \EFb{:ne} \EFs{"?"} \EFhq{\#'}\EFhs{calibredb-dispatch}
        \EFb{:ne} \EFs{"a"} \EFhq{\#'}\EFhs{calibredb-add}
        \EFb{:ne} \EFs{"A"} \EFhq{\#'}\EFhs{calibredb-add-dir}
        \EFb{:ne} \EFs{"c"} \EFhq{\#'}\EFhs{calibredb-clone}
        \EFb{:ne} \EFs{"d"} \EFhq{\#'}\EFhs{calibredb-remove}
        \EFb{:ne} \EFs{"D"} \EFhq{\#'}\EFhs{calibredb-remove-marked-items}
        \EFb{:ne} \EFs{"j"} \EFhq{\#'}\EFhs{calibredb-next-entry}
        \EFb{:ne} \EFs{"k"} \EFhq{\#'}\EFhs{calibredb-previous-entry}
        \EFb{:ne} \EFs{"l"} \EFhq{\#'}\EFhs{calibredb-virtual-library-list}
        \EFb{:ne} \EFs{"L"} \EFhq{\#'}\EFhs{calibredb-library-list}
        \EFb{:ne} \EFs{"n"} \EFhq{\#'}\EFhs{calibredb-virtual-library-next}
        \EFb{:ne} \EFs{"N"} \EFhq{\#'}\EFhs{calibredb-library-next}
        \EFb{:ne} \EFs{"p"} \EFhq{\#'}\EFhs{calibredb-virtual-library-previous}
        \EFb{:ne} \EFs{"P"} \EFhq{\#'}\EFhs{calibredb-library-previous}
        \EFb{:ne} \EFs{"s"} \EFhq{\#'}\EFhs{calibredb-set-metadata-dispatch}
        \EFb{:ne} \EFs{"S"} \EFhq{\#'}\EFhs{calibredb-switch-library}
        \EFb{:ne} \EFs{"o"} \EFhq{\#'}\EFhs{calibredb-find-file}
        \EFb{:ne} \EFs{"O"} \EFhq{\#'}\EFhs{calibredb-find-file-other-frame}
        \EFb{:ne} \EFs{"v"} \EFhq{\#'}\EFhs{calibredb-view}
        \EFb{:ne} \EFs{"V"} \EFhq{\#'}\EFhs{calibredb-open-file-with-default-tool}
        \EFb{:ne} \EFs{"."} \EFhq{\#'}\EFhs{calibredb-open-dired}
        \EFb{:ne} \EFs{"b"} \EFhq{\#'}\EFhs{calibredb-catalog-bib-dispatch}
        \EFb{:ne} \EFs{"e"} \EFhq{\#'}\EFhs{calibredb-export-dispatch}
        \EFb{:ne} \EFs{"r"} \EFhq{\#'}\EFhs{calibredb-search-refresh-and-clear-filter}
        \EFb{:ne} \EFs{"R"} \EFhq{\#'}\EFhs{calibredb-search-clear-filter}
        \EFb{:ne} \EFs{"q"} \EFhq{\#'}\EFhs{calibredb-search-quit}
        \EFb{:ne} \EFs{"m"} \EFhq{\#'}\EFhs{calibredb-mark-and-forward}
        \EFb{:ne} \EFs{"f"} \EFhq{\#'}\EFhs{calibredb-toggle-favorite-at-point}
        \EFb{:ne} \EFs{"x"} \EFhq{\#'}\EFhs{calibredb-toggle-archive-at-point}
        \EFb{:ne} \EFs{"h"} \EFhq{\#'}\EFhs{calibredb-toggle-highlight-at-point}
        \EFb{:ne} \EFs{"u"} \EFhq{\#'}\EFhs{calibredb-unmark-and-forward}
        \EFb{:ne} \EFs{"i"} \EFhq{\#'}\EFhs{calibredb-edit-annotation}
        \EFb{:ne} \EFs{"DEL"} \EFhq{\#'}\EFhs{calibredb-unmark-and-backward}
        \EFb{:ne} \EFrdc{[}backtab\EFrdc{]} \EFhq{\#'}\EFhs{calibredb-toggle-view}
        \EFb{:ne} \EFrdc{[}tab\EFrdc{]} \EFhq{\#'}\EFhs{calibredb-toggle-view-at-point}
        \EFb{:ne} \EFs{"M-n"} \EFhq{\#'}\EFhs{calibredb-show-next-entry}
        \EFb{:ne} \EFs{"M-p"} \EFhq{\#'}\EFhs{calibredb-show-previous-entry}
        \EFb{:ne} \EFs{"/"} \EFhq{\#'}\EFhs{calibredb-search-live-filter}
        \EFb{:ne} \EFs{"M-t"} \EFhq{\#'}\EFhs{calibredb-set-metadata--tags}
        \EFb{:ne} \EFs{"M-a"} \EFhq{\#'}\EFhs{calibredb-set-metadata--author\_sort}
        \EFb{:ne} \EFs{"M-A"} \EFhq{\#'}\EFhs{calibredb-set-metadata--authors}
        \EFb{:ne} \EFs{"M-T"} \EFhq{\#'}\EFhs{calibredb-set-metadata--title}
        \EFb{:ne} \EFs{"M-c"} \EFhq{\#'}\EFhs{calibredb-set-metadata--comments}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} nov
  \EFb{:mode} \EFrdb{(}\EFs{"\char92{}\char92{}.epub\char92{}\char92{}'"} . nov-mode\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{map!} \EFb{:map} nov-mode-map
        \EFb{:n} \EFs{"RET"} \EFhq{\#'}\EFhs{nov-scroll-up}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{doom-modeline-segment--nov-info} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFo{concat}
     \EFs{" "}
     \EFrdd{(}\EFo{propertize}
      \EFrda{(}\EFo{cdr} \EFrdb{(}\EFo{assoc} \EFhq{'}\EFhs{creator} nov-metadata\EFrdb{)}\EFrda{)}
      \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-modeline-project-parent-dir}\EFrdd{)}
     \EFs{" "}
     \EFrdd{(}\EFo{cdr} \EFrda{(}\EFo{assoc} \EFhq{'}\EFhs{title} nov-metadata\EFrda{)}\EFrdd{)}
     \EFs{" "}
     \EFrdd{(}\EFo{propertize}
      \EFrda{(}\EFo{format} \EFs{"\%d/\%d"}
              \EFrdb{(}\EFo{1+} nov-documents-index\EFrdb{)}
              \EFrdb{(}\EFo{length} nov-documents\EFrdb{)}\EFrda{)}
      \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-modeline-info}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFo{advice-add} \EFhq{'}\EFhs{nov-render-title} \EFb{:override} \EFhq{\#'}\EFhs{ignore}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{+nov-mode-setup} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFo{face-remap-add-relative} \EFhq{'}\EFhs{variable-pitch}
                             \EFb{:family} \EFs{"Merriweather"}
                             \EFb{:height} \EFhn{1.4}
                             \EFb{:width} \EFhq{'}\EFhs{semi-expanded}\EFrdc{)}
    \EFrdc{(}\EFo{face-remap-add-relative} \EFhq{'}\EFhs{default} \EFb{:height} \EFhn{0.7}\EFrdc{)}
    \EFrdc{(}\EFk{setq-local} \EFv{line-spacing} \EFhn{0.1}
                \EFv{next-screen-context-lines} \EFhn{4}
                \EFv{shr-use-colors} nil\EFrdc{)}
    \EFrdc{(}\EFo{require} \EFhq{'}\EFo{visual-fill-column} nil t\EFrdc{)}
    \EFrdc{(}\EFk{setq-local} \EFv{visual-fill-column-center-text} t
                \EFv{visual-fill-column-width} \EFhn{81}
                nov-text-width \EFhn{120}\EFrdc{)}
    \EFrdc{(}\EFv{visual-fill-column-mode} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFv{hl-line-mode} \EFhn{-1}\EFrdc{)}

    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{+lookup-definition-functions} \EFhq{\#'}\EFhs{+lookup/dictionary-definition}\EFrdc{)}

    \EFrdc{(}\EFk{setq-local} \EFv{mode-line-format}
                \EFhq{`}\EFrdd{(}\EFrda{(}\EFb{:eval}
                   \EFrdb{(}\EFo{doom-modeline-segment--workspace-name}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFb{:eval}
                   \EFrdb{(}\EFo{doom-modeline-segment--window-number}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFb{:eval}
                   \EFrdb{(}doom-modeline-segment--nov-info\EFrdb{)}\EFrda{)}
                  ,\EFrda{(}\EFo{propertize}
                    \EFs{" \%P "}
                    \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-modeline-buffer-minor-mode}\EFrda{)}
                  ,\EFrda{(}\EFo{propertize}
                    \EFs{" "}
                    \EFhq{'}\EFhs{face} \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{doom-modeline--active}\EFrdc{)} \EFhq{'}\EFhs{mode-line} \EFhq{'}\EFhs{mode-line-inactive}\EFrdb{)}
                    \EFhq{'}\EFhs{display} \EFhq{`}\EFrdb{(}\EFrdc{(}space
                                \EFb{:align-to}
                                \EFrdd{(}\EFo{-} \EFrda{(}\EFo{+} right right-fringe right-margin\EFrda{)}
                                   ,\EFrda{(}\EFo{*} \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}width \EFrda{(}\EFo{doom-modeline--font-width}\EFrda{)}\EFrdd{)}\EFrdc{)}
                                         \EFrdc{(}\EFk{or} \EFrdd{(}\EFk{and} \EFrda{(}\EFo{=} width \EFhn{1}\EFrda{)} \EFhn{1}\EFrdd{)}
                                             \EFrdd{(}\EFo{/} width \EFrda{(}\EFo{frame-char-width}\EFrda{)} \EFhn{1.0}\EFrdd{)}\EFrdc{)}\EFrdb{)}
                                       \EFrdb{(}\EFo{string-width}
                                        \EFrdc{(}\EFo{format-mode-line} \EFrdd{(}\EFo{cons} \EFs{""} \EFhq{'}\EFrda{(}\EFb{:eval} \EFrdb{(}\EFo{doom-modeline-segment--major-mode}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFb{:eval} \EFrdb{(}\EFo{doom-modeline-segment--major-mode}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFhs{nov-mode-hook} \EFhq{\#'}\EFhs{+nov-mode-setup}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{ebook-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Org-Roam}
\label{sec:org384210a}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-roam-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org88792ec}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} org-roam\EFrda{)}
\EFrda{(}\EFk{package!} org-roam-ui\EFrda{)}
\EFrda{(}\EFk{package!} org-roam-timestamps\EFrda{)}
\EFrda{(}\EFk{package!} org-roam-bibtex\EFrda{)}
\EFrda{(}\EFk{package!} citar-org-roam\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:orgb4cabad}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{setq} \EFv{org-roam-directory} \EFs{"\char126{}/dox/sync/org/roam"}\EFrda{)}
\EFrda{(}\EFv{org-roam-db-autosync-mode} \EFhn{1}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-roam-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Editing}
\label{sec:orga86775d}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{editing}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgb9b5b27}
\#+begin\textsubscript{src} emacs-lisp :tangle packages.el

\subsubsection{Code}
\label{sec:org78eef7f}
\#+end\textsubscript{src}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{editing.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{defun} \EFf{which-active-modes} \EFrdb{(}\EFrdb{)}
  \EFd{"Return which minor modes are enabled in the current buffer."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}active-modes\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{mapc} \EFrdd{(}\EFk{lambda} \EFrda{(}mode\EFrda{)} \EFrda{(}\EFk{condition-case} nil
                        \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{symbolp} mode\EFrdd{)} \EFrdd{(}\EFo{symbol-value} mode\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFhs{active-modes} mode\EFrdc{)}\EFrdb{)}
                      \EFrdb{(}\EFo{error} nil\EFrdb{)} \EFrda{)}\EFrdd{)}
          \EFv{minor-mode-list}\EFrdc{)}
    \EFrdc{(}\EFo{format} \EFs{"\%s"} active-modes\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{replace-regexp-entire-buffer} \EFrdb{(}pattern replacement\EFrdb{)}
  \EFd{"Perform regular-expression replacement throughout buffer."}
  \EFrdb{(}\EFk{interactive}
   \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}args \EFrdb{(}\EFo{query-replace-read-args} \EFs{"Replace"} t\EFrdb{)}\EFrda{)}\EFrdd{)}
     \EFrdd{(}\EFo{setcdr} \EFrda{(}\EFo{cdr} args\EFrda{)} nil\EFrdd{)}    \EFcd{; }\EFc{remove third value returned from query---args}
     args\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{while} \EFrdd{(}\EFo{re-search-forward} pattern nil t\EFrdd{)}
      \EFrdd{(}\EFo{replace-match} replacement\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{setq} toggle-auto-fill-boolean nil
      \EFv{which-key-idle-delay} \EFhn{0.5}
      \EFv{which-key-allow-multiple-replacements} t\EFrda{)}

\EFrda{(}\EFk{after!} which-key
  \EFrdb{(}\EFk{pushnew!}
   \EFv{which-key-replacement-alist}
   \EFhq{'}\EFrdc{(}\EFrdd{(}\EFs{""} . \EFs{"\char92{}\char92{}`+?evil[-:]?}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(?:}}\EFs{a-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{?}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"}\EFrdd{)} . \EFrdd{(}nil . \EFs{"◂\char92{}\char92{}1"}\EFrdd{)}\EFrdc{)}
   \EFhq{'}\EFrdc{(}\EFrdd{(}\EFs{"\char92{}\char92{}`g s"} . \EFs{"\char92{}\char92{}`evilem--?motion-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"}\EFrdd{)} . \EFrdd{(}nil . \EFs{"◃\char92{}\char92{}1"}\EFrdd{)}\EFrdc{)}
   \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} company
  \EFrdb{(}\EFk{setq} \EFv{company-idle-delay} \EFhn{0.5}
        \EFv{company-minimum-prefix-length} \EFhn{2}
        \EFv{company-show-numbers} t\EFrdb{)}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{evil-normal-state-entry-hook} \EFhq{\#'}\EFhs{company-abort}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFf{set-company-backend!}
  \EFhq{'}\EFrdb{(}text-mode
    markdown-mode
    gfm-mode\EFrdb{)}
  \EFhq{'}\EFrdb{(}\EFb{:seperate}
    company-ispell
    company-files
    company-yasnippet\EFrdb{)}\EFrda{)}

\EFrda{(}\EFf{set-company-backend!} \EFhq{'}\EFhs{ess-r-mode}
  \EFhq{'}\EFrdb{(}company-R-args company-R-objects company-dabbrev-code \EFb{:separate}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} vlf-setup
  \EFb{:defer-incrementally} vlf-tune vlf-base vlf-write vlf-search vlf-occur vlf-follow vlf-ediff vlf\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{eros-eval-result-prefix} \EFs{"⟹ "}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{toggle-auto-fill-on} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{set-fill-column} \EFhn{100}\EFrdb{)} \EFcd{;}\EFc{80}
  \EFrdb{(}\EFo{auto-fill-mode} t\EFrdb{)}
  \EFrdb{(}\EFk{setq} toggle-auto-fill-boolean t\EFrdb{)}
  \EFcd{;}\EFc{(string-match-p "auto-fill-function" (which-active-modes))}
  \EFrdb{(}\EFo{message} \EFs{"auto-fill-mode on"}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{toggle-auto-fill-off} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFf{replace-regexp-entire-buffer} \EFs{"\char92{}n"} \EFs{" "}\EFrdb{)}
  \EFrdb{(}\EFo{auto-fill-mode} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} toggle-auto-fill-boolean nil\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFs{"auto-fill-mode off"}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{toggle-auto-fill} \EFrdb{(}\EFrdb{)}
  \EFd{"Toggle auto fill mode and reset buffer to non-auto-fill."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} toggle-auto-fill-boolean
      \EFrdc{(}\EFf{toggle-auto-fill-off}\EFrdc{)}
    \EFrdc{(}\EFf{toggle-auto-fill-on}\EFrdc{)}
    \EFrdb{)}\EFrda{)}



\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"M-q"}\EFrdb{)} \EFhq{'}\EFhs{toggle-auto-fill}\EFrda{)}

\EFrda{(}\EFk{use-package!} aas
  \EFb{:commands} aas-mode\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{yas-triggers-in-field} t\EFrda{)}

\EFrda{(}\EFk{use-package!} string-inflection
  \EFb{:commands} \EFrdb{(}\EFo{string-inflection-all-cycle}
             string-inflection-toggle
             string-inflection-camelcase
             string-inflection-lower-camelcase
             string-inflection-kebab-case
             string-inflection-underscore
             string-inflection-capital-underscore
             string-inflection-upcase\EFrdb{)}
  \EFb{:init}
  \EFrdb{(}\EFk{map!} \EFb{:leader} \EFb{:prefix} \EFrdc{(}\EFs{"c\char126{}"} . \EFs{"naming convention"}\EFrdc{)}
        \EFb{:desc} \EFs{"cycle"} \EFs{"\char126{}"} \EFhq{\#'}\EFhs{string-inflection-all-cycle}
        \EFb{:desc} \EFs{"toggle"} \EFs{"t"} \EFhq{\#'}\EFhs{string-inflection-toggle}
        \EFb{:desc} \EFs{"CamelCase"} \EFs{"c"} \EFhq{\#'}\EFhs{string-inflection-camelcase}
        \EFb{:desc} \EFs{"downCase"} \EFs{"d"} \EFhq{\#'}\EFhs{string-inflection-lower-camelcase}
        \EFb{:desc} \EFs{"kebab-case"} \EFs{"k"} \EFhq{\#'}\EFhs{string-inflection-kebab-case}
        \EFb{:desc} \EFs{"under\_score"} \EFs{"\_"} \EFhq{\#'}\EFhs{string-inflection-underscore}
        \EFb{:desc} \EFs{"Upper\_Score"} \EFs{"u"} \EFhq{\#'}\EFhs{string-inflection-capital-underscore}
        \EFb{:desc} \EFs{"UP\_CASE"} \EFs{"U"} \EFhq{\#'}\EFhs{string-inflection-upcase}\EFrdb{)}
  \EFrdb{(}\EFk{after!} evil
    \EFrdc{(}\EFk{evil-define-operator} \EFf{evil-operator-string-inflection} \EFrdd{(}beg end \_type\EFrdd{)}
      \EFd{"Define a new evil operator that cycles symbol casing."}
      \EFb{:move-point} nil
      \EFrdd{(}\EFk{interactive} \EFs{"<R>"}\EFrdd{)}
      \EFrdd{(}\EFo{string-inflection-all-cycle}\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{evil-repeat-info} \EFhq{'}\EFrda{(}\EFrdb{[}?g ?\char126{}\EFrdb{]}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-normal-state-map} \EFrdd{(}\EFo{kbd} \EFs{"g\char126{}"}\EFrdd{)} \EFhq{'}\EFhs{evil-operator-string-inflection}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-normal-state-map} \EFrdd{(}\EFo{kbd} \EFs{"<remap> <evil-next-line>"}\EFrdd{)} \EFhq{'}\EFhs{evil-next-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-normal-state-map} \EFrdd{(}\EFo{kbd} \EFs{"<remap> <evil-previous-line>"}\EFrdd{)} \EFhq{'}\EFhs{evil-previous-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-motion-state-map} \EFrdd{(}\EFo{kbd} \EFs{"<remap> <evil-next-line>"}\EFrdd{)} \EFhq{'}\EFhs{evil-next-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{evil-motion-state-map} \EFrdd{(}\EFo{kbd} \EFs{"<remap> <evil-previous-line>"}\EFrdd{)} \EFhq{'}\EFhs{evil-previous-visual-line}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{sp-local-pair}
 \EFhq{'}\EFrdb{(}org-mode\EFrdb{)}
 \EFs{"<<"} \EFs{">>"}
 \EFb{:actions} \EFhq{'}\EFrdb{(}insert\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} authinfo-color-mode
  \EFb{:mode} \EFrdb{(}\EFs{"authinfo.gpg\char92{}\char92{}'"} . authinfo-color-mode\EFrdb{)}
  \EFb{:init} \EFrdb{(}\EFo{advice-add} \EFhq{'}\EFhs{authinfo-mode} \EFb{:override} \EFhq{\#'}\EFhs{authinfo-color-mode}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} systemd
  \EFb{:defer} t\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{global-visual-line-mode} t
 \EFv{evil-respect-visual-line-mode} t\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{editing}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Elfeed Tweaks}
\label{sec:org301e38f}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{elfeed-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orge463788}
\#+begin\textsubscript{src} emacs-lisp :tangle packages.el

\subsubsection{Code}
\label{sec:orgae676a8}
\#+end\textsubscript{src}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{elfeed-tweaks.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} rmh-elfeed-org-files \EFrdb{(}\EFo{cons} \EFrdc{(}\EFo{expand-file-name} \EFs{"ext/elfeed/elfeed.org"} \EFv{doom-private-dir}\EFrdc{)}\EFrdc{(}\EFrdc{)}\EFrdb{)}
      elfeed-db-directory \EFrdb{(}\EFo{expand-file-name} \EFs{"ext/elfeed/db/"} \EFv{doom-private-dir}\EFrdb{)}
      elfeed-thumbnail-dir \EFs{"/tmp/elfeed-thumbnails/"}\EFrda{)}


\EFrda{(}\EFk{map!} \EFb{:map} elfeed-search-mode-map
      \EFb{:after} elfeed-search
                                        \EFcd{;}\EFc{[remap kill-this-buffer] "q"}
                                        \EFcd{;}\EFc{[remap kill-buffer] "q"}
      \EFb{:n} \EFv{doom-leader-key} nil
      \EFb{:n} \EFs{"q"} \EFhq{\#'}\EFhs{elfeed-save-summary}
      \EFb{:n} \EFs{"e"} \EFhq{\#'}\EFhs{elfeed-update}
      \EFb{:n} \EFs{"r"} \EFhq{\#'}\EFhs{elfeed-search-untag-all-unread}
      \EFb{:n} \EFs{"u"} \EFhq{\#'}\EFhs{elfeed-search-tag-all-unread}
      \EFb{:n} \EFs{"s"} \EFhq{\#'}\EFhs{elfeed-search-live-filter}
      \EFb{:n} \EFs{"RET"} \EFhq{\#'}\EFhs{elfeed-search-show-entry}
      \EFb{:n} \EFs{"p"} \EFhq{\#'}\EFhs{elfeed-show-pdf}
      \EFb{:n} \EFs{"v"} \EFhq{\#'}\EFhs{elfeed-search-youtube-dl}
      \EFb{:n} \EFs{"L"} \EFhq{\#'}\EFhs{youtube-dl-list}
      \EFb{:n} \EFs{"+"} \EFhq{\#'}\EFhs{elfeed-search-tag-all}
      \EFb{:n} \EFs{"-"} \EFhq{\#'}\EFhs{elfeed-search-untag-all}
      \EFb{:n} \EFs{"S"} \EFhq{\#'}\EFhs{elfeed-search-set-filter}
      \EFb{:n} \EFs{"b"} \EFhq{\#'}\EFhs{elfeed-search-browse-url}
      \EFb{:n} \EFs{"t"} \EFhq{\#'}\EFhs{elfeed-search-thumbnail}
      \EFb{:n} \EFs{"y"} \EFhq{\#'}\EFhs{elfeed-search-yank}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} elfeed-show-mode-map
      \EFb{:after} elfeed-show
                                        \EFcd{;}\EFc{[remap kill-this-buffer] "q"}
                                        \EFcd{;}\EFc{[remap kill-buffer] "q"}
      \EFb{:n} \EFv{doom-leader-key} nil
      \EFb{:nm} \EFs{"q"} \EFhq{\#'}\EFhs{elfeed-save-close}
      \EFb{:nm} \EFs{"o"} \EFhq{\#'}\EFhs{ace-link-elfeed}
      \EFb{:nm} \EFs{"A"} \EFhq{\#'}\EFhs{elfeed-wget-url}
      \EFb{:nm} \EFs{"RET"} \EFhq{\#'}\EFhs{elfeed-tube-mpv-open}
      \EFb{:nm} \EFs{"n"} \EFhq{\#'}\EFhs{elfeed-show-next}
      \EFb{:nm} \EFs{"N"} \EFhq{\#'}\EFhs{elfeed-show-prev}
      \EFb{:nm} \EFs{"p"} \EFhq{\#'}\EFhs{elfeed-show-pdf}
      \EFb{:nm} \EFs{"v"} \EFhq{\#'}\EFhs{elfeed-show-youtube-dl}
      \EFb{:nm} \EFs{"d"} \EFhq{\#'}\EFhs{elfeed-show-download-enclosure}
      \EFb{:nm} \EFs{"D"} \EFhq{\#'}\EFhs{elfeed-show-download-enclosure}
      \EFb{:nm} \EFs{"L"} \EFhq{\#'}\EFhs{youtube-dl-list}
      \EFb{:nm} \EFs{"+"} \EFhq{\#'}\EFhs{elfeed-show-tag}
      \EFb{:nm} \EFs{"-"} \EFhq{\#'}\EFhs{elfeed-show-untag}
      \EFb{:nm} \EFs{"s"} \EFhq{\#'}\EFhs{elfeed-show-new-live-search}
      \EFb{:nm} \EFs{"y"} \EFhq{\#'}\EFhs{elfeed-show-yank}\EFrda{)}
\EFrda{(}\EFk{map!} \EFb{:map} elfeed-summary-mode-map
      \EFb{:after} elfeed-summary
      \EFb{:n} \EFs{"L"} \EFhq{\#'}\EFhs{youtube-dl-list}
      \EFb{:n} \EFs{"V"} \EFhq{\#'}\EFhs{open-yt-dl-videos}
      \EFb{:n} \EFs{"R"} \EFhq{\#'}\EFhs{elfeed-summary-load-update}
      \EFb{:n} \EFs{"C-x C-s"} \EFhq{\#'}\EFhs{elfeed-summary-save}
      \EFb{:n} \EFs{"RET"} \EFhq{\#'}\EFhs{elfeed-summary-action-save-location}\EFrda{)}

\EFrda{(}\EFk{after!} elfeed-search
  \EFrdb{(}\EFf{set-evil-initial-state!} \EFhq{'}\EFhs{elfeed-search-mode} \EFhq{'}\EFhs{normal}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{after!} elfeed-show-mode
  \EFrdb{(}\EFf{set-evil-initial-state!} \EFhq{'}\EFhs{elfeed-show-mode}   \EFhq{'}\EFhs{normal}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} evil-snipe
  \EFrdb{(}\EFk{push} \EFhq{'}\EFhs{elfeed-show-mode}   \EFv{evil-snipe-disabled-modes}\EFrdb{)}
  \EFrdb{(}\EFk{push} \EFhq{'}\EFhs{elfeed-search-mode} \EFv{evil-snipe-disabled-modes}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} elfeed
  \EFrdb{(}\EFf{elfeed-org}\EFrdb{)}
  \EFrdb{(}\EFk{use-package!} elfeed-link\EFrdb{)}
  \EFrdb{(}elfeed-db-load\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFcd{;}\EFc{elfeed-search-filter "@1-week-ago +unread"}
        elfeed-search-filter \EFs{"@3-days-ago unread"}
        \EFv{flycheck-global-modes} \EFhq{'}\EFrdc{(}not . \EFrdd{(}elfeed-search-mode\EFrdd{)}\EFrdc{)}
        elfeed-summary--only-unread t
        elfeed-search-print-entry-function \EFhq{'}\EFhs{+rss/elfeed-search-print-entry}
        elfeed-search-title-min-width \EFhn{80}
        elfeed-show-entry-switch \EFhq{\#'}\EFhs{pop-to-buffer}
        elfeed-show-entry-delete \EFhq{\#'}\EFhs{+rss/delete-pane}
        elfeed-show-refresh-function \EFhq{\#'}\EFhs{+rss/elfeed-show-refresh--better-style}
        \EFv{shr-max-image-proportion} \EFhn{0.6}\EFrdb{)}

  \EFrdb{(}\EFk{add-hook!} \EFhq{'}\EFhs{elfeed-show-mode-hook} \EFrdc{(}\EFv{hide-mode-line-mode} \EFhn{1}\EFrdc{)}\EFrdb{)}
\EFrdb{(}\EFk{defun} \EFf{elfeed-eb-garamond} \EFrdc{(}\EFrdc{)}
  \EFrdc{(}\EFo{buffer-face-set} \EFhq{'}\EFrdd{(}\EFb{:family} \EFs{"EB Garamond"} \EFb{:height} \EFhn{120}\EFrdd{)}\EFrdc{)}\EFrdb{)}

\EFrdb{(}\EFk{add-hook!} \EFhq{'}\EFhs{elfeed-show-mode-hook} \EFhq{'}\EFhs{elfeed-eb-garamond}\EFrdb{)}
  \EFrdb{(}\EFk{add-hook!} \EFhq{'}\EFhs{elfeed-search-update-hook} \EFhq{\#'}\EFv{hide-mode-line-mode}\EFrdb{)}

  \EFrdb{(}\EFk{defface} \EFv{elfeed-show-title-face} \EFhq{'}\EFrdc{(}\EFrdd{(}t \EFrda{(}\EFb{:weight} ultrabold \EFb{:slant} italic \EFb{:height} \EFhn{1.5}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFd{"title face in elfeed show buffer"}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}
  \EFrdb{(}\EFk{defface} \EFv{elfeed-show-author-face} \EFhq{`}\EFrdc{(}\EFrdd{(}t \EFrda{(}\EFb{:weight} light\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFd{"title face in elfeed show buffer"}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}
  \EFrdb{(}\EFo{set-face-attribute} \EFhq{'}\EFhs{elfeed-search-title-face} nil
                      \EFb{:foreground} \EFhq{'}\EFhs{nil}
                      \EFb{:weight} \EFhq{'}\EFhs{light}\EFrdb{)}

  \EFrdb{(}\EFk{defadvice!} +rss-elfeed-wrap-h-nicer \EFrdc{(}\EFrdc{)}
    \EFd{"Enhances an elfeed entry's readability by wrapping it to a width of
`}\textcolor[HTML]{a9a1e1}{fill-column}\EFd{' and centering it with `}\textcolor[HTML]{a9a1e1}{visual-fill-column-mode}\EFd{'."}
    \EFb{:override} \EFhq{\#'}\EFhs{+rss-elfeed-wrap-h}
    \EFrdc{(}\EFk{setq-local} \EFv{truncate-lines} nil
                \EFv{shr-width} \EFhn{120}
                \EFv{visual-fill-column-center-text} t
                \EFv{default-text-properties} \EFhq{'}\EFrdd{(}line-height \EFhn{1.1}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{inhibit-read-only} t\EFrda{)}
          \EFrda{(}\EFv{inhibit-modification-hooks} t\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFv{visual-fill-column-mode} nil\EFrdd{)}
      \EFrdd{(}\EFk{setq-local} \EFv{shr-current-font} \EFhq{'}\EFrda{(}\EFb{:family} \EFs{"Linux Libertine O"} \EFb{:height} \EFhn{1.2}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{set-buffer-modified-p} nil\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{+rss/elfeed-search-print-entry} \EFrdc{(}entry\EFrdc{)}
    \EFd{"Print ENTRY to the buffer."}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}elfeed-goodies/tag-column-width \EFhn{40}\EFrda{)}
           \EFrda{(}elfeed-goodies/feed-source-column-width \EFhn{30}\EFrda{)}
           \EFrda{(}title \EFrdb{(}\EFk{or} \EFrdc{(}elfeed-meta entry \EFb{:title}\EFrdc{)} \EFrdc{(}elfeed-entry-title entry\EFrdc{)} \EFs{""}\EFrdb{)}\EFrda{)}
           \EFrda{(}title-faces \EFrdb{(}elfeed-search--faces \EFrdc{(}elfeed-entry-tags entry\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}feed \EFrdb{(}elfeed-entry-feed entry\EFrdb{)}\EFrda{)}
           \EFrda{(}feed-title
            \EFrdb{(}\EFk{when} feed
              \EFrdc{(}\EFk{or} \EFrdd{(}elfeed-meta feed \EFb{:title}\EFrdd{)} \EFrdd{(}elfeed-feed-title feed\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}tags \EFrdb{(}\EFo{mapcar} \EFhq{\#'}\EFhs{symbol-name} \EFrdc{(}elfeed-entry-tags entry\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}tags-str \EFrdb{(}\EFo{concat} \EFrdc{(}\EFo{mapconcat} \EFhq{'}\EFhs{identity} tags \EFs{","}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}title-width \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{window-width}\EFrdc{)} elfeed-goodies/feed-source-column-width
                           elfeed-goodies/tag-column-width \EFhn{4}\EFrdb{)}\EFrda{)}

           \EFrda{(}tag-column \EFrdb{(}elfeed-format-column
                        tags-str \EFrdc{(}elfeed-clamp \EFrdd{(}\EFo{length} tags-str\EFrdd{)}
                                               elfeed-goodies/tag-column-width
                                               elfeed-goodies/tag-column-width\EFrdc{)}
                        \EFb{:left}\EFrdb{)}\EFrda{)}
           \EFrda{(}feed-column \EFrdb{(}elfeed-format-column
                         feed-title \EFrdc{(}elfeed-clamp elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width\EFrdc{)}
                         \EFb{:left}\EFrdb{)}\EFrda{)}\EFrdd{)}

                                        \EFcd{;}\EFc{(insert (propertize feed-column 'face 'elfeed-search-feed-face) " ")}
                                        \EFcd{;}\EFc{(insert (propertize tag-column 'face 'elfeed-search-tag-face) " ")}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFo{propertize} title \EFhq{'}\EFhs{face} title-faces \EFhq{'}\EFhs{kbd-help} title\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq-local} \EFv{line-spacing} \EFhn{0.2}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{+rss/elfeed-show-refresh--better-style} \EFrdc{(}\EFrdc{)}
    \EFd{"Update the buffer to match the selected entry, using a mail-style."}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}\EFv{inhibit-read-only} t\EFrda{)}
           \EFrda{(}title \EFrdb{(}elfeed-entry-title elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}date \EFrdb{(}\EFo{seconds-to-time} \EFrdc{(}elfeed-entry-date elfeed-show-entry\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}author \EFrdb{(}elfeed-meta elfeed-show-entry \EFb{:author}\EFrdb{)}\EFrda{)}
           \EFrda{(}link \EFrdb{(}elfeed-entry-link elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}tags \EFrdb{(}elfeed-entry-tags elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}tagsstr \EFrdb{(}\EFo{mapconcat} \EFhq{\#'}\EFhs{symbol-name} tags \EFs{", "}\EFrdb{)}\EFrda{)}
           \EFrda{(}nicedate \EFrdb{(}\EFo{format-time-string} \EFs{"\%a, \%e \%b \%Y \%T \%Z"} date\EFrdb{)}\EFrda{)}
           \EFrda{(}content \EFrdb{(}elfeed-deref \EFrdc{(}elfeed-entry-content elfeed-show-entry\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}type \EFrdb{(}elfeed-entry-content-type elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}feed \EFrdb{(}elfeed-entry-feed elfeed-show-entry\EFrdb{)}\EFrda{)}
           \EFrda{(}feed-title \EFrdb{(}elfeed-feed-title feed\EFrdb{)}\EFrda{)}
           \EFrda{(}base \EFrdb{(}\EFk{and} feed \EFrdc{(}elfeed-compute-base \EFrdd{(}elfeed-feed-url feed\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{erase-buffer}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"\char92{}n"}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFo{format} \EFs{"\%s\char92{}n\char92{}n"} \EFrdb{(}\EFo{propertize} title \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-show-title-face}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFo{format} \EFs{"\%s\char92{}t"} \EFrdb{(}\EFo{propertize} feed-title \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-search-feed-face}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFk{and} author elfeed-show-entry-author\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{format} \EFs{"\%s\char92{}n"} \EFrdc{(}\EFo{propertize} author \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-show-author-face}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFo{format} \EFs{"\%s\char92{}n\char92{}n"} \EFrdb{(}\EFo{propertize} nicedate \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-log-date-face}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} tags
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{format} \EFs{"\%s\char92{}n"}
                        \EFrdc{(}\EFo{propertize} tagsstr \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{elfeed-search-tag-face}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFcd{;; }\EFc{(insert (propertize "Link: " 'face 'message-header-name))}
      \EFcd{;; }\EFc{(elfeed-insert-link link link)}
      \EFcd{;; }\EFc{(insert "\char92{}n")}
      \EFrdd{(}\EFk{cl-loop} for enclosure in \EFrda{(}elfeed-entry-enclosures elfeed-show-entry\EFrda{)}
               do \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{propertize} \EFs{"Enclosure: "} \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{message-header-name}\EFrdb{)}\EFrda{)}
               do \EFrda{(}elfeed-insert-link \EFrdb{(}\EFo{car} enclosure\EFrdb{)}\EFrda{)}
               do \EFrda{(}\EFo{insert} \EFs{"\char92{}n"}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"\char92{}n"}\EFrdd{)}
      \EFrdd{(}\EFk{if} content
          \EFrda{(}\EFk{if} \EFrdb{(}\EFo{eq} type \EFhq{'}\EFhs{html}\EFrdb{)}
              \EFrdb{(}elfeed-insert-html content base\EFrdb{)}
            \EFrdb{(}\EFo{insert} content\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{propertize} \EFs{"(empty)\char92{}n"} \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{italic}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defface} \EFv{elfeed-youtube}
    \EFhq{'}\EFrdc{(}\EFrdd{(}t \EFb{:foreground} \EFs{"purple"}\EFrdd{)}\EFrdc{)}
    \EFd{"Marks YouTube videos in Elfeed."}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}

  \EFrdb{(}\EFk{defface} \EFv{elfeed-religion}
    \EFhq{'}\EFrdc{(}\EFrdd{(}t \EFb{:foreground} \EFs{"gold"}\EFrdd{)}\EFrdc{)}
    \EFd{"Marks YouTube videos in Elfeed."}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}

  \EFrdb{(}\EFk{defface} \EFv{elfeed-tech}
    \EFhq{'}\EFrdc{(}\EFrdd{(}t \EFb{:foreground} \EFs{"LightSteelBlue4"}\EFrdd{)}\EFrdc{)}
    \EFd{"Marks Tech videos in Elfeed."}
    \EFb{:group} \EFhq{'}\EFhs{elfeed}\EFrdb{)}

  \EFrdb{(}\EFk{push} \EFhq{'}\EFrdc{(}youtube elfeed-youtube\EFrdc{)}
        elfeed-search-face-alist\EFrdb{)}
  \EFrdb{(}\EFk{push} \EFhq{'}\EFrdc{(}religion elfeed-religion\EFrdc{)}
        elfeed-search-face-alist\EFrdb{)}
  \EFrdb{(}\EFk{push} \EFhq{'}\EFrdc{(}tech elfeed-tech\EFrdc{)}
        elfeed-search-face-alist\EFrdb{)}


  \EFrda{)}

\EFrda{(}\EFk{after!} elfeed-show
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{url}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{elfeed-show-download-enclosure} \EFrdc{(}\EFrdc{)}
    \EFd{"Download the enclosure to yt-dlp directory"}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{let*}
         \EFrdd{(}\EFrda{(}url-enclosure \EFrdb{(}\EFo{car} \EFrdc{(}\EFo{elt} \EFrdd{(}elfeed-entry-enclosures elfeed-show-entry\EFrdd{)} \EFhn{0}\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}filename \EFrdb{(}\EFo{concat} elfeed-enclosure-default-dir \EFs{"/"} \EFrdc{(}elfeed-entry-title elfeed-show-entry\EFrdc{)} \EFs{".mp3"}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}elfeed--download-enclosure url-enclosure filename\EFrdd{)}
      \EFrdd{(}\EFo{message} \EFrda{(}\EFo{format} \EFs{"Downloading \%s"} filename\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defvar} \EFv{elfeed-pdf-dir}
    \EFrdc{(}\EFo{expand-file-name} \EFs{"pdfs/"}
                      \EFrdd{(}\EFo{file-name-directory} \EFrda{(}\EFo{directory-file-name} elfeed-enclosure-default-dir\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defvar} \EFv{elfeed-link-pdfs}
    \EFhq{'}\EFrdc{(}\EFrdd{(}\EFs{"https://www.jstatsoft.org/index.php/jss/article/view/v0}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{/]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} . \EFs{"https://www.jstatsoft.org/index.php/jss/article/view/v0\char92{}\char92{}1/v\char92{}\char92{}1.pdf"}\EFrdd{)}
      \EFrdd{(}\EFs{"http://arxiv.org/abs/}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{/]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} . \EFs{"https://arxiv.org/pdf/\char92{}\char92{}1.pdf"}\EFrdd{)}\EFrdc{)}
    \EFd{"List of alists of the form (REGEX-FOR-LINK . FORM-FOR-PDF)"}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{elfeed-show-pdf} \EFrdc{(}entry\EFrdc{)}
    \EFrdc{(}\EFk{interactive}
     \EFrdd{(}\EFo{list} \EFrda{(}\EFk{or} elfeed-show-entry \EFrdb{(}elfeed-search-selected \EFb{:ignore-region}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}link \EFrdb{(}elfeed-entry-link entry\EFrdb{)}\EFrda{)}
          \EFrda{(}feed-name \EFrdb{(}\EFo{plist-get} \EFrdc{(}elfeed-feed-meta \EFrdd{(}elfeed-entry-feed entry\EFrdd{)}\EFrdc{)} \EFb{:title}\EFrdb{)}\EFrda{)}
          \EFrda{(}title \EFrdb{(}elfeed-entry-title entry\EFrdb{)}\EFrda{)}
          \EFrda{(}file-view-function
           \EFrdb{(}\EFk{lambda} \EFrdc{(}f\EFrdc{)}
             \EFrdc{(}\EFk{when} elfeed-show-entry
               \EFrdd{(}elfeed-kill-buffer\EFrdd{)}\EFrdc{)}
             \EFrdc{(}\EFo{pop-to-buffer} \EFrdd{(}\EFo{find-file-noselect} f\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
          pdf\EFrdd{)}

      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}file \EFrdc{(}\EFo{expand-file-name}
                   \EFrdd{(}\EFo{concat} \EFrda{(}\EFo{subst-char-in-string} ?/ ?, title\EFrda{)} \EFs{".pdf"}\EFrdd{)}
                   \EFrdd{(}\EFo{expand-file-name} \EFrda{(}\EFo{subst-char-in-string} ?/ ?, feed-name\EFrda{)}
                                     elfeed-pdf-dir\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFo{file-exists-p} file\EFrdb{)}
            \EFrdb{(}\EFo{funcall} file-view-function file\EFrdb{)}
          \EFrdb{(}\EFk{dolist} \EFrdc{(}link-pdf elfeed-link-pdfs\EFrdc{)}
            \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{and} \EFrda{(}\EFf{string-match-p} \EFrdb{(}\EFo{car} link-pdf\EFrdb{)} link\EFrda{)}
                       \EFrda{(}\EFo{not} pdf\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFk{setq} pdf \EFrda{(}\EFo{replace-regexp-in-string} \EFrdb{(}\EFo{car} link-pdf\EFrdb{)} \EFrdb{(}\EFo{cdr} link-pdf\EFrdb{)} link\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{not} pdf\EFrdc{)}
              \EFrdc{(}\EFo{message} \EFs{"No associated PDF for entry"}\EFrdc{)}
            \EFrdc{(}\EFo{message} \EFs{"Fetching \%s"} pdf\EFrdc{)}
            \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{file-exists-p} \EFrda{(}\EFo{file-name-directory} file\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFo{make-directory} \EFrda{(}\EFo{file-name-directory} file\EFrda{)} t\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{url-copy-file} pdf file\EFrdc{)}
            \EFrdc{(}\EFo{funcall} file-view-function file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrda{)}

\EFrda{(}\EFk{after!} elfeed-summary
  \EFrdb{(}\EFf{elfeed-org}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-summary-save} \EFrdb{(}\EFrdb{)}
  \EFd{"Save database"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}elfeed-db-save-safe\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-save-summary} \EFrdb{(}\EFrdb{)}
  \EFd{"Save database and go to summary"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}elfeed-db-save-safe\EFrdb{)}
  \EFrdb{(}\EFo{kill-this-buffer}\EFrdb{)}
  \EFrdb{(}\EFf{elfeed-summary}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{boundp} \EFhq{'}\EFhs{elfeed-summary--current-pos}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} elfeed-summary--current-pos\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-save-close} \EFrdb{(}\EFrdb{)}
  \EFd{"Save database and close rss"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}elfeed-db-save-safe\EFrdb{)}
  \EFrdb{(}\EFf{+rss/delete-pane}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-load-summary} \EFrdb{(}\EFrdb{)}
  \EFd{"Load database and go to summary"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{functionp} \EFhq{'}\EFhs{elfeed-db-load}\EFrdd{)} \EFrdd{(}\EFo{not} \EFrda{(}\EFo{get-buffer} \EFs{"*elfeed-summary*"}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{make-thread} \EFrdd{(}elfeed-db-load\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFf{elfeed-summary}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{boundp} \EFhq{'}\EFhs{elfeed-summary--current-pos}\EFrdc{)}
    \EFrdc{(}\EFk{progn}
      \EFrdd{(}\EFo{goto-char} elfeed-summary--current-pos\EFrdd{)}
      \EFrdd{(}\EFo{recenter-top-bottom}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-summary-load-update} \EFrdb{(}\EFrdb{)}
  \EFd{"Loads the database again before updating"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}elfeed-db-load\EFrdb{)}
  \EFrdb{(}\EFo{message} \EFs{"Refreshing db..."}\EFrdb{)}
  \EFrdb{(}\EFf{elfeed-update}\EFrdb{)}
  \EFrdb{(}elfeed-summary-update\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} elfeed-summary-settings
      \EFhq{'}\EFrdb{(}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Blogs [Security]"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . \EFrdb{(}\EFk{and} people security\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Blogs [People]"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . \EFrdb{(}\EFk{and} people \EFrdc{(}\EFo{not} security\EFrdc{)}\EFrdb{)}\EFrda{)}
                \EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Religion"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . religion\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Cooking"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . cooking\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"ASMR"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . asmr\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Crafting"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . crafting\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Entertainment"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . entertainment\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Finances"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . finances\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Foreign Places"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . foreign\_places\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Geography"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . geography\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"History"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . history\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Language"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . language\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Math"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . music\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Nature"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . nature\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Philosophy"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . philosophy\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Politics"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . politics\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Science"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . science\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"SCP"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . scp\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Tech"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . tech\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Podcasts"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . podcast\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Pictures"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                \EFrda{(}query . picture\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFcd{;; }\EFc{...}
        \EFrdc{(}group \EFrdd{(}\EFb{:title} . \EFs{"Miscellaneous"}\EFrdd{)}
               \EFrdd{(}\EFb{:elements}
                                        \EFcd{;}\EFc{(group}
                                        \EFcd{; }\EFc{(:title . "Searches")}
                                        \EFcd{; }\EFc{(:elements}
                                        \EFcd{;  }\EFc{(search}
                                        \EFcd{;   }\EFc{(:filter . "@6-months-ago")}
                                        \EFcd{;   }\EFc{(:title . "Unread"))))}
                \EFrda{(}group
                 \EFrdb{(}\EFb{:title} . \EFs{"Ungrouped"}\EFrdb{)}
                 \EFrdb{(}\EFb{:elements} \EFb{:misc}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-e"}\EFrdb{)} \EFhq{'}\EFhs{elfeed-load-summary}\EFrda{)}

                                        \EFcd{; }\EFc{Elfeed Youtube}

                                        \EFcd{; }\EFc{External youtube-dl library}
\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{load-path} \EFs{"\char126{}/.doom.d/lisp/youtube-dl-emacs"}\EFrda{)}
\EFrda{(}\EFf{after-startup} \EFrdb{(}\EFo{require} \EFhq{'}\EFo{youtube-dl}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{youtube-dl-directory} \EFs{"\char126{}/elfeed-youtube"}
      elfeed-enclosure-default-dir \EFv{youtube-dl-directory}
      youtube-dl-temp-directory \EFs{"/tmp/elfeed-youtube"}
      \EFv{youtube-dl-program} \EFs{"yt-dlp"}
      \EFv{youtube-dl-arguments}
      \EFrdb{(}\EFo{nconc} \EFhq{`}\EFrdc{(}\EFs{"-f"} \EFs{"bestvideo[height<=1080]+bestaudio/best[height<=1080]"}
               \EFs{"--sponsorblock-remove"} \EFs{"default"}
               \EFs{"--prefer-free-formats"}
               \EFs{"--embed-subs"}
               \EFs{"--embed-metadata"}
               \EFs{"--embed-chapters"}
               \EFs{"--ffmpeg-location"} \EFs{"/home/user/.doom.d/ext/bin/"}
               \EFs{"--no-colors"}\EFrdc{)}
             \EFv{youtube-dl-arguments}\EFrdb{)}\EFrda{)}
                                        \EFcd{; }\EFc{(setq youtube-dl-arguments nil)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-v"}\EFrdb{)} \EFhq{'}\EFhs{open-yt-dl-videos}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-V"}\EFrdb{)} \EFhq{'}\EFhs{open-yt-dl-temp-videos}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{open-yt-dl-videos} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFv{youtube-dl-directory}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{open-yt-dl-temp-videos} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} youtube-dl-temp-directory\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{cl-defun} \EFf{elfeed-show-youtube-dl} \EFrdb{(}\EFt{\&key} slow\EFrdb{)}
  \EFd{"Download the current entry with youtube-dl."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{null} \EFrdd{(}\EFf{youtube-dl} \EFrda{(}elfeed-entry-link elfeed-show-entry\EFrda{)}
                        \EFb{:title} \EFrda{(}elfeed-entry-title elfeed-show-entry\EFrda{)}
                        \EFb{:slow} slow\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFo{message} \EFs{"Entry is not a YouTube link!"}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFs{"Downloading \%s"} \EFrdd{(}elfeed-entry-title elfeed-show-entry\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{cl-defun} \EFf{elfeed-search-youtube-dl} \EFrdb{(}\EFt{\&key} slow\EFrdb{)}
  \EFd{"Download the current entry with youtube-dl."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}entries \EFrda{(}elfeed-search-selected\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}entry entries\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{null} \EFrdb{(}\EFf{youtube-dl} \EFrdc{(}elfeed-entry-link entry\EFrdc{)}
                            \EFb{:title} \EFrdc{(}elfeed-entry-title entry\EFrdc{)}
                            \EFb{:slow} slow\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{message} \EFs{"Entry is not a YouTube link!"}\EFrda{)}
        \EFrda{(}\EFo{message} \EFs{"Downloading \%s"} \EFrdb{(}elfeed-entry-title entry\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}elfeed-untag entry \EFhq{'}\EFhs{unread}\EFrdd{)}
      \EFrdd{(}elfeed-search-update-entry entry\EFrdd{)}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFo{use-region-p}\EFrda{)} \EFrda{(}\EFo{forward-line}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{youtube-dl-list-url} \EFrdb{(}\EFrdb{)}
  \EFd{"Return url of item under point."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}n \EFrda{(}\EFo{1-} \EFrdb{(}\EFo{line-number-at-pos}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}item \EFrda{(}\EFo{nth} n \EFv{youtube-dl-items}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} item
      \EFrdd{(}\EFo{message} \EFrda{(}\EFf{youtube-dl-item-destination} item\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                                        \EFcd{; }\EFc{Faces}

\EFrda{(}\EFk{defun} \EFf{elfeed-summary-action-save-location} \EFrdb{(}pos \EFt{\&optional} event\EFrdb{)}
  \EFrdb{(}\EFk{interactive} \EFs{"@d"}\EFrdb{)}
  \EFrdb{(}\EFk{setq} elfeed-summary--current-pos pos\EFrdb{)}
  \EFrdb{(}elfeed-summary--action pos event\EFrdb{)}
  \EFrda{)}



\EFrda{(}\EFk{defun} \EFf{image-tooltip} \EFrdb{(}img-path\EFrdb{)}
  \EFd{"Display image at img-path as tooltip"}
  \EFrdb{(}\EFv{tooltip-mode} \EFhn{1}\EFrdb{)}
  \EFrdb{(}\EFo{tooltip-show}
    \EFrdc{(}\EFo{propertize} \EFs{"Look in minbuffer"}
                \EFhq{'}\EFhs{display} \EFrdd{(}\EFo{create-image} img-path\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-search-thumbnail} \EFrdb{(}\EFrdb{)}
  \EFd{"Display the thumbnail of the currently selected video"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mkdir} elfeed-thumbnail-dir t\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}buffer \EFrda{(}\EFo{current-buffer}\EFrda{)}\EFrdd{)}
        \EFrdd{(}entries \EFrda{(}elfeed-search-selected\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{cl-loop} for entry in entries
             when \EFrdd{(}elfeed-entry-link entry\EFrdd{)}
             do \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}title \EFrdc{(}\EFo{concat} elfeed-thumbnail-dir \EFrdd{(}\EFo{secure-hash} \EFhq{'}\EFhs{sha224} \EFrda{(}elfeed-entry-title entry\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFk{if} \EFrdb{(}\EFo{file-exists-p} \EFrdc{(}\EFo{concat} title \EFs{".jpg"}\EFrdc{)}\EFrdb{)}
                      \EFrdb{(}\EFf{image-tooltip} \EFrdc{(}\EFo{concat} title \EFs{".jpg"}\EFrdc{)}\EFrdb{)}
                    \EFrdb{(}\EFf{youtube-dl-get-video-thumbnail} it title \EFrdc{(}\EFk{lambda} \EFrdd{(}a\EFrdd{)} \EFrdd{(}\EFf{image-tooltip} \EFrda{(}\EFo{concat} title \EFs{".jpg"}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFk{with-current-buffer} buffer
      \EFrda{(}\EFo{mapc} \EFhq{\#'}\EFhs{elfeed-search-update-entry} entries\EFrda{)}
      \EFrda{(}\EFk{unless} \EFrdb{(}\EFk{or} elfeed-search-remain-on-entry \EFrdc{(}\EFo{use-region-p}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-wget-url} \EFrdb{(}\EFrdb{)}
  \EFd{"Wgets URL at point to elfeed video dir"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}url \EFrda{(}\EFo{shr-url-at-point} \EFv{current-prefix-arg}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{display-buffer-alist} \EFhq{'}\EFrdd{(}\EFs{"*Async Shell Command*"} display-buffer-no-window \EFrda{(}nil\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{async-shell-command} \EFrdd{(}\EFo{concat} \EFs{"wget -O "} \EFv{youtube-dl-directory} \EFs{"/\char92{}""} \EFrda{(}elfeed-entry-title elfeed-show-entry\EFrda{)} \EFs{"\char92{}".mp3 "} url\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{youtube-dl-move-temp} \EFrdb{(}\EFrdb{)}
  \EFd{"Moves content of elfeed video dir to temporary location"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mkdir} youtube-dl-temp-directory t\EFrdb{)}
  \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{display-buffer-alist} \EFhq{'}\EFrdc{(}\EFs{"*Async Shell Command*"} display-buffer-no-window \EFrdd{(}nil\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{async-shell-command} \EFrdc{(}\EFo{concat} \EFs{"mv "} \EFv{youtube-dl-directory} \EFs{"/* "} youtube-dl-temp-directory \EFs{"/"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} elfeed-tube
  \EFb{:after} elfeed
  \EFb{:demand} t
  \EFb{:config}
  \EFcd{;; }\EFc{(setq elfeed-tube-auto-save-p nil) ; default value}
  \EFcd{;; }\EFc{(setq elfeed-tube-auto-fetch-p t)  ; default value}
  \EFrdb{(}elfeed-tube-setup\EFrdb{)}

  \EFb{:bind} \EFrdb{(}\EFb{:map} elfeed-show-mode-map
         \EFrdc{(}\EFs{"F"} . elfeed-tube-fetch\EFrdc{)}
         \EFrdc{(}\EFrdd{[}remap save-buffer\EFrdd{]} . elfeed-tube-save\EFrdc{)}
         \EFb{:map} elfeed-search-mode-map
         \EFrdc{(}\EFs{"F"} . elfeed-tube-fetch\EFrdc{)}
         \EFrdc{(}\EFrdd{[}remap save-buffer\EFrdd{]} . elfeed-tube-save\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} elfeed-tube-mpv
  \EFb{:bind}
  \EFrdb{(}\EFs{"C-c C-f"} . elfeed-tube-mpv-follow-mode\EFrdb{)}
  \EFrdb{(}\EFs{"C-c C-w"} . elfeed-tube-mpv-where\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} elfeed-tube-captions-languages \EFhq{'}\EFrdb{(}\EFs{"en"} \EFs{"de"} \EFs{"la"} \EFs{"english (auto generated)"} \EFs{"german (auto generated)"}\EFrdb{)}
      elfeed-tube-captions-chunk-time \EFhn{60}
      elfeed-tube-thumbnail-size \EFhq{'}\EFhs{large}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{elfeed-tube-mpv-open} \EFrdb{(}\EFrdb{)}
  \EFd{"Opens selected elfeed tube feed in mpv and activates follow mode"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFf{elfeed-tube-mpv-follow-mode} \EFhn{1}\EFrdb{)}
  \EFrdb{(}elfeed-tube-mpv \EFrdc{(}\EFo{point}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{add-hook!} \EFhq{'}\EFhs{elfeed-show-mode-hook} \EFhq{'}\EFrdb{(}lambda \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFf{elfeed-tube-mpv-follow-mode} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{elfeed-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Interface}
\label{sec:orgfc14a06}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{interface}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org3a1834b}
\subsubsection{Code}
\label{sec:org6cca069}
\paragraph{General settings}
\label{sec:orgf28c29c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{setq-default}
 \EFv{x-stretch-cursor} t\EFrda{)}
\EFrda{(}\EFv{good-scroll-mode} \EFhn{-1}\EFrda{)}
\EFrda{(}\EFk{setq-default} \EFv{word-wrap} t\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{undo-limit} \EFhn{80000000}                         \EFcd{; }\EFc{Raise undo-limit to 80Mb}
      \EFv{evil-want-fine-undo} t                       \EFcd{; }\EFc{By default while in insert all changes are one big blob. Be more granular}
      \EFv{truncate-string-ellipsis} \EFs{"…"}                \EFcd{; }\EFc{Unicode ellispis are nicer than "...", and also save /precious/ space}
      \EFv{password-cache-expiry} nil                   \EFcd{; }\EFc{I can trust my computers ... can't I?}
      \EFv{scroll-margin} \EFhn{2}\EFrda{)}                            \EFcd{; }\EFc{It's nice to maintain a little margin}

\EFrda{(}\EFv{display-time-mode} \EFhn{1}\EFrda{)}                             \EFcd{; }\EFc{Enable time in the mode-line}
\EFrda{(}\EFv{display-battery-mode} \EFhn{1}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Font}
\label{sec:orga18b2f0}
\begin{Code}
\begin{Verbatim}
\color{EFD}
\EFcd{;;; }\EFc{Unicode emojis}
\EFrda{(}\EFk{if} \EFrdb{(}\EFo{>=} \EFv{emacs-major-version} \EFhn{27}\EFrdb{)}
    \EFrdb{(}\EFo{set-fontset-font} t \EFhq{'}\EFrdc{(}\EFhn{\#x1f000} . \EFhn{\#x1faff}\EFrdc{)}
                      \EFrdc{(}\EFo{font-spec} \EFb{:family} \EFs{"Noto Color Emoji"}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{set-face-attribute}
 \EFhq{'}\EFhs{default} nil \EFb{:stipple} nil \EFb{:height} \EFhn{120} \EFb{:width} \EFhq{'}\EFhs{normal} \EFb{:inverse-video} nil \EFb{:box} nil \EFb{:strike-through} nil \EFb{:overline} nil \EFb{:underline} nil \EFb{:slant} \EFhq{'}\EFhs{normal} \EFb{:weight} \EFhq{'}\EFhs{normal} \EFb{:foundry} \EFs{"outline"} \EFb{:family} \EFs{"Source Code Pro for Powerline"}\EFrda{)}
\EFcd{;;;; }\EFc{setting up composition functions for emoji modifiers}
\EFcd{;;}\EFc{(dolist (items `(((?🇦 . ?🇿) [".[🇦-🇿]+" 0 font-shape-gstring])}
\EFcd{;                 }\EFc{((?🏳 . ?🏴) [".[️‍🌈⚧☠󠀠-󠁿]*" 0 font-shape-gstring])}
\EFcd{;                 }\EFc{(?⃣ ["[\#*0-9]️⃣" 2 font-shape-gstring])}
\EFcd{;                 }\EFc{;; }\textcolor[HTML]{ECBE7B}{\textbf{TODO:}}\EFc{ I can't make keycap sequences work because I}
\EFcd{;                 }\EFc{;; think they're trying to shape with the wrong font.}
\EFcd{;                 }\EFc{,@(mapcar (lambda (range) (list range [".‍?[🏻-🏿]?[‍️♂♀]*️?" 0 font-shape-gstring]))}
\EFcd{;                           }\EFc{(concatenate 'list "☝🎅🏇👂👃👦👧👼💏💑💪🕴🕵🕺🖐🖕🖖🙇🚣🛀🛌🤏🤞🤟🤦🤽🤾🥷🦻👯❤"}
\EFcd{;                                        }\EFc{'((?⛹ . ?✍) (?🏂 . ?🏄) (?🏊 . ?🏌) (?👆 . ?👐)}
\EFcd{;                                          }\EFc{(?👫 . ?👮) (?👰 . ?👸) (?💁 . ?💇) (?🙅 . ?🙇) (?🙋 . ?🙏)}
\EFcd{;                                          }\EFc{(?🚴 . ?🚶) (?🤘 . ?🤜) (?🤰 . ?🤹) (?🤼 . ?🤾) (?🦵 . ?🦹)}
\EFcd{;                                          }\EFc{(?🧍 . ?🧏) (?🧒 . ?🧟))) )}
\EFcd{;                 }\EFc{(?🧑 [".‍?[🏻-🏿]?[‍⚕⚖✈❤️🌾🍳🍼🎄🎓🎤🎨🏫🏭👦-👩💋💻💼🔧🔬🚀🚒🤝🦯🦰-🦳🦼🦽🧑]*" 0 font-shape-gstring])}
\EFcd{;                 }\EFc{((?👨 . ?👩) [".‍?[🏻-🏿]?[‍⚕⚖✈❤️🌾🍳🍼🎄🎓🎤🎨🏫🏭👦-👩💋💻💼🔧🔬🚀🚒🤝🦯🦰-🦳🦼🦽🧑]*" 0 font-shape-gstring])}
\EFcd{;                 }\EFc{,@(mapcar (lambda (str) (list (elt str 0) (vector str 0 'font-shape-gstring)))}
\EFcd{;                           }\EFc{'("😶‍🌫️" "🐈‍⬛" "🐕‍🦺" "🐻‍❄️" "👁️‍🗨️" "😮‍💨" "😵‍💫"))))}
\EFcd{;  }\EFc{(set-char-table-range}
\EFcd{;   }\EFc{composition-function-table}
\EFcd{;   }\EFc{(car items)}
\EFcd{;   }\EFc{(list (cadr items))))}

\EFrda{(}\EFk{setq} \EFv{emojify-emoji-set} \EFs{"twemoji-v2"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{emojify--replace-text-with-emoji} \EFrdb{(}orig-fn emoji text buffer start end \EFt{\&optional} target\EFrdb{)}
  \EFd{"Modify `}\textcolor[HTML]{a9a1e1}{emojify--propertize-text-for-emoji}\EFd{' to replace ascii/github emoticons with unicode emojis, on the fly."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{not} \EFv{emoticon-to-emoji}\EFrdd{)} \EFrdd{(}\EFo{=} \EFhn{1} \EFrda{(}\EFo{length} text\EFrda{)}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFo{funcall} orig-fn emoji text buffer start end target\EFrdc{)}
    \EFrdc{(}\EFo{delete-region} start end\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFrdd{(}\EFo{ht-get} emoji \EFs{"unicode"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{define-minor-mode} \EFv{emoticon-to-emoji}
  \EFd{"Write ascii/gh emojis, and have them converted to unicode live."}
  \EFb{:global} nil
  \EFb{:init-value} nil
  \EFrdb{(}\EFk{if} \EFv{emoticon-to-emoji}
      \EFrdc{(}\EFk{progn}
        \EFrdd{(}\EFk{setq-local} \EFv{emojify-emoji-styles} \EFhq{'}\EFrda{(}ascii github unicode\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{advice-add} \EFhq{'}\EFhs{emojify--propertize-text-for-emoji} \EFb{:around} \EFhq{\#'}\EFhs{emojify--replace-text-with-emoji}\EFrdd{)}
        \EFrdd{(}\EFk{unless} \EFv{emojify-mode}
          \EFrda{(}\EFo{emojify-turn-on-emojify-mode}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq-local} \EFv{emojify-emoji-styles} \EFrdd{(}\EFo{default-value} \EFhq{'}\EFv{emojify-emoji-styles}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{advice-remove} \EFhq{'}\EFhs{emojify--propertize-text-for-emoji} \EFhq{\#'}\EFhs{emojify--replace-text-with-emoji}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{add-hook!} \EFhq{'}\EFrdb{(}mu4e-compose-mode org-msg-edit-mode circe-channel-mode org-mode\EFrdb{)} \EFrdb{(}\EFv{emoticon-to-emoji} \EFhn{1}\EFrdb{)}\EFrda{)}
\end{Verbatim}
\end{Code}
\paragraph{Other}
\label{sec:orgcceb64d}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{interface.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"<f5>"}\EFrdb{)} \EFhq{'}\EFhs{revert-buffer}\EFrda{)}

                                        \EFcd{;}\EFc{(unless (string-match-p "\char94{}Power N/A" (battery))   ; On laptops...}
                                        \EFcd{;  }\EFc{(display-battery-mode 1))                       ; it's nice to know how much power you have}
\EFrda{(}\EFv{global-subword-mode} \EFhn{1}\EFrda{)}                           \EFcd{; }\EFc{Iterate through CamelCase words}
\EFrda{(}\EFk{setq} \EFv{battery-mode-line-format} \EFs{"\%t"}\EFrda{)}
\EFrda{(}\EFv{display-battery-mode} t\EFrda{)}
\EFrda{(}\EFv{display-battery-mode} \EFhn{-1}\EFrda{)}



\EFrda{(}\EFk{use-package!} selectic-mode
  \EFb{:commands} selectic-mode\EFrda{)}

\EFrda{(}\EFo{set-char-table-range} \EFv{composition-function-table} ?f \EFhq{'}\EFrdb{(}\EFrdc{[}\EFs{"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(?:}}\EFs{ff?[fijlt]}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFhn{0} font-shape-gstring\EFrdc{]}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{set-char-table-range} \EFv{composition-function-table} ?T \EFhq{'}\EFrdb{(}\EFrdc{[}\EFs{"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(?:}}\EFs{Th}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFhn{0} font-shape-gstring\EFrdc{]}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{after!} centaur-tabs
  \EFrdb{(}centaur-tabs-mode \EFhn{-1}\EFrdb{)}
  \EFrdb{(}\EFk{setq} centaur-tabs-height \EFhn{12}
        centaur-tabs-set-icons t
        centaur-tabs-modified-marker \EFs{"o"}
        centaur-tabs-close-button \EFs{"×"}
        centaur-tabs-set-bar \EFhq{'}\EFhs{above}
        centaur-tabs-gray-out-icons \EFhq{'}\EFhs{buffer}\EFrdb{)}
  \EFrdb{(}centaur-tabs-change-fonts \EFs{"SourceCodePro"} \EFhn{100}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{cleanup-after-init} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{switch-to-buffer} \EFs{"*scratch*"}\EFrdb{)}
  \EFrdb{(}\EFo{delete-other-windows}\EFrdb{)}
  \EFrdb{(}\EFf{kill-unwanted-buffers}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{schedule-cleanup-after-init} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{run-at-time} \EFs{"1 sec"} nil \EFhq{'}\EFhs{cleanup-after-init}\EFrdb{)}\EFrda{)}

                                        \EFcd{;}\EFc{(schedule-cleanup-after-init)}

                                        \EFcd{;}\EFc{(add-hook 'after-init-hook 'schedule-cleanup-after-init)}

\EFrda{(}\EFk{use-package!} info-colors
  \EFb{:commands} \EFrdb{(}\EFo{info-colors-fontify-node}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{Info-selection-hook} \EFhq{'}\EFhs{info-colors-fontify-node}\EFrda{)}

\EFrda{(}\EFk{use-package!} page-break-lines
  \EFb{:commands} page-break-lines-mode
  \EFb{:init}
  \EFrdb{(}\EFo{autoload} \EFhq{'}\EFhs{turn-on-page-break-lines-mode} \EFs{"page-break-lines"}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{setq} page-break-lines-max-width \EFv{fill-column}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:prefix} \EFs{"g"}
        \EFb{:desc} \EFs{"Prev page break"} \EFb{:nv} \EFs{"["} \EFhq{\#'}\EFhs{backward-page}
        \EFb{:desc} \EFs{"Next page break"} \EFb{:nv} \EFs{"]"} \EFhq{\#'}\EFhs{forward-page}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{use-package!} theme-magic
  \EFb{:commands} theme-magic-from-emacs
  \EFb{:config}
  \EFrdb{(}\EFk{defadvice!} theme-magic--auto-extract-16-doom-colors \EFrdc{(}\EFrdc{)}
    \EFb{:override} \EFhq{\#'}\EFhs{theme-magic--auto-extract-16-colors}
    \EFrdc{(}\EFo{list}
     \EFrdd{(}\EFo{face-attribute} \EFhq{'}\EFhs{default} \EFb{:background}\EFrdd{)}
     \EFrdd{(}\EFo{doom-color} \EFhq{'}\EFhs{error}\EFrdd{)}
     \EFrdd{(}\EFo{doom-color} \EFhq{'}\EFhs{success}\EFrdd{)}
     \EFrdd{(}\EFo{doom-color} \EFhq{'}\EFhs{type}\EFrdd{)}
     \EFrdd{(}\EFo{doom-color} \EFhq{'}\EFhs{keywords}\EFrdd{)}
     \EFrdd{(}\EFo{doom-color} \EFhq{'}\EFhs{constants}\EFrdd{)}
     \EFrdd{(}\EFo{doom-color} \EFhq{'}\EFhs{functions}\EFrdd{)}
     \EFrdd{(}\EFo{face-attribute} \EFhq{'}\EFhs{default} \EFb{:foreground}\EFrdd{)}
     \EFrdd{(}\EFo{face-attribute} \EFhq{'}\EFhs{shadow} \EFb{:foreground}\EFrdd{)}
     \EFrdd{(}\EFo{doom-blend} \EFhq{'}\EFhs{base8} \EFhq{'}\EFhs{error} \EFhn{0.1}\EFrdd{)}
     \EFrdd{(}\EFo{doom-blend} \EFhq{'}\EFhs{base8} \EFhq{'}\EFhs{success} \EFhn{0.1}\EFrdd{)}
     \EFrdd{(}\EFo{doom-blend} \EFhq{'}\EFhs{base8} \EFhq{'}\EFhs{type} \EFhn{0.1}\EFrdd{)}
     \EFrdd{(}\EFo{doom-blend} \EFhq{'}\EFhs{base8} \EFhq{'}\EFhs{keywords} \EFhn{0.1}\EFrdd{)}
     \EFrdd{(}\EFo{doom-blend} \EFhq{'}\EFhs{base8} \EFhq{'}\EFhs{constants} \EFhn{0.1}\EFrdd{)}
     \EFrdd{(}\EFo{doom-blend} \EFhq{'}\EFhs{base8} \EFhq{'}\EFhs{functions} \EFhn{0.1}\EFrdd{)}
     \EFrdd{(}\EFo{face-attribute} \EFhq{'}\EFhs{default} \EFb{:foreground}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{run-with-idle-timer} \EFhn{0.1} nil \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFo{add-hook} \EFhq{'}\EFv{doom-load-theme-hook} \EFhq{'}\EFhs{theme-magic-from-emacs}\EFrdc{)}\EFrdb{)}\EFrda{)}

                                        \EFcd{; }\EFc{Modern org mode}
\EFrda{(}\EFv{global-org-modern-mode} t\EFrda{)}

\EFcd{;; }\EFc{Transparent scratch buffer}
\EFrda{(}\EFk{defun} \EFf{buffer-empty-p} \EFrdb{(}\EFt{\&optional} buffer\EFrdb{)}
  \EFrdb{(}\EFo{=} \EFrdc{(}\EFo{buffer-size} buffer\EFrdc{)} \EFhn{0}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{frame-trans-on} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{set-frame-parameter} \EFrdc{(}\EFo{selected-frame}\EFrdc{)} \EFhq{'}\EFhs{alpha} \EFhq{'}\EFrdc{(}\EFhn{0} \EFhn{0}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{frame-trans-off} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{set-frame-parameter} \EFrdc{(}\EFo{selected-frame}\EFrdc{)} \EFhq{'}\EFhs{alpha} \EFhq{'}\EFrdc{(}\EFhn{100} \EFhn{100}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{scratch-trans} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{setq} my-buffer \EFrdc{(}\EFo{get-buffer} \EFs{"*scratch*"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}\EFo{eq} my-buffer \EFrda{(}\EFo{window-buffer} \EFrdb{(}\EFo{selected-window}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFk{if} \EFrda{(}\EFo{=} \EFrdb{(}\EFo{length} \EFrdc{(}\EFo{window-list}\EFrdc{)}\EFrdb{)} \EFhn{1}\EFrda{)} \EFrda{(}\EFf{frame-trans-on}\EFrda{)} \EFrda{(}\EFf{frame-trans-off}\EFrda{)}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}\EFrdd{(}\EFo{get-buffer-window} my-buffer\EFrdd{)}
         \EFrdd{(}\EFf{frame-trans-off}\EFrdd{)}\EFrdc{)}
        \EFrdc{(}t
         \EFrdd{(}\EFf{frame-trans-off}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{window-configuration-change-hook} \EFhq{'}\EFhs{scratch-trans}\EFrda{)}

\EFcd{;; }\EFc{Async shell commands without popup buffer}
\EFrda{(}\EFk{defun} \EFf{async-shell-command-no-window}
    \EFrdb{(}command\EFrdb{)}
  \EFd{"Execute async shell command without popup buffer."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let}
      \EFrdc{(}\EFrdd{(}\EFv{display-buffer-alist}
        \EFrda{(}\EFo{list}
         \EFrdb{(}\EFo{cons}
          \EFs{"\char92{}\char92{}*Async Shell Command\char92{}\char92{}*.*"}
          \EFrdc{(}\EFo{cons} \EFhq{\#'}\EFhs{display-buffer-no-window} nil\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{async-shell-command} command\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{interface}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{EXWM Tweaks}
\label{sec:org0ab8454}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{exwm-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org7d8f9cb}
\subsubsection{Code}
\label{sec:orgfe4fe81}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{exwm-tweaks.el -*- lexical-binding: t; -*-}
\EFrda{(}\EFk{use-package!} exwm
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{mouse-autoselect-window} t
        \EFv{focus-follows-mouse} t\EFrdb{)}
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{exwm}\EFrdb{)}
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{exwm-config}\EFrdb{)}
  \EFrdb{(}\EFo{exwm-config-default}\EFrdb{)}
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{exwm-randr}\EFrdb{)}

\EFrdb{(}\EFk{when} \EFrdc{(}\EFo{string=} \EFrdd{(}\EFv{system-name}\EFrdd{)} \EFs{"astaroth"}\EFrdc{)}
  \EFrdc{(}\EFk{setq} \EFv{exwm-randr-workspace-output-plist} \EFhq{'}\EFrdd{(}\EFhn{1} \EFs{"DP-2-1"} \EFhn{2} \EFs{"HDMI-2"} \EFhn{3} \EFs{"DP-2-2"} \EFhn{4} \EFs{"eDP-1"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
\EFrdb{(}\EFk{when} \EFrdc{(}\EFo{string=} \EFrdd{(}\EFv{system-name}\EFrdd{)} \EFs{"jarvis"}\EFrdc{)}
  \EFrdc{(}\EFk{setq} \EFv{exwm-randr-workspace-output-plist} \EFhq{'}\EFrdd{(}\EFhn{1} \EFs{"DisplayPort-0"} \EFhn{2} \EFs{"DVI-0"} \EFhn{3} \EFs{"HDMI-0"} \EFhn{4} \EFs{"eDP-1"}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{exwm-randr-screen-change-hook}
	    \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
	      \EFrdd{(}\EFo{start-process-shell-command}
	       \EFs{"xrandr"} nil \EFs{"xrandr --output eDP-1 --primary --mode 1920x1080 --pos 1920x0 --rotate normal --output DP-1 --off --output HDMI-1 --off --output DP-2 --off --output HDMI-2 --mode 1920x1080 --pos 0x0 --rotate normal"}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFo{exwm-randr-enable}\EFrdb{)}
  \EFrdb{(}\EFv{winner-mode} t\EFrdb{)}
  \EFrdb{(}\EFo{require} \EFhq{'}\EFo{exwm-systemtray}\EFrdb{)}
  \EFrdb{(}\EFo{exwm-systemtray-enable}\EFrdb{)}
  \EFrdb{(}\EFo{define-key} \EFv{exwm-mode-map} \EFrdc{(}\EFo{kbd} \EFs{"C-c"}\EFrdc{)} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{exwm-input-simulation-keys}
	\EFhq{'}\EFrdc{(}\EFrdd{(}\EFrda{[}?\char92{}C-b\EFrda{]} . \EFrda{[}left\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}C-f\EFrda{]} . \EFrda{[}right\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}C-p\EFrda{]} . \EFrda{[}up\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}C-n\EFrda{]} . \EFrda{[}down\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}C-a\EFrda{]} . \EFrda{[}home\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}C-e\EFrda{]} . \EFrda{[}end\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}M-a\EFrda{]} . \EFrda{[}C-a\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}M-v\EFrda{]} . \EFrda{[}prior\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}C-d\EFrda{]} . \EFrda{[}delete\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}C-k\EFrda{]} . \EFrda{[}S-end delete\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}C-w\EFrda{]} . \EFrda{[}?\char92{}C-x\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}M-w\EFrda{]} . \EFrda{[}?\char92{}C-c\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}C-y\EFrda{]} . \EFrda{[}?\char92{}C-v\EFrda{]}\EFrdd{)}
	  \EFcd{;; }\EFc{search}
	  \EFrdd{(}\EFrda{[}?\char92{}C-s\EFrda{]} . \EFrda{[}?\char92{}C-f\EFrda{]}\EFrdd{)}
	  \EFrdd{(}\EFrda{[}?\char92{}M-s\EFrda{]} . \EFrda{[}?\char92{}C-s\EFrda{]}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{functionp} \EFhq{'}\EFhs{exwm-enable-ido-workaround}\EFrdc{)}
    \EFrdc{(}exwm-enable-ido-workaround\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{with-eval-after-load} \EFhq{'}\EFhs{ediff-wind}
  \EFrdc{(}\EFk{setq} ediff-control-frame-parameters
	\EFrdd{(}\EFo{cons} \EFhq{'}\EFrda{(}unsplittable . t\EFrda{)} ediff-control-frame-parameters\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFo{global-set-key} \EFrdc{(}\EFo{kbd} \EFs{"C-x C-c"}\EFrdc{)} \EFhq{'}\EFhs{save-buffers-kill-emacs}\EFrdb{)}
\EFcd{;  }\EFc{(global-set-key (kbd "C-c m") 'toggle-maximize-buffer)}


  \EFrdb{(}\EFk{defun} \EFf{fullscreen} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{exwm-mode}\EFrdd{)}
      \EFrdd{(}\EFo{call-interactively} \EFhq{'}\EFhs{exwm-layout-toggle-fullscreen}\EFrdd{)}
      \EFrdd{(}\EFf{toggle-maximize-buffer}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}

\EFcd{;;; }\EFc{Make current buffer float}
\EFrdb{(}\EFk{defun} \EFf{toggle-float-buffer} \EFrdc{(}\EFrdc{)}
  \EFrdc{(}\EFk{interactive}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{exwm-mode}\EFrdd{)}
      \EFrdd{(}\EFk{progn}
      \EFrda{(}\EFo{call-interactively} \EFhq{'}\EFhs{exwm-floating-toggle-floating}\EFrda{)}
      \EFrda{(}\EFo{call-interactively} \EFhq{'}\EFhs{exwm-layout-hide-mode-line}\EFrda{)}
      \EFrdd{)}\EFrdc{)}\EFrdb{)}


\EFcd{;;; }\EFc{Sometimes exwm fails to sets a buffer, so set it to scratch}
\EFcd{;;; }\EFc{with a button press}
\EFrdb{(}\EFk{defun} \EFf{go-to-scratch} \EFrdc{(}\EFrdc{)}
  \EFrdc{(}\EFk{interactive}\EFrdc{)}
  \EFrdc{(}\EFo{message} \EFs{"\%s"} \EFrdd{(}\EFo{selected-window}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{switch-to-buffer} \EFs{"*scratch*"}\EFrdc{)}\EFrdb{)}

\EFrdb{(}\EFk{defun} \EFf{go-to-scratch-other} \EFrdc{(}\EFrdc{)}
  \EFrdc{(}\EFk{interactive}\EFrdc{)}
  \EFrdc{(}\EFo{switch-to-buffer-other-frame} \EFs{"*scratch*"}\EFrdc{)}\EFrdb{)}

\EFrdb{(}\EFk{setq} save-temp-location \EFs{"\char126{}/dox/temp-save/"}\EFrdb{)}
\EFrdb{(}\EFk{defun} \EFf{save-buffer-temp} \EFrdc{(}\EFrdc{)}
  \EFrdc{(}\EFk{interactive}\EFrdc{)}
  \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}s \EFrdb{(}\EFo{buffer-string}\EFrdb{)}\EFrda{)}
         \EFrda{(}ss \EFrdb{(}\EFo{split-string} s \EFs{" "}\EFrdb{)}\EFrda{)}
         \EFrda{(}nl \EFrdb{(}\EFo{butlast} ss \EFrdc{(}\EFo{-} \EFrdd{(}\EFo{length} ss\EFrdd{)} \EFhn{5}\EFrdc{)}\EFrdb{)}\EFrda{)}

         \EFrdd{)}
    \EFrdd{(}\EFo{set-visited-file-name} \EFrda{(}\EFo{concat} save-temp-location \EFrdb{(}\EFo{mapconcat} \EFhq{'}\EFrdc{(}lambda \EFrdd{(}x\EFrdd{)}  \EFrdd{(}\EFo{format} \EFs{"\%s"} x\EFrdd{)}\EFrdc{)}  nl \EFs{" "}\EFrdb{)} \EFs{".org"}\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFo{save-buffer}\EFrdd{)}
    \EFrdc{)}
  \EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{switchmonitor-next} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFo{shell-command} \EFs{"xdotool mousemove\_relative 1920 0"}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{switchmonitor-prev} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFo{shell-command} \EFs{"xdotool mousemove\_relative -- -1920 0"}\EFrdc{)}\EFrdb{)}


  \EFrdb{(}\EFk{setq} \EFv{exwm-workspace-number} \EFhn{9}
        \EFv{exwm-workspace-show-all-buffers} t
        \EFv{exwm-layout-show-all-buffers} t
        \EFv{exwm-manage-force-tiling} t\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{exwm-input-global-keys}
      \EFhq{`}\EFrdc{(}\EFrdd{(}\EFrda{[}?\char92{}s-f\EFrda{]} . fullscreen\EFrdd{)}
	\EFrdd{(}\EFrda{[}?\char92{}s-F\EFrda{]} . toggle-maximize-buffer\EFrdd{)}
        \EFrdd{(}\EFrda{[}?\char92{}s-g\EFrda{]} . toggle-float-buffer\EFrdd{)}
	\EFrdd{(}\EFrda{[}?\char92{}s-q\EFrda{]} . kill-curr-buffer\EFrdd{)}
	\EFrdd{(}\EFrda{[}?\char92{}s-n\EFrda{]} . switchmonitor-next\EFrdd{)}
	\EFrdd{(}\EFrda{[}?\char92{}s-p\EFrda{]} . switchmonitor-prev\EFrdd{)}
        \EFcd{;}\EFc{((kbd "s-<return>") . switchmonitor-prev)}
        ,@\EFrdd{(}\EFo{mapcar} \EFrda{(}\EFk{lambda} \EFrdb{(}i\EFrdb{)}
                    \EFhq{`}\EFrdb{(},\EFrdc{(}\EFo{kbd} \EFrdd{(}\EFo{format} \EFs{"s-\%d"} i\EFrdd{)}\EFrdc{)} .
                      \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
                        \EFrdd{(}\EFk{interactive}\EFrdd{)}
                        \EFrdd{(}\EFo{exwm-workspace-switch-create} ,i\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFo{number-sequence} \EFhn{0} \EFhn{9}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{exwm-manage-finish-hook}
          \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
            \EFrdd{(}\EFk{if} \EFrda{(}\EFk{and} \EFv{exwm-class-name}
                       \EFrdb{(}\EFo{string=} \EFv{exwm-class-name} \EFs{"St"}\EFrdb{)}\EFrda{)}
              \EFrda{(}\EFk{progn}
		\EFrdb{(}\EFo{exwm-input-release-keyboard}\EFrdb{)}\EFrda{)}
	      \EFrda{(}\EFk{progn}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFo{exwm-layout-hide-mode-line}\EFrdd{)}\EFrdc{)}\EFrdb{)}

\EFrdb{(}\EFk{setq} \EFv{exwm-input-prefix-keys}
\EFhq{'}\EFrdc{(}?\char92{}C-x ?\char92{}C-u ?\char92{}C-h ?\char92{}M-x ?\char92{}M-\EFhq{`} \EFhs{?}\char92{}M-\& ?\char92{}M-:\EFrdc{)}\EFrdb{)}


\EFrdb{(}\EFo{global-set-key} \EFrdc{(}\EFo{kbd} \EFs{"s-<f4>"}\EFrdc{)} \EFhq{'}\EFhs{go-to-scratch}\EFrdb{)}
\EFrdb{(}\EFo{global-set-key} \EFrdc{(}\EFo{kbd} \EFs{"s-S-<f4>"}\EFrdc{)} \EFhq{'}\EFhs{save-buffer-temp}\EFrdb{)}
\EFrdb{(}\EFo{require} \EFhq{'}\EFo{exwm-edit}\EFrdb{)}
\EFrdb{(}\EFk{defun} \EFf{ag-exwm/on-exwm-edit-compose} \EFrdc{(}\EFrdc{)}
  \EFrdc{(}\EFo{funcall} \EFhq{'}\EFhs{org-mode}\EFrdc{)}\EFrdb{)}
\EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{exwm-edit-compose-hook} \EFhq{'}\EFhs{ag-exwm/on-exwm-edit-compose}\EFrdb{)}


\EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{exwm-update-title-hook}
          \EFrdc{(}\EFk{lambda} \EFrdd{(}\EFrdd{)}
              \EFrdd{(}\EFo{exwm-workspace-rename-buffer} \EFv{exwm-title}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{exwm-manage-configurations}
      \EFhq{'}\EFrdb{(}\EFrdc{(}\EFrdd{(}\EFk{or} \EFrda{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"Nm-applet"}\EFrda{)}
             \EFrda{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"Surf"}\EFrda{)}
             \EFrda{(}\EFo{string-equal} \EFv{exwm-class-name} \EFs{"Steam"}\EFrda{)}
             \EFrda{(}\EFo{not} \EFrdb{(}\EFo{message} \EFv{exwm-class-name}\EFrdb{)}\EFrda{)}\EFrdd{)}
           floating t
           floating-mode-line nil
\EFcd{;           }\EFc{width 0.4}
\EFcd{;           }\EFc{height 0.4}
	   \EFrdc{)}
        \EFrdc{(}\EFrdd{(}\EFo{equal} \EFv{exwm-window-type} \EFv{xcb:Atom:\_NET\_WM\_WINDOW\_TYPE\_DIALOG}\EFrdd{)}
         floating t
         floating-mode-line nil\EFrdc{)}
        \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{exwm-floating--set-floating} \EFrdb{(}id\EFrdb{)}
  \EFd{"Make window ID floating."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}window \EFrda{(}\EFo{get-buffer-window} \EFrdb{(}\EFf{exwm--id->buffer} id\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} window
      \EFcd{;; }\EFc{Hide the non-floating X window first.}
      \EFrdd{(}\EFo{set-window-buffer} window \EFrda{(}\EFo{other-buffer} nil t\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}original-frame \EFrda{(}\EFo{buffer-local-value} \EFhq{'}\EFv{exwm--frame}
                                             \EFrdb{(}\EFf{exwm--id->buffer} id\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFcd{;; }\EFc{Create new frame}
         \EFrdd{(}frame \EFrda{(}\EFk{with-current-buffer}
                    \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{get-buffer} \EFs{"*scratch*"}\EFrdc{)}
                        \EFrdc{(}\EFk{progn}
                          \EFrdd{(}\EFo{set-buffer-major-mode}
                           \EFrda{(}\EFo{get-buffer-create} \EFs{"*scratch*"}\EFrda{)}\EFrdd{)}
                          \EFrdd{(}\EFo{get-buffer} \EFs{"*scratch*"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
                  \EFrdb{(}\EFo{make-frame}
                   \EFhq{`}\EFrdc{(}\EFrdd{(}minibuffer . ,\EFrda{(}\EFo{minibuffer-window} \EFv{exwm--frame}\EFrda{)}\EFrdd{)}
                     \EFrdd{(}left . ,\EFrda{(}\EFo{*} \EFv{window-min-width} \EFhn{-10000}\EFrda{)}\EFrdd{)}
                     \EFrdd{(}top . ,\EFrda{(}\EFo{*} \EFv{window-min-height} \EFhn{-10000}\EFrda{)}\EFrdd{)}
                     \EFrdd{(}width . ,\EFv{window-min-width}\EFrdd{)}
                     \EFrdd{(}height . ,\EFv{window-min-height}\EFrdd{)}
                     \EFrdd{(}unsplittable . t\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)} \EFcd{;}\EFc{and fix the size later}
         \EFrdd{(}outer-id \EFrda{(}\EFo{string-to-number} \EFrdb{(}\EFo{frame-parameter} frame \EFhq{'}\EFhs{outer-window-id}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}window-id \EFrda{(}\EFo{string-to-number} \EFrdb{(}\EFo{frame-parameter} frame \EFhq{'}\EFhs{window-id}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}frame-container \EFrda{(}\EFf{xcb:generate-id} \EFv{exwm--connection}\EFrda{)}\EFrdd{)}
         \EFrdd{(}window \EFrda{(}\EFo{frame-first-window} frame\EFrda{)}\EFrdd{)} \EFcd{;}\EFc{and it's the only window}
         \EFrdd{(}x \EFrda{(}\EFo{slot-value} \EFv{exwm--geometry} \EFhq{'}\EFhs{x}\EFrda{)}\EFrdd{)}
         \EFrdd{(}y \EFrda{(}\EFo{slot-value} \EFv{exwm--geometry} \EFhq{'}\EFhs{y}\EFrda{)}\EFrdd{)}
         \EFrdd{(}width \EFrda{(}\EFo{slot-value} \EFv{exwm--geometry} \EFhq{'}\EFhs{width}\EFrda{)}\EFrdd{)}
         \EFrdd{(}height \EFrda{(}\EFo{slot-value} \EFv{exwm--geometry} \EFhq{'}\EFhs{height}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFcd{;; }\EFc{Force drawing menu-bar \& tool-bar.}
    \EFrdc{(}\EFo{redisplay} t\EFrdc{)}
    \EFrdc{(}\EFo{exwm-workspace--update-offsets}\EFrdc{)}
    \EFrdc{(}\EFk{exwm--log} \EFs{"Floating geometry (original): \%dx\%d\%+d\%+d"} width height x y\EFrdc{)}
    \EFcd{;; }\EFc{Save frame parameters.}
    \EFrdc{(}\EFo{set-frame-parameter} frame \EFhq{'}\EFhs{exwm-outer-id} outer-id\EFrdc{)}
    \EFrdc{(}\EFo{set-frame-parameter} frame \EFhq{'}\EFhs{exwm-id} window-id\EFrdc{)}
    \EFrdc{(}\EFo{set-frame-parameter} frame \EFhq{'}\EFhs{exwm-container} frame-container\EFrdc{)}
    \EFrdc{(}\EFo{set-frame-parameter} frame \EFhq{'}\EFhs{alpha} \EFhn{10}\EFrdc{)}
    \EFcd{;; }\EFc{Fix illegal parameters}
    \EFcd{;; }\textcolor[HTML]{ff6c6b}{\textbf{FIXME:}}\EFc{ check normal hints restrictions}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}workarea \EFrdb{(}\EFo{elt} \EFv{exwm-workspace--workareas}
                          \EFrdc{(}\EFf{exwm-workspace--position} original-frame\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}x* \EFrdb{(}\EFo{aref} workarea \EFhn{0}\EFrdb{)}\EFrda{)}
           \EFrda{(}y* \EFrdb{(}\EFo{aref} workarea \EFhn{1}\EFrdb{)}\EFrda{)}
           \EFrda{(}width* \EFrdb{(}\EFo{aref} workarea \EFhn{2}\EFrdb{)}\EFrda{)}
           \EFrda{(}height* \EFrdb{(}\EFo{aref} workarea \EFhn{3}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFcd{;; }\EFc{Center floating windows}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFk{and} \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{=} x \EFhn{0}\EFrdc{)} \EFrdc{(}\EFo{=} x x*\EFrdc{)}\EFrdb{)}
                 \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{=} y \EFhn{0}\EFrdc{)} \EFrdc{(}\EFo{=} y y*\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{let} \EFrdb{(}\EFrdc{(}buffer \EFrdd{(}\EFf{exwm--id->buffer} \EFv{exwm-transient-for}\EFrdd{)}\EFrdc{)}
              window edges\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} buffer \EFrdd{(}\EFk{setq} window \EFrda{(}\EFo{get-buffer-window} buffer\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{setq} edges \EFrdd{(}\EFo{window-inside-absolute-pixel-edges} window\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{unless} \EFrdd{(}\EFk{and} \EFrda{(}\EFo{<=} width \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{elt} edges \EFhn{2}\EFrdc{)} \EFrdc{(}\EFo{elt} edges \EFhn{0}\EFrdc{)}\EFrdb{)}\EFrda{)}
                         \EFrda{(}\EFo{<=} height \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{elt} edges \EFhn{3}\EFrdc{)} \EFrdc{(}\EFo{elt} edges \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFk{setq} edges nil\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{if} edges
              \EFcd{;; }\EFc{Put at the center of leading window}
              \EFrdc{(}\EFk{setq} x \EFrdd{(}\EFo{+} x* \EFrda{(}\EFo{/} \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{elt} edges \EFhn{2}\EFrdc{)} \EFrdc{(}\EFo{elt} edges \EFhn{0}\EFrdc{)} width\EFrdb{)} \EFhn{2}\EFrda{)}\EFrdd{)}
                    y \EFrdd{(}\EFo{+} y* \EFrda{(}\EFo{/} \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{elt} edges \EFhn{3}\EFrdc{)} \EFrdc{(}\EFo{elt} edges \EFhn{1}\EFrdc{)} height\EFrdb{)} \EFhn{2}\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFcd{;; }\EFc{Put at the center of screen}
            \EFrdc{(}\EFk{setq} x \EFrdd{(}\EFo{/} \EFrda{(}\EFo{-} width* width\EFrda{)} \EFhn{2}\EFrdd{)}
                  y \EFrdd{(}\EFo{/} \EFrda{(}\EFo{-} height* height\EFrda{)} \EFhn{2}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{>} width width*\EFrda{)}
          \EFcd{;; }\EFc{Too wide}
          \EFrda{(}\EFk{progn} \EFrdb{(}\EFk{setq} x x*
                       width width*\EFrdb{)}\EFrda{)}
        \EFcd{;; }\EFc{Invalid width}
        \EFrda{(}\EFk{when} \EFrdb{(}\EFo{=} \EFhn{0} width\EFrdb{)} \EFrdb{(}\EFk{setq} width \EFrdc{(}\EFo{/} width* \EFhn{2}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFcd{;; }\EFc{Make sure at least half of the window is visible}
        \EFrda{(}\EFk{unless} \EFrdb{(}\EFo{<} x* \EFrdc{(}\EFo{+} x \EFrdd{(}\EFo{/} width \EFhn{2}\EFrdd{)}\EFrdc{)} \EFrdc{(}\EFo{+} x* width*\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{setq} x \EFrdc{(}\EFo{+} x* \EFrdd{(}\EFo{/} \EFrda{(}\EFo{-} width* width\EFrda{)} \EFhn{2}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{>} height height*\EFrda{)}
          \EFcd{;; }\EFc{Too tall}
          \EFrda{(}\EFk{setq} y y*
                height height*\EFrda{)}
        \EFcd{;; }\EFc{Invalid height}
        \EFrda{(}\EFk{when} \EFrdb{(}\EFo{=} \EFhn{0} height\EFrdb{)} \EFrdb{(}\EFk{setq} height \EFrdc{(}\EFo{/} height* \EFhn{2}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFcd{;; }\EFc{Make sure at least half of the window is visible}
        \EFrda{(}\EFk{unless} \EFrdb{(}\EFo{<} y* \EFrdc{(}\EFo{+} y \EFrdd{(}\EFo{/} height \EFhn{2}\EFrdd{)}\EFrdc{)} \EFrdc{(}\EFo{+} y* height*\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{setq} y \EFrdc{(}\EFo{+} y* \EFrdd{(}\EFo{/} \EFrda{(}\EFo{-} height* height\EFrda{)} \EFhn{2}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFcd{;; }\EFc{The geometry can be overridden by user options.}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}x** \EFrdc{(}\EFo{plist-get} \EFv{exwm--configurations} \EFhq{'}\EFhs{x}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}y** \EFrdc{(}\EFo{plist-get} \EFv{exwm--configurations} \EFhq{'}\EFhs{y}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}width** \EFrdc{(}\EFo{plist-get} \EFv{exwm--configurations} \EFhq{'}\EFhs{width}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}height** \EFrdc{(}\EFo{plist-get} \EFv{exwm--configurations} \EFhq{'}\EFhs{height}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFo{integerp} x**\EFrdb{)}
            \EFrdb{(}\EFk{setq} x \EFrdc{(}\EFo{+} x* x**\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{floatp} x**\EFrdd{)}
                     \EFrdd{(}\EFo{>=} \EFhn{1} x** \EFhn{0}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{setq} x \EFrdd{(}\EFo{+} x* \EFrda{(}\EFo{round} \EFrdb{(}\EFo{*} x** width*\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFo{integerp} y**\EFrdb{)}
            \EFrdb{(}\EFk{setq} y \EFrdc{(}\EFo{+} y* y**\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{floatp} y**\EFrdd{)}
                     \EFrdd{(}\EFo{>=} \EFhn{1} y** \EFhn{0}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{setq} y \EFrdd{(}\EFo{+} y* \EFrda{(}\EFo{round} \EFrdb{(}\EFo{*} y** height*\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFo{integerp} width**\EFrdb{)}
            \EFrdb{(}\EFk{setq} width width**\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{floatp} width**\EFrdd{)}
                     \EFrdd{(}\EFo{>} \EFhn{1} width** \EFhn{0}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{setq} width \EFrdd{(}\EFo{max} \EFhn{1} \EFrda{(}\EFo{round} \EFrdb{(}\EFo{*} width** width*\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFo{integerp} height**\EFrdb{)}
            \EFrdb{(}\EFk{setq} height height**\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{floatp} height**\EFrdd{)}
                     \EFrdd{(}\EFo{>} \EFhn{1} height** \EFhn{0}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{setq} height \EFrdd{(}\EFo{max} \EFhn{1} \EFrda{(}\EFo{round} \EFrdb{(}\EFo{*} height** height*\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{exwm--set-geometry} id x y nil nil\EFrdc{)}
    \EFrdc{(}\EFf{xcb:flush} \EFv{exwm--connection}\EFrdc{)}
    \EFrdc{(}\EFk{exwm--log} \EFs{"Floating geometry (corrected): \%dx\%d\%+d\%+d"} width height x y\EFrdc{)}
    \EFcd{;; }\EFc{Fit frame to client}
    \EFcd{;; }\EFc{It seems we have to make the frame invisible in order to resize it}
    \EFcd{;; }\EFc{timely.}
    \EFcd{;; }\EFc{The frame will be made visible by `}\textcolor[HTML]{a9a1e1}{select-frame-set-input-focus}\EFc{'.}
    \EFrdc{(}\EFo{make-frame-invisible} frame\EFrdc{)}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}edges \EFrdb{(}\EFo{window-inside-pixel-edges} window\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{frame-width} \EFrdb{(}\EFo{+} width \EFrdc{(}\EFo{-} \EFrdd{(}\EFo{frame-pixel-width} frame\EFrdd{)}
                                    \EFrdd{(}\EFo{-} \EFrda{(}\EFo{elt} edges \EFhn{2}\EFrda{)} \EFrda{(}\EFo{elt} edges \EFhn{0}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{frame-height} \EFrdb{(}\EFo{+} height \EFrdc{(}\EFo{-} \EFrdd{(}\EFo{frame-pixel-height} frame\EFrdd{)}
                                      \EFrdd{(}\EFo{-} \EFrda{(}\EFo{elt} edges \EFhn{3}\EFrda{)} \EFrda{(}\EFo{elt} edges \EFhn{1}\EFrda{)}\EFrdd{)}\EFrdc{)}
                            \EFcd{;; }\EFc{Use `}\textcolor[HTML]{a9a1e1}{frame-outer-height}\EFc{' in the future.}
                            \EFv{exwm-workspace--frame-y-offset}\EFrdb{)}\EFrda{)}
           \EFrda{(}floating-mode-line \EFrdb{(}\EFo{plist-get} \EFv{exwm--configurations}
                                          \EFhq{'}\EFhs{floating-mode-line}\EFrdb{)}\EFrda{)}
           \EFrda{(}floating-header-line \EFrdb{(}\EFo{plist-get} \EFv{exwm--configurations}
                                            \EFhq{'}\EFhs{floating-header-line}\EFrdb{)}\EFrda{)}
           \EFrda{(}border-pixel \EFrdb{(}\EFo{exwm--color->pixel} \EFv{exwm-floating-border-color}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{if} floating-mode-line
          \EFrda{(}\EFk{setq} \EFv{exwm--mode-line-format} \EFrdb{(}\EFk{or} \EFv{exwm--mode-line-format}
                                           \EFv{mode-line-format}\EFrdb{)}
                \EFv{mode-line-format} floating-mode-line\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFk{and} \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{plist-member} \EFv{exwm--configurations} \EFhq{'}\EFhs{floating-mode-line}\EFrdd{)}\EFrdc{)}
                 \EFv{exwm--mwm-hints-decorations}\EFrdb{)}
            \EFrdb{(}\EFk{when} \EFv{exwm--mode-line-format}
              \EFrdc{(}\EFk{setq} \EFv{mode-line-format} \EFv{exwm--mode-line-format}\EFrdc{)}\EFrdb{)}
          \EFcd{;; }\EFc{The mode-line need to be hidden in floating mode.}
          \EFrdb{(}\EFk{setq} frame-height \EFrdc{(}\EFo{-} frame-height \EFrdd{(}\EFo{window-mode-line-height}
                                              \EFrda{(}\EFo{frame-root-window} frame\EFrda{)}\EFrdd{)}\EFrdc{)}
                \EFv{exwm--mode-line-format} \EFrdc{(}\EFk{or} \EFv{exwm--mode-line-format}
                                           \EFv{mode-line-format}\EFrdc{)}
                \EFv{mode-line-format} nil\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{if} floating-header-line
          \EFrda{(}\EFk{setq} \EFv{header-line-format} floating-header-line\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFk{and} \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{plist-member} \EFv{exwm--configurations}
                                    \EFhq{'}\EFhs{floating-header-line}\EFrdd{)}\EFrdc{)}
                 \EFv{exwm--mwm-hints-decorations}\EFrdb{)}
            \EFrdb{(}\EFk{setq} \EFv{header-line-format} nil\EFrdb{)}
          \EFcd{;; }\EFc{The header-line need to be hidden in floating mode.}
          \EFrdb{(}\EFk{setq} frame-height \EFrdc{(}\EFo{-} frame-height \EFrdd{(}\EFo{window-header-line-height}
                                              \EFrda{(}\EFo{frame-root-window} frame\EFrda{)}\EFrdd{)}\EFrdc{)}
                \EFv{header-line-format} nil\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{set-frame-size} frame frame-width frame-height t\EFrdd{)}
      \EFcd{;; }\EFc{Create the frame container as the parent of the frame.}
      \EFrdd{(}\EFk{xcb:+request} \EFv{exwm--connection}
          \EFrda{(}\EFf{make-instance} \EFhq{'}\EFhs{xcb:CreateWindow}
                         \EFb{:depth} \EFhn{0}
                         \EFb{:wid} frame-container
                         \EFb{:parent} \EFv{exwm--root}
                         \EFb{:x} x
                         \EFb{:y} \EFrdb{(}\EFo{-} y \EFv{exwm-workspace--window-y-offset}\EFrdb{)}
                         \EFb{:width} width
                         \EFb{:height} height
                         \EFb{:border-width}
                         \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFf{exwm--id->buffer} id\EFrdc{)}
                           \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}border-witdh \EFrdb{(}\EFo{plist-get} \EFv{exwm--configurations}
                                                          \EFhq{'}\EFhs{border-width}\EFrdb{)}\EFrda{)}\EFrdd{)}
                             \EFrdd{(}\EFk{if} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{integerp} border-witdh\EFrdb{)}
                                      \EFrdb{(}\EFo{>=} border-witdh \EFhn{0}\EFrdb{)}\EFrda{)}
                                 border-witdh
                               \EFv{exwm-floating-border-width}\EFrdd{)}\EFrdc{)}\EFrdb{)}
                         \EFb{:class} \EFv{xcb:WindowClass:InputOutput}
                         \EFb{:visual} \EFhn{0}
                         \EFb{:value-mask} \EFrdb{(}\EFo{logior} \EFv{xcb:CW:BackPixmap}
                                             \EFrdc{(}\EFk{if} border-pixel
                                                 \EFv{xcb:CW:BorderPixel} \EFhn{0}\EFrdc{)}
                                             \EFv{xcb:CW:OverrideRedirect}\EFrdb{)}
                         \EFb{:background-pixmap} \EFv{xcb:BackPixmap:ParentRelative}
                         \EFb{:border-pixel} border-pixel
                         \EFb{:override-redirect} \EFhn{1}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{xcb:+request} \EFv{exwm--connection}
          \EFrda{(}\EFf{make-instance} \EFhq{'}\EFhs{xcb:ewmh:set-\_NET\_WM\_NAME}
                         \EFb{:window} frame-container
                         \EFb{:data}
                         \EFrdb{(}\EFo{format} \EFs{"EXWM floating frame container for 0x\%x"} id\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFcd{;; }\EFc{Map it.}
      \EFrdd{(}\EFk{xcb:+request} \EFv{exwm--connection}
          \EFrda{(}\EFf{make-instance} \EFhq{'}\EFhs{xcb:MapWindow} \EFb{:window} frame-container\EFrda{)}\EFrdd{)}
      \EFcd{;; }\EFc{Put the X window right above this frame container.}
      \EFrdd{(}\EFk{xcb:+request} \EFv{exwm--connection}
          \EFrda{(}\EFf{make-instance} \EFhq{'}\EFhs{xcb:ConfigureWindow}
                         \EFb{:window} id
                         \EFb{:value-mask} \EFrdb{(}\EFo{logior} \EFv{xcb:ConfigWindow:Sibling}
                                             \EFv{xcb:ConfigWindow:StackMode}\EFrdb{)}
                         \EFb{:sibling} frame-container
                         \EFb{:stack-mode} \EFv{xcb:StackMode:Above}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFcd{;; }\EFc{Reparent this frame to its container.}
    \EFrdc{(}\EFk{xcb:+request} \EFv{exwm--connection}
        \EFrdd{(}\EFf{make-instance} \EFhq{'}\EFhs{xcb:ReparentWindow}
                       \EFb{:window} outer-id \EFb{:parent} frame-container \EFb{:x} \EFhn{0} \EFb{:y} \EFhn{0}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{exwm-floating--set-allowed-actions} id nil\EFrdc{)}
    \EFrdc{(}\EFf{xcb:flush} \EFv{exwm--connection}\EFrdc{)}
    \EFcd{;; }\EFc{Set window/buffer}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFf{exwm--id->buffer} id\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{window-size-fixed} \EFv{exwm--fixed-size}
            \EFv{exwm--floating-frame} frame\EFrdd{)}
      \EFcd{;; }\EFc{Do the refresh manually.}
      \EFrdd{(}\EFo{remove-hook} \EFhq{'}\EFv{window-configuration-change-hook} \EFhq{\#'}\EFhs{exwm-layout--refresh}\EFrdd{)}
      \EFrdd{(}\EFo{set-window-buffer} window \EFrda{(}\EFo{current-buffer}\EFrda{)}\EFrdd{)} \EFcd{;}\EFc{this changes current buffer}
      \EFrdd{(}\EFo{add-hook} \EFhq{'}\EFv{window-configuration-change-hook} \EFhq{\#'}\EFhs{exwm-layout--refresh}\EFrdd{)}
      \EFrdd{(}\EFo{set-window-dedicated-p} window t\EFrdd{)}
      \EFrdd{(}\EFo{exwm-layout--show} id window\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFf{exwm--id->buffer} id\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{exwm-layout--iconic-state-p} id\EFrda{)}
          \EFcd{;; }\EFc{Hide iconic floating X windows.}
          \EFrda{(}\EFo{exwm-floating-hide}\EFrda{)}
        \EFrda{(}\EFk{with-selected-frame} \EFv{exwm--frame}
          \EFrdb{(}\EFo{exwm-layout--refresh}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{select-frame-set-input-focus} frame\EFrdd{)}\EFrdc{)}
    \EFcd{;; }\textcolor[HTML]{ff6c6b}{\textbf{FIXME:}}\EFc{ Strangely, the Emacs frame can move itself at this point}
    \EFcd{;;        }\EFc{when there are left/top struts set.  Force resetting its}
    \EFcd{;;        }\EFc{position seems working, but it'd better to figure out why.}
    \EFcd{;; }\textcolor[HTML]{ff6c6b}{\textbf{FIXME:}}\EFc{ This also happens in another case (\#220) where the cause is}
    \EFcd{;;        }\EFc{still unclear.}
    \EFrdc{(}\EFo{exwm--set-geometry} outer-id \EFhn{0} \EFhn{0} nil nil\EFrdc{)}
    \EFrdc{(}\EFf{xcb:flush} \EFv{exwm--connection}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFf{exwm--id->buffer} id\EFrdc{)}
    \EFrdc{(}\EFo{run-hooks} \EFhq{'}\EFv{exwm-floating-setup-hook}\EFrdc{)}\EFrdb{)}
  \EFcd{;; }\EFc{Redraw the frame.}
  \EFrdb{(}\EFo{redisplay} t\EFrdb{)}\EFrda{)}

\EFcd{;; }\EFc{Additional commands that should also work in exwm}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<return>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{+vterm/toggle} nil\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-e"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{elfeed-load-summary}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-v"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{open-yt-dl-videos}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-r"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFk{progn}
  \EFrdd{(}\EFf{+vterm/here} t\EFrdd{)}
  \EFrdd{(}vterm-send-string \EFs{"cd /home/user/dox/install/rosarium \&\& cargo run\char92{}n"}\EFrdd{)}
\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<f4>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{go-to-scratch}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<left>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{winner-undo}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<right>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{winner-undo}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-a"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{org-agenda-list}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-m"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}mu4e--goto-inbox\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{exwm-input--update-global-prefix-keys}\EFrda{)}

\EFcd{;; }\EFc{Wallpaper}
\EFrda{(}\EFk{defmacro} \EFf{ifdirexists} \EFrdb{(}dir \EFt{\&rest} actions\EFrdb{)}
  \EFd{"Execute functions taking dir as an argument if dir exists"}
  \EFhq{`}\EFrdb{(}\EFk{when} \EFrdc{(}\EFo{file-exists-p} ,dir\EFrdc{)}
     \EFrdc{(}\EFrdd{(}\EFk{lambda} \EFrda{(}dir\EFrda{)}
       ,@actions\EFrdd{)} \EFwr{,dir}\textcolor[HTML]{98be65}{)}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}

\EFrda{(}\EFk{ifdirexists} \EFs{"/home/user/dox/wallpapers"}
             \EFrdb{(}\EFk{setq} wallpaper-cycle-directory dir\EFrdb{)}
             \EFrdb{(}\EFf{wallpaper-set-wallpaper}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{exwm-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{General}
\label{sec:orge4251ba}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{general}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgf78df47}
\subsubsection{Code}
\label{sec:orgc6e0684}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{general.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} \EFv{mouse-autoselect-window} t
      \EFv{focus-follows-mouse} t\EFrda{)}

\EFcd{;; }\EFc{Disable backup files}
\EFrda{(}\EFk{setq} \EFv{make-backup-files} nil\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{auto-save-default} nil\EFrda{)}

\EFcd{;; }\EFc{Delete selection when pasting}
\EFrda{(}\EFv{delete-selection-mode} \EFhn{1}\EFrda{)}

\EFcd{;; }\EFc{Save the session}
\EFrda{(}\EFv{desktop-save-mode} \EFhn{1}\EFrda{)}
\EFrda{(}\EFk{setq} desktop-restore-eager \EFhn{10}\EFrda{)}
\EFcd{;; }\EFc{Save last visited place in files}
\EFrda{(}\EFk{setq-default} \EFv{save-place} t\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{save-place-file} \EFs{"\char126{}/.emacs.d/etc/saveplace"}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{general}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Navigation}
\label{sec:org11280a9}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{navigation}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org8344a2d}
\subsubsection{Code}
\label{sec:orgd568048}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{navigation.el -*- lexical-binding: t; -*-}

\EFcd{;; }\EFc{Kill minibuffer when loosing focus}
\EFrda{(}\EFk{defun} \EFf{stop-using-minibuffer} \EFrdb{(}\EFrdb{)}
  \EFd{"kill the minibuffer"}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{>=} \EFrda{(}\EFo{recursion-depth}\EFrda{)} \EFhn{1}\EFrdd{)} \EFrdd{(}\EFo{active-minibuffer-window}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{abort-recursive-edit}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{mouse-leave-buffer-hook} \EFhq{'}\EFhs{stop-using-minibuffer}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{doom-fallback-buffer-name} \EFs{"► Doom"}
      \EFv{+doom-dashboard-name} \EFs{"► Doom"}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} \EFv{+doom-dashboard-mode-map}
      \EFb{:ne} \EFs{"f"} \EFhq{\#'}\EFhs{find-file}
      \EFb{:ne} \EFs{"r"} \EFhq{\#'}\EFhs{consult-recent-file}
      \EFb{:ne} \EFs{"p"} \EFhq{\#'}\EFhs{doom/open-private-config}
      \EFb{:ne} \EFs{"c"} \EFrdb{(}\EFk{cmd!} \EFrdc{(}\EFo{find-file} \EFrdd{(}\EFo{expand-file-name} \EFs{"config.org"} \EFv{doom-private-dir}\EFrdd{)}\EFrdc{)}\EFrdb{)}
      \EFb{:ne} \EFs{"."} \EFrdb{(}\EFk{cmd!} \EFrdc{(}\EFf{doom-project-find-file} \EFs{"\char126{}/.config/"}\EFrdc{)}\EFrdb{)} \EFcd{; }\EFc{. for dotfiles}
      \EFb{:ne} \EFs{"b"} \EFhq{\#'}\EFhs{+vertico/switch-workspace-buffer}
      \EFb{:ne} \EFs{"B"} \EFhq{\#'}\EFhs{consult-buffer}
      \EFb{:ne} \EFs{"q"} \EFhq{\#'}\EFhs{save-buffers-kill-terminal}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:n} \EFrdb{[}mouse-8\EFrdb{]} \EFhq{\#'}\EFhs{better-jumper-jump-backward}
      \EFb{:n} \EFrdb{[}mouse-9\EFrdb{]} \EFhq{\#'}\EFhs{better-jumper-jump-forward}\EFrda{)}

\EFcd{;}\EFc{(setq org-roam-directory "") ;; Temporary workaroundA}
\EFcd{;}\EFc{(setq frame-title-format}
\EFcd{;      }\EFc{'(""}
\EFcd{;        }\EFc{(:eval}
\EFcd{;         }\EFc{(if (s-contains-p org-roam-directory (or buffer-file-name ""))}
\EFcd{;             }\EFc{(replace-regexp-in-string}
\EFcd{;              }\EFc{".*/[0-9]*-?" "☰ "}
\EFcd{;              }\EFc{(subst-char-in-string ?\_ ?  buffer-file-name))}
\EFcd{;           }\EFc{"\%b"))}
\EFcd{;        }\EFc{(:eval}
\EFcd{;         }\EFc{(let ((project-name (projectile-project-name)))}
\EFcd{;           }\EFc{(unless (string= "-" project-name)}
\EFcd{;             }\EFc{(format (if (buffer-modified-p)  " ◉ \%s" "  ●  \%s") project-name))))))}

\EFrda{(}\EFk{setq} \EFv{display-line-numbers-type} \EFhq{'}\EFhs{relative}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ignore-dired-buffers-ivy} \EFrdb{(}str\EFrdb{)}
  \EFd{"Return non-nil if STR names a Dired buffer.
This function is intended for use with `}\textcolor[HTML]{a9a1e1}{ivy-ignore-buffers}\EFd{'."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}buf \EFrda{(}\EFo{get-buffer} str\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{and} buf \EFrdd{(}\EFo{eq} \EFrda{(}\EFo{buffer-local-value} \EFhq{'}\EFv{major-mode} buf\EFrda{)} \EFhq{'}\EFhs{dired-mode}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ignore-help-buffers-ivy} \EFrdb{(}str\EFrdb{)}
  \EFd{"Return non-nil if STR names a help buffer (buffers starting and ending with *)
This function is intended for use with `}\textcolor[HTML]{a9a1e1}{ivy-ignore-buffers}\EFd{'."}
  \EFrdb{(}\EFk{and}
   \EFrdc{(}\EFo{s-starts-with-p} \EFs{"*"} str\EFrdc{)}
   \EFrdc{(}\EFo{s-ends-with-p} \EFs{"*"} str\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ignore-unwanted-buffers-ivy} \EFrdb{(}str\EFrdb{)}
  \EFd{"Return non-nil if STR names a Dired buffer.
This function is intended for use with `}\textcolor[HTML]{a9a1e1}{ivy-ignore-buffers}\EFd{'."}
  \EFrdb{(}\EFk{or}
   \EFrdc{(}\EFo{string-equal} \EFs{"elfeed.org"} str\EFrdc{)}
   \EFrdc{(}\EFo{member} str \EFrdd{(}\EFo{map} \EFhq{'}\EFhs{list} \EFhq{'}\EFhs{file-name-nondirectory} \EFv{org-agenda-files}\EFrdd{)}\EFrdc{)}
   \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{with-eval-after-load} \EFhq{'}\EFhs{ivy}
  \EFrdb{(}\EFk{progn}
  \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{ivy-ignore-buffers} \EFhq{\#'}\EFhs{ignore-dired-buffers-ivy}\EFrdc{)}
  \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{ivy-ignore-buffers} \EFhq{\#'}\EFhs{ignore-help-buffers-ivy}\EFrdc{)}
  \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{ivy-ignore-buffers} \EFhq{\#'}\EFhs{ignore-unwanted-buffers-ivy}\EFrdc{)}
  \EFrdb{)}\EFrda{)}

\EFcd{;;; }\EFc{Switch window}
\EFrda{(}\EFk{use-package!} switch-window
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{switch-window-multiple-frames} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{switch-window-input-style} \EFhq{'}\EFhs{minibuffer}\EFrdb{)}
  \EFrdb{(}\EFk{setq} switch-window-increase \EFhn{4}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{switch-window-threshold} \EFhn{2}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{switch-window-shortcut-style} \EFhq{'}\EFhs{qwerty}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{switch-window-qwerty-shortcuts}
	\EFhq{'}\EFrdc{(}\EFs{"j"} \EFs{"k"} \EFs{"l"} \EFs{"a"} \EFs{"s"} \EFs{"d"} \EFs{"f"}\EFrdc{)}\EFrdb{)} \EFcd{; }\EFc{ö does not work without pressing RET}
  \EFb{:bind}
  \EFrdb{(}\EFrdc{[}remap other-window\EFrdc{]} . switch-window\EFrdb{)}\EFrda{)}

\EFcd{;;; }\EFc{Temporarily maximize current buffer}
\EFrda{(}\EFk{defun} \EFf{toggle-maximize-buffer} \EFrdb{(}\EFrdb{)} \EFd{"Maximize buffer"}
       \EFrdb{(}\EFk{interactive}\EFrdb{)}
       \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{=} \EFhn{1} \EFrdd{(}\EFo{length} \EFrda{(}\EFo{window-list}\EFrda{)}\EFrdd{)}\EFrdc{)}
	   \EFrdc{(}\EFo{jump-to-register} \EFhq{'}\EFhs{\_}\EFrdc{)}
	 \EFrdc{(}\EFk{progn}
	   \EFrdd{(}\EFo{window-configuration-to-register} \EFhq{'}\EFhs{\_}\EFrdd{)}
	   \EFrdd{(}\EFo{delete-other-windows}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{transparent-buffer-advice}
  \EFrdb{(}orig-fun \EFt{\&rest} args\EFrdb{)}
  \EFrdb{(}\EFo{shell-command} \EFs{"transset -p 1"}\EFrdb{)} \EFcd{; }\EFc{0.3}
  \EFrdb{(}\EFk{let}
      \EFrdc{(}\EFrdd{(}res
	\EFrda{(}\EFo{apply} orig-fun args\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{shell-command} \EFs{"transset -p 1"}\EFrdc{)}
    res\EFrdb{)}\EFrda{)}


\EFcd{;;; }\EFc{kill current buffer}
\EFrda{(}\EFk{defun} \EFf{kill-curr-buffer} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{string-equal} \EFrda{(}\EFo{buffer-name} \EFrdb{(}\EFo{current-buffer}\EFrdb{)}\EFrda{)} \EFs{"*scratch*"}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFo{kill-buffer} \EFrdd{(}\EFo{current-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{bury-buffer}\EFrdc{)}
    \EFrdc{(}\EFo{switch-to-buffer} \EFs{"*scratch*"}\EFrdc{)}
  \EFrdb{)}\EFrda{)}

\EFcd{;;; }\EFc{move to start and end of buffer}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"M-n"}\EFrdb{)} \EFhq{'}\EFhs{end-of-buffer}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"M-p"}\EFrdb{)} \EFhq{'}\EFhs{beginning-of-buffer}\EFrda{)}

\EFcd{;; }\EFc{Kill all buffers}
\EFrda{(}\EFk{defun} \EFf{close-all-buffers} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mapc} \EFhq{'}\EFhs{kill-buffer} \EFrdc{(}\EFo{buffer-list}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x C-k k"}\EFrdb{)} \EFhq{'}\EFhs{close-all-buffers}\EFrda{)}

\EFcd{;; }\EFc{Kill unwanted buffers}
\EFrda{(}\EFk{defun} \EFf{kill-if-unwanted} \EFrdb{(}buffer\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}b \EFrda{(}\EFo{buffer-name} buffer\EFrda{)}\EFrdd{)}
	\EFrdd{(}bfn \EFrda{(}\EFv{buffer-file-name} buffer\EFrda{)}\EFrdd{)}
        \EFrdd{(}bmm \EFrda{(}\EFo{buffer-local-value} \EFhq{'}\EFv{major-mode} buffer\EFrda{)}\EFrdd{)}
	\EFrdd{(}unwanted-buffers \EFhq{'}\EFrda{(}
			    \EFs{"*Messages*"}
			    \EFs{"*Backtrace*"}
			    \EFs{"*Help*"}
			    \EFs{"*Warnings*"}
			    \EFs{"*Compile-Log*"}
			    \EFs{"*elfeed-log*"}
			    \EFs{"*system-packages*"}
			    \EFs{"*Async Shell Command*"}
			    \EFs{"*Flycheck errors*"}
			    \EFs{"*Flycheck error messages*"}
			    \EFs{"*Flymake log*"}
			    \EFs{"*Calendar*"}
			    \EFs{"*XELB-DEBUG*"}
			    \EFs{"*Read-Aloud Log*"}
			    \EFs{"*elfeed-search*"}
			    \EFs{"elfeed.org"}
			    \EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{or} \EFrda{(}\EFo{member} b unwanted-buffers\EFrda{)}
	  \EFrda{(}\EFo{member} bfn \EFrdb{(}\EFo{mapcar} \EFhq{'}\EFhs{expand-file-name} \EFv{org-agenda-files}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{eq} \EFhq{'}\EFhs{dired-mode} bmm\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*tramp.*}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.png\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.jpg\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.jpeg\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.gif\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.log\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}\_region\_.tex\$"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*helpful .*}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*"} b\EFrda{)}
          \EFrda{(}\EFo{string-match} \EFs{"- Thunar"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}magit"} b\EFrda{)}
	  \EFrda{(}\EFo{string-match} \EFs{"\char94{}}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*.*}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{*\$"} b\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer} b\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{kill-unwanted-buffers} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{mapc} \EFhq{'}\EFhs{kill-if-unwanted} \EFrdc{(}\EFo{buffer-list}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x k"}\EFrdb{)} \EFhq{'}\EFhs{kill-unwanted-buffers}\EFrda{)}

\EFcd{;;; }\EFc{Window splitting}
\EFrda{(}\EFk{defun} \EFf{split-and-follow-horizontally} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{split-window-below}\EFrdb{)}
  \EFrdb{(}\EFo{balance-windows}\EFrdb{)}
  \EFrdb{(}\EFo{other-window} \EFhn{1}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x 2"}\EFrdb{)} \EFhq{'}\EFhs{split-and-follow-horizontally}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{split-and-follow-vertically} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{split-window-right}\EFrdb{)}
  \EFrdb{(}\EFo{balance-windows}\EFrdb{)}
  \EFrdb{(}\EFo{other-window} \EFhn{1}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x 3"}\EFrdb{)} \EFhq{'}\EFhs{split-and-follow-vertically}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{kill-and-balance} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{delete-window}\EFrdb{)}
  \EFrdb{(}\EFo{balance-windows}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x 0"}\EFrdb{)} \EFhq{'}\EFhs{kill-and-balance}\EFrda{)}



\EFcd{;;; }\EFc{Subword moving}
\EFrda{(}\EFv{global-subword-mode} \EFhn{1}\EFrda{)}

\EFcd{;;; }\EFc{Cycle though tabs}
\EFcd{;}\EFc{(global-set-key (kbd "C-<tab>") 'next-buffer)}
\EFcd{;}\EFc{(global-set-key (kbd "<C-iso-lefttab>") 'previous-buffer)}

\EFcd{;;; }\EFc{Winum mode for easy moving through windows}
\EFrda{(}\EFk{use-package!} winum
  \EFb{:config}
  \EFrdb{(}\EFk{setq} winum-auto-setup-mode-line nil\EFrdb{)}
  \EFrdb{(}\EFv{winum-mode} t\EFrdb{)}
  \EFb{:bind} \EFrdb{(}
	 \EFrdc{(}\EFs{"s-="} . winum-select-window-0\EFrdc{)}
	 \EFrdc{(}\EFs{"s-!"} . winum-select-window-1\EFrdc{)}
	 \EFrdc{(}\EFs{"s-\char92{}""} . winum-select-window-2\EFrdc{)}
	 \EFrdc{(}\EFs{"s-§"} . winum-select-window-3\EFrdc{)}
	 \EFrdc{(}\EFs{"s-\$"} . winum-select-window-4\EFrdc{)}
	 \EFrdc{(}\EFs{"s-\%"} . winum-select-window-5\EFrdc{)}
	 \EFrdc{(}\EFs{"s-\&"} . winum-select-window-6\EFrdc{)}
	 \EFrdc{(}\EFs{"s-/"} . winum-select-window-7\EFrdc{)}
	 \EFrdc{(}\EFs{"s-("} . winum-select-window-8\EFrdc{)}
	 \EFrdc{(}\EFs{"s-)"} . winum-select-window-9\EFrdc{)}
	 \EFrdc{(}\EFs{"s-°"} . winum-select-window-by-number\EFrdc{)}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{navigation}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Shortcuts}
\label{sec:org3c3de9c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{shortcuts}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org25f0d18}
\subsubsection{Code}
\label{sec:org78ce0d6}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{shortcuts.el -*- lexical-binding: t; -*-}

\EFcd{;;;; }\EFc{Copy-whole-line}
\EFrda{(}\EFk{defun} \EFf{copy-whole-line} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{kill-ring-save} \EFrdd{(}\EFo{point-at-bol}\EFrdd{)} \EFrdd{(}\EFo{point-at-eol}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c w l"}\EFrdb{)} \EFhq{'}\EFhs{copy-whole-line}\EFrda{)}

\EFcd{;;;; }\EFc{Copy-line-above and copy-line-below (and paste)}
\EFrda{(}\EFk{defun} \EFf{copy-line-above} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{evil-previous-visual-line}\EFrdc{)}
    \EFrdc{(}\EFf{copy-whole-line}\EFrdc{)}
    \EFrdc{(}\EFo{evil-next-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{evil-paste-after} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c l a"}\EFrdb{)} \EFhq{'}\EFhs{copy-line-above}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{copy-line-below} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{evil-next-visual-line}\EFrdc{)}
    \EFrdc{(}\EFf{copy-whole-line}\EFrdc{)}
    \EFrdc{(}\EFo{evil-previous-visual-line}\EFrdc{)}
    \EFrdc{(}\EFo{evil-paste-after} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c l b"}\EFrdb{)} \EFhq{'}\EFhs{copy-line-below}\EFrda{)}

\EFcd{;;;; }\EFc{Duplicate line}
\EFrda{(}\EFk{defun} \EFf{duplicate-line} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{evil-open-below} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFf{copy-line-above}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{evil-next-visual-line}\EFrdb{)}
  \EFrdb{(}\EFo{evil-normal-state}\EFrdb{)}
  \EFrdb{(}\EFo{evil-forward-char}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c l l"}\EFrdb{)} \EFhq{'}\EFhs{duplicate-line}\EFrda{)}

\EFcd{;;; }\EFc{Kill word improved}
\EFcd{;;; }\EFc{normal kill-word kills forward, but not whole word. This fixes that}
\EFrda{(}\EFk{defun} \EFf{kill-whole-word} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{backward-word}\EFrdb{)}
  \EFrdb{(}\EFo{kill-word} \EFhn{1}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c k w"}\EFrdb{)} \EFhq{'}\EFhs{kill-whole-word}\EFrda{)}

\EFcd{;;; }\EFc{File shortcuts}
\EFcd{;; }\EFc{Note taken on [2018-08-03 Fri 18:19]}
\EFrda{(}\EFo{global-unset-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defadvice} \EFf{goto-line} \EFrdb{(}after unfold-tree activate\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFf{outline-invisible-p}\EFrdc{)}
    \EFrdc{(}\EFk{save-excursion}
      \EFrdd{(}\EFo{outline-previous-visible-heading} \EFhn{1}\EFrdd{)}
      \EFrdd{(}\EFo{org-fold-show-subtree}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{agenda-today} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{goto-line} \EFrdc{(}\EFo{string-to-number} \EFrdd{(}\EFo{shell-command-to-string} \EFs{"\char126{}/.scripts/agendatoday"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{org-reveal} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{dailyplan}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFrdc{(}\EFo{shell-command-to-string} \EFs{"date +'}\textcolor[HTML]{a9a1e1}{/home/user/dp/dailyplan/\%Y/\%Y-\%m/\%Y-\%m-\%d.org}\EFs{' | tr -d '}\textcolor[HTML]{a9a1e1}{\char92{}n}\EFs{'"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{end-of-buffer}\EFrdb{)}\EFrda{)}

\EFcd{;}\EFc{(add-hook 'find-file-hook 'dailyplan-hook)}
\EFcd{;}\EFc{(defun dailyplan-hook ()}
\EFcd{;  }\EFc{(when (string= (buffer-file-name) "dailyplan.org")}
\EFcd{;    }\EFc{(agenda-today)))}

\EFrda{(}\EFk{defun} \EFf{books}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/books.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{thesis}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/nextcloud/bachelor/thesis/structure.tex"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{projects}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/currprojects.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{movies}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/movies.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{reviews}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/reviews/2018.org"}\EFrdb{)}
  \EFrdb{(}\EFf{split-and-follow-vertically}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/pCloudDrive/agenda/reviews/template.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ceres}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/ssh:user@sermak.xyz:\char126{}"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ceres-root}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/ssh:user@sermak.xyz|sudo:root@sermak.xyz:/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{jarvis}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/ssh:user@sermak.xyz|sudo:root@jarvis:/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{jarvis-root}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/ssh:user@sermak.xyz|ssh:user@jarvis:/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z d"}\EFrdb{)} \EFhq{'}\EFhs{dailyplan}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z b"}\EFrdb{)} \EFhq{'}\EFhs{books}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z m"}\EFrdb{)} \EFhq{'}\EFhs{movies}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z r"}\EFrdb{)} \EFhq{'}\EFhs{reviews}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z p"}\EFrdb{)} \EFhq{'}\EFhs{projects}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z t"}\EFrdb{)} \EFhq{'}\EFhs{thesis}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z e"}\EFrdb{)} \EFhq{'}\EFhs{mu4e}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z s c"}\EFrdb{)} \EFhq{'}\EFhs{ceres}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c z s r"}\EFrdb{)} \EFhq{'}\EFhs{ceres-root}\EFrda{)}

\EFcd{;; }\EFc{University}
\EFrda{(}\EFk{setq} uni-base-folder \EFs{"/mnt/server-de/mnt/backup/backups/pre\_master/Uni"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{open-uni-folder} \EFrdb{(}folder\EFrdb{)}
  \EFd{"Mount/Open university folder specified as FOLDER."}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{file-exists-p} uni-base-folder\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{shell-command} \EFs{"sshfs sermak.xyz:/ /mnt/server-de"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFrdc{(}\EFo{f-join} uni-base-folder folder\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defmacro} \EFf{uni-folder-shortcut} \EFrdb{(}shortcut folder funcname\EFrdb{)}
  \EFhq{`}\EFrdb{(}\EFk{progn}
  \EFrdc{(}\EFk{defun} ,funcname \EFrdd{(}\EFrdd{)}
    ,\EFrdd{(}\EFo{format} \EFs{"Open Uni/\%s"} folder\EFrdd{)}
     \EFrdd{(}\EFk{interactive}\EFrdd{)}
     \EFrdd{(}\EFf{open-uni-folder} ,folder\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{global-set-key} \EFrdd{(}\EFo{kbd} \EFrda{(}\EFo{concat} \EFs{"C-c u "} ,shortcut\EFrda{)}\EFrdd{)} \EFhq{'},funcname\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"u"} \EFs{""} uni\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"6"} \EFs{"6"} uni6\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"l 1"} \EFs{"6/Orthodox Liturgy I"} orthodox-liturgy-1\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"l 2"} \EFs{"6/Orthodox Liturgy II"} orthodox-liturgy-2\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"h 1"} \EFs{"6/Orthodox History I"} orthodox-history-1\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"h 2"} \EFs{"6/Orthodox History II"} orthodox-history-2\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"t 1"} \EFs{"6/Orthodox Theology I"} orthodox-theology-1\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"t 2"} \EFs{"6/Orthodox Theology II"} orthodox-theology-2\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"s"} \EFs{"6/Orthodox Scripture"} orthodox-scripture\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"a"} \EFs{"6/Orthodox Anthropology"} orthodox-anthropology\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"w"} \EFs{"6/War and Statesbuilding in Afghanistan"} war-and-statesbuilding\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"e"} \EFs{"6/Exegesis of the Old and New Testament"} exegesis\EFrda{)}
\EFrda{(}\EFk{uni-folder-shortcut} \EFs{"m"} \EFs{"6/Monte Carlo Techniques"} monte-carlo\EFrda{)}

\EFcd{;; }\EFc{Tones}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c -"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{"̄"}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c \char94{}"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{"̂"}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFcd{;;; }\EFc{Chinese tones}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 1"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{"̄"}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 2"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{"́"}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 3"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{"̌"}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c 4"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFo{insert} \EFs{"̀"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;; }\EFc{Rectangle mark mode}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-ö"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFv{rectangle-mark-mode}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFcd{;;; }\EFc{Sudo-edit}
\EFrda{(}\EFk{use-package!} sudo-edit
  \EFb{:bind} \EFrdb{(}\EFs{"C-c s"} . sudo-edit\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{rededicate-window} \EFrdb{(}\EFrdb{)}
  \EFd{"Toggles window dedication in the selected window."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}dedication \EFrda{(}\EFo{not} \EFrdb{(}\EFo{window-dedicated-p} \EFrdc{(}\EFo{selected-window}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFrdd{(}\EFo{format} \EFs{"\%s"} dedication\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{set-window-dedicated-p} \EFrdd{(}\EFo{selected-window}\EFrdd{)} dedication\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-<return>"}\EFrdb{)} \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)} \EFrdc{(}\EFk{interactive}\EFrdc{)} \EFrdc{(}\EFf{+vterm/toggle} nil\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{; }\EFc{Org agenda}

\EFrda{(}\EFk{defun} \EFf{agenda-folder} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/home/user/sync/agenda/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{agenda-uni} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/home/user/sync/agenda/uni.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{agenda-personal} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/home/user/sync/agenda/personal.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c a a"}\EFrdb{)} \EFhq{'}\EFhs{agenda-folder}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c a u"}\EFrdb{)} \EFhq{'}\EFhs{agenda-uni}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c a p"}\EFrdb{)} \EFhq{'}\EFhs{agenda-personal}\EFrda{)}

\EFcd{; }\EFc{Books}

\EFrda{(}\EFk{defun} \EFf{books} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"/home/user/dox/books/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c b"}\EFrdb{)} \EFhq{'}\EFhs{books}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{shortcuts}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Config visit}
\label{sec:org7aecc8b}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{config-visit}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org0ef2352}
\subsubsection{Code}
\label{sec:orgc26c547}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{config.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} module-dir \EFrdb{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"modules/"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq-default} \EFv{custom-file} \EFrdb{(}\EFo{expand-file-name} \EFs{".custom.el"} \EFv{doom-private-dir}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{when} \EFrdb{(}\EFo{file-exists-p} \EFv{custom-file}\EFrdb{)}
  \EFrdb{(}\EFo{load} \EFv{custom-file}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{config-visit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFrdc{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"config.org"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{init-visit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFrdc{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"init.el"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{packages-visit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFrdc{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"packages.el"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{module-visit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} module-dir\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{recompile-modules} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{digit-argument} nil\EFrdb{)}
  \EFrdb{(}\EFo{byte-recompile-directory} module-dir \EFhn{0}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{config-reload} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFcd{;;}\EFc{(recompile-modules)}
  \EFrdb{(}\EFo{org-babel-tangle-file} \EFrdc{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"config.org"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{load-file} \EFrdc{(}\EFo{expand-file-name} \EFrdd{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"config.el"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c e c"}\EFrdb{)} \EFhq{'}\EFhs{config-visit}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c e p"}\EFrdb{)} \EFhq{'}\EFhs{packages-visit}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c e i"}\EFrdb{)} \EFhq{'}\EFhs{init-visit}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c e m"}\EFrdb{)} \EFhq{'}\EFhs{module-visit}\EFrda{)}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c r"}\EFrdb{)} \EFhq{'}\EFhs{config-reload}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{config-visit}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Search}
\label{sec:org7380182}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{search}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org3d2de02}
\subsubsection{Code}
\label{sec:orgd8dd4bc}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{search.el -*- lexical-binding: t; -*-}

\EFcd{;; }\EFc{Swiper / Ivy / Counsel}
\EFcd{;;  }\EFc{Swiper gives us a really efficient incremental search with regular expressions}
\EFcd{;;  }\EFc{and Ivy / Counsel replace a lot of ido or helms completion functionality}
\EFrda{(}\EFk{use-package!} counsel
  \EFb{:bind}
  \EFrdb{(}\EFrdc{(}\EFs{"M-y"} . counsel-yank-pop\EFrdc{)}
   \EFb{:map} \EFv{ivy-minibuffer-map}
   \EFrdc{(}\EFs{"M-y"} . ivy-next-line\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} ivy
  \EFb{:diminish} \EFrdb{(}\EFv{ivy-mode}\EFrdb{)}
  \EFb{:bind} \EFrdb{(}\EFrdc{(}\EFs{"C-x C-b"} . ivy-icon-switch-buffer\EFrdc{)}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFv{ivy-mode} \EFhn{1}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{ivy-use-virtual-buffers} t
	\EFv{ivy-count-format} \EFs{"\%d/\%d "}
	\EFv{ivy-height} \EFhn{20}
	\EFv{enable-recursive-minibuffers} t
	\EFv{ivy-display-style} \EFhq{'}\EFhs{fancy}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{use-package!} all-the-icons-ibuffer
  \EFb{:init} \EFrdb{(}\EFv{all-the-icons-ibuffer-mode} \EFhn{1}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{ivy-icon-switch-buffer} \EFrdb{(}\EFrdb{)}
  \EFd{"ivy-switch-buffer with icons"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{condition-case} nil
      \EFrdc{(}\EFo{all-the-icons-ivy-setup}\EFrdc{)}\EFrdb{)}

\EFrdb{(}\EFk{defun} \EFf{all-the-icons-ivy--buffer-transformer} \EFrdc{(}b s\EFrdc{)}
  \EFd{"Return a candidate string for buffer B named S preceded by an icon.
Try to find the icon for the buffer's B `}\textcolor[HTML]{a9a1e1}{major-mode}\EFd{'.
If that fails look for an icon for the mode that the `}\textcolor[HTML]{a9a1e1}{major-mode}\EFd{' is derived from."}
  \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}mode \EFrdb{(}\EFo{buffer-local-value} \EFhq{'}\EFv{major-mode} b\EFrdb{)}\EFrda{)}
	\EFrda{(}buffname \EFrdb{(}\EFo{replace-regexp-in-string} \EFs{"<.*>\$"} \EFs{""} s\EFrdb{)}\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFo{format} \EFrda{(}\EFo{concat} \EFs{"\%s"} \EFv{all-the-icons-spacer} \EFs{"\%s"}\EFrda{)}
            \EFrda{(}\EFo{propertize} \EFs{"\char92{}t"} \EFhq{'}\EFhs{display} \EFrdb{(}\EFk{or}
                                       \EFrdc{(}\EFo{all-the-icons-ivy--icon-for-mode} mode\EFrdc{)}
                                       \EFrdc{(}\EFo{all-the-icons-ivy--icon-for-mode} \EFrdd{(}\EFo{get} mode \EFhq{'}\EFhs{derived-mode-parent}\EFrdd{)}\EFrdc{)}
				       \EFrdc{(}\EFf{all-the-icons-ivy--icon-for-firefox} mode buffname\EFrdc{)}
				       \EFrdc{(}\EFf{all-the-icons-ivy--icon-for-tor} mode buffname\EFrdc{)}
				       \EFrdc{(}\EFf{all-the-icons-ivy--icon-for-exwm} mode buffname\EFrdc{)}
                                       \EFrdc{(}\EFo{funcall}
                                        \EFv{all-the-icons-ivy-family-fallback-for-buffer}
                                        \EFv{all-the-icons-ivy-name-fallback-for-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFo{all-the-icons-ivy--buffer-propertize} b s\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}


  \EFrdb{(}\EFo{ivy-switch-buffer}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{all-the-icons-ivy-file-commands} \EFhq{'}\EFrdb{(}counsel-find-file counsel-file-jump counsel-recentf counsel-projectile-find-file counsel-projectile-find-dir\EFrdb{)}\EFrda{)}

\EFcd{;; }\EFc{Overwrite some stuff for exwm and icons in Firefox}
\EFrda{(}\EFk{defun} \EFf{all-the-icons-ivy--icon-for-firefox} \EFrdb{(}mode buffname\EFrdb{)}
  \EFd{"Apply `}\textcolor[HTML]{a9a1e1}{all-the-icons-icon-for-url}\EFd{' on Firefox window in exwm-mode.
Assuming that url is in title like in Keepass Helper extension."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-equal} \EFrdd{(}\EFo{format} \EFs{"\%s"} mode\EFrdd{)} \EFs{"exwm-mode"}\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}bnl \EFrdb{(}\EFo{split-string} buffname \EFs{" - "}\EFrdb{)}\EFrda{)}
	    \EFrda{(}fnl \EFrdb{(}\EFo{split-string} buffname \EFs{" — "}\EFrdb{)}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}browser \EFrdc{(}\EFo{format} \EFs{"\%s"} \EFrdd{(}\EFo{last} fnl\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
      \EFrda{(}\EFk{if} \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{string-equal} browser \EFs{"(Mozilla Firefox)"}\EFrdc{)} \EFrdc{(}\EFo{string-equal} browser \EFs{"(Mozilla Firefox (Private Browsing))"}\EFrdc{)}\EFrdb{)}
	  \EFrdb{(}\EFo{all-the-icons-faicon} \EFs{"firefox"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-red}\EFrdb{)}
	\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;; }\EFc{Overwrite some stuff for exwm and icons in Tor Browser}
\EFrda{(}\EFk{defun} \EFf{all-the-icons-ivy--icon-for-tor} \EFrdb{(}mode buffname\EFrdb{)}
  \EFd{"Apply youtube icon on Tor Browser window in exwm-mode.
Not assuming that url is in title like in Keepass Helper extension, for privacy."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-equal} \EFrdd{(}\EFo{format} \EFs{"\%s"} mode\EFrdd{)} \EFs{"exwm-mode"}\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}bnl \EFrdb{(}\EFo{split-string} buffname \EFs{" - "}\EFrdb{)}\EFrda{)}\EFrdd{)}
	\EFrdd{(}\EFk{if} \EFrda{(}\EFo{string-equal} \EFrdb{(}\EFo{format} \EFs{"\%s"} \EFrdc{(}\EFo{last} bnl\EFrdc{)}\EFrdb{)} \EFs{"(Tor Browser)"}\EFrda{)}
	    \EFrda{(}\EFk{if} \EFrdb{(}\EFo{string-equal} \EFrdc{(}\EFo{format} \EFs{"\%s"} \EFrdd{(}\EFo{last} bnl \EFhn{2}\EFrdd{)}\EFrdc{)} \EFs{"(YouTube Tor Browser)"}\EFrdb{)}
		\EFrdb{(}\EFf{all-the-icons-icon-for-url} \EFs{"youtube.com"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-red}\EFrdb{)}
	      \EFrdb{(}\EFo{all-the-icons-faicon} \EFs{"user-secret"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-red}\EFrdb{)}
	      \EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;; }\EFc{Overwrite some stuff for exwm}
\EFrda{(}\EFk{defun} \EFf{all-the-icons-ivy--icon-for-exwm} \EFrdb{(}mode buffname\EFrdb{)}
  \EFd{"Hard-code some icons for common programs."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-equal} \EFrdd{(}\EFo{format} \EFs{"\%s"} mode\EFrdd{)} \EFs{"exwm-mode"}\EFrdc{)}
      \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{string-prefix-p} \EFs{"Signal"} buffname\EFrda{)}
	     \EFrda{(}\EFo{all-the-icons-faicon} \EFs{"comment"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-blue-alt}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-prefix-p} \EFs{"Skype"} buffname\EFrda{)}
	     \EFrda{(}\EFo{all-the-icons-faicon} \EFs{"skype"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-blue}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-suffix-p} \EFs{" - Discord"} buffname\EFrda{)}
	     \EFrda{(}\EFo{all-the-icons-faicon} \EFs{"simplybuilt"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-purple}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-prefix-p} \EFs{"OBS"} buffname\EFrda{)}
	     \EFrda{(}\EFo{all-the-icons-faicon} \EFs{"video-camera"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-purple-alt}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-equal} \EFs{"Volume Control"} buffname\EFrda{)}
	     \EFrda{(}\EFo{all-the-icons-faicon} \EFs{"volume-up"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-purple-alt}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{file-directory-p} buffname\EFrda{)}
	     \EFrda{(}\EFo{all-the-icons-faicon} \EFs{"folder-open"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-yellow}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-suffix-p} \EFs{" - mpv"} buffname\EFrda{)}
	     \EFrda{(}\EFo{all-the-icons-faicon} \EFs{"play"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-orange}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFo{string-suffix-p} \EFs{"}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{.java"} buffname\EFrda{)}
	     \EFrda{(}\EFo{all-the-icons-alltheicon} \EFs{"java"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-orange}\EFrda{)}\EFrdd{)}
	    \EFrdd{(}\EFrda{(}\EFk{or}\EFrdb{(}\EFo{string-equal} \EFs{"st"} buffname\EFrdb{)} \EFrdb{(}\EFo{string-prefix-p} \EFrdc{(}\EFo{concat} \EFrdd{(}\EFv{user-login-name}\EFrdd{)} \EFs{"@"}\EFrdc{)} buffname\EFrdb{)} \EFrdb{(}\EFo{string-prefix-p} \EFs{"root@"} buffname\EFrdb{)}\EFrda{)}
	     \EFrda{(}\EFo{all-the-icons-faicon} \EFs{"terminal"} \EFb{:face} \EFhq{'}\EFhs{all-the-icons-green}\EFrda{)}\EFrdd{)}
	    \EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{use-package!} swiper
  \EFb{:bind} \EFrdb{(}\EFrdc{(}\EFs{"C-s"} . swiper\EFrdc{)}
	 \EFrdc{(}\EFs{"C-r"} . swiper\EFrdc{)}
	 \EFrdc{(}\EFs{"C-c C-r"} . ivy-resume\EFrdc{)}
	 \EFrdc{(}\EFs{"M-x"} . counsel-M-x\EFrdc{)}
	 \EFrdc{(}\EFs{"C-x C-f"} . counsel-find-file\EFrdc{)}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{progn}
    \EFrdc{(}\EFv{ivy-mode} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{ivy-use-virtual-buffers} t\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{ivy-display-style} \EFhq{'}\EFhs{fancy}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} \EFv{read-expression-map} \EFrdd{(}\EFo{kbd} \EFs{"C-r"}\EFrdd{)} \EFhq{'}\EFhs{counsel-expression-history}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFcd{;; }\EFc{IDO}
\EFcd{;;; }\EFc{enable ido mode}
\EFrda{(}\EFk{setq} \EFv{ido-enable-flex-matching} nil\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{ido-create-new-buffer} \EFhq{'}\EFhs{always}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{ido-everywhere} t\EFrda{)}
\EFrda{(}\EFv{ido-mode} \EFhn{1}\EFrda{)}

\EFcd{;;; }\EFc{ido vertical}
\EFrda{(}\EFk{use-package!} \EFv{ido-vertical-mode}
  \EFb{:init}
  \EFrdb{(}\EFv{ido-vertical-mode} \EFhn{1}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{ido-vertical-define-keys} \EFhq{'}\EFhs{C-n-and-C-p-only}\EFrdb{)}\EFrda{)}

\EFcd{;;; }\EFc{smex}
\EFrda{(}\EFk{use-package!} amx
  \EFb{:init} \EFrdb{(}\EFo{amx-initialize}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{setq} \EFv{amx-backend} \EFhq{'}\EFhs{ivy}
	-show-key-bindings t\EFrdb{)}
  \EFb{:bind}
  \EFrdb{(}\EFs{"M-x"} . amx\EFrdb{)}\EFrda{)}

\EFcd{;;; }\EFc{switch buffer}
\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-x b"}\EFrdb{)} \EFhq{'}\EFhs{ido-switch-buffer}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{search}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Read Aloud}
\label{sec:org36a385c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{read-aloud}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org3e1fc97}
\subsubsection{Code}
\label{sec:org2ba83bd}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{read-aloud.el -*- lexical-binding: t; -*-}

\EFcd{;;; }\EFc{read-aloud.el --- A simple interface to TTS engines  -*- lexical-binding: t; -*-}

\EFcd{;; }\EFc{Author: Alexander Gromnitsky <alexander.gromnitsky@gmail.com>}
\EFcd{;; }\EFc{Version: 0.0.2}
\EFcd{;; }\EFc{Package-Requires: ((emacs "24.4"))}
\EFcd{;; }\EFc{Keywords: multimedia}
\EFcd{;; }\EFc{URL: https://github.com/gromnitsky/read-aloud.el}

\EFcd{;; }\EFc{This file is not part of GNU Emacs.}

\EFcd{;;; }\EFc{License:}

\EFcd{;; }\EFc{MIT}

\EFcd{;;; }\EFc{Commentary:}

\EFcd{;; }\EFc{This package uses an external TTS engine (like flite) to pronounce}
\EFcd{;; }\EFc{the word at or near point, the selected region or a whole buffer.}

\EFcd{;;; }\EFc{Code:}

\EFrda{(}\EFk{defvar} \EFv{read-aloud-engine} \EFs{"speech-dispatcher"}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{read-aloud-engine} \EFs{"flite"}\EFrda{)}
\EFrda{(}\EFk{defvar} \EFv{read-aloud-engines}
  \EFhq{'}\EFrdb{(}\EFs{"speech-dispatcher"}			\EFcd{; }\EFc{Linux/FreeBSD only}
    \EFrdc{(}cmd \EFs{"spd-say"} args \EFrdd{(}\EFs{"-e"} \EFs{"-w"}\EFrdd{)} kill \EFs{"spd-say -S"}\EFrdc{)}
    \EFs{"flite"}				\EFcd{; }\EFc{Cygwin?}
    \EFrdc{(}cmd \EFs{"flite"} args nil\EFrdc{)}
    \EFs{"jampal"}				\EFcd{; }\EFc{Windows}
    \EFrdc{(}cmd \EFs{"cscript"} args \EFrdd{(}\EFs{"C:\char92{}\char92{}Program Files\char92{}\char92{}Jampal\char92{}\char92{}ptts.vbs"} \EFs{"-r"} \EFs{"5"}\EFrdd{)}\EFrdc{)}
    \EFs{"say"}				\EFcd{; }\EFc{macOS}
    \EFrdc{(}cmd \EFs{"say"} args nil\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{read-aloud-max} \EFhn{160}\EFrda{)}		\EFcd{; }\EFc{chars}
\EFrda{(}\EFk{defface} \EFv{read-aloud-text-face} \EFhq{'}\EFrdb{(}\EFrdc{(}t \EFb{:inverse-video} t\EFrdc{)}\EFrdb{)}
  \EFd{"For highlighting the text that is being read"}\EFrda{)}



\EFrda{(}\EFo{require} \EFhq{'}\EFo{cl-lib}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{subr-x}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{read-aloud-word-hist} \EFhq{'}\EFrdb{(}\EFrdb{)}\EFrda{)}	\EFcd{; }\EFc{(*-current-word) uses it}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--logbufname} \EFs{"*Read-Aloud Log*"}\EFrda{)}

\EFcd{;; }\EFc{this should be in cl-defstruct}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-pr} nil\EFrda{)}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-buf} nil\EFrda{)}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-bufpos} nil\EFrda{)}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-locked} nil\EFrda{)}
\EFrda{(}\EFk{defconst} \EFv{read-aloud--c-overlay} nil\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--log}\EFrdb{(}msg \EFt{\&optional} args\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}buf \EFrda{(}\EFo{get-buffer-create} \EFv{read-aloud--logbufname}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} buf
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert-before-markers} \EFrda{(}\EFo{format} \EFrdb{(}\EFo{concat} msg \EFs{"\char92{}n"}\EFrdb{)} args\EFrda{)}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud-test} \EFrdb{(}\EFrdb{)}
  \EFd{"Open a new tmp buffer, insert a string, try to read it."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}buf \EFrda{(}\EFo{get-buffer-create} \EFs{"*Read-Aloud Test*"}\EFrda{)}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{with-current-buffer} buf
      \EFrdd{(}\EFo{erase-buffer}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"Here lies the body of William Jay,
Who died maintaining his right of way--
He was right, dead right, as he speed along,
But he's just as dead as if he were wrong."}\EFrdd{)}\EFrdc{)}

    \EFcd{;; }\EFc{show our logs}
    \EFrdc{(}\EFo{switch-to-buffer} \EFv{read-aloud--logbufname}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-max}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFf{read-aloud--u-switch-to-buffer} buf\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-buf} buf\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-bufpos} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFf{read-aloud-buf}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{read-aloud-change-engine}\EFrdb{(}\EFrdb{)}
  \EFd{"Select another TTS engine."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud-engine}
	\EFrdc{(}\EFo{ido-completing-read}
	 \EFs{"read aloud with: "}
	 \EFrdd{(}\EFk{cl-loop} for \EFrda{(}key \_\EFrda{)} on \EFv{read-aloud-engines} by \EFhq{'}\EFhs{cddr}
		  collect key\EFrdd{)}
	 nil nil nil nil \EFv{read-aloud-engine}
	 \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--cmd} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{plist-get} \EFrdd{(}\EFo{lax-plist-get} \EFv{read-aloud-engines} \EFv{read-aloud-engine}\EFrdd{)} \EFhq{'}\EFhs{cmd}\EFrdc{)}
      \EFrdc{(}\EFo{user-error} \EFs{"Failed to get the default TTS engine"}\EFrdc{)}\EFrdb{)} \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--args} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{plist-get} \EFrdc{(}\EFo{lax-plist-get} \EFv{read-aloud-engines} \EFv{read-aloud-engine}\EFrdc{)} \EFhq{'}\EFhs{args}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--valid-str-p} \EFrdb{(}str\EFrdb{)}
  \EFrdb{(}\EFk{and} str \EFrdc{(}\EFo{not} \EFrdd{(}\EFo{equal} \EFs{""} \EFrda{(}\EFo{string-trim} str\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--overlay-rm}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFv{read-aloud--c-overlay}
    \EFrdc{(}\EFo{delete-overlay} \EFv{read-aloud--c-overlay}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-overlay} nil\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--overlay-make}\EFrdb{(}beg end\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} beg end\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-overlay} \EFrdd{(}\EFo{make-overlay} beg end\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{overlay-put} \EFv{read-aloud--c-overlay} \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{read-aloud-text-face}\EFrdc{)} \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--reset}\EFrdb{(}\EFrdb{)}
  \EFd{"Reset internal state."}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-pr} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-buf} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-bufpos} nil\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-locked} nil\EFrdb{)}

  \EFrdb{(}\EFf{read-aloud--overlay-rm}\EFrdb{)}
  \EFrdb{(}\EFf{read-aloud--log} \EFs{"RESET"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{cl-defun} \EFf{read-aloud--string}\EFrdb{(}str source\EFrdb{)}
  \EFd{"Open an async process, feed its stdin with STR. SOURCE is an
arbitual string like '}\textcolor[HTML]{a9a1e1}{buffer}\EFd{', '}\textcolor[HTML]{a9a1e1}{word}\EFd{' or '}\textcolor[HTML]{a9a1e1}{selection}\EFd{'."}
  \EFrdb{(}\EFk{unless} \EFrdc{(}\EFf{read-aloud--valid-str-p} str\EFrdc{)} \EFrdc{(}\EFk{cl-return-from} read-aloud--string\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{process-connection-type} nil\EFrdd{)}\EFrdc{)} \EFcd{; }\EFc{(start-process) requires this}

    \EFrdc{(}\EFk{if} \EFv{read-aloud--c-locked} \EFrdd{(}\EFo{error} \EFs{"Read-aloud is LOCKED"}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-locked} source\EFrdc{)}
    \EFrdc{(}\EFk{condition-case} err
	\EFrdd{(}\EFk{setq} \EFv{read-aloud--c-pr}
	      \EFrda{(}\EFo{apply} \EFhq{'}\EFhs{start-process} \EFs{"read-aloud"} nil
		     \EFrdb{(}\EFf{read-aloud--cmd}\EFrdb{)} \EFrdb{(}\EFf{read-aloud--args}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{error}
       \EFrda{(}\EFf{read-aloud--reset}\EFrda{)}
       \EFrda{(}\EFo{user-error} \EFs{"External TTS engine failed to start: \%s"}
		   \EFrdb{(}\EFo{error-message-string} err\EFrdb{)}\EFrda{)}\EFrdd{)} \EFrdc{)}

    \EFrdc{(}\EFo{set-process-sentinel} \EFv{read-aloud--c-pr} \EFhq{'}\EFhs{read-aloud--sentinel}\EFrdc{)}
    \EFrdc{(}\EFk{setq} str \EFrdd{(}\EFo{concat} \EFrda{(}\EFo{string-trim} str\EFrda{)} \EFs{"\char92{}n"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{read-aloud--log} \EFs{"Sending: `\%s`"} str\EFrdc{)}
    \EFrdc{(}\EFo{process-send-string} \EFv{read-aloud--c-pr} str\EFrdc{)}
    \EFrdc{(}\EFo{process-send-eof} \EFv{read-aloud--c-pr}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--sentinel} \EFrdb{(}process event\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}source \EFv{read-aloud--c-locked}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{setq} event \EFrdd{(}\EFo{string-trim} event\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{equal} event \EFs{"finished"}\EFrdd{)}
	\EFrdd{(}\EFk{progn}
	  \EFrda{(}\EFf{read-aloud--overlay-rm}\EFrda{)}
	  \EFrda{(}\EFk{setq} \EFv{read-aloud--c-locked} nil\EFrda{)}
	  \EFrda{(}\EFk{cond}
	   \EFrdb{(}\EFrdc{(}\EFo{equal} source \EFs{"buffer"}\EFrdc{)} \EFrdc{(}\EFf{read-aloud-buf}\EFrdc{)}\EFrdb{)}
	   \EFrdb{(}\EFrdc{(}\EFo{equal} source \EFs{"word"}\EFrdc{)} t\EFrdb{)}	  \EFcd{; }\EFc{do nothing}
	   \EFrdb{(}\EFrdc{(}\EFo{equal} source \EFs{"selection"}\EFrdc{)} t\EFrdb{)} \EFcd{; }\EFc{do nothing}
	   \EFrdb{(}t \EFrdc{(}\EFo{error} \EFs{"Unknown source: \%s"} source\EFrdc{)}\EFrdb{)}\EFrda{)} \EFrdd{)}

      \EFcd{;; }\EFc{else}
      \EFrdd{(}\EFf{read-aloud--reset}\EFrdd{)}
      \EFrdd{(}\EFo{user-error} \EFs{"\%s ended w/ the event: \%s"} process event\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{read-aloud-stop} \EFrdb{(}\EFrdb{)}
  \EFd{"Ask a TTS engine to stop."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{kill-process} \EFv{read-aloud--c-pr}\EFrdb{)}

  \EFcd{;; }\EFc{if a tts engine has a separate step to switch itself off, use it}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}c \EFrda{(}\EFo{plist-get} \EFrdb{(}\EFo{lax-plist-get} \EFv{read-aloud-engines} \EFv{read-aloud-engine}\EFrdb{)} \EFhq{'}\EFhs{kill}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} c
      \EFrdd{(}\EFo{start-process-shell-command} \EFs{"read-aloud-kill"} \EFv{read-aloud--logbufname} c\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFf{read-aloud--log} \EFs{"INTERRUPTED BY USER"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud-reset}\EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
    \EFrdb{(}\EFk{setq} \EFv{read-aloud--c-buf} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{cl-defun} \EFf{read-aloud-buf}\EFrdb{(}\EFrdb{)}
  \EFd{"Read the current buffer, highlighting words along the
read. Run it again to stop reading."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}

  \EFrdb{(}\EFk{when} \EFv{read-aloud--c-locked}
    \EFrdc{(}\EFf{read-aloud-stop}\EFrdc{)}
    \EFrdc{(}\EFk{cl-return-from} read-aloud-buf\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFv{read-aloud--c-buf} \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-buf} \EFrdd{(}\EFo{current-buffer}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFv{read-aloud--c-bufpos} \EFrdc{(}\EFk{setq} \EFv{read-aloud--c-bufpos} \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{let} \EFrdc{(}tb\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFv{read-aloud--c-buf}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFo{eobp}\EFrda{)}
	\EFrda{(}\EFf{read-aloud--log} \EFs{"END OF BUFFER"}\EFrda{)}
	\EFrda{(}\EFf{read-aloud--reset}\EFrda{)}
	\EFrda{(}\EFk{cl-return-from} read-aloud-buf\EFrda{)}\EFrdd{)}

      \EFrdd{(}\EFk{setq} tb \EFrda{(}\EFf{read-aloud--grab-text} \EFv{read-aloud--c-buf} \EFv{read-aloud--c-bufpos}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{unless} tb
	\EFrda{(}\EFk{progn}
	  \EFrdb{(}\EFf{read-aloud--log} \EFs{"SPACES AT THE END OF BUFFER"}\EFrdb{)}
	  \EFrdb{(}\EFf{read-aloud--reset}\EFrdb{)}
	  \EFrdb{(}\EFk{cl-return-from} read-aloud-buf\EFrdb{)}\EFrda{)}\EFrdd{)}

      \EFcd{;; }\EFc{highlight text}
      \EFrdd{(}\EFf{read-aloud--overlay-make} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{beg}\EFrda{)} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{end}\EFrda{)}\EFrdd{)}

      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{end}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{read-aloud--string} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{text}\EFrda{)} \EFs{"buffer"}\EFrdd{)}

      \EFrdd{(}\EFk{setq} \EFv{read-aloud--c-bufpos} \EFrda{(}\EFo{plist-get} tb \EFhq{'}\EFhs{end}\EFrda{)}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{cl-defun} \EFf{read-aloud--grab-text}\EFrdb{(}buf point\EFrdb{)}
  \EFd{"Return (text \char92{}"omglol\char92{}" beg 10 end 20) plist or nil on
eof. BUF \& POINT are the starting location for the job."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFo{max} t2 p pstart chunks pchunk\EFrdc{)}

    \EFrdc{(}\EFk{with-current-buffer} buf
      \EFrdd{(}\EFk{save-excursion}
	\EFrda{(}\EFo{goto-char} point\EFrda{)}
	\EFrda{(}\EFo{skip-chars-forward} \EFs{"[\char92{}\char92{}-,.:!;[:space:]\char92{}r\char92{}n]"}\EFrda{)}

	\EFrda{(}\EFk{setq} max \EFrdb{(}\EFo{+} \EFrdc{(}\EFo{point}\EFrdc{)} \EFv{read-aloud-max}\EFrdb{)}\EFrda{)}
	\EFrda{(}\EFk{if} \EFrdb{(}\EFo{>} max \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)} \EFrdb{(}\EFk{setq} max \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}\EFrda{)}
	\EFrda{(}\EFk{setq} t2 \EFrdb{(}\EFo{buffer-substring-no-properties} \EFrdc{(}\EFo{point}\EFrdc{)} max\EFrdb{)}\EFrda{)}

	\EFrda{(}\EFk{if} \EFrdb{(}\EFf{string-empty-p} \EFrdc{(}\EFo{string-trim-right} t2\EFrdc{)}\EFrdb{)}
	    \EFcd{;; }\EFc{we have spaces at the end of buffer, there is nothing to grab}
	    \EFrdb{(}\EFk{cl-return-from} read-aloud--grab-text nil\EFrdb{)}\EFrda{)}

	\EFrda{(}\EFk{setq} pstart \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}

	\EFrda{(}\EFk{unless} \EFrdb{(}\EFo{=} max \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}
	  \EFrdb{(}\EFk{progn}
	    \EFcd{;; }\EFc{look for the 1st non-space in `t` from the end \& cut}
	    \EFcd{;; }\EFc{off that part}
	    \EFrdc{(}\EFk{setq} p \EFrdd{(}\EFo{string-match} \EFs{"[[:space:]\char92{}r\char92{}n]"}
				  \EFrda{(}\EFf{read-aloud--u-str-reverse} t2\EFrda{)}\EFrdd{)} \EFrdc{)}
	    \EFrdc{(}\EFk{if} p \EFrdd{(}\EFk{setq} t2 \EFrda{(}\EFo{substring} t2 \EFhn{0} \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{length} t2\EFrdc{)} p \EFhn{1}\EFrdb{)}\EFrda{)}\EFrdd{)} \EFrdc{)}\EFrdb{)}\EFrda{)}

	\EFrda{(}\EFk{setq} chunks
	      \EFrdb{(}\EFo{split-string} t2 \EFs{"[,.:!;]}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{\char92{}n}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{\char92{}r\char92{}n}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}\{2,\char92{}\char92{}\}"} t\EFrdb{)}\EFrda{)}
	\EFrda{(}\EFk{if} chunks
	    \EFrdb{(}\EFk{progn}
	      \EFrdc{(}\EFo{search-forward} \EFrdd{(}\EFo{car} chunks\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFk{setq} pchunk \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFo{search-backward} \EFrdd{(}\EFo{car} chunks\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFk{setq} pstart \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFk{setq} t2 \EFrdd{(}\EFo{buffer-substring-no-properties} pstart pchunk\EFrdd{)}\EFrdc{)} \EFrdb{)}\EFrda{)}

	\EFrda{(}\EFf{read-aloud--log} \EFs{"text grab: `\%s`"} t2\EFrda{)}
	\EFhq{`}\EFrda{(}text ,t2
	       beg ,pstart
	       end ,\EFrdb{(}\EFo{+} pstart \EFrdc{(}\EFo{length} t2\EFrdc{)}\EFrdb{)}\EFrda{)}
	\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{cl-defun} \EFf{read-aloud--current-word}\EFrdb{(}\EFrdb{)}
  \EFd{"Pronounce a word under the pointer. If under there is rubbish,
ask user for an additional input."}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}cw \EFrda{(}\EFf{read-aloud--u-current-word}\EFrda{)}\EFrdd{)}
	 \EFrdd{(}word \EFrda{(}\EFo{nth} \EFhn{2} cw\EFrda{)}\EFrdd{)}\EFrdc{)}

    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFk{and} word \EFrda{(}\EFo{string-match} \EFs{"[[:alnum:]]"} word\EFrda{)}\EFrdd{)}
      \EFcd{;; }\EFc{maybe we should share the hist list w/ `wordnut-completion-hist`?}
      \EFrdd{(}\EFk{setq} word \EFrda{(}\EFo{read-string} \EFs{"read aloud: "} word \EFhq{'}\EFv{read-aloud-word-hist}\EFrda{)}\EFrdd{)} \EFrdc{)}

    \EFrdc{(}\EFf{read-aloud--overlay-make} \EFrdd{(}\EFo{nth} \EFhn{0} cw\EFrdd{)} \EFrdd{(}\EFo{nth} \EFhn{1} cw\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{read-aloud--string} word \EFs{"word"}\EFrdc{)}
    \EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{cl-defun} \EFf{read-aloud-this}\EFrdb{(}\EFrdb{)}
  \EFd{"Pronounce either the selection or a word under the pointer."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}

  \EFrdb{(}\EFk{when} \EFv{read-aloud--c-locked}
    \EFrdc{(}\EFf{read-aloud-stop}\EFrdc{)}
    \EFrdc{(}\EFk{cl-return-from} read-aloud-selection\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{use-region-p}\EFrdc{)}
      \EFrdc{(}\EFf{read-aloud--string}
       \EFrdd{(}\EFo{buffer-substring-no-properties} \EFrda{(}\EFo{region-beginning}\EFrda{)} \EFrda{(}\EFo{region-end}\EFrda{)}\EFrdd{)}
       \EFs{"selection"}\EFrdc{)}
    \EFrdc{(}\EFf{read-aloud--current-word}\EFrdc{)}\EFrdb{)} \EFrda{)}



\EFrda{(}\EFk{defun} \EFf{read-aloud--u-switch-to-buffer}\EFrdb{(}buf\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFrdc{(}\EFo{eq} \EFrdd{(}\EFo{current-buffer}\EFrdd{)} buf\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{cdr} \EFrda{(}\EFo{window-list}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{split-window-vertically}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{other-window} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFo{switch-to-buffer} buf\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;; }\EFc{for emacs < 25}
\EFrda{(}\EFk{defun} \EFf{read-aloud--u-str-reverse} \EFrdb{(}str\EFrdb{)}
  \EFd{"Reverse the STR."}
  \EFrdb{(}\EFo{apply} \EFhq{\#'}\EFhs{string} \EFrdc{(}\EFo{reverse} \EFrdd{(}\EFf{string-to-list} str\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{read-aloud--u-current-word}\EFrdb{(}\EFrdb{)}
  \EFd{"This is a modified (current-word) that doesn't take any args \&
return (beg end word) or nil."}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}oldpoint \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)} \EFrda{(}start \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)} \EFrda{(}end \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}
	   \EFrda{(}syntaxes \EFs{"w\_"}\EFrda{)}
	   \EFrda{(}not-syntaxes \EFrdb{(}\EFo{concat} \EFs{"\char94{}"} syntaxes\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{skip-syntax-backward} syntaxes\EFrdd{)} \EFrdd{(}\EFk{setq} start \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} oldpoint\EFrdd{)}
      \EFrdd{(}\EFo{skip-syntax-forward} syntaxes\EFrdd{)} \EFrdd{(}\EFk{setq} end \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{eq} start oldpoint\EFrdb{)} \EFrdb{(}\EFo{eq} end oldpoint\EFrdb{)}\EFrda{)}
	\EFcd{;; }\EFc{Look for preceding word in same line.}
	\EFrda{(}\EFo{skip-syntax-backward} not-syntaxes \EFrdb{(}\EFo{line-beginning-position}\EFrdb{)}\EFrda{)}
	\EFrda{(}\EFk{if} \EFrdb{(}\EFo{bolp}\EFrdb{)}
	    \EFcd{;; }\EFc{No preceding word in same line.}
	    \EFcd{;; }\EFc{Look for following word in same line.}
	    \EFrdb{(}\EFk{progn}
	      \EFrdc{(}\EFo{skip-syntax-forward} not-syntaxes \EFrdd{(}\EFo{line-end-position}\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFk{setq} start \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}
	      \EFrdc{(}\EFo{skip-syntax-forward} syntaxes\EFrdc{)}
	      \EFrdc{(}\EFk{setq} end \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}\EFrdb{)}
	  \EFrdb{(}\EFk{setq} end \EFrdc{(}\EFo{point}\EFrdc{)}\EFrdb{)}
	  \EFrdb{(}\EFo{skip-syntax-backward} syntaxes\EFrdb{)}
	  \EFrdb{(}\EFk{setq} start \EFrdc{(}\EFo{point}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFcd{;; }\EFc{If we found something nonempty, return it as a list.}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFo{=} start end\EFrda{)}
	\EFrda{(}\EFo{list} start end \EFrdb{(}\EFo{buffer-substring-no-properties} start end\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{read-aloud}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Speed Read}
\label{sec:org5c050cf}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{speed-read}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org6b76319}
\subsubsection{Code}
\label{sec:org50ec4fb}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{read-single.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{use-package!} spray
  \EFb{:commands} spray-mode
  \EFb{:config}
  \EFrdb{(}\EFk{setq} spray-wpm \EFhn{400}
        spray-height \EFhn{300}\EFrdb{)}
  \EFrdb{(}\EFk{defun} \EFf{spray-mode-hide-cursor} \EFrdc{(}\EFrdc{)}
    \EFd{"Hide or unhide the cursor as is appropriate."}
    \EFrdc{(}\EFk{if} spray-mode
        \EFrdd{(}\EFk{setq-local} spray--last-evil-cursor-state \EFv{evil-normal-state-cursor}
                    \EFv{evil-normal-state-cursor} \EFhq{'}\EFrda{(}nil\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq-local} \EFv{evil-normal-state-cursor} spray--last-evil-cursor-state\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFhs{spray-mode-hook} \EFhq{\#'}\EFhs{spray-mode-hide-cursor}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:map} spray-mode-map
        \EFb{:n} \EFs{"<return>"} \EFhq{\#'}\EFhs{spray-start/stop}
        \EFb{:n} \EFs{"SPC"} \EFhq{\#'}\EFhs{spray-start/stop}
        \EFb{:n} \EFs{"f"} \EFhq{\#'}\EFhs{spray-faster}
        \EFb{:n} \EFs{"s"} \EFhq{\#'}\EFhs{spray-slower}
        \EFb{:n} \EFs{"t"} \EFhq{\#'}\EFhs{spray-time}
        \EFb{:n} \EFs{"<right>"} \EFhq{\#'}\EFhs{spray-forward-word}
        \EFb{:n} \EFs{"h"} \EFhq{\#'}\EFhs{spray-forward-word}
        \EFb{:n} \EFs{"<left>"} \EFhq{\#'}\EFhs{spray-backward-word}
        \EFb{:n} \EFs{"l"} \EFhq{\#'}\EFhs{spray-backward-word}
        \EFb{:n} \EFs{"q"} \EFhq{\#'}\EFhs{spray-quit}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{speed-read}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Spaced Repetition}
\label{sec:orgabd8f3e}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{spaced-repetition}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org4a6b7ed}
\subsubsection{Code}
\label{sec:orga7fe1e4}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{pamparam.el -*- lexical-binding: t; -*-}

\EFcd{;;; }\EFc{pamparam.el --- Simple and fast flashcards. -*- lexical-binding: t -*-}

\EFcd{;; }\EFc{Copyright (C) 2016-2020 Oleh Krehel}

\EFcd{;; }\EFc{Author: Oleh Krehel <ohwoeowho@gmail.com>}
\EFcd{;; }\EFc{URL: https://github.com/abo-abo/pamparam}
\EFcd{;; }\EFc{Version: 0.1.0}
\EFcd{;; }\EFc{Package-Requires: ((emacs "26.1") (lispy "0.27.0") (worf "0.1.0") (ivy-posframe "0.5.5"))}
\EFcd{;; }\EFc{Keywords: outlines, hypermedia, flashcards, memory}

\EFcd{;; }\EFc{This file is not part of GNU Emacs}

\EFcd{;; }\EFc{This file is free software; you can redistribute it and/or modify}
\EFcd{;; }\EFc{it under the terms of the GNU General Public License as published by}
\EFcd{;; }\EFc{the Free Software Foundation; either version 3, or (at your option)}
\EFcd{;; }\EFc{any later version.}

\EFcd{;; }\EFc{This program is distributed in the hope that it will be useful,}
\EFcd{;; }\EFc{but WITHOUT ANY WARRANTY; without even the implied warranty of}
\EFcd{;; }\EFc{MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
\EFcd{;; }\EFc{GNU General Public License for more details.}

\EFcd{;; }\EFc{For a full copy of the GNU General Public License}
\EFcd{;; }\EFc{see <http://www.gnu.org/licenses/>.}

\EFcd{;;; }\EFc{Commentary:}
\EFcd{;;}
\EFcd{;; }\EFc{An example master file is given in doc/sets/capitals/capitals.org.}
\EFcd{;; }\EFc{Use `}\textcolor[HTML]{a9a1e1}{hydra-pamparam/body}\EFc{' as the entry point.}
\EFcd{;; }\EFc{See README.org for more info.}

\EFcd{;;; }\EFc{Code:}

\EFcd{;;}\EFc{* Requires}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{worf}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{ivy}\EFrda{)}

\EFrda{(}\EFk{defgroup} \EFt{pamparam} nil
  \EFd{"Simple and fast flashcards."}
  \EFb{:group} \EFhq{'}\EFhs{flashcards}\EFrda{)}

\EFcd{;;}\EFc{* Pure}
\EFrda{(}\EFk{defun} \EFf{pamparam-sm2} \EFrdb{(}card-stats q\EFrdb{)}
  \EFd{"Determine the next iteration of CARD-STATS based on Q.

CARD-STATS is (EASE-FACTOR . INTERVALS), the result has the
same shape, with updated values.

EASE-FACTOR - the previous ease factor of the card.  All cards are
initialized with EASE-FACTOR of 2.5.  It will decrease for
difficult cards, but not below 1.3.

INTERVALS - list of integer day intervals between repetitions.

Q - the quality of the answer:
  5 - perfect response
  4 - correct response after a hesitation
  3 - correct response recalled with serious difficulty
  2 - incorrect response; where the correct one seemed easy to recall
  1 - incorrect response; the correct one remembered
  0 - complete blackout"}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}EF \EFrda{(}\EFo{car} card-stats\EFrda{)}\EFrdd{)}
        \EFrdd{(}intervals \EFrda{(}\EFo{cdr} card-stats\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} EF \EFrdd{(}\EFo{max} \EFhn{1.3} \EFrda{(}\EFo{+} EF \EFhn{0.1} \EFrdb{(}\EFo{*} \EFrdc{(}\EFo{-} q \EFhn{5}\EFrdc{)} \EFrdc{(}\EFo{+} \EFhn{0.08} \EFrdd{(}\EFo{*} \EFrda{(}\EFo{-} \EFhn{5} q\EFrda{)} \EFhn{0.02}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{<} q \EFhn{3}\EFrdd{)}
        \EFrdd{(}\EFo{cons} EF \EFrda{(}\EFo{cons} \EFhn{1} intervals\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{cons} EF
            \EFrda{(}\EFo{cons}
             \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}\EFo{null} intervals\EFrdd{)}
                    \EFhn{1}\EFrdc{)}
                   \EFrdc{(}\EFrdd{(}\EFo{=} \EFrda{(}\EFo{car} intervals\EFrda{)} \EFhn{1}\EFrdd{)}
                    \EFhn{6}\EFrdc{)}
                   \EFrdc{(}t
                    \EFrdd{(}\EFo{round} \EFrda{(}\EFo{*} EF \EFrdb{(}\EFo{car} intervals\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
             intervals\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;}\EFc{* Card files}
\EFrda{(}\EFk{defun} \EFf{pamparam-card-insert-score} \EFrdb{(}score actual-answer\EFrdb{)}
  \EFd{"Insert SCORE into the current card file."}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{outline-show-all}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*\char92{}\char92{}* scores"} nil t\EFrdc{)}
      \EFrdc{(}\EFo{outline-end-of-subtree}\EFrdc{)}
    \EFrdc{(}\EFo{forward-line} \EFhn{2}\EFrdc{)}
    \EFrdc{(}\EFo{insert} \EFs{"** scores\char92{}n"}\EFrdc{)}
    \EFrdc{(}\EFo{backward-char}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} actual-answer
    \EFrdc{(}\EFo{kill-new} actual-answer\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{insert} \EFrdc{(}\EFo{format-time-string} \EFs{"\char92{}n| <\%Y-\%m-\%d> "}\EFrdc{)}
          \EFrdc{(}\EFo{format} \EFs{"| \%d |"} score\EFrdc{)}
          \EFrdc{(}\EFo{format} \EFs{" \%s |"}
                  \EFrdd{(}\EFk{or} actual-answer \EFs{""}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{org-table-align}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-wdiff} \EFrdb{(}actual-answer\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}expected-answer
         \EFrda{(}\EFk{save-excursion}
           \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}
           \EFrdb{(}\EFo{skip-chars-backward} \EFs{"\char92{}n"}\EFrdb{)}
           \EFrdb{(}\EFo{buffer-substring-no-properties}
            \EFrdc{(}\EFo{line-beginning-position}\EFrdc{)}
            \EFrdc{(}\EFo{line-end-position}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{and} actual-answer
               \EFrda{(}\EFo{not} \EFrdb{(}\EFf{pamparam-equal} actual-answer expected-answer\EFrdb{)}\EFrda{)}
               \EFrda{(}\EFo{executable-find} \EFs{"wdiff"}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{message}
       \EFrda{(}\EFo{string-trim}
        \EFrdb{(}\EFo{shell-command-to-string}
         \EFrdc{(}\EFo{format}
          \EFs{"wdiff -i <(echo \char92{}"\%s\char92{}") <(echo \char92{}"\%s\char92{}")"}
          actual-answer
          \EFrdd{(}\EFo{string-trim-right} expected-answer \EFs{"[.?!]"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-read-stats} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*\char92{}\char92{}* stats\char92{}n"} nil t\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}beg \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}
            \EFrda{(}exp1 \EFrdb{(}\EFo{read} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}
            \EFrda{(}exp2 \EFrdb{(}\EFo{read} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}
            ease-factor intervals\EFrdd{)}
        \EFrdd{(}\EFk{if} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{eq} \EFrdc{(}\EFo{nth} \EFhn{0} exp1\EFrdc{)} \EFhq{'}\EFhs{setq}\EFrdb{)}
                 \EFrdb{(}\EFo{eq} \EFrdc{(}\EFo{nth} \EFhn{1} exp1\EFrdc{)} \EFhq{'}\EFhs{ease-factor}\EFrdb{)}
                 \EFrdb{(}\EFo{numberp} \EFrdc{(}\EFo{nth} \EFhn{2} exp1\EFrdc{)}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFk{setq} ease-factor \EFrdb{(}\EFo{nth} \EFhn{2} exp1\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{error} \EFs{"Bad sexp \%S"} exp1\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{if} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{eq} \EFrdc{(}\EFo{nth} \EFhn{0} exp2\EFrdc{)} \EFhq{'}\EFhs{setq}\EFrdb{)}
                 \EFrdb{(}\EFo{eq} \EFrdc{(}\EFo{nth} \EFhn{1} exp2\EFrdc{)} \EFhq{'}\EFhs{intervals}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFk{setq} intervals \EFrdb{(}\EFo{cadr} \EFrdc{(}\EFo{nth} \EFhn{2} exp2\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{error} \EFs{"Bad sexp \%S"} exp2\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{delete-region} beg \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{cons} ease-factor intervals\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*\char92{}\char92{}* scores\char92{}n"} nil t\EFrdd{)}
        \EFrdd{(}\EFk{progn}
          \EFrda{(}\EFo{outline-end-of-subtree}\EFrda{)}
          \EFrda{(}\EFo{insert} \EFs{"\char92{}n** stats\char92{}n"}\EFrda{)}
          \EFrda{(}\EFo{list} \EFhn{2.5}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{error} \EFs{"** scores not found"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-insert-stats} \EFrdb{(}stats\EFrdb{)}
  \EFrdb{(}\EFo{insert} \EFrdc{(}\EFo{format} \EFs{"(setq ease-factor \%f)\char92{}n"} \EFrdd{(}\EFo{car} stats\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{insert} \EFrdc{(}\EFo{format} \EFs{"(setq intervals '\%S)"} \EFrdd{(}\EFo{cdr} stats\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-delete-region} \EFrdb{(}beg end\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}str \EFrda{(}\EFo{buffer-substring-no-properties} beg end\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{delete-region} beg end\EFrdc{)}
    str\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-save-buffer} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{inhibit-message} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{write-file} \EFrdd{(}\EFv{buffer-file-name}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-card-abbreviate}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-abbreviate} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}fname \EFrda{(}\EFo{file-name-nondirectory} \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{>} \EFrda{(}\EFo{length} fname\EFrda{)} \EFhn{60}\EFrdd{)}
      \EFrdd{(}\EFo{rename-buffer}
       \EFrda{(}\EFo{concat} \EFs{"card-"} \EFrdb{(}\EFo{substring} fname \EFhn{0} \EFhn{6}\EFrdb{)} \EFs{".org"}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-score} \EFrdb{(}score \EFt{\&optional} actual-answer\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}card-file \EFrda{(}\EFo{file-name-nondirectory} \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}todo-file \EFrda{(}\EFf{pamparam-todo-file}\EFrda{)}\EFrdd{)}
         \EFrdd{(}state \EFrda{(}\EFk{with-current-buffer} todo-file
                  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
                  \EFrdb{(}\EFo{search-forward} card-file\EFrdb{)}
                  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{+} \EFhn{2} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)}\EFrdc{)}\EFrdb{)}
                  \EFrdb{(}\EFo{buffer-substring-no-properties}
                   \EFrdc{(}\EFo{point}\EFrdc{)}
                   \EFrdc{(}\EFk{progn}
                     \EFrdd{(}\EFo{forward-word}\EFrdd{)}
                     \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFv{save-silently} t\EFrdd{)}
         \EFrdd{(}\EFv{inhibit-read-only} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{string=} state \EFs{"}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\EFs{"}\EFrda{)}
           \EFrda{(}\EFk{with-current-buffer} todo-file
             \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}\EFo{search-forward} card-file\EFrdb{)}
             \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{=} score \EFhn{5}\EFrdd{)}
                     \EFrdd{(}\EFo{=} score \EFhn{4}\EFrdd{)}
                     \EFrdd{(}\EFo{=} score \EFhn{3}\EFrdd{)}\EFrdc{)}
                 \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{org-log-done} nil\EFrda{)}
                       \EFrda{(}\EFv{inhibit-message} t\EFrda{)}\EFrdd{)}
                   \EFrdd{(}\EFo{org-todo} \EFhq{'}\EFhs{done}\EFrdd{)}\EFrdc{)}
               \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}item \EFrdb{(}\EFf{pamparam-delete-region}
                            \EFrdc{(}\EFo{line-beginning-position}\EFrdc{)}
                            \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{line-end-position}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
                 \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
                 \EFrdd{(}\EFo{insert} item\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}\EFf{pamparam-save-buffer}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFf{pamparam-save-buffer}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string=} state \EFs{"DONE"}\EFrda{)}
           \EFrda{(}\EFk{if} \EFrdb{(}\EFo{y-or-n-p} \EFs{"Card already done today.  Re-rate? "}\EFrdb{)}
               \EFrdb{(}\EFf{pamparam--card-score} score t actual-answer\EFrdb{)}
             \EFrdb{(}\EFo{user-error} \EFs{"This card is already done today"}\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string=} state \EFs{"}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{"}\EFrda{)}
           \EFrda{(}\EFf{pamparam--card-score} score nil actual-answer\EFrda{)}\EFrdd{)}
          \EFrdd{(}t
           \EFrda{(}\EFo{user-error} \EFs{"Unexpected state: \%s"} state\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} todo-file
      \EFrdd{(}\EFf{pamparam--recalculate-progress}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{outline-show-all}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-manual-score} \EFrdb{(}\EFrdb{)}
  \EFd{"Score the card 0-5 manually."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{undo}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}score \EFrda{(}\EFo{completing-read} \EFs{"score: "} \EFhq{'}\EFrdb{(}\EFs{"0"} \EFs{"1"} \EFs{"2"} \EFs{"3"} \EFs{"4"} \EFs{"5"}\EFrdb{)} nil t\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-card-score} \EFrdd{(}\EFo{string-to-number} score\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--todo-from-file} \EFrdb{(}card-file\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-match} \EFs{"\char92{}\char92{}`}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{-]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{-"} card-file\EFrdc{)}
      \EFrdc{(}\EFo{format}
       \EFs{"* }\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{ [[file:cards/\%s/\%s][\%s]]\char92{}n"}
       \EFrdd{(}\EFo{substring} card-file \EFhn{0} \EFhn{2}\EFrdd{)}
       card-file
       \EFrdd{(}\EFo{match-string} \EFhn{1} card-file\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{error} \EFs{"Unexpected file name"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--card-score} \EFrdb{(}score \EFt{\&optional} already-done actual-answer\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}card-file \EFrda{(}\EFo{file-name-nondirectory} \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}
        stats
        new-interval\EFrdc{)}
    \EFrdc{(}\EFk{save-excursion}
      \EFrdd{(}\EFf{pamparam-card-insert-score} score actual-answer\EFrdd{)}
      \EFrdd{(}\EFk{setq} stats \EFrda{(}\EFf{pamparam-card-read-stats}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} stats \EFrda{(}\EFf{pamparam-sm2} stats score\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-card-insert-stats} stats\EFrdd{)}
      \EFrdd{(}\EFk{setq} new-interval \EFrda{(}\EFo{nth} \EFhn{1} stats\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{unless} already-done
        \EFrda{(}\EFk{let*} \EFrdb{(}\EFrdc{(}todo-entry \EFrdd{(}\EFf{pamparam--todo-from-file} card-file\EFrdd{)}\EFrdc{)}
               str\EFrdb{)}
          \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFf{pamparam-todo-file}\EFrdc{)}
            \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{search-forward} card-file\EFrdd{)}
              \EFrdd{(}\EFk{if} \EFrda{(}\EFo{memq} score \EFhq{'}\EFrdb{(}\EFhn{4} \EFhn{5}\EFrdb{)}\EFrda{)}
                  \EFrda{(}\EFk{progn}
                    \EFrdb{(}\EFo{beginning-of-line}\EFrdb{)}
                    \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{looking-at} \EFs{"\char92{}\char92{}* }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"}\EFrdc{)}
                        \EFrdc{(}\EFo{replace-match} \EFs{"DONE"} nil nil nil \EFhn{1}\EFrdc{)}
                      \EFrdc{(}\EFo{error} \EFs{"Unexpected"}\EFrdc{)}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFk{setq} str \EFrdb{(}\EFo{buffer-substring-no-properties}
                           \EFrdc{(}\EFo{+} \EFhn{7} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)}\EFrdc{)}
                           \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{line-end-position}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFo{delete-region}
                 \EFrdb{(}\EFo{line-beginning-position}\EFrdb{)}
                 \EFrdb{(}\EFo{1+} \EFrdc{(}\EFo{line-end-position}\EFrdc{)}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFo{insert} \EFs{"* }\textcolor[HTML]{51afef}{\textbf{REVIEW}}\EFs{ "} str\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFf{pamparam-todo-file} new-interval\EFrdc{)}
            \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{search-forward} todo-entry nil t\EFrdd{)}
              \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFo{insert} todo-entry\EFrdd{)}
              \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{kill-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-wdiff} actual-answer\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar-local} \EFv{pamparam-card-answer-validate-p} nil\EFrda{)}

\EFrda{(}\EFk{defcustom} \EFv{pamparam-card-answer-function} \EFhq{\#'}\EFhs{pamparam-card-answer-at-point}
  \EFd{"Select how to answer the card."}
  \EFb{:type} \EFhq{'}\EFrdb{(}choice
          \EFrdc{(}const \EFb{:tag} \EFs{"Answer at point"} pamparam-card-answer-at-point\EFrdc{)}
          \EFrdc{(}const \EFb{:tag} \EFs{"Answer in a child frame"} pamparam-card-answer-posframe\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-answer-at-point} \EFrdb{(}\EFrdb{)}
  \EFd{"Answer the current card.
Enter the answer at point, then press \char92{}".\char92{}" to validate."}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}* m\$"} nil t\EFrdc{)}
    \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{point-min}\EFrdd{)} \EFrdd{(}\EFo{match-beginning} \EFhn{0}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFo{insert} \EFs{"* \char92{}n"}\EFrdb{)}
  \EFrdb{(}\EFo{goto-char} \EFhn{3}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{pamparam-card-answer-validate-p} t\EFrdb{)}
  \EFrdb{(}\EFo{outline-hide-body}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-posframe-keymap}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFo{map} \EFrda{(}\EFo{make-sparse-keymap}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"C-v"}\EFrdd{)} \EFhq{\#'}\EFhs{pamparam-card-reveal}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"."}\EFrdd{)} \EFhq{\#'}\EFhs{ivy-done}\EFrdc{)}
    map\EFrdb{)}
  \EFd{"The keymap for `}\textcolor[HTML]{a9a1e1}{pamparam-card-answer-posframe}\EFd{'"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-reveal} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFo{ivy-state-buffer} \EFv{ivy-last}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-shifttab}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--ivy-read-posframe} \EFrdb{(}prompt\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}ivy-posframe-state \EFrda{(}\EFk{bound-and-true-p} ivy-posframe-mode\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} ivy-posframe-state
      \EFrdd{(}ivy-posframe-mode \EFhn{1}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unwind-protect}
         \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}\EFv{ivy-add-newline-after-prompt} t\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{ivy-read} prompt nil
                     \EFb{:keymap} \EFv{pamparam-posframe-keymap}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{unless} ivy-posframe-state
        \EFrda{(}ivy-posframe-mode \EFhn{-1}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-answer-posframe} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{outline-hide-body}\EFrdb{)}
  \EFrdb{(}\EFo{read-only-mode} \EFhn{1}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}card-front
          \EFrda{(}\EFk{save-excursion}
            \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}\EFo{zo-down} \EFhn{1}\EFrdb{)}
            \EFrdb{(}\EFo{substring-no-properties} \EFrdc{(}\EFo{org-get-heading}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}answer \EFrda{(}\EFf{pamparam--ivy-read-posframe}
                  \EFrdb{(}\EFo{concat} card-front \EFs{": "}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{string=} answer \EFs{""}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-card-validate} answer \EFrda{(}\EFf{pamparam--card-true-answer}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{remove-overlays} \EFrdd{(}\EFo{point-min}\EFrdd{)} \EFrdd{(}\EFo{point-max}\EFrdd{)} \EFhq{'}\EFhs{invisible} \EFhq{'}\EFhs{outline}\EFrdc{)}
    \EFrdc{(}\EFo{read-only-mode} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-answer} \EFrdb{(}\EFrdb{)}
  \EFd{"Answer the current card."}
  \EFrdb{(}\EFo{funcall} \EFv{pamparam-card-answer-function}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-is-redo} nil\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--card-true-answer} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{save-excursion}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-max}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{re-search-backward} \EFs{"\char94{}\char92{}\char92{}*"}\EFrdc{)}
    \EFrdc{(}\EFo{beginning-of-line} \EFhn{2}\EFrdc{)}
    \EFrdc{(}\EFo{buffer-substring-no-properties}
     \EFrdd{(}\EFo{point}\EFrdd{)}
     \EFrdd{(}\EFo{1-} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-validate-maybe} \EFrdb{(}\EFt{\&optional} arg\EFrdb{)}
  \EFd{"Validate the given answer and score the current card.

The given answer is the text between the card's first heading and
point."}
  \EFrdb{(}\EFk{interactive} \EFs{"p"}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFv{pamparam-card-answer-validate-p}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}tans \EFrdb{(}\EFf{pamparam--card-true-answer}\EFrdb{)}\EFrda{)}
            \EFrda{(}actual-answer \EFrdb{(}\EFo{buffer-substring-no-properties}
                            \EFrdc{(}\EFo{+} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)} \EFhn{2}\EFrdc{)}
                            \EFrdc{(}\EFo{line-end-position}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{delete-region} \EFrda{(}\EFo{point-min}\EFrda{)}
                       \EFrda{(}\EFo{1+} \EFrdb{(}\EFo{line-end-position}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{setq} \EFv{pamparam-card-answer-validate-p} nil\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-card-validate} actual-answer tans\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{self-insert-command} arg\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-validate} \EFrdb{(}actual-answer correct-answer\EFrdb{)}
  \EFd{"Give a card score, comparing ACTUAL-ANSWER to CORRECT-ANSWER."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFf{pamparam-equal} actual-answer correct-answer\EFrdc{)}
      \EFrdc{(}\EFk{if} \EFrdd{(}\EFk{save-excursion}
            \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFo{re-search-backward} \EFs{"\char94{}\char92{}\char92{}* "}\EFrda{)}
            \EFrda{(}\EFo{overlays-in} \EFrdb{(}\EFo{point}\EFrdb{)} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFk{if} \EFv{pamparam-is-redo}
              \EFrda{(}\EFf{pamparam-card-score} \EFhn{4}\EFrda{)}
            \EFrda{(}\EFf{pamparam-card-score} \EFhn{5}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-card-score} \EFhn{3}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-card-score} \EFhn{0} actual-answer\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;}\EFc{* Equivalence testing}
\EFrda{(}\EFk{defvar} \EFv{pamparam-equiv-hash} \EFrdb{(}\EFo{make-hash-table} \EFb{:test} \EFhq{'}\EFhs{equal}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-equiv-classes} \EFhq{'}\EFrdb{(}\EFrdc{(}\EFs{"we"} \EFs{"wij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"je"} \EFs{"jij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"ze"} \EFs{"zij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"u"} \EFs{"jij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"dichtbij"} \EFs{"vlakbij"}\EFrdc{)}
                            \EFrdc{(}\EFs{"test"} \EFs{"toets"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-make-equivalent} \EFrdb{(}a b\EFrdb{)}
  \EFrdb{(}\EFo{puthash} a b \EFv{pamparam-equiv-hash}\EFrdb{)}
  \EFrdb{(}\EFo{puthash} b b \EFv{pamparam-equiv-hash}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{dolist} \EFrdb{(}c \EFv{pamparam-equiv-classes}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-make-equivalent} \EFrdc{(}\EFo{car} c\EFrdc{)} \EFrdc{(}\EFo{cadr} c\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-equal} \EFrdb{(}sa sb\EFrdb{)}
  \EFd{"Check if the answer SA matches the question SB.
When SB has multiple lines, SA may match one of them."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFf{string-match-p} \EFs{"\char92{}n"} sb\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}sbl \EFrdb{(}\EFo{split-string} sb \EFs{"\char92{}n"} t\EFrdb{)}\EFrda{)}
            res\EFrdd{)}
        \EFrdd{(}\EFk{while} \EFrda{(}\EFk{and} \EFrdb{(}\EFo{null} res\EFrdb{)} \EFrdb{(}\EFk{setq} sb \EFrdc{(}\EFk{pop} sbl\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFk{setq} res \EFrdb{(}\EFf{pamparam-equal-single} sa sb\EFrdb{)}\EFrda{)}\EFrdd{)}
        res\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-equal-single} sa sb\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-equal-single} \EFrdb{(}sa sb\EFrdb{)}
  \EFd{"Check if SA matches SB."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}lista \EFrda{(}\EFf{pamparam-sloppy} sa\EFrda{)}\EFrdd{)}
        \EFrdd{(}listb \EFrda{(}\EFf{pamparam-sloppy} sb\EFrda{)}\EFrdd{)}
        \EFrdd{(}res t\EFrdd{)}
        a b
        ah\EFrdc{)}
    \EFrdc{(}\EFk{while} \EFrdd{(}\EFk{and} res lista\EFrdd{)}
      \EFrdd{(}\EFk{setq} a \EFrda{(}\EFk{pop} lista\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} b \EFrda{(}\EFk{pop} listb\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFk{or} \EFrdb{(}\EFo{string=} a b\EFrdb{)}
                  \EFrdb{(}\EFk{and} \EFrdc{(}\EFk{setq} ah \EFrdd{(}\EFo{gethash} a \EFv{pamparam-equiv-hash}\EFrdd{)}\EFrdc{)}
                       \EFrdc{(}\EFo{equal} ah
                              \EFrdd{(}\EFo{gethash} b \EFv{pamparam-equiv-hash}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{setq} res nil\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{and} res \EFrdd{(}\EFo{null} listb\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-sloppy} \EFrdb{(}str\EFrdb{)}
  \EFrdb{(}\EFo{mapcar} \EFhq{\#'}\EFhs{downcase}
          \EFrdc{(}\EFo{split-string} str \EFs{"[.,?!: ]"} t\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-load-file-name} \EFrdb{(}\EFk{or} \EFv{load-file-name}
                                    \EFrdc{(}\EFv{buffer-file-name}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-path} \EFrdb{(}\EFo{expand-file-name}
                       \EFs{"doc/sets/capitals/capitals.pam"}
                       \EFrdc{(}\EFo{file-name-directory} \EFv{pamparam-load-file-name}\EFrdc{)}\EFrdb{)}
  \EFd{"Point to a default repository. In case you call `}\textcolor[HTML]{a9a1e1}{pamparam-drill}\EFd{'
while not in any repo, this repo will be selected."}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-alist}
  \EFrdb{(}\EFo{list} \EFrdc{(}\EFo{cons} \EFrdd{(}\EFo{expand-file-name} \EFs{"capitals.org"}
                                \EFrda{(}\EFo{file-name-directory} \EFv{pamparam-path}\EFrda{)}\EFrdd{)}
              \EFv{pamparam-path}\EFrdc{)}\EFrdb{)}
  \EFd{"Map a master file to the corresponding repository.
Otherwise, the repository will be in the same directory as the master file."}\EFrda{)}

\EFcd{;;}\EFc{* Schedule files}
\EFrda{(}\EFk{defun} \EFf{pamparam-repo-directory} \EFrdb{(}file\EFrdb{)}
  \EFd{"Return the Git repository that corresponds to FILE."}
  \EFrdb{(}\EFk{or} \EFrdc{(}\EFo{cdr} \EFrdd{(}\EFo{assoc} file \EFv{pamparam-alist}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFk{if} file
          \EFrdd{(}\EFo{expand-file-name}
           \EFrda{(}\EFo{concat}
            \EFrdb{(}\EFo{file-name-sans-extension}
             \EFrdc{(}\EFo{file-name-nondirectory}
              file\EFrdc{)}\EFrdb{)}
            \EFs{".pam/"}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{locate-dominating-file} \EFv{default-directory} \EFs{".git"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-repo-init} \EFrdb{(}repo-dir\EFrdb{)}
  \EFd{"Initialize REPO-DIR Git repository."}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{file-exists-p} repo-dir\EFrdc{)}
      \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{file-directory-p} repo-dir\EFrdd{)}
        \EFrdd{(}\EFo{error} \EFs{"\%s must be a directory"} repo-dir\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{make-directory} repo-dir\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{default-directory} repo-dir\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{shell-command} \EFs{"git init"}\EFrdd{)}
      \EFrdd{(}\EFo{make-directory} \EFs{"cards/"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-new-cards-per-day} \EFhn{75}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-delete} \EFrdb{(}file\EFrdb{)}
  \EFd{"Delete the card in FILE.
When called interactively, delete the card in the current buffer."}
  \EFrdb{(}\EFk{interactive} \EFrdc{(}\EFo{list} \EFrdd{(}\EFv{buffer-file-name}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{file-exists-p} file\EFrdd{)}
             \EFrdd{(}\EFo{y-or-n-p}
              \EFrda{(}\EFo{format} \EFs{"Really delete \%s? "}
                      \EFrdb{(}\EFo{file-name-nondirectory} file\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{delete-file} file\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{string=} \EFrda{(}\EFv{buffer-file-name}\EFrda{)} file\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam--update-card}
     \EFrdd{(}\EFo{file-name-nondirectory} file\EFrdd{)}
     nil\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--update-card} \EFrdb{(}prev-file new-entry\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}prev-scheduled \EFrda{(}\EFf{pamparam-cmd-to-list} \EFrdb{(}\EFo{format} \EFs{"git grep \%s"} \EFrdc{(}\EFo{shell-quote-argument} prev-file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFv{save-silently} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}prev prev-scheduled\EFrdd{)}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{:]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{:.*\char92{}\char92{}[\char92{}\char92{}[file:cards/}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}]\char92{}\char92{}[}\textcolor[HTML]{a9a1e1}{.*\char92{}\char92{}}\EFs{]\char92{}\char92{}'"} prev\EFrda{)}
        \EFrda{(}\EFo{user-error} \EFs{"Bad scheduled item: \%s"} prev\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}schedule-file
             \EFrdc{(}\EFo{expand-file-name}
              \EFrdd{(}\EFo{match-string} \EFhn{1} prev\EFrdd{)}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}entry \EFrdc{(}\EFo{match-string} \EFhn{2} prev\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{with-temp-buffer}
          \EFrdb{(}\EFo{insert-file-contents} schedule-file\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{re-search-forward} entry nil t\EFrdc{)}
            \EFrdc{(}\EFk{if} new-entry
                \EFrdd{(}\EFo{replace-match} new-entry\EFrdd{)}
              \EFrdd{(}\EFo{delete-region}
               \EFrda{(}\EFo{line-beginning-position}\EFrda{)}
               \EFrda{(}\EFo{1+} \EFrdb{(}\EFo{line-end-position}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{write-file} schedule-file\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-hash-card-name->file} nil\EFrda{)}
\EFrda{(}\EFk{defvar} \EFv{pamparam-hash-card-body->file} nil\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-cmd-to-list} \EFrdb{(}cmd \EFt{\&optional} directory\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{default-directory} \EFrda{(}\EFk{or} directory \EFv{default-directory}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{split-string}
     \EFrdd{(}\EFo{shell-command-to-string} cmd\EFrdd{)}
     \EFs{"\char92{}n"} t\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-cards} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-cmd-to-list}
   \EFs{"git ls-files cards/"}
   repo-dir\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-visited-cards} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-cmd-to-list}
   \EFs{"git grep --files-with-matches '\char94{}\char92{}\char92{}*\char92{}\char92{}* scores'"}
   repo-dir\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-unvisited-cards} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-cmd-to-list}
   \EFs{"git grep --files-without-match '\char94{}\char92{}\char92{}*\char92{}\char92{}* scores' | grep cards/"}
   repo-dir\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-pile} \EFrdb{(}repo-dir\EFrdb{)}
  \EFd{"Pile up all unvisited cards into a single file."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}unvisited-cards \EFrda{(}\EFf{pamparam-unvisited-cards} repo-dir\EFrda{)}\EFrdd{)}
        \EFrdd{(}schedule-files \EFrda{(}\EFf{pamparam-cmd-to-list} \EFs{"git ls-files --full-name pamparam-*-[0-9][0-9].org"}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFv{save-silently} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}sf schedule-files\EFrdd{)}
      \EFrdd{(}\EFk{with-current-buffer} \EFrda{(}\EFo{find-file} \EFrdb{(}\EFo{expand-file-name} sf repo-dir\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{dolist} \EFrdb{(}card unvisited-cards\EFrdb{)}
          \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{while} \EFrdc{(}\EFo{search-forward} card nil t\EFrdc{)}
            \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)} \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{line-end-position}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFf{pamparam-save-buffer}\EFrda{)}
        \EFrda{(}\EFo{kill-buffer}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFo{find-file} \EFrda{(}\EFo{expand-file-name} \EFs{"pampile.org"} repo-dir\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{delete-region} \EFrda{(}\EFo{point-min}\EFrda{)} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{dolist} \EFrda{(}card unvisited-cards\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFf{pamparam--todo-from-file} \EFrdc{(}\EFo{file-name-nondirectory} card\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-pull} \EFrdb{(}arg \EFt{\&optional} buffer\EFrdb{)}
  \EFd{"Pull ARG cards into BUFFER.
When called interactively, use today's schedule file."}
  \EFrdb{(}\EFk{interactive}
   \EFrdc{(}\EFo{list} \EFrdd{(}\EFo{read-number} \EFs{"how many cards: "}\EFrdd{)}
         \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{save-silently} t\EFrdd{)}
        cards\EFrdc{)}
    \EFrdc{(}\EFk{setq} arg \EFrdd{(}\EFo{min} \EFhn{100} arg\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{switch-to-buffer} buffer\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFo{find-file-noselect}
                          \EFrda{(}\EFo{expand-file-name} \EFs{"pampile.org"}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{end-of-line} arg\EFrdd{)}
      \EFrdd{(}\EFk{setq} cards \EFrda{(}\EFf{pamparam-delete-region} \EFrdb{(}\EFo{point-min}\EFrdb{)}
                                     \EFrdb{(}\EFo{min} \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}
                                          \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-goto-schedule-part}\EFrdc{)}
    \EFrdc{(}\EFo{insert} cards\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-save-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-goto-schedule-part} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*"} nil t\EFrdc{)}
      \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{match-beginning} \EFhn{0}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-max}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--recompute-git-cards} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{pamparam-hash-card-name->file} \EFrdc{(}\EFo{make-hash-table} \EFb{:test} \EFhq{'}\EFhs{equal}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{pamparam-hash-card-body->file} \EFrdc{(}\EFo{make-hash-table} \EFb{:test} \EFhq{'}\EFhs{equal}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}git-files \EFrda{(}\EFf{pamparam-cards} repo-dir\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}gf git-files\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`cards/[0-9a-f]\char92{}\char92{}\{2\char92{}\char92{}\}/}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{-]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{-}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{.]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}.org\char92{}\char92{}'"} gf\EFrda{)}
          \EFrda{(}\EFk{progn}
            \EFrdb{(}\EFo{puthash} \EFrdc{(}\EFo{match-string} \EFhn{1} gf\EFrdc{)} gf \EFv{pamparam-hash-card-name->file}\EFrdb{)}
            \EFrdb{(}\EFo{puthash} \EFrdc{(}\EFo{match-string} \EFhn{2} gf\EFrdc{)} gf \EFv{pamparam-hash-card-body->file}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{error} \EFs{"Unexpected file name \%s"} gf\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--replace-card} \EFrdb{(}\_card-front \_card-body repo-dir card-file prev-file\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}full-name \EFrda{(}\EFo{expand-file-name} prev-file repo-dir\EFrda{)}\EFrdd{)}
         \EFrdd{(}old-metadata
          \EFrda{(}\EFk{with-temp-buffer}
            \EFrdb{(}\EFo{insert-file-contents} full-name\EFrdb{)}
            \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
            \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{looking-at} \EFs{"\char92{}\char92{}* m\$"}\EFrdc{)}
              \EFrdc{(}\EFo{outline-end-of-subtree}\EFrdc{)}
              \EFrdc{(}\EFo{buffer-substring-no-properties}
               \EFrdd{(}\EFo{point-min}\EFrdd{)}
               \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-kill-buffer-of-file} full-name\EFrdc{)}
    \EFrdc{(}\EFo{delete-file} full-name\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{default-directory} repo-dir\EFrda{)}
          \EFrda{(}fnn \EFrdb{(}\EFo{file-name-nondirectory} card-file\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam--update-card} prev-file \EFrda{(}\EFo{concat} \EFrdb{(}\EFo{substring} fnn \EFhn{0} \EFhn{2}\EFrdb{)} \EFs{"/"} fnn\EFrda{)}\EFrdd{)}\EFrdc{)}
    old-metadata\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{eval-and-compile}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{eq} \EFv{system-type} \EFhq{'}\EFhs{windows-nt}\EFrdc{)}
      \EFrdc{(}\EFk{defun} \EFf{pamparam-spit} \EFrdd{(}str file\EFrdd{)}
        \EFrdd{(}\EFk{with-current-buffer} \EFrda{(}\EFo{find-file-noselect} file\EFrda{)}
          \EFrda{(}\EFo{erase-buffer}\EFrda{)}
          \EFrda{(}\EFo{insert} str\EFrda{)}
          \EFrda{(}\EFo{save-buffer}\EFrda{)}
          \EFrda{(}\EFo{kill-buffer} \EFrdb{(}\EFo{current-buffer}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{defun} \EFf{pamparam-spit} \EFrdd{(}str file\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}cmd \EFrdc{(}\EFo{format} \EFs{"echo '}\textcolor[HTML]{a9a1e1}{\%s}\EFs{' > \%s"}
                         \EFrdd{(}\EFo{replace-regexp-in-string} \EFs{"'"} \EFs{"'}\textcolor[HTML]{a9a1e1}{\char92{}\char92{}}\EFs{''"} str t t\EFrdd{)}
                         \EFrdd{(}\EFo{shell-quote-argument} file\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{unless} \EFrdb{(}\EFo{=} \EFhn{0} \EFrdc{(}\EFo{call-process-shell-command} cmd\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{error} \EFs{"Command failed: \%s"} cmd\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-slurp} \EFrdb{(}f\EFrdb{)}
  \EFrdb{(}\EFk{with-temp-buffer}
    \EFrdc{(}\EFo{insert-file-contents} f\EFrdc{)}
    \EFrdc{(}\EFo{buffer-string}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-update-card} \EFrdb{(}card-front card-body repo-dir\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}card-front-id \EFrda{(}\EFo{md5} card-front\EFrda{)}\EFrdd{)}
         \EFrdd{(}card-body-id \EFrda{(}\EFo{md5} card-body\EFrda{)}\EFrdd{)}
         \EFrdd{(}prev-file
          \EFrda{(}\EFk{or}
           \EFrdb{(}\EFo{gethash} card-front-id \EFv{pamparam-hash-card-name->file}\EFrdb{)}
           \EFrdb{(}\EFo{gethash} card-body-id \EFv{pamparam-hash-card-body->file}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}subdir \EFrda{(}\EFo{substring} card-front-id \EFhn{0} \EFhn{2}\EFrda{)}\EFrdd{)}
         \EFrdd{(}card-file
          \EFrda{(}\EFo{concat}
           \EFs{"cards/"} subdir \EFs{"/"} card-front-id \EFs{"-"} card-body-id \EFs{".org"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}full-card-file \EFrda{(}\EFo{expand-file-name} card-file repo-dir\EFrda{)}\EFrdd{)}
         \EFrdd{(}metadata nil\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{null} prev-file\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string=} card-file prev-file\EFrda{)}\EFrdd{)}
          \EFrdd{(}t
           \EFrda{(}\EFk{when} \EFrdb{(}\EFo{file-exists-p} \EFrdc{(}\EFo{expand-file-name} prev-file repo-dir\EFrdc{)}\EFrdb{)}
             \EFrdb{(}\EFk{setq} metadata \EFrdc{(}\EFf{pamparam--replace-card}
                             card-front card-body repo-dir card-file prev-file\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{file-exists-p} \EFrda{(}\EFo{expand-file-name} card-file repo-dir\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}txt
              \EFrdc{(}\EFo{concat}
               \EFrdd{(}\EFk{or} metadata \EFs{"* m\char92{}n\#+STARTUP: content\char92{}n"}\EFrdd{)}
               \EFrdd{(}\EFo{format} \EFs{"* \%s\char92{}n\%s"} card-front card-body\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{make-directory} \EFrdb{(}\EFo{file-name-directory} full-card-file\EFrdb{)} t\EFrda{)}
        \EFrda{(}\EFf{pamparam-spit} txt full-card-file\EFrda{)}
        \EFrda{(}\EFo{cons} \EFrdb{(}\EFk{if} metadata
                  \EFhq{'}\EFhs{update}
                \EFhq{'}\EFhs{new}\EFrdb{)}
              card-file\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defconst} \EFv{pamparam-card-source-regexp} \EFs{"\char94{}\char92{}\char92{}*+ .*:cards:"}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-sync} \EFrdb{(}\EFrdb{)}
  \EFd{"Synchronize the current `}\textcolor[HTML]{a9a1e1}{org-mode}\EFd{' master file to the cards repository.

Create the cards repository if it doesn't exist.

Each card is uniquely identifiable by either its front or its
back.  So if you want to modify both the front and the back, first
modify the front, call `}\textcolor[HTML]{a9a1e1}{pamparam-sync}\EFd{', then modify the back and call
`}\textcolor[HTML]{a9a1e1}{pamparam-sync}\EFd{' again.  Otherwise, there's no way to \char92{}"connect\char92{}" the
new card to the old one, and the old card will remain in the
repository, while the new card will start with empty metadata."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{unless} \EFrdc{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrdc{)}
    \EFrdc{(}\EFo{error} \EFs{"Must be in `}\textcolor[HTML]{a9a1e1}{org-mode}\EFs{' file"}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFf{pamparam--cards-available-p}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}repo-dir \EFrdb{(}\EFf{pamparam-repo-directory} \EFrdc{(}\EFv{buffer-file-name}\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFv{make-backup-files} nil\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-repo-init} repo-dir\EFrdd{)}
      \EFrdd{(}\EFf{pamparam--recompute-git-cards} repo-dir\EFrdd{)}
      \EFrdd{(}\EFf{pamparam--sync} repo-dir\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-kill-buffer-of-file} \EFrdb{(}fname\EFrdb{)}
  \EFrdb{(}\EFk{dolist} \EFrdc{(}buf \EFrdd{(}\EFo{buffer-list}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{equal} fname \EFrda{(}\EFv{buffer-file-name} buf\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer} buf\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{org-keyword-properties}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamapram--cards-at-level-one-p} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}alist \EFrda{(}\EFk{if} \EFrdb{(}\EFo{boundp} \EFhq{'}\EFhs{org-file-properties}\EFrdb{)}
                   org-file-properties
                 \EFv{org-keyword-properties}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{assoc-string} \EFs{"pamparam"} alist t\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--cards-available-p} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{or} \EFrdc{(}\EFf{pamapram--cards-at-level-one-p}\EFrdc{)}
      \EFrdc{(}\EFk{save-excursion}
        \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{if} \EFrda{(}\EFo{re-search-forward} \EFv{pamparam-card-source-regexp} nil t\EFrda{)}
            t
          \EFrda{(}\EFo{error} \EFs{"No outlines with the :cards: tag found"}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--sync} \EFrdb{(}repo-dir\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}old-point \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}
        \EFrdd{(}processed-headings nil\EFrdd{)}
        \EFrdd{(}new-cards nil\EFrdd{)}
        \EFrdd{(}updated-cards nil\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}cards-at-level-one-p \EFrdb{(}\EFf{pamapram--cards-at-level-one-p}\EFrdb{)}\EFrda{)}
           \EFrda{(}regex \EFrdb{(}\EFk{if} cards-at-level-one-p
                      \EFs{"\char92{}\char92{}*+ .*\$"}
                    \EFv{pamparam-card-source-regexp}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{while} \EFrda{(}\EFo{re-search-forward} regex nil t\EFrda{)}
        \EFrda{(}\EFk{when} cards-at-level-one-p
          \EFrdb{(}\EFo{beginning-of-line}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{lispy-destructuring-setq} \EFrdb{(}processed-headings new-cards updated-cards\EFrdb{)}
            \EFrdb{(}\EFf{pamparam-sync-current-outline}
             processed-headings new-cards updated-cards repo-dir\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} old-point\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{or} new-cards updated-cards\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}pile-fname \EFrdc{(}\EFo{expand-file-name} \EFs{"pampile.org"} repo-dir\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFf{pamparam-kill-buffer-of-file} pile-fname\EFrda{)}
        \EFrda{(}\EFf{pamparam-schedule-today}
         \EFrdb{(}\EFo{mapcar} \EFhq{\#'}\EFhs{pamparam--todo-from-file} new-cards\EFrdb{)}
         \EFrdb{(}\EFo{find-file-noselect} pile-fname\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{shell-command-to-string}
       \EFrda{(}\EFo{format}
        \EFs{"cd \%s \&\& git add . \&\& git commit -m \%s"}
        \EFrdb{(}\EFo{shell-quote-argument} repo-dir\EFrdb{)}
        \EFrdb{(}\EFo{shell-quote-argument}
         \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{null} updated-cards\EFrda{)}
                \EFrda{(}\EFo{format} \EFs{"Add \%d new card(s)"} \EFrdb{(}\EFo{length} new-cards\EFrdb{)}\EFrda{)}\EFrdd{)}
               \EFrdd{(}\EFrda{(}\EFo{null} new-cards\EFrda{)}
                \EFrda{(}\EFo{format} \EFs{"Update \%d card(s)"} \EFrdb{(}\EFo{length} updated-cards\EFrdb{)}\EFrda{)}\EFrdd{)}
               \EFrdd{(}t
                \EFrda{(}\EFo{format} \EFs{"Add \%d new card(s), update \%d cards"}
                        \EFrdb{(}\EFo{length} new-cards\EFrdb{)}
                        \EFrdb{(}\EFo{length} updated-cards\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFs{"\%d new cards, \%d updated, \%d total"}
             \EFrdd{(}\EFo{length} new-cards\EFrdd{)}
             \EFrdd{(}\EFo{length} updated-cards\EFrdd{)}
             \EFrdd{(}\EFo{length} processed-headings\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{defun} \EFf{pamparam--card-info} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}bnd \EFrda{(}\EFf{worf--bounds-subtree}\EFrda{)}\EFrdd{)}
         \EFrdd{(}str \EFrda{(}\EFo{lispy--string-dwim} bnd\EFrda{)}\EFrdd{)}
         front back\EFrdc{)}
    \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{string-match} \EFs{"\char94{}\char92{}\char92{}*+ a\char92{}n}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} str\EFrda{)}
           \EFrda{(}\EFk{setq} front \EFrdb{(}\EFo{substring} str \EFhn{0} \EFrdc{(}\EFo{match-beginning} \EFhn{0}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} back \EFrdb{(}\EFo{concat} \EFs{"* a\char92{}n"} \EFrdc{(}\EFo{match-string} \EFhn{1} str\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} front \EFrdb{(}\EFo{string-trim-left} front\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{cdr} bnd\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`\char92{}\char92{}*+ }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}n}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{*]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(?:}}\EFs{\char92{}n\char92{}\char92{}*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{?"} str\EFrda{)}
           \EFrda{(}\EFk{setq} front \EFrdb{(}\EFo{match-string} \EFhn{1} str\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} back \EFrdb{(}\EFo{match-string} \EFhn{2} str\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{+} \EFrdc{(}\EFo{car} bnd\EFrdc{)} \EFrdc{(}\EFo{match-end} \EFhn{2}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} back \EFrdb{(}\EFo{string-trim-right} back\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{\char92{}\char92{}*+ }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{.*\{}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{\}]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\}.*\char92{}\char92{}'"} str\EFrda{)}
           \EFrda{(}\EFk{setq} front
                 \EFrdb{(}\EFo{concat} \EFrdc{(}\EFo{substring} str \EFrdd{(}\EFo{match-end} \EFhn{1}\EFrdd{)} \EFrdd{(}\EFo{1-} \EFrda{(}\EFo{match-beginning} \EFhn{2}\EFrda{)}\EFrdd{)}\EFrdc{)}
                         \EFs{"[...]"}
                         \EFrdc{(}\EFo{substring} str \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{match-end} \EFhn{2}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
           \EFrda{(}\EFk{setq} back \EFrdb{(}\EFo{match-string} \EFhn{2} str\EFrdb{)}\EFrda{)}\EFrdd{)}
          \EFrdd{(}t
           \EFrda{(}\EFo{error} \EFs{"unexpected"}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{cons} front back\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-sync-current-outline} \EFrdb{(}processed-headings new-cards updated-cards repo-dir\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}end \EFrda{(}\EFk{save-excursion}
               \EFrdb{(}\EFo{outline-end-of-subtree}\EFrdb{)}
               \EFrdb{(}\EFo{point}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{while} \EFrdd{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}*+ }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"} end t\EFrdd{)}
      \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}card-info \EFrdc{(}\EFf{pamparam--card-info}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}card-front \EFrdc{(}\EFo{car} card-info\EFrdc{)}\EFrdb{)}
             \EFrdb{(}card-body \EFrdc{(}\EFo{cdr} card-info\EFrdc{)}\EFrdb{)}
             card-file\EFrda{)}
        \EFrda{(}\EFk{if} \EFrdb{(}\EFo{member} card-front processed-headings\EFrdb{)}
            \EFrdb{(}\EFo{error} \EFs{"Duplicate heading encountered: \%s"} card-front\EFrdb{)}
          \EFrdb{(}\EFk{push} card-front processed-headings\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{when} \EFrdb{(}\EFk{setq} card-info \EFrdc{(}\EFf{pamparam-update-card} card-front card-body repo-dir\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{setq} card-file \EFrdc{(}\EFo{file-name-nondirectory} \EFrdd{(}\EFo{cdr} card-info\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{cond} \EFrdc{(}\EFrdd{(}\EFo{eq} \EFrda{(}\EFo{car} card-info\EFrda{)} \EFhq{'}\EFhs{new}\EFrdd{)}
                 \EFrdd{(}\EFk{push} card-file new-cards\EFrdd{)}\EFrdc{)}
                \EFrdc{(}\EFrdd{(}\EFo{eq} \EFrda{(}\EFo{car} card-info\EFrda{)} \EFhq{'}\EFhs{update}\EFrdd{)}
                 \EFrdd{(}\EFk{push} card-file updated-cards\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{list} processed-headings new-cards updated-cards\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-default-directory} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-match} \EFs{"\char94{}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{.*\char92{}\char92{}.pam/}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFv{default-directory}\EFrdc{)}
      \EFrdc{(}\EFo{expand-file-name} \EFrdd{(}\EFo{match-string} \EFhn{1} \EFv{default-directory}\EFrdd{)}\EFrdc{)}
    \EFv{pamparam-path}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-kill-buffers} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}pdir \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}cards-dir \EFrda{(}\EFo{expand-file-name} \EFs{"cards/"} pdir\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}b \EFrda{(}\EFo{buffer-list}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFv{buffer-file-name} b\EFrda{)}
        \EFrda{(}\EFk{let} \EFrdb{(}\EFrdc{(}dir \EFrdd{(}\EFo{file-name-directory} \EFrda{(}\EFv{buffer-file-name} b\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{equal} dir cards-dir\EFrdd{)}
                    \EFrdd{(}\EFk{and} \EFrda{(}\EFo{equal} dir pdir\EFrda{)}
                         \EFrda{(}\EFo{not} \EFrdb{(}\EFo{equal} \EFrdc{(}\EFo{file-name-nondirectory}
                                      \EFrdd{(}\EFv{buffer-file-name} b\EFrdd{)}\EFrdc{)}
                                     \EFrdc{(}\EFf{pamparam-schedule-file} \EFrdd{(}\EFo{current-time}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{kill-buffer} b\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-schedule-file} \EFrdb{(}time\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}year \EFrda{(}\EFo{format-time-string} \EFs{"\%Y"} time\EFrda{)}\EFrdd{)}
        \EFrdd{(}current-year \EFrda{(}\EFo{format-time-string} \EFs{"\%Y"} \EFrdb{(}\EFo{current-time}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}base \EFrda{(}\EFo{format-time-string} \EFs{"pam-\%Y-\%m-\%d.org"} time\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{string=} year current-year\EFrdd{)}
        base
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}dir \EFrdc{(}\EFo{expand-file-name}
                  year \EFrdd{(}\EFo{expand-file-name} \EFs{"years"} \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{unless} \EFrdb{(}\EFo{file-exists-p} dir\EFrdb{)}
          \EFrdb{(}\EFo{make-directory} dir t\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{expand-file-name} base dir\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-todo-file} \EFrdb{(}\EFt{\&optional} offset\EFrdb{)}
  \EFrdb{(}\EFk{setq} offset \EFrdc{(}\EFk{or} offset \EFhn{0}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}\EFv{default-directory} \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}todo-file \EFrda{(}\EFo{expand-file-name}
                     \EFrdb{(}\EFf{pamparam-schedule-file}
                      \EFrdc{(}\EFo{time-add}
                       \EFrdd{(}\EFo{current-time}\EFrdd{)}
                       \EFrdd{(}\EFo{days-to-time} offset\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFv{save-silently} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFo{file-exists-p} todo-file\EFrdd{)}
      \EFrdd{(}\EFk{save-current-buffer}
        \EFrda{(}\EFo{find-file} todo-file\EFrda{)}
        \EFrda{(}\EFo{insert} \EFs{"\#+SEQ\_}\textcolor[HTML]{ECBE7B}{\textbf{TODO:}} \textcolor[HTML]{ECBE7B}{\textbf{TODO}} \textcolor[HTML]{51afef}{\textbf{REVIEW}}\EFs{ | DONE\char92{}n"}\EFrda{)}
        \EFrda{(}\EFk{when} \EFrdb{(}\EFo{eq} offset \EFhn{0}\EFrdb{)}
          \EFrdb{(}\EFf{pamparam-pull} \EFhn{10} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{message} \EFs{"Schedule was empty, used `}\textcolor[HTML]{a9a1e1}{pamparam-pull}\EFs{' for 10 cards"}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFf{pamparam-save-buffer}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{find-file-noselect} todo-file\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-last-rechedule} nil\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-schedule-today} \EFrdb{(}cards \EFt{\&optional} buffer\EFrdb{)}
  \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFk{or} buffer \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-goto-schedule-part}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}card cards\EFrdd{)}
      \EFrdd{(}\EFo{insert} card\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{save-silently} t\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar-local} \EFv{pamparam--progress} nil
  \EFd{"Cache the current progress."}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-current-progress} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFf{pamparam-todo-file}\EFrdc{)}
    \EFrdc{(}\EFk{or} \EFv{pamparam--progress}
        \EFrdd{(}\EFf{pamparam--recalculate-progress}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam--recalculate-progress} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{pamparam--progress}
        \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}n-done \EFhn{0}\EFrda{)}
              \EFrda{(}n-todo \EFhn{0}\EFrda{)}
              \EFrda{(}n-review \EFhn{0}\EFrda{)}\EFrdd{)}
          \EFrdd{(}\EFk{save-excursion}
            \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-min}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFk{while} \EFrdb{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}* }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{DONE}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} nil t\EFrdb{)}
              \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}ms \EFrda{(}\EFo{match-string} \EFhn{1}\EFrda{)}\EFrdd{)}\EFrdc{)}
                \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{string=} ms \EFs{"}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{"}\EFrda{)}
                       \EFrda{(}\EFk{cl-incf} n-todo\EFrda{)}\EFrdd{)}
                      \EFrdd{(}\EFrda{(}\EFo{string=} ms \EFs{"DONE"}\EFrda{)}
                       \EFrda{(}\EFk{cl-incf} n-done\EFrda{)}\EFrdd{)}
                      \EFrdd{(}\EFrda{(}\EFo{string=} ms \EFs{"}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\EFs{"}\EFrda{)}
                       \EFrda{(}\EFk{cl-incf} n-review\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
            \EFrda{(}\EFo{list} n-done n-todo n-review\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-mode-line} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{cl-destructuring-bind} \EFrdc{(}n-done n-todo n-review\EFrdc{)}
      \EFrdc{(}\EFf{pamparam-current-progress}\EFrdc{)}
    \EFrdc{(}\EFo{format} \EFs{"(pam: \%d/\%d+\%d)"} n-done n-todo n-review\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defvar} \EFv{pamparam-day-limit} \EFhn{50}
  \EFd{"Limit for today's repetitions.
All cards above this number that would be scheduled for today
will instead be moved to tomorrow."}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-merge-schedules} \EFrdb{(}from to\EFrdb{)}
  \EFd{"Copy items FROM -> TO. Delete FROM."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}from-lines
         \EFrda{(}\EFo{cl-remove-if-not}
          \EFrdb{(}\EFk{lambda} \EFrdc{(}s\EFrdc{)} \EFrdc{(}\EFf{string-match-p} \EFs{"\char94{}\char92{}\char92{}*"} s\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{split-string} \EFrdc{(}\EFf{pamparam-slurp} from\EFrdc{)} \EFs{"\char92{}n"} t\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}to-lines \EFrda{(}\EFo{split-string} \EFrdb{(}\EFf{pamparam-slurp} to\EFrdb{)} \EFs{"\char92{}n"} t\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-spit}
     \EFrdd{(}\EFo{mapconcat} \EFhq{\#'}\EFhs{identity}
                \EFrda{(}\EFo{append} to-lines from-lines\EFrda{)}
                \EFs{"\char92{}n"}\EFrdd{)}
     to\EFrdc{)}
    \EFrdc{(}\EFo{delete-file} from\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-carryover-year-maybe} \EFrdb{(}\EFrdb{)}
  \EFd{"Move e.g. years/2018/*.org to . if the current year is 2018."}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}today \EFrda{(}\EFo{calendar-current-date}\EFrda{)}\EFrdd{)}
         \EFrdd{(}year \EFrda{(}\EFo{nth} \EFhn{2} today\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFv{default-directory} \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}year-directory \EFrda{(}\EFo{format} \EFs{"years/\%d"} year\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{file-exists-p} year-directory\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}year-files \EFrdc{(}\EFo{directory-files} year-directory nil \EFs{"org\$"}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{dolist} \EFrdb{(}file year-files\EFrdb{)}
          \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}file-from \EFrda{(}\EFo{expand-file-name} file year-directory\EFrda{)}\EFrdd{)}
                \EFrdd{(}file-to \EFrda{(}\EFo{expand-file-name} file\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{file-exists-p} file-to\EFrdd{)}
                \EFrdd{(}\EFf{pamparam-merge-schedules} file-from file-to\EFrdd{)}
              \EFrdd{(}\EFo{rename-file} file-from file-to\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{delete-directory} year-directory\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-check} \EFrdb{(}\EFrdb{)}
  \EFd{"Check the repo for inconsistencies and fix them.

Check that all existing cards are scheduled, and only once.
Check that there are no scheduled unexisting cards."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}\EFv{default-directory} \EFrda{(}\EFf{pamparam-default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}all-cards \EFrda{(}\EFf{pamparam-cards} \EFv{default-directory}\EFrda{)}\EFrdd{)}
         \EFrdd{(}all-schedules \EFrda{(}\EFo{delq} nil
                              \EFrdb{(}\EFo{mapcar}
                               \EFrdc{(}\EFk{lambda} \EFrdd{(}s\EFrdd{)}
                                 \EFrdd{(}\EFk{when} \EFrda{(}\EFo{string-match} \EFs{"file:}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{]]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} s\EFrda{)}
                                   \EFrda{(}\EFo{match-string} \EFhn{1} s\EFrda{)}\EFrdd{)}\EFrdc{)}
                               \EFrdc{(}\EFf{pamparam-cmd-to-list}
                                \EFs{"git grep '\char94{}\char92{}\char92{}* TODO'"}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}unscheduled-cards \EFrda{(}\EFo{cl-set-difference}
                             all-cards
                             all-schedules
                             \EFb{:test} \EFhq{\#'}\EFhs{equal}\EFrda{)}\EFrdd{)}
         \EFrdd{(}unexisting-cards \EFrda{(}\EFo{cl-set-difference}
                            all-schedules
                            all-cards
                            \EFb{:test} \EFhq{\#'}\EFhs{equal}\EFrda{)}\EFrdd{)}
         \EFrdd{(}all-schedules-nodups \EFrda{(}\EFo{delete-dups} \EFrdb{(}\EFo{copy-sequence} all-schedules\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}duplicate-cards \EFrda{(}\EFo{cl-set-difference} all-schedules all-schedules-nodups\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFo{find-file-noselect} \EFs{"pampile.org"}\EFrdd{)}
      \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{dolist} \EFrda{(}card unscheduled-cards\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{format} \EFs{"* }\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{ [[file:\%s][\%s]]\char92{}n"}
                        card \EFrdc{(}\EFo{nth} \EFhn{1} \EFrdd{(}\EFo{split-string} card \EFs{"[-.]"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{save-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}card \EFrda{(}\EFo{append} duplicate-cards unexisting-cards\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}occurences \EFrdc{(}\EFf{pamparam-cmd-to-list} \EFrdd{(}\EFo{format} \EFs{"git grep \%s"} card\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{dolist} \EFrdb{(}occ \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{=} \EFrda{(}\EFo{length} occurences\EFrda{)} \EFhn{1}\EFrdd{)}
                         occurences
                       \EFrdd{(}\EFo{cdr} occurences\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{with-current-buffer} \EFrdc{(}\EFo{find-file-noselect} \EFrdd{(}\EFo{car} \EFrda{(}\EFo{split-string} occ \EFs{":"}\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{re-search-forward} card\EFrdc{)}
            \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)}
                           \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{line-end-position}\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{save-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-reschedule-maybe} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-carryover-year-maybe}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}today \EFrda{(}\EFo{calendar-current-date}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{unless} \EFrdd{(}\EFk{and} \EFv{pamparam-last-rechedule}
                 \EFrda{(}\EFo{<}
                  \EFrdb{(}\EFf{calendar-absolute-from-gregorian} today\EFrdb{)}
                  \EFrdb{(}\EFf{calendar-absolute-from-gregorian} \EFv{pamparam-last-rechedule}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{pamparam-last-rechedule} today\EFrdd{)}
      \EFrdd{(}\EFk{let*} \EFrda{(}\EFrdb{(}today-file \EFrdc{(}\EFf{pamparam-todo-file}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}today-file-name \EFrdc{(}\EFo{file-name-nondirectory}
                               \EFrdd{(}\EFv{buffer-file-name} today-file\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}pdir \EFrdc{(}\EFo{file-name-directory}
                    \EFrdd{(}\EFv{buffer-file-name} today-file\EFrdd{)}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}all-files \EFrdc{(}\EFo{directory-files} pdir nil \EFs{"org\$"}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}idx \EFrdc{(}\EFo{cl-position} today-file-name all-files
                               \EFb{:test} \EFhq{'}\EFhs{equal}\EFrdc{)}\EFrdb{)}
             \EFrdb{(}old-files \EFrdc{(}\EFo{reverse} \EFrdd{(}\EFo{cl-subseq} all-files \EFhn{0} idx\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{dolist} \EFrdb{(}old-file old-files\EFrdb{)}
          \EFrdb{(}\EFk{setq} old-file \EFrdc{(}\EFo{expand-file-name} old-file pdir\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{let} \EFrdc{(}cards\EFrdc{)}
            \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFo{find-file-noselect} old-file\EFrdd{)}
              \EFrdd{(}\EFo{goto-char} \EFrda{(}\EFo{point-min}\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFk{while} \EFrda{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}* }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{ "} nil t\EFrda{)}
                \EFrda{(}\EFk{push} \EFrdb{(}\EFo{buffer-substring-no-properties}
                       \EFrdc{(}\EFo{point}\EFrdc{)} \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{line-end-position}\EFrdd{)}\EFrdc{)}\EFrdb{)}
                      cards\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFf{pamparam-schedule-today} \EFrdd{(}\EFo{mapcar} \EFrda{(}\EFk{lambda} \EFrdb{(}s\EFrdb{)} \EFrdb{(}\EFo{concat} \EFs{"* }\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{ "} s\EFrdb{)}\EFrda{)}
                                             \EFrda{(}\EFo{nreverse} cards\EFrda{)}\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFo{delete-file} old-file\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{with-current-buffer} today-file
          \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}* }\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{"} nil t \EFv{pamparam-day-limit}\EFrdc{)}
            \EFrdc{(}\EFo{beginning-of-line} \EFhn{2}\EFrdc{)}
            \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}rescheduled \EFrdb{(}\EFo{buffer-substring-no-properties}
                                \EFrdc{(}\EFo{point}\EFrdc{)} \EFrdc{(}\EFo{point-max}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFo{delete-region} \EFrda{(}\EFo{point}\EFrda{)} \EFrda{(}\EFo{point-max}\EFrda{)}\EFrdd{)}
              \EFrdd{(}\EFo{save-buffer}\EFrdd{)}
              \EFrdd{(}\EFk{with-current-buffer} \EFrda{(}\EFf{pamparam-todo-file} \EFhn{1}\EFrda{)}
                \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}
                \EFrda{(}\EFo{insert} rescheduled\EFrda{)}
                \EFrda{(}\EFo{save-buffer}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{pamparam-drill} \EFrdb{(}\EFrdb{)}
  \EFd{"Start a learning session.

When `}\textcolor[HTML]{a9a1e1}{default-directory}\EFd{' is in a *.pam repository, use that repository.
Otherwise, use the repository that `}\textcolor[HTML]{a9a1e1}{pamparam-path}\EFd{' points to.

See `}\textcolor[HTML]{a9a1e1}{pamparam-sync}\EFd{' for creating and updating a *.pam repository.

If you have no more cards scheduled for today, use `}\textcolor[HTML]{a9a1e1}{pamparam-pull}\EFd{'."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-reschedule-maybe}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}card-link card-file\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFk{bound-and-true-p} \EFv{pamparam-card-mode}\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFo{buffer-modified-p}\EFrda{)}
        \EFrda{(}\EFf{pamparam-save-buffer}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{kill-buffer}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{delete-other-windows}\EFrdc{)}
    \EFrdc{(}\EFo{split-window-vertically}\EFrdc{)}
    \EFrdc{(}\EFf{pamparam-kill-buffers}\EFrdc{)}
    \EFrdc{(}\EFo{switch-to-buffer} \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{goto-char} \EFrdd{(}\EFo{point-min}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{re-search-forward} \EFs{"\char94{}* }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{ "} nil t\EFrdd{)}
      \EFrdd{(}\EFo{recenter} \EFhn{5}\EFrdd{)}
      \EFrdd{(}\EFk{setq} card-link \EFrda{(}\EFo{buffer-substring-no-properties}
                       \EFrdb{(}\EFo{point}\EFrdb{)} \EFrdb{(}\EFo{line-end-position}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{beginning-of-line}\EFrdd{)}
      \EFrdd{(}\EFo{set-window-point} \EFrda{(}\EFo{selected-window}\EFrda{)} \EFrda{(}\EFo{point}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{other-window} \EFhn{1}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{null} card-link\EFrdd{)}
        \EFrdd{(}\EFo{message} \EFs{"\%d cards learned/reviewed today. Well done!"}
                 \EFrda{(}\EFo{cl-count-if}
                  \EFrdb{(}\EFk{lambda} \EFrdc{(}x\EFrdc{)} \EFrdc{(}\EFo{string-match} \EFs{"\char94{}\char92{}\char92{}* DONE"} x\EFrdc{)}\EFrdb{)}
                  \EFrdb{(}\EFo{split-string} \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}
                                  \EFrdd{(}\EFo{buffer-string}\EFrdd{)}\EFrdc{)} \textcolor[HTML]{ECBE7B}{"\char92{}n"}\textcolor[HTML]{c678dd}{)}\textcolor[HTML]{51afef}{)}\textcolor[HTML]{a9a1e1}{)}
      \EFrdd{(}\EFk{unless} \EFrda{(}\EFo{string-match} \EFs{"\char92{}\char92{}`\char92{}\char92{}[\char92{}\char92{}[file:}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{]]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}]\char92{}\char92{}[}\textcolor[HTML]{a9a1e1}{.*\char92{}\char92{}}\EFs{]\char92{}\char92{}]\char92{}\char92{}'"} card-link\EFrda{)}
        \EFrda{(}\EFo{error} \EFs{"Bad entry in \%s: \%s"} \EFrdb{(}\EFf{pamparam-todo-file}\EFrdb{)} card-link\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{setq} card-file \EFrda{(}\EFo{match-string} \EFhn{1} card-link\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{switch-to-buffer}
       \EFrda{(}\EFo{find-file-noselect}
        \EFrdb{(}\EFo{expand-file-name} card-file \EFrdc{(}\EFf{pamparam-default-directory}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFv{pamparam-card-mode}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-commit} \EFrdb{(}\EFrdb{)}
  \EFd{"Commit the current progress using Git."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}repo-dir \EFrda{(}\EFf{pamparam-repo-directory} \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFv{default-directory} \EFrda{(}\EFk{if} \EFrdb{(}\EFo{file-exists-p} repo-dir\EFrdb{)}
                                repo-dir
                              \EFrdb{(}\EFf{pamparam-default-directory}\EFrdb{)}\EFrda{)}\EFrdd{)}
         \EFrdd{(}status \EFrda{(}\EFf{pamparam-cmd-to-list} \EFs{"git status"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}card-count
          \EFrda{(}\EFo{cl-count-if}
           \EFrdb{(}\EFk{lambda} \EFrdc{(}s\EFrdc{)}
             \EFrdc{(}\EFk{or} \EFrdd{(}\EFo{string-match} \EFs{"modified.*cards/"} s\EFrdd{)}
                 \EFrdd{(}\EFo{string-match} \EFs{"new file.*cards/"} s\EFrdd{)}\EFrdc{)}\EFrdb{)}
           status\EFrda{)}\EFrdd{)}
         \EFrdd{(}card-str \EFrda{(}\EFk{if} \EFrdb{(}\EFo{=} card-count \EFhn{1}\EFrdb{)}
                       \EFs{"card"}
                     \EFs{"cards"}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message}
     \EFrdd{(}\EFo{replace-regexp-in-string}
      \EFs{"\%"} \EFs{"\%\%"}
      \EFrda{(}\EFo{shell-command-to-string}
       \EFrdb{(}\EFo{format}
        \EFs{"git add . \&\& git commit -m 'Do \%s \%s'"}
        card-count card-str\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-unschedule-card} \EFrdb{(}card-file\EFrdb{)}
  \EFd{"Unschedule CARD-FILE everywhere and schedule it for today."}
  \EFrdb{(}\EFk{let*} \EFrdc{(}\EFrdd{(}repo-dir \EFrda{(}\EFo{locate-dominating-file} card-file \EFs{".git"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}s-files \EFrda{(}\EFf{pamparam-cmd-to-list} \EFrdb{(}\EFo{format} \EFs{"git add . \&\& git grep --files-with-matches \%s"} \EFrdc{(}\EFo{shell-quote-argument} card-file\EFrdc{)}\EFrdb{)}
                                        repo-dir\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{dolist} \EFrdd{(}file s-files\EFrdd{)}
      \EFrdd{(}\EFk{with-current-buffer} \EFrda{(}\EFo{find-file-noselect} \EFrdb{(}\EFo{expand-file-name} file repo-dir\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{save-excursion}
          \EFrdb{(}\EFo{goto-char} \EFrdc{(}\EFo{point-min}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{while} \EFrdc{(}\EFo{re-search-forward} card-file nil t\EFrdc{)}
            \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{line-beginning-position}\EFrdd{)}
                           \EFrdd{(}\EFo{1+} \EFrda{(}\EFo{line-end-position}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{save-silently} t\EFrdd{)}\EFrdc{)}
            \EFrdc{(}\EFf{pamparam-save-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{unless} \EFrdb{(}\EFo{equal} \EFrdc{(}\EFo{current-buffer}\EFrdc{)} \EFrdc{(}\EFf{pamparam-todo-file}\EFrdc{)}\EFrdb{)}
          \EFrdb{(}\EFo{kill-buffer}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer} \EFrdd{(}\EFf{pamparam-todo-file}\EFrdd{)}
      \EFrdd{(}\EFf{pamparam-goto-schedule-part}\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{re-search-forward} \EFs{"\char94{}\char92{}\char92{}* }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\textcolor[HTML]{51afef}{\textbf{REVIEW}}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} nil t\EFrda{)}
          \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{match-beginning} \EFhn{0}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFrda{(}\EFf{pamparam--todo-from-file} card-file\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-card-redo} \EFrdb{(}\EFrdb{)}
  \EFd{"Redo the current card without penalty."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFf{string-match-p} \EFs{"cards/.*org\char92{}\char92{}'"} \EFrdd{(}\EFv{buffer-file-name}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}fname \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-save-buffer}\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-cmd-to-list} \EFrda{(}\EFo{format} \EFs{"git checkout -- \%s"} \EFrdb{(}\EFo{shell-quote-argument} fname\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{revert-buffer} nil t nil\EFrdd{)}
        \EFrdd{(}\EFf{pamparam-unschedule-card} \EFrda{(}\EFo{file-name-nondirectory} fname\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{setq-local} \EFv{pamparam-is-redo} t\EFrdd{)}
        \EFrdd{(}\EFv{pamparam-card-mode}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{user-error} \EFs{"Applies only to card files"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-shifttab} \EFrdb{(}\EFrdb{)}
  \EFd{"Hide/show everything."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{inhibit-message} t\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{eq} \EFv{org-cycle-global-status} \EFhq{'}\EFhs{overview}\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{org-cycle-global-status} \EFhq{'}\EFhs{contents}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} \EFv{this-command} \EFv{last-command}\EFrdc{)}
    \EFrdc{(}\EFo{org-cycle-internal-global}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;}\EFc{* `}\textcolor[HTML]{a9a1e1}{pamparam-card-mode}\EFc{'}
\EFrda{(}\EFk{defvar} \EFv{pamparam-card-mode-map}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFo{map} \EFrda{(}\EFo{make-sparse-keymap}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFf{worf-define-key} map \EFrdd{(}\EFo{kbd} \EFs{"q"}\EFrdd{)} \EFhq{'}\EFhs{bury-buffer}\EFrdc{)}
    \EFrdc{(}\EFf{worf-define-key} map \EFrdd{(}\EFo{kbd} \EFs{"R"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-card-redo}
                     \EFb{:break} t\EFrdc{)}
    \EFrdc{(}\EFf{worf-define-key} map \EFrdd{(}\EFo{kbd} \EFs{"n"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-drill}
                     \EFb{:break} t\EFrdc{)}
    \EFrdc{(}\EFf{worf-define-key} map \EFrdd{(}\EFo{kbd} \EFs{"D"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-card-delete}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"."}\EFrdd{)} \EFhq{'}\EFhs{pamparam-card-validate-maybe}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"M-m"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-card-manual-score}\EFrdc{)}
    \EFrdc{(}\EFo{define-key} map \EFrdd{(}\EFo{kbd} \EFs{"<S-iso-lefttab>"}\EFrdd{)} \EFhq{'}\EFhs{pamparam-shifttab}\EFrdc{)}
    map\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{define-minor-mode} \EFv{pamparam-card-mode}
  \EFd{"Minor mode for Pam cards.

\char92{}\char92{}\{pamparam-card-mode-map\}"}
  \EFb{:lighter} \EFs{" p"}
  \EFrdb{(}\EFk{when} \EFv{pamparam-card-mode}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrdd{)}
        \EFrdd{(}\EFk{progn}
          \EFrda{(}\EFf{pamparam-card-abbreviate}\EFrda{)}
          \EFrda{(}\EFk{setq-local} \EFv{mode-line-format}
                      \EFhq{`}\EFrdb{(}\EFrdc{(}\EFv{pamparam-card-mode}
                         \EFrdd{(}\EFb{:eval} \EFrda{(}\EFf{pamparam-mode-line}\EFrda{)}\EFrdd{)}\EFrdc{)}
                        ,@\EFrdc{(}\EFo{assq-delete-all}
                           \EFhq{'}\EFv{pamparam-card-mode}
                           \EFrdd{(}\EFo{default-value} \EFhq{'}\EFv{mode-line-format}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFo{force-mode-line-update} t\EFrda{)}
          \EFrda{(}\EFk{setq} \EFv{org-cycle-global-status} \EFhq{'}\EFhs{contents}\EFrda{)}
          \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-min}\EFrdb{)}\EFrda{)}
          \EFrda{(}\EFf{pamparam-card-answer}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFv{pamparam-card-mode} \EFhn{-1}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFv{lispy-mode} t\EFrda{)}
\EFrda{(}\EFo{lispy-raise-minor-mode} \EFhq{'}\EFv{pamparam-card-mode}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-latin} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/latin/Latin.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-tagalog} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/tagalog/Tagalog.org"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-drill-latin} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/latin/Latin.pam"}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-drill}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-drill-tagalog} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/tagalog/Tagalog.pam"}\EFrdb{)}
  \EFrdb{(}\EFf{pamparam-drill}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-magit-commit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{find-file} \EFs{"\char126{}/dox/pamparam/"}\EFrdb{)}
  \EFrdb{(}\EFf{magit}\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{pamparam-push} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{async-shell-command} \EFs{"cd \char126{}/dox/pamparam/ \&\& \char126{}/dox/pamparam/update.sh"}\EFrdb{)}
  \EFrda{)}

\EFcd{;;}\EFc{* `}\textcolor[HTML]{a9a1e1}{hydra-pamparam}\EFc{'}
\EFrda{(}\EFk{defhydra} hydra-pamparam \EFrdb{(}\EFb{:exit} t\EFrdb{)}
  \EFd{"pam"}
  \EFrdb{(}\EFs{"t"} pamparam-drill-tagalog \EFs{"tagalog"}\EFrdb{)}
  \EFrdb{(}\EFs{"l"} pamparam-drill-latin \EFs{"latin"}\EFrdb{)}
  \EFrdb{(}\EFs{"d"} pamparam-drill \EFs{"drill"}\EFrdb{)}
  \EFrdb{(}\EFs{"s"} pamparam-sync \EFs{"sync"}\EFrdb{)}
  \EFrdb{(}\EFs{"m"} pamparam-pull \EFs{"more cards"}\EFrdb{)}
  \EFrdb{(}\EFs{"p"} pamparam-push \EFs{"push"}\EFrdb{)}
  \EFrdb{(}\EFs{"gl"} pamparam-latin \EFs{"goto latin"}\EFrdb{)}
  \EFrdb{(}\EFs{"gt"} pamparam-tagalog \EFs{"goto tagalog"}\EFrdb{)}
  \EFrdb{(}\EFs{"q"} nil \EFs{"quit"}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFo{hydra-set-property} \EFhq{'}\EFhs{hydra-pamparam} \EFb{:verbosity} \EFhn{1}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"C-c v"}\EFrdb{)} \EFhq{'}\EFhs{hydra-pamparam/body}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{pamparam-path} \EFs{"/home/user/dox/pamparam/pamparam.pam"}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{spaced-repetition}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Accounting}
\label{sec:org5feea1e}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{accounting}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org6002c6f}
\subsubsection{Code}
\label{sec:org729a71c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{beancount.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{use-package!} beancount
  \EFb{:mode} \EFrdb{(}\EFs{"\char92{}\char92{}.beancount\char92{}\char92{}'"} . beancount-mode\EFrdb{)}
  \EFb{:init}
  \EFrdb{(}\EFk{after!} all-the-icons
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{all-the-icons-icon-alist}
                 \EFhq{'}\EFrdd{(}\EFs{"\char92{}\char92{}.beancount\char92{}\char92{}'"} all-the-icons-material \EFs{"attach\_money"} \EFb{:face} all-the-icons-lblue\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{all-the-icons-mode-icon-alist}
                 \EFhq{'}\EFrdd{(}beancount-mode all-the-icons-material \EFs{"attach\_money"} \EFb{:face} all-the-icons-lblue\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFb{:config}
  \EFrdb{(}\EFk{setq} beancount-electric-currency t\EFrdb{)}
  \EFrdb{(}\EFk{defun} \EFf{beancount-bal} \EFrdc{(}\EFrdc{)}
    \EFd{"Run bean-report bal."}
    \EFrdc{(}\EFk{interactive}\EFrdc{)}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}\EFv{compilation-read-command} nil\EFrda{)}\EFrdd{)}
      \EFrdd{(}beancount--run \EFs{"bean-report"}
                      \EFrda{(}\EFo{file-relative-name} \EFv{buffer-file-name}\EFrda{)} \EFs{"bal"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{map!} \EFb{:map} beancount-mode-map
        \EFb{:n} \EFs{"TAB"} \EFhq{\#'}\EFhs{beancount-align-to-previous-number}
        \EFb{:i} \EFs{"RET"} \EFrdc{(}\EFk{cmd!} \EFrdd{(}\EFo{newline-and-indent}\EFrdd{)} \EFrdd{(}beancount-align-to-previous-number\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{accounting}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Popes}
\label{sec:org7b6b5fa}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{popes}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org2761001}
\subsubsection{Code}
\label{sec:org719f443}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{popes.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{defun} \EFf{get-pope-image} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{let*} \EFrdc{(}
         \EFrdd{(}folder \EFrda{(}\EFo{concat} \EFv{doom-private-dir} \EFs{"/scripts/popes/images/"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}files \EFrda{(}\EFo{directory-files} folder nil \EFs{"\char92{}\char92{}.png\char92{}\char92{}'"}\EFrda{)}\EFrdd{)}
         \EFrdd{(}number-popes \EFrda{(}\EFo{length} files\EFrda{)}\EFrdd{)}
         \EFrdd{(}pope-img \EFrda{(}\EFo{nth} \EFrdb{(}\EFo{random} number-popes\EFrdb{)} files\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} currently-displayed-pope \EFrdd{(}\EFo{replace-regexp-in-string} \EFs{".png"} \EFs{""} pope-img\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{setq} pope-info \EFrdd{(}\EFo{shell-command-to-string} \EFrda{(}\EFo{concat} \EFs{"grep -m1 \char92{}""} currently-displayed-pope \EFs{"\char92{}" "} folder \EFs{"../pope\_info.txt"}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{concat} folder pope-img\EFrdc{)}
    \EFrdb{)}
  \EFrda{)}


\EFrda{(}\EFk{defun} \EFf{psalm} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFo{shell-command-to-string} \EFs{"\char126{}/.scripts/psalms.sh de"}\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{setq} fancy-splash-last-size nil\EFrda{)}
\EFrda{(}\EFk{setq} fancy-splash-last-theme nil\EFrda{)}
\EFrda{(}\EFk{defun} \EFf{set-appropriate-splash} \EFrdb{(}\EFt{\&rest} \_\EFrdb{)}
   \EFrdb{(}\EFk{setq} \EFv{fancy-splash-image} \EFrdc{(}\EFf{get-pope-image}\EFrdc{)}\EFrdb{)}
   \EFrdb{(}\EFk{setq} \EFv{+doom-dashboard-banner-padding} \EFhq{'}\EFrdc{(}\EFhn{5} . \EFhn{5}\EFrdc{)}\EFrdb{)}
   \EFrdb{(}\EFk{setq} fancy-splash-last-theme \EFv{doom-theme}\EFrdb{)}
   \EFrdb{(}\EFf{+doom-dashboard-reload}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{window-size-change-functions} \EFhq{\#'}\EFhs{set-appropriate-splash}\EFrda{)}
\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{doom-load-theme-hook} \EFhq{\#'}\EFhs{set-appropriate-splash}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{doom-dashboard-phrase} \EFrdb{(}\EFrdb{)}
  \EFd{"Get a splash phrase, flow it over multiple lines as needed, and make fontify it."}
  \EFrdb{(}\EFo{mapconcat}
   \EFrdc{(}\EFk{lambda} \EFrdd{(}line\EFrdd{)}
     \EFrdd{(}\EFf{+doom-dashboard--center}
      \EFv{+doom-dashboard--width}
      \EFrda{(}\EFk{with-temp-buffer}
        \EFrdb{(}\EFo{insert-text-button}
         line
         \EFhq{'}\EFhs{action}
         \EFrdc{(}\EFk{lambda} \EFrdd{(}\_\EFrdd{)} \EFrdd{(}\EFf{+doom-dashboard-reload} t\EFrdd{)}\EFrdc{)}
         \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-dashboard-menu-title}
         \EFhq{'}\EFhs{mouse-face} \EFhq{'}\EFhs{doom-dashboard-menu-title}
         \EFhq{'}\EFhs{help-echo} currently-displayed-pope
         \EFhq{'}\EFhs{follow-link} t\EFrdb{)}
        \EFrdb{(}\EFo{buffer-string}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
   \EFrdc{(}\EFo{split-string}
    \EFrdd{(}\EFk{with-temp-buffer}
      \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{concat} \EFs{"Seine Heiligkeit "} currently-displayed-pope \EFs{"\char92{}n\char92{}n"} pope-info \EFs{"\char92{}n"} \EFs{"Heiliger Vater, bete für uns."} \EFs{"\char92{}n\char92{}n"}\EFrdb{)}\EFrda{)}
      \EFrda{(}\EFk{setq} \EFv{fill-column} \EFrdb{(}\EFo{min} \EFhn{70} \EFrdc{(}\EFo{/} \EFrdd{(}\EFo{*} \EFhn{2} \EFrda{(}\EFo{window-width}\EFrda{)}\EFrdd{)} \EFhn{3}\EFrdc{)}\EFrdb{)}\EFrda{)}
      \EFrda{(}\EFo{fill-region} \EFrdb{(}\EFo{point-min}\EFrdb{)} \EFrdb{(}\EFo{point-max}\EFrdb{)}\EFrda{)}
      \EFrda{(}\EFo{buffer-string}\EFrda{)}\EFrdd{)}
    \EFs{"\char92{}n"}\EFrdc{)}
   \EFs{"\char92{}n"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defadvice!} doom-dashboard-widget-loaded-with-phrase \EFrdb{(}\EFrdb{)}
  \EFb{:override} \EFhq{\#'}\EFhs{doom-dashboard-widget-loaded}
  \EFrdb{(}\EFk{setq} \EFv{line-spacing} \EFhn{0.2}\EFrdb{)}
  \EFrdb{(}\EFo{insert}
   \EFs{"\char92{}n\char92{}n"}
   \EFrdc{(}\EFo{propertize}
    \EFrdd{(}\EFf{+doom-dashboard--center}
     \EFv{+doom-dashboard--width}
     \EFrda{(}\EFf{doom-display-benchmark-h} \EFhq{'}\EFhs{return}\EFrda{)}\EFrdd{)}
    \EFhq{'}\EFhs{face} \EFhq{'}\EFhs{doom-dashboard-loaded}\EFrdc{)}
   \EFs{"\char92{}n"}
   \EFrdc{(}\EFf{doom-dashboard-phrase}\EFrdc{)}
   \EFrdc{(}\EFf{psalm}\EFrdc{)}
   \EFs{"\char92{}n"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{remove-hook} \EFhq{'}\EFv{+doom-dashboard-functions} \EFhq{\#'}\EFhs{doom-dashboard-widget-shortmenu}\EFrda{)}
\EFrda{(}\EFk{add-hook!} \EFhq{'}\EFv{+doom-dashboard-mode-hook} \EFrdb{(}\EFv{hide-mode-line-mode} \EFhn{1}\EFrdb{)} \EFrdb{(}\EFv{hl-line-mode} \EFhn{-1}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{setq-hook!} \EFhq{'}\EFv{+doom-dashboard-mode-hook} \EFv{evil-normal-state-cursor} \EFrdb{(}\EFo{list} nil\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{popes}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Keycast Tweaks}
\label{sec:orgd02887b}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{keycast-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org980cad5}
\subsubsection{Code}
\label{sec:org23abfeb}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{keycast.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{use-package!} keycast
  \EFb{:commands} \EFv{keycast-mode}
  \EFb{:config}
  \EFrdb{(}\EFk{define-minor-mode} \EFv{keycast-mode}
    \EFd{"Show current command and its key binding in the mode line."}
    \EFb{:global} t
    \EFrdc{(}\EFk{if} \EFv{keycast-mode}
        \EFrdd{(}\EFk{progn}
          \EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{pre-command-hook} \EFhq{'}\EFhs{keycast--update} t\EFrda{)}
          \EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{global-mode-string} \EFhq{'}\EFrdb{(}\EFs{""} \EFv{mode-line-keycast} \EFs{" "}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{remove-hook} \EFhq{'}\EFv{pre-command-hook} \EFhq{'}\EFhs{keycast--update}\EFrdd{)}
      \EFrdd{(}\EFk{setq} \EFv{global-mode-string} \EFrda{(}\EFo{remove} \EFhq{'}\EFrdb{(}\EFs{""} \EFv{mode-line-keycast} \EFs{" "}\EFrdb{)} \EFv{global-mode-string}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{custom-set-faces!}
    \EFhq{'}\EFrdc{(}keycast-command \EFb{:inherit} doom-modeline-debug
                      \EFb{:height} \EFhn{0.9}\EFrdc{)}
    \EFhq{'}\EFrdc{(}keycast-key \EFb{:inherit} custom-modified
                  \EFb{:height} \EFhn{1.1}
                  \EFb{:weight} bold\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{keycast-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsection{Weather}
\label{sec:orgd031e45}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{weather}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org48984a9}
\subsubsection{Code}
\label{sec:orgcba894e}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{wttrin.el --- Emacs frontend for weather web service wttr.in -*- lexical-binding: t; -*-}
\EFcd{;; }\EFc{Copyright (C) 2016 Carl X. Su}

\EFcd{;; }\EFc{Author: Carl X. Su <bcbcarl@gmail.com>}
\EFcd{;;         }\EFc{ono hiroko (kuanyui) <azazabc123@gmail.com>}
\EFcd{;; }\EFc{Version: 0.2.0}
\EFcd{;; }\EFc{Package-Requires: ((emacs "24.4") (xterm-color "1.0"))}
\EFcd{;; }\EFc{Keywords: comm, weather, wttrin}
\EFcd{;; }\EFc{URL: https://github.com/bcbcarl/emacs-wttrin}
\EFcd{;;}
\EFcd{;; }\EFc{Modifications made by @tecosaur}

\EFcd{;;; }\EFc{Commentary:}

\EFcd{;; }\EFc{Provides the weather information from wttr.in based on your query condition.}

\EFcd{;;; }\EFc{Code:}

\EFrda{(}\EFo{require} \EFhq{'}\EFo{url}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{xterm-color}\EFrda{)}

\EFrda{(}\EFk{defgroup} \EFt{wttrin} nil
  \EFd{"Emacs frontend for weather web service wttr.in."}
  \EFb{:prefix} \EFs{"wttrin-"}
  \EFb{:group} \EFhq{'}\EFhs{comm}\EFrda{)}

\EFrda{(}\EFk{defcustom} \EFv{wttrin-default-api-version} \EFhn{1}
  \EFd{"Specifies which version of the wttrin API to use."}
  \EFb{:group} \EFhq{'}\EFhs{wttrn}
  \EFb{:type} \EFhq{'}\EFrdb{(}choice \EFrdc{(}const \EFhn{1}\EFrdc{)} \EFrdc{(}const \EFhn{2}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defcustom} \EFv{wttrin-default-cities} \EFhq{'}\EFrdb{(}\EFs{"Amsterdam"}
                                   \EFs{"Baghdad"}
                                   \EFs{"Beijing"}
                                   \EFs{"Brussels"}
                                   \EFs{"Buenos Aires"}
                                   \EFs{"Cairo"}
                                   \EFs{"Delhi"}
                                   \EFs{"Gurnsey"}
                                   \EFs{"Ho Chi Ming City"}
                                   \EFs{"Hong Kong"}
                                   \EFs{"Istanbul"}
                                   \EFs{"Johannesburg"}
                                   \EFs{"Köln"}
                                   \EFs{"Kuala Lumpur"}
                                   \EFs{"Leipzig"}
                                   \EFs{"Lima"}
                                   \EFs{"London"}
                                   \EFs{"Madrid"}
                                   \EFs{"Manila"}
                                   \EFs{"Mexico City"}
                                   \EFs{"Miami"}
                                   \EFs{"Moscow"}
                                   \EFs{"Mumbai"}
                                   \EFs{"München"}
                                   \EFs{"New York"}
                                   \EFs{"Nijmegen"}
                                   \EFs{"Paris"}
                                   \EFs{"Seoul"}
                                   \EFs{"Shanghai"}
                                   \EFs{"Singapore"}
                                   \EFs{"Surat"}
                                   \EFs{"Sydney"}
                                   \EFs{"Tokyo"}
                                   \EFs{"Toronto"}
                                   \EFcd{;; }\EFc{and the fun one!}
                                   \EFs{"Moon"}\EFrdb{)}
  \EFd{"Specify default cities list for quick completion."}
  \EFb{:group} \EFhq{'}\EFhs{wttrin}
  \EFb{:type} \EFhq{'}\EFhs{list}\EFrda{)}

\EFrda{(}\EFk{defcustom} \EFv{wttrin-default-accept-language} \EFhq{'}\EFrdb{(}\EFs{"Accept-Language"} . \EFs{"en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4"}\EFrdb{)}
  \EFd{"Specify default HTTP request Header for Accept-Language."}
  \EFb{:group} \EFhq{'}\EFhs{wttrin}
  \EFb{:type} \EFhq{'}\EFrdb{(}list\EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{wttrin-fetch-raw-string} \EFrdb{(}query \EFt{\&optional} api-version\EFrdb{)}
  \EFd{"Get the weather information based on your QUERY."}
  \EFrdb{(}\EFk{unless} api-version \EFrdc{(}\EFk{setq} api-version \EFv{wttrin-default-api-version}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}\EFv{url-user-agent} \EFs{"curl"}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{add-to-list} \EFhq{'}\EFv{url-request-extra-headers} \EFv{wttrin-default-accept-language}\EFrdc{)}
    \EFrdc{(}\EFk{with-current-buffer}
        \EFrdd{(}\EFo{url-retrieve-synchronously}
         \EFrda{(}\EFo{concat} \EFs{"http://v"} \EFrdb{(}\EFo{number-to-string} api-version\EFrdb{)} \EFs{".wttr.in/"} query\EFrda{)}
         \EFrda{(}\EFk{lambda} \EFrdb{(}status\EFrdb{)} \EFrdb{(}\EFo{switch-to-buffer} \EFrdc{(}\EFo{current-buffer}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{decode-coding-string} \EFrda{(}\EFo{buffer-string}\EFrda{)} \EFhq{'}\EFhs{utf-8}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{wttrin-exit} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{quit-window} t\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{wttrin-query} \EFrdb{(}city-name \EFt{\&optional} api-version\EFrdb{)}
  \EFd{"Query weather of CITY-NAME via wttrin, and display the result in new buffer."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}raw-string \EFrda{(}\EFf{wttrin-fetch-raw-string} city-name api-version\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{string-match} \EFs{"ERROR"} raw-string\EFrdd{)}
        \EFrdd{(}\EFo{message} \EFs{"Cannot get weather data. Maybe you inputed a wrong city name?"}\EFrdd{)}
      \EFrdd{(}\EFk{let} \EFrda{(}\EFrdb{(}buffer \EFrdc{(}\EFo{get-buffer-create} \EFrdd{(}\EFo{format} \EFs{"*wttr.in - \%s*"} city-name\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{switch-to-buffer} buffer\EFrda{)}
        \EFrda{(}\EFk{setq} \EFv{buffer-read-only} nil\EFrda{)}
        \EFrda{(}\EFo{erase-buffer}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFrdb{(}\EFo{xterm-color-filter} raw-string\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{goto-char} \EFrdb{(}\EFo{point-min}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{save-excursion}
          \EFrdb{(}\EFo{re-search-forward} \EFs{"\char94{}\$"}\EFrdb{)}
          \EFrdb{(}\EFo{delete-region} \EFrdc{(}\EFo{point-min}\EFrdc{)} \EFrdc{(}\EFo{1+} \EFrdd{(}\EFo{point}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFk{save-excursion}
          \EFrdb{(}\EFk{while}  \EFrdc{(}\EFo{re-search-forward} \EFs{"(B"} nil t\EFrdc{)}
            \EFrdc{(}\EFo{delete-region} \EFrdd{(}\EFo{match-beginning} \EFhn{0}\EFrdd{)} \EFrdd{(}\EFo{match-end} \EFhn{0}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{use-local-map} \EFrdb{(}\EFo{make-sparse-keymap}\EFrdb{)}\EFrda{)}
        \EFrda{(}\EFo{local-set-key} \EFs{"q"} \EFhq{'}\EFhs{wttrin-exit}\EFrda{)}
        \EFrda{(}\EFo{local-set-key} \EFs{"g"} \EFhq{'}\EFhs{wttrin}\EFrda{)}
        \EFrda{(}\EFk{setq} \EFv{buffer-read-only} t\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{defun} \EFf{wttrin} \EFrdb{(}city \EFt{\&optional} api-version\EFrdb{)}
  \EFd{"Display weather information for CITY."}
  \EFrdb{(}\EFk{interactive}
   \EFrdc{(}\EFk{cond} \EFrdd{(}\EFrda{(}\EFo{equal} \EFv{current-prefix-arg} nil\EFrda{)}
          \EFrda{(}\EFo{list} \EFs{""} nil\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFrda{(}\EFo{equal} \EFv{current-prefix-arg} \EFhn{1}\EFrda{)}
          \EFrda{(}\EFo{list} \EFs{""} \EFhn{1}\EFrda{)}\EFrdd{)}
         \EFrdd{(}\EFrda{(}\EFo{equal} \EFv{current-prefix-arg} \EFhn{2}\EFrda{)}
          \EFrda{(}\EFo{list} \EFs{""} \EFhn{2}\EFrda{)}\EFrdd{)}
         \EFrdd{(}t \EFrda{(}\EFo{list}
             \EFrdb{(}\EFo{completing-read} \EFs{"City name: "} \EFv{wttrin-default-cities} nil nil
                              \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{=} \EFrda{(}\EFo{length} \EFv{wttrin-default-cities}\EFrda{)} \EFhn{1}\EFrdd{)}
                                \EFrdd{(}\EFo{car} \EFv{wttrin-default-cities}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFf{wttrin-query} city api-version\EFrdb{)}\EFrda{)}

\end{Verbatim}
\end{Code}

\subsection{Org Tweaks}
\label{sec:orga75e2b0}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgb3e5aec}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{package!} engrave-faces\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Code}
\label{sec:orgc00c02f}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{org-tweaks.el -*- lexical-binding: t; -*-}
\EFcd{;;; }\EFc{Code:}
\EFrda{(}\EFk{after!} org
  \EFrdb{(}\EFk{ifdirexists} \EFs{"\char126{}/sync/org/"}
               \EFrdc{(}\EFk{setq} \EFv{org-directory} dir\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{ifdirexists} \EFs{"\char126{}/sync/agenda"}
               \EFrdc{(}\EFk{setq} \EFv{org-agenda-files} \EFrdd{(}\EFo{directory-files} \EFs{"\char126{}/sync/agenda/"} t \EFrda{(}\EFk{rx} \EFs{".org"} eos\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{setq} \EFv{org-todo-keywords} \EFhq{'}\EFrdc{(}\EFrdd{(}sequence \EFs{"}\textcolor[HTML]{ECBE7B}{\textbf{TODO}}\EFs{(t)"} \EFs{"LECT(l)"} \EFs{"EXAM(e)"} \EFs{"MEET(m)"} \EFs{"PROJ(p)"} \EFs{"LOOP(L)"} \EFs{"START(s)"} \EFs{"WAIT(w)"} \EFs{"HOLD(h)"} \EFs{"IDEA(i)"} \EFs{"INPRO(n)"} \EFs{"OPT(o)"} \EFs{"READ(r)"} \EFs{"|"} \EFs{"DONE(d)"} \EFs{"KILL(k)"}\EFrdd{)}
                            \EFrdd{(}sequence \EFs{"[ ](T)"} \EFs{"[-](S)"} \EFs{"[?](W)"} \EFs{"|"} \EFs{"[X](D)"}\EFrdd{)}
                            \EFrdd{(}sequence \EFs{"|"} \EFs{"OKAY(O)"} \EFs{"YES(Y)"} \EFs{"NO(N)"}\EFrdd{)}\EFrdc{)}
        \EFv{org-startup-folded} t
        \EFv{org-log-done} \EFhq{'}\EFhs{time}
        \EFv{org-log-reschedule} \EFhq{'}\EFhs{time}
        \EFv{initial-major-mode} \EFhq{'}\EFhs{org-mode}
        \EFv{org-export-async-init-file} \EFs{"/home/user/.doom.d/ext/export/org-export-init.el"}
        \EFv{org-latex-src-block-backend} \EFhq{'}\EFhs{engraved}\EFrdb{)}

  \EFcd{;;; }\EFc{Add org mode to txt and archive files}
  \EFrdb{(}\EFo{add-to-list} \EFhq{'}\EFv{auto-mode-alist} \EFhq{'}\EFrdc{(}\EFs{"\char92{}\char92{}.}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{org}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{org\_archive}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{|}}\EFs{txt}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\$"} . org-mode\EFrdc{)}\EFrdb{)}

  \EFcd{;; }\EFc{Org Babel}
  \EFrdb{(}\EFk{setq} \EFv{org-confirm-babel-evaluate} nil
        \EFv{org-src-fontify-natively} t
        \EFv{org-src-tab-acts-natively} t
        \EFv{org-auto-tangle-default} t\EFrdb{)}
  \EFcd{;; }\EFc{Auto tangle}
  \EFrdb{(}\EFo{add-hook} \EFhq{'}\EFv{org-mode-hook} \EFhq{'}\EFv{org-auto-tangle-mode}\EFrdb{)}
\EFrda{)}

\EFrda{(}\EFk{setq} beancount-main-file \EFs{"/media/user/keychain/finances/wallet.beancount"}
      beancount-local-file \EFs{"\char126{}/dox/notes/wallet.org"}\EFrda{)}
\EFcd{;; }\EFc{Capture}
\EFrda{(}\EFk{setq} \EFv{org-default-notes-file} \EFs{"\char126{}/dox/notes/notes.org"}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{org-capture-templates}
      \EFhq{'}\EFrdb{(}\EFrdc{(}\EFs{"b"} \EFs{"Beancount Entry"} plain
         \EFrdd{(}file beancount-local-file\EFrdd{)}
         \EFcd{;}\EFc{"\%(progn (yas-expand-snippet (yas-lookup-snippet \char92{}"beancount\char92{}" 'org-mode)) nil)")))}
         \EFs{"bc"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-agenda-export-to-ics} \EFrdb{(}\EFrdb{)}
  \EFd{"Exports current org agenda buffer to ics, treating DEADLINES as dates"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{with-temp-buffer}
    \EFrdc{(}\EFo{cl-map} \EFhq{'}\EFhs{nil} \EFhq{\#'}\EFhs{insert-file-contents} \EFv{org-agenda-files}\EFrdc{)}
    \EFrdc{(}\EFf{replace-regexp-entire-buffer} \EFs{"<.*> }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{<.*>}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFs{"\char92{}\char92{}1"}\EFrdc{)}
    \EFrdc{(}\EFf{replace-regexp-entire-buffer} \EFs{"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{<.*>}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{ <.*>"} \EFs{"\char92{}\char92{}1"}\EFrdc{)}
    \EFrdc{(}\EFf{replace-regexp-entire-buffer} \EFs{"SCHEDULED: }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{<.*>}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFs{"\char92{}\char92{}1"}\EFrdc{)}
    \EFrdc{(}\EFf{replace-regexp-entire-buffer} \EFs{"DEADLINE: }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{<.*>}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{"} \EFs{"\char92{}\char92{}1"}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFrdd{(}\EFo{org-icalendar-export-to-ics}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Languages}
\label{sec:org165fa8c}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{languages}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org6dd0610}
\subsubsection{Code}
\label{sec:org1993a56}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{languages.el -*- lexical-binding: t; -*-}

\EFcd{;; }\EFc{Rust}
\EFrda{(}\EFk{setq} rustic-format-trigger \EFhq{'}\EFhs{on-save}
      rustic-format-on-save t\EFrda{)}

\EFcd{;; }\EFc{Latin}
\EFcd{;;}

\EFcd{;;;}\EFc{\#\#\#}\textcolor[HTML]{ECBE7B}{autoload}
\EFrda{(}\EFk{define-minor-mode} \EFv{latin-minor-mode}
  \EFd{"Minor mode for writing Church Latin"}
  \EFb{:lighter} \EFs{" ☧"}
  \EFb{:global} t\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{latin-minor-mode--insert-ae} \EFrdb{(}\EFrdb{)}
  \EFd{"Replace ae with æ"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{bound-and-true-p} \EFv{latin-minor-mode}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFrda{(}\EFo{char-before}\EFrda{)} ?a\EFrdd{)}
      \EFrdd{(}\EFk{progn}
        \EFrda{(}\EFo{backward-delete-char} \EFhn{1}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFs{"æ"}\EFrda{)}\EFrdd{)}
    \EFrdd{(}\EFk{if} \EFrda{(}\EFo{eq} \EFrdb{(}\EFo{char-before}\EFrdb{)} ?A\EFrda{)}
        \EFrda{(}\EFk{progn}
          \EFrdb{(}\EFo{backward-delete-char} \EFhn{1}\EFrdb{)}
          \EFrdb{(}\EFo{insert} \EFs{"Æ"}\EFrdb{)}
          \EFrda{)}
      \EFrda{(}\EFo{insert} \EFs{"e"}\EFrda{)}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{self-insert-command} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{latin-minor-mode--insert-versicle} \EFrdb{(}\EFrdb{)}
  \EFd{"Replace VV with ℣"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{bound-and-true-p} \EFv{latin-minor-mode}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFrda{(}\EFo{char-before}\EFrda{)} ?V\EFrdd{)}
      \EFrdd{(}\EFk{progn}
        \EFrda{(}\EFo{backward-delete-char} \EFhn{1}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFs{"℣"}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"V"}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{self-insert-command} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{latin-minor-mode--insert-response} \EFrdb{(}\EFrdb{)}
  \EFd{"Replace RR with ℟"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFk{bound-and-true-p} \EFv{latin-minor-mode}\EFrdc{)}
  \EFrdc{(}\EFk{if} \EFrdd{(}\EFo{eq} \EFrda{(}\EFo{char-before}\EFrda{)} ?R\EFrdd{)}
      \EFrdd{(}\EFk{progn}
        \EFrda{(}\EFo{backward-delete-char} \EFhn{1}\EFrda{)}
        \EFrda{(}\EFo{insert} \EFs{"℟"}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{insert} \EFs{"R"}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{self-insert-command} \EFhn{1}\EFrdc{)}\EFrdb{)}\EFrda{)}



\EFrda{(}\EFk{map!} \EFb{:map} latin-minor-mode-map
      \EFb{:n} \EFs{"e"} \EFhq{\#'}\EFhs{latin-minor-mode--insert-ae}
      \EFb{:n} \EFs{"R"} \EFhq{\#'}\EFhs{latin-minor-mode--insert-response}
      \EFb{:n} \EFs{"V"} \EFhq{\#'}\EFhs{latin-minor-mode--insert-versicle}\EFrda{)}

\EFcd{;; }\EFc{For some reason, that doesn't work...}
\EFcd{;;}\EFc{(progn}
\EFcd{;;  }\EFc{(global-set-key (kbd "e") 'latin-minor-mode--insert-ae)}
\EFcd{;;  }\EFc{(global-set-key (kbd "R") 'latin-minor-mode--insert-response)}
\EFcd{;;  }\EFc{(global-set-key (kbd "V") 'latin-minor-mode--insert-versicle))}
\EFrda{(}\EFo{provide} \EFhq{'}\EFo{languages}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Email}
\label{sec:orga1f915a}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module-if} \EFhq{'}\EFhs{mu4e} \EFhq{'}\EFhs{email}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org4551dd8}
\subsubsection{Code}
\label{sec:org310e984}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{email.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} mu4e-mu-binary \EFs{"/bin/mu"}\EFrda{)}

\EFcd{;;; }\EFc{mu4e reindexing when tmp file exists}
\EFrda{(}\EFk{after!} mu4e
  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request-file} \EFs{"/tmp/mu\_reindex\_now"}
    \EFd{"Location of the reindex request, signaled by existance"}\EFrdb{)}
  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request-min-seperation} \EFhn{5.0}
    \EFd{"Don't refresh again until this many second have elapsed.
Prevents a series of redisplays from being called (when set to an appropriate value)"}\EFrdb{)}

  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request--file-watcher} nil\EFrdb{)}
  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request--file-just-deleted} nil\EFrdb{)}
  \EFrdb{(}\EFk{defvar} \EFv{mu4e-reindex-request--last-time} \EFhn{0}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{mu4e-reindex-request--add-watcher} \EFrdc{(}\EFrdc{)}
    \EFrdc{(}\EFk{setq} mu4e-reindex-request--file-just-deleted nil\EFrdc{)}
    \EFrdc{(}\EFk{setq} mu4e-reindex-request--file-watcher
          \EFrdd{(}\EFo{file-notify-add-watch} mu4e-reindex-request-file
                                 \EFhq{'}\EFrda{(}change\EFrda{)}
                                 \EFhq{\#'}\EFhs{mu4e-file-reindex-request}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defadvice!} mu4e-stop-watching-for-reindex-request \EFrdc{(}\EFrdc{)}
    \EFb{:after} \EFhq{\#'}\EFhs{mu4e\char126{}proc-kill}
    \EFrdc{(}\EFk{if} mu4e-reindex-request--file-watcher
        \EFrdd{(}\EFo{file-notify-rm-watch} mu4e-reindex-request--file-watcher\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defadvice!} mu4e-watch-for-reindex-request \EFrdc{(}\EFrdc{)}
    \EFb{:after} \EFhq{\#'}\EFhs{mu4e\char126{}proc-start}
    \EFrdc{(}mu4e-stop-watching-for-reindex-request\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{file-exists-p} mu4e-reindex-request-file\EFrdd{)}
      \EFrdd{(}\EFo{delete-file} mu4e-reindex-request-file\EFrdd{)}\EFrdc{)}
    \EFrdc{(}mu4e-reindex-request--add-watcher\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{mu4e-file-reindex-request} \EFrdc{(}event\EFrdc{)}
    \EFd{"Act based on the existance of `}\textcolor[HTML]{a9a1e1}{mu4e-reindex-request-file}\EFd{'"}
    \EFrdc{(}\EFk{if} mu4e-reindex-request--file-just-deleted
        \EFrdd{(}mu4e-reindex-request--add-watcher\EFrdd{)}
      \EFrdd{(}\EFk{when} \EFrda{(}\EFo{equal} \EFrdb{(}\EFo{nth} \EFhn{1} event\EFrdb{)} \EFhq{'}\EFhs{created}\EFrda{)}
        \EFrda{(}\EFo{delete-file} mu4e-reindex-request-file\EFrda{)}
        \EFrda{(}\EFk{setq} mu4e-reindex-request--file-just-deleted t\EFrda{)}
        \EFrda{(}mu4e-reindex-maybe t\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}

  \EFrdb{(}\EFk{defun} \EFf{mu4e-reindex-maybe} \EFrdc{(}\EFt{\&optional} new-request\EFrdc{)}
    \EFd{"Run `}\textcolor[HTML]{a9a1e1}{mu4e\char126{}proc-index}\EFd{' if it's been more than
`}\textcolor[HTML]{a9a1e1}{mu4e-reindex-request-min-seperation}\EFd{'seconds since the last request,"}
    \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}time-since-last-request \EFrdb{(}\EFo{-} \EFrdc{(}\EFo{float-time}\EFrdc{)}
                                      mu4e-reindex-request--last-time\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{when} new-request
        \EFrda{(}\EFk{setq} mu4e-reindex-request--last-time \EFrdb{(}\EFo{float-time}\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFk{if} \EFrda{(}\EFo{>} time-since-last-request mu4e-reindex-request-min-seperation\EFrda{)}
          \EFrda{(}mu4e\char126{}proc-index nil t\EFrda{)}
        \EFrda{(}\EFk{when} new-request
          \EFrdb{(}\EFo{run-at-time} \EFrdc{(}\EFo{*} \EFhn{1.1} mu4e-reindex-request-min-seperation\EFrdc{)} nil
                       \EFhq{\#'}\EFhs{mu4e-reindex-maybe}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{email}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Email Config}
\label{sec:org566cb76}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module-if} \EFhq{'}\EFhs{mu4e} \EFhq{'}\EFhs{email-config}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orga5a798f}
\subsubsection{Code}
\label{sec:org6b0721f}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{email-config.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFo{require} \EFhq{'}\EFo{mu4e}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{smtpmail}\EFrda{)}
\EFrda{(}\EFo{define-key} mu4e-view-mode-map \EFrdb{(}\EFo{kbd} \EFs{"f"}\EFrdb{)} \EFhq{'}\EFhs{mu4e-view-go-to-url}\EFrda{)}

\EFrda{(}\EFk{setq} mu4e-root-maildir \EFs{"\char126{}/mail"}
      \EFcd{;}\EFc{mu4e-get-mail-command "offlineimap -q -f INBOX"}
      mu4e-get-mail-command \EFs{"mbsync -a || true"}
      mu4e-update-interval \EFhn{300} \EFcd{;; }\EFc{second}
      mu4e-compose-signature-auto-include nil
      mu4e-view-show-images t
      mu4e-view-prefer-html t
      mu4e-html2text-command \EFs{"iconv -c -t utf-8 | pandoc -f html -t plain"}
      mu4e-headers-auto-update t
      mu4e-compose-format-flowed t
      smtpmail-stream-type \EFhq{'}\EFhs{starttls}
      mu4e-view-show-addresses t
      mu4e-split-view \EFhq{'}\EFhs{single-window} \EFcd{;; }\EFc{horizontal (default), vertical}
      mu4e-attachment-dir \EFs{"\char126{}/Downloads"}
      smtpmail-queue-mail nil
      smtpmail-queue-dir \EFs{"\char126{}/mail/queue/cur"}
      mu4e-compose-in-new-frame nil
      mu4e-compose-dont-reply-to-self t
      mu4e-headers-date-format \EFs{"\%Y-\%m-\%d \%H:\%M"}
      \EFv{message-kill-buffer-on-exit} nil
      mu4e-confirm-quit nil
      mu4e-context-policy \EFhq{'}\EFhs{ask-if-none}
      mu4e-compose-context-policy \EFhq{'}\EFhs{always-ask}
      mu4e-headers-results-limit \EFhn{500}
      mu4e-use-fancy-chars t\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{mu4e--view-quit-and-back} \EFrdb{(}\EFrdb{)}
  \EFd{"Quit mu4e view buffer and go back to mu4e"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}mu4e\char126{}view-quit-buffer\EFrdb{)}
  \EFrdb{(}\EFf{=mu4e}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{mu4e--goto-inbox} \EFrdb{(}\EFrdb{)}
  \EFd{"Goto mu4e inbox"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}mu4e\char126{}headers-jump-to-maildir \EFs{"/gmail/INBOX"}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{map!} \EFb{:map} mu4e-view-mode-map
      \EFb{:after} mu4e-view
      \EFb{:n} \EFs{"<backspace>"} \EFhq{'}\EFhs{mu4e--view-quit-and-back}\EFrda{)}

\EFrda{(}\EFo{global-set-key} \EFrdb{(}\EFo{kbd} \EFs{"s-m"}\EFrdb{)} \EFhq{'}\EFhs{mu4e--goto-inbox}\EFrda{)}

\EFrda{(}\EFk{when} \EFrdb{(}\EFo{fboundp} \EFhq{'}\EFhs{imagemagick-register-types}\EFrdb{)}
  \EFrdb{(}\EFo{imagemagick-register-types}\EFrdb{)}\EFrda{)}

\EFcd{;}\EFc{(require 'org-mu4e)}
\EFcd{;}\EFc{(setq org-mu4e-convert-to-html t}
\EFcd{;}\EFc{org-mu4e-link-query-in-headers-mode nil)}

\EFrda{(}\EFo{require} \EFhq{'}\EFo{org-mime}\EFrda{)}

\EFcd{;; }\EFc{this seems to fix the babel file saving thing}
\EFrda{(}\EFk{defun} \EFf{org\char126{}mu4e-mime-replace-images} \EFrdb{(}str current-file\EFrdb{)}
\EFd{"Replace images in html files with cid links."}
\EFrdb{(}\EFk{let} \EFrdc{(}html-images\EFrdc{)}
\EFrdc{(}\EFo{cons}
\EFrdd{(}\EFo{replace-regexp-in-string} \EFcd{;; }\EFc{replace images in html}
\EFs{"src=\char92{}"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{\char92{}"]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}""}
\EFrda{(}\EFk{lambda} \EFrdb{(}text\EFrdb{)}
\EFrdb{(}\EFo{format}
        \EFs{"src=\char92{}"./:\%s\char92{}""}
        \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}url \EFrdb{(}\EFk{and} \EFrdc{(}\EFo{string-match} \EFs{"src=\char92{}"}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{[}\textcolor[HTML]{51afef}{\textbf{\char94{}}}\EFs{\char92{}"]+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}""} text\EFrdc{)}
                        \EFrdc{(}\EFo{match-string} \EFhn{1} text\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}path \EFrdb{(}\EFo{expand-file-name}
                url \EFrdc{(}\EFo{file-name-directory} current-file\EFrdc{)}\EFrdb{)}\EFrda{)}
        \EFrda{(}ext \EFrdb{(}\EFo{file-name-extension} path\EFrdb{)}\EFrda{)}
        \EFrda{(}id \EFrdb{(}\EFo{replace-regexp-in-string} \EFs{"[}\textcolor[HTML]{ECBE7B}{\char92{}}\EFs{/\char92{}\char92{}\char92{}\char92{}]"} \EFs{"\_"} path\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFo{add-to-list} \EFhq{'}\EFhs{html-images}
                \EFrda{(}org\char126{}mu4e-mime-file
                \EFrdb{(}\EFo{concat} \EFs{"image/"} ext\EFrdb{)} path id\EFrda{)}\EFrdd{)}
        id\EFrdc{)}\EFrdb{)}\EFrda{)}
str\EFrdd{)}
html-images\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFhs{mu4e-view-actions}
\EFhq{'}\EFrdb{(}\EFs{"ViewInBrowser"} . mu4e-action-view-in-browser\EFrdb{)} t\EFrda{)}


\EFrda{(}\EFo{provide} \EFhq{'}\EFo{email-config}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Email Accounts}
\label{sec:org664d186}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module-if} \EFhq{'}\EFhs{mu4e} \EFhq{'}\EFhs{email-accounts}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orge096980}
\subsubsection{Code}
\label{sec:org1d66a4a}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;; }\EFc{Email Accounts}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{email-refile}\EFrda{)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{smtpmail}\EFrda{)}
\EFrda{(}\EFk{setq} +mu4e-gmail-accounts \EFhq{'}\EFrdb{(}\EFrdc{(}\EFs{"e.p.mysliwietz@gmail.com"} . \EFs{"/gmail"}\EFrdc{)}\EFrdb{)}
      mu4e-contexts
      \EFhq{`}\EFrdb{(}
       ,\EFrdc{(}make-mu4e-context
	  \EFb{:name} \EFs{"gmail"}
	  \EFb{:enter-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}mu4e-message \EFs{"Switching to gmail context"}\EFrda{)}\EFrdd{)}
	  \EFb{:leave-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}mu4e-message \EFs{"Leaving gmail context"}\EFrda{)}\EFrdd{)}
	  \EFb{:vars} \EFhq{'}\EFrdd{(}
		  \EFrda{(} \EFv{user-full-name}	         . \EFs{"Egidius Mysliwietz"} \EFrda{)}
		  \EFrda{(} \EFv{user-mail-address}	         . \EFs{"e.p.mysliwietz@gmail.com"} \EFrda{)}
                  \EFrda{(} smtpmail-mail-address        . \EFs{"e.p.mysliwietz@gmail.com"}\EFrda{)}
		  \EFrda{(} smtpmail-smtp-user           . \EFs{"e.p.mysliwietz@gmail.com"}\EFrda{)}
		  \EFrda{(} mu4e-drafts-folder           . \EFs{"/gmail/[Gmail]/Entwürfe"} \EFrda{)}
                  \EFrda{(} mu4e-sent-folder             . \EFs{"/gmail/[Gmail]/Gesendet"} \EFrda{)}
		  \EFrda{(} mu4e-trash-folder            . \EFs{"/gmail/[Gmail]/Papierkorb"} \EFrda{)}
		  \EFrda{(} mu4e-refile-folder           . gmail-refile \EFrda{)}
                  \EFrda{(} smtpmail-default-smtp-server . \EFs{"smtp.gmail.com"} \EFrda{)}
                  \EFrda{(} smtpmail-smtp-server         . \EFs{"smtp.gmail.com"} \EFrda{)}
		  \EFrda{(} smtpmail-local-domain        . \EFs{"gmail.com"} \EFrda{)}
                  \EFrda{(} smtpmail-smtp-service        . \EFhn{587} \EFrda{)}
		  \EFrdd{)}\EFrdc{)}
        ,\EFrdc{(}make-mu4e-context
	  \EFb{:name} \EFs{"emysliwietz"}
	  \EFb{:enter-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}mu4e-message \EFs{"Switching to egidius context"}\EFrda{)}\EFrdd{)}
          \EFb{:leave-func} \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}mu4e-message \EFs{"Leaving egidius context"}\EFrda{)}\EFrdd{)}
	  \EFcd{;; }\EFc{we match based on the contact-fields of the message}
	  \EFb{:vars} \EFhq{'}\EFrdd{(}
		  \EFrda{(} \EFv{user-full-name}               . \EFs{"Egidius Mysliwietz"} \EFrda{)}
		  \EFrda{(} \EFv{user-mail-address}	         . \EFs{"egidius@mysliwietz.de"}  \EFrda{)}
                  \EFrda{(} smtpmail-mail-address        . \EFs{"egidius@mysliwietz.de"}\EFrda{)}
		  \EFrda{(} smtpmail-smtp-user           . \EFs{"egidius@mysliwietz.de"}\EFrda{)}
		  \EFrda{(} mu4e-archive-folder          . \EFs{"/egidius/Archive"} \EFrda{)}
		  \EFrda{(} mu4e-drafts-folder           . \EFs{"/egidius/Drafts"} \EFrda{)}
                  \EFrda{(} mu4e-sent-folder             . \EFs{"/egidius/Sent"} \EFrda{)}
		  \EFrda{(} mu4e-trash-folder            . \EFs{"/egidius/Trash"} \EFrda{)}
		  \EFrda{(} mu4e-refile-folder           . gmail-refile \EFrda{)}
                  \EFrda{(} smtpmail-default-smtp-server . \EFs{"smtp.strato.de"} \EFrda{)}
                  \EFrda{(} smtpmail-smtp-server         . \EFs{"smtp.strato.de"} \EFrda{)}
		  \EFrda{(} smtpmail-local-domain        . \EFs{"strato.de"} \EFrda{)}
                  \EFrda{(} smtpmail-smtp-service        . \EFhn{465} \EFrda{)}
		  \EFrdd{)}\EFrdc{)}
      \EFcd{;}\EFc{,(make-mu4e-context}
	  \EFcd{;}\EFc{:name "xgmx"}
	  \EFcd{;}\EFc{:enter-func (lambda () (mu4e-message "Switching to gmx context"))}
	  \EFcd{;}\EFc{:leave-func (lambda () (mu4e-message "Leaving gmx context"))}
	  \EFcd{;}\EFc{:vars '(}
		  \EFcd{;}\EFc{( user-full-name	         . "Egidius Mysliwietz" )}
		  \EFcd{;}\EFc{( user-mail-address	         . "egidius.mysliwietz@gmx.de" )}
                  \EFcd{;}\EFc{( smtpmail-mail-address        . "egidius.mysliwietz@gmx.de")}
		  \EFcd{;}\EFc{( smtpmail-smtp-user           . "egidius.mysliwietz@gmx.de")}
		  \EFcd{;}\EFc{( mu4e-archive-folder          . "/gmx/Archiv" )}
		  \EFcd{;}\EFc{( mu4e-drafts-folder           . "/gmx/Entwürfe" )}
                  \EFcd{;}\EFc{( mu4e-sent-folder             . "/gmx/Gesendet" )}
		  \EFcd{;}\EFc{( mu4e-trash-folder            . "/gmx/Gelöscht" )}
                  \EFcd{;}\EFc{( smtpmail-default-smtp-server . "mail.gmx.net" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-server         . "mail.gmx.net" )}
		  \EFcd{;}\EFc{( smtpmail-local-domain        . "gmx.net" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-service        . 465 )}
		  \EFcd{;}\EFc{))}
       \EFcd{;}\EFc{,(make-mu4e-context}
	  \EFcd{;}\EFc{:name "radboud"}
	  \EFcd{;}\EFc{:enter-func (lambda () (mu4e-message "Switch to radboud context"))}
	  \EFcd{;}\EFc{:leave-func (lambda () (mu4e-message "Leaving radboud context"))}
	  \EFcd{;}\EFc{:vars '(}
		  \EFcd{;}\EFc{( user-full-name	         . "Egidius Mysliwietz" )}
		  \EFcd{;}\EFc{( user-mail-address	         . "e.mysliwietz@student.ru.nl" )}
                  \EFcd{;}\EFc{( smtpmail-mail-address        . "e.mysliwietz@student.ru.nl")}
		  \EFcd{;}\EFc{( smtpmail-smtp-user           . "s1000796")}
		  \EFcd{;}\EFc{( mu4e-drafts-folder           . "/radboud/Drafts" )}
                  \EFcd{;}\EFc{( mu4e-sent-folder             . "/radboud/Sent Items" )}
		  \EFcd{;}\EFc{( mu4e-trash-folder            . "/radboud/Trash" )}
                  \EFcd{;}\EFc{( smtpmail-default-smtp-server . "smtp-auth.ru.nl" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-server         . "smtp-auth.ru.nl" )}
		  \EFcd{;}\EFc{( smtpmail-local-domain        . "ru.nl" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-service        . 587 )}
		  \EFcd{;}\EFc{))}
       \EFcd{;}\EFc{,(make-mu4e-context}
	  \EFcd{;}\EFc{:name "eindhoven"}
	  \EFcd{;}\EFc{:enter-func (lambda () (mu4e-message "Switch to eindhoven context"))}
	  \EFcd{;}\EFc{:leave-func (lambda () (mu4e-message "Leaving eindhoven context"))}
	  \EFcd{;}\EFc{:vars '(}
		  \EFcd{;}\EFc{( user-full-name	         . "Egidius Mysliwietz" )}
		  \EFcd{;}\EFc{( user-mail-address	         . "e.p.j.mysliwietz@student.tue.nl" )}
                  \EFcd{;}\EFc{( smtpmail-mail-address        . "e.p.j.mysliwietz@student.tue.nl")}
		  \EFcd{;}\EFc{( smtpmail-smtp-user           . "e.p.j.mysliwietz@student.tue.nl")}
                  \EFcd{;}\EFc{( mu4e-archive-folder          . "/eindhoven/Archive" )}
		  \EFcd{;}\EFc{( mu4e-drafts-folder           . "/eindhoven/Drafts" )}
                  \EFcd{;}\EFc{( mu4e-sent-folder             . "/eindhoven/Sent Items" )}
		  \EFcd{;}\EFc{( mu4e-trash-folder            . "/eindhoven/Trash" )}
                  \EFcd{;}\EFc{( smtpmail-default-smtp-server . "smtp.office365.com" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-server         . "smtp.office365.com" )}
		  \EFcd{;}\EFc{( smtpmail-local-domain        . "office365.com" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-service        . 587 )}
		  \EFcd{;}\EFc{))}
       \EFcd{;}\EFc{,(make-mu4e-context}
	  \EFcd{;}\EFc{:name "ntu"}
	  \EFcd{;}\EFc{:enter-func (lambda () (mu4e-message "Switch to ntu context"))}
	  \EFcd{;}\EFc{:leave-func (lambda () (mu4e-message "Leaving ntu context"))}
	  \EFcd{;}\EFc{:vars '(}
		  \EFcd{;}\EFc{( user-full-name	         . "Egidius Mysliwietz" )}
		  \EFcd{;}\EFc{( user-mail-address	         . "n1903483e@e.ntu.edu.sg" )}
                  \EFcd{;}\EFc{( smtpmail-mail-address        . "n1903483e@e.ntu.edu.sg")}
		  \EFcd{;}\EFc{( smtpmail-smtp-user           . "n1903483e@e.ntu.edu.sg")}
                  \EFcd{;}\EFc{( mu4e-archive-folder          . "/ntu/Archive" )}
		  \EFcd{;}\EFc{( mu4e-drafts-folder           . "/ntu/Drafts" )}
                  \EFcd{;}\EFc{( mu4e-sent-folder             . "/ntu/Sent Items" )}
		  \EFcd{;}\EFc{( mu4e-trash-folder            . "/ntu/Trash" )}
                  \EFcd{;}\EFc{( smtpmail-default-smtp-server . "smtp.office365.com" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-server         . "smtp.office365.com" )}
		  \EFcd{;}\EFc{( smtpmail-local-domain        . "office365.com" )}
                  \EFcd{;}\EFc{( smtpmail-smtp-service        . 587 )}
		  \EFcd{;}\EFc{))}
       \EFrdb{)}\EFrda{)}


\EFrda{(}\EFo{provide} \EFhq{'}\EFo{email-accounts}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Latex Tweaks}
\label{sec:orgaf9554d}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{latex-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:orgd24e93f}
\subsubsection{Code}
\label{sec:orgda5adc7}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{latex.el -*- lexical-binding: t; -*-}

\EFrda{(}\EFk{setq} \EFv{TeX-command-extra-options} \EFs{"--shell-escape"}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{TeX-engine} \EFhq{'}\EFhs{luatex}\EFrda{)}
\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{org-mode-hook}
          \EFrdb{(}\EFk{lambda} \EFrdc{(}\EFrdc{)}
            \EFrdc{(}\EFo{local-set-key} \EFrdd{(}\EFo{kbd} \EFs{"<f6>"}\EFrdd{)}
                           \EFrdd{(}\EFk{lambda} \EFrda{(}\EFrda{)} \EFrda{(}\EFk{interactive}\EFrda{)} \EFrda{(}\EFo{org-latex-export-to-pdf} t\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{defun} \EFf{force-compile} \EFrdb{(}\EFrdb{)}
  \EFd{"Set the file modification times on the current file, then call
TeX-command-sequence.
This forces a complete recompilation of the document, even if the source
(.tex) is older than any existing outputs (.pdf etc)."}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFo{set-buffer-modified-p} t\EFrdb{)} \EFcd{;; }\EFc{sets mod time to current time}
  \EFrdb{(}\EFo{save-buffer}\EFrdb{)}
  \EFrdb{(}TeX-command-sequence t t\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{auto-async-export} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFk{and} \EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrdd{)}
             \EFrdd{(}\EFo{string-equal} \EFs{"t"} \EFrda{(}\EFk{pop} \EFrdb{(}\EFo{cdr} \EFrdc{(}\EFo{car} \EFrdd{(}\EFo{org-collect-keywords} \EFhq{'}\EFrda{(}\EFs{"auto\_async\_export"}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{message} \EFs{"Exporting to pdf..."}\EFrdc{)}
    \EFrdc{(}\EFo{org-latex-export-to-pdf} t\EFrdc{)}
    \EFrdc{(}\EFk{when} \EFrdd{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{latex-mode}\EFrdd{)}
      \EFrdd{(}\EFf{force-compile}\EFrdd{)}\EFrdc{)}
    \EFrdb{)}
  \EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-after-save-cmd} \EFrdb{(}\EFrdb{)}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrdc{)}
  \EFrdc{(}\EFk{let} \EFrdd{(}\EFrda{(}cmd \EFrdb{(}\EFo{cdr} \EFrdc{(}\EFo{car} \EFrdd{(}\EFo{org-collect-keywords} \EFhq{'}\EFrda{(}\EFs{"on\_save\_cmd"}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}
        \EFrdd{(}\EFk{when} cmd
  \EFrda{(}\EFf{async-shell-command-no-window} \EFrdb{(}\EFk{pop} cmd\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}
\EFrda{(}\EFk{setq} \EFv{password-cache} t \EFcd{; }\EFc{enable password caching}
      \EFv{password-cache-expiry} \EFhn{36000}\EFrda{)} \EFcd{; }\EFc{for ten hours (time in secs)}

\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{after-save-hook} \EFhq{'}\EFhs{auto-async-export}\EFrda{)}
\EFrda{(}\EFo{add-hook} \EFhq{'}\EFv{after-save-hook} \EFhq{'}\EFhs{org-after-save-cmd}\EFrda{)}
                                        \EFcd{;}\EFc{(global-set-key [f6] (lambda () (interactive) (org-latex-export-to-pdf t)))}
\EFrda{(}\EFk{setq} \EFv{org-latex-compiler} \EFs{"lualatex"}\EFrda{)}
\EFrda{(}\EFk{setq-default} \EFv{TeX-master} nil\EFrda{)}
\EFrda{(}\EFo{add-to-list} \EFhq{'}\EFv{org-latex-packages-alist}
             \EFhq{'}\EFrdb{(}\EFs{"AUTO"} \EFs{"polyglossia"} t \EFrdc{(}\EFs{"xelatex"} \EFs{"lualatex"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{latex-word-count} \EFrdb{(}\EFrdb{)}
  \EFd{"Return latex word count using texlive"}
  \EFrdb{(}\EFk{interactive}\EFrdb{)}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}file-name \EFrda{(}\EFk{if} \EFrdb{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{latex-mode}\EFrdb{)}
                       \EFrdb{(}\EFv{buffer-file-name}\EFrdb{)}
                     \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{eq} \EFv{major-mode} \EFhq{'}\EFhs{org-mode}\EFrdc{)}
                         \EFrdc{(}\EFo{file-name-with-extension} \EFrdd{(}\EFv{buffer-file-name}\EFrdd{)} \EFs{"tex"}\EFrdc{)}
                       \EFrdc{(}\EFv{buffer-file-name}\EFrdc{)}\EFrdb{)}\EFrda{)}\EFrdd{)}\EFrdc{)}
  \EFrdc{(}\EFo{message} \EFrdd{(}\EFo{shell-command-to-string} \EFrda{(}\EFo{format} \EFs{"texcount -1 -merge -template=\{1\} \%s"} file-name\EFrda{)}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

  \EFcd{;; }\EFc{Latex classes}
  \EFrda{(}\EFk{setq} \EFv{org-latex-subtitle-separate} t
        \EFv{org-latex-subtitle-format} \EFs{"\char92{}\char92{}subtitle\{\%s\}"}\EFrda{)}
  \EFrda{(}\EFk{setq} \EFv{org-latex-classes} \EFhq{'}\EFrdb{(}\EFrdc{(}\EFs{"article"} \EFs{"\char92{}\char92{}documentclass[a4wide,10pt]\{article\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}paragraph\{\%s\}"} . \EFs{"\char92{}\char92{}paragraph*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subparagraph\{\%s\}"} . \EFs{"\char92{}\char92{}subparagraph*\{\%s\}"}\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFs{"report"} \EFs{"\char92{}\char92{}documentclass[11pt]\{report\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}part\{\%s\}"} . \EFs{"\char92{}\char92{}part*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}chapter\{\%s\}"} . \EFs{"\char92{}\char92{}chapter*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFs{"artikel"} \EFs{"\char92{}\char92{}documentclass[fancy, modern, twocolumn, titlepage=head, paper=a4, 12pt]\{artikel\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}paragraph\{\%s\}"} . \EFs{"\char92{}\char92{}paragraph*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subparagraph\{\%s\}"} . \EFs{"\char92{}\char92{}subparagraph*\{\%s\}"}\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFs{"thesis"} \EFs{"\char92{}\char92{}documentclass[fancy, modern, twocolumn, titlepage=thesis, paper=a4, 12pt]\{artikel\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}paragraph\{\%s\}"} . \EFs{"\char92{}\char92{}paragraph*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subparagraph\{\%s\}"} . \EFs{"\char92{}\char92{}subparagraph*\{\%s\}"}\EFrdd{)}\EFrdc{)}
                            \EFrdc{(}\EFs{"book"} \EFs{"\char92{}\char92{}documentclass[11pt]\{book\}"}
                             \EFrdd{(}\EFs{"\char92{}\char92{}part\{\%s\}"} . \EFs{"\char92{}\char92{}part*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}chapter\{\%s\}"} . \EFs{"\char92{}\char92{}chapter*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}section\{\%s\}"} . \EFs{"\char92{}\char92{}section*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsection*\{\%s\}"}\EFrdd{)}
                             \EFrdd{(}\EFs{"\char92{}\char92{}subsubsection\{\%s\}"} . \EFs{"\char92{}\char92{}subsubsection*\{\%s\}"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{org-export-headline-levels} \EFhn{5}\EFrda{)}

\EFcd{; }\EFc{Allow headlines, but not content, to not be exported (used for structuring org files)}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{ox-extra}\EFrda{)}
\EFrda{(}\EFo{ox-extras-activate} \EFhq{'}\EFrdb{(}ignore-headlines\EFrdb{)}\EFrda{)}


\EFrda{(}\EFk{let*} \EFrdb{(}\EFrdc{(}base-dir \EFs{"/home/user/dox/bib/"}\EFrdc{)}
        \EFrdc{(}bibfile \EFrdd{(}\EFo{concat} base-dir \EFs{"bib.bib"}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}notes-dir \EFrdd{(}\EFo{concat} base-dir \EFs{"notes/"}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}lib-dir \EFrdd{(}\EFo{concat} base-dir \EFs{"papers/"}\EFrdd{)}\EFrdc{)}\EFrdb{)}
  \EFrdb{(}\EFk{setq} bibtex-completion-bibliography bibfile
        citar-bibliography \EFhq{`}\EFrdc{(},bibfile\EFrdc{)}
        bibtex-completion-library-path \EFhq{`}\EFrdc{(},lib-dir\EFrdc{)}
        bibtex-completion-notes-path notes-dir
        citar-library-paths \EFhq{`}\EFrdc{(},lib-dir\EFrdc{)}
        citar-notes-paths \EFhq{`}\EFrdc{(},notes-dir\EFrdc{)}
        \EFv{org-cite-global-bibliography} \EFhq{`}\EFrdc{(},bibfile\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{org-export-with-sub-superscripts} \EFs{"\{\}"}
      \EFv{org-export-with-smart-quotes} nil\EFrda{)}

\EFrda{(}\EFo{engrave-faces-use-theme} \EFhq{'}\EFhs{doom-one}\EFrda{)}

\EFrda{(}\EFk{setq} \EFv{org-preview-latex-process-alist}
   \EFhq{'}\EFrdb{(}\EFrdc{(}dvipng \EFb{:programs}
      \EFrdd{(}\EFs{"dvilualatex"} \EFs{"dvipng"}\EFrdd{)}
      \EFb{:description} \EFs{"dvi > png"} \EFb{:message} \EFs{"you need to install the programs: dvilualatex and dvipng."} \EFb{:image-input-type} \EFs{"dvi"} \EFb{:image-output-type} \EFs{"png"} \EFb{:image-size-adjust}
      \EFrdd{(}\EFhn{1.0} . \EFhn{1.0}
\EFrdd{)}
      \EFb{:latex-compiler}
      \EFrdd{(}\EFs{"dvilualatex -interaction nonstopmode -output-directory \%o \%f"}\EFrdd{)}
      \EFb{:image-converter}
      \EFrdd{(}\EFs{"dvipng -D \%D -T tight -o \%O \%f"}\EFrdd{)}
      \EFb{:transparent-image-converter}
      \EFrdd{(}\EFs{"dvipng -D \%D -T tight -bg Transparent -o \%O \%f"}\EFrdd{)}\EFrdc{)}
     \EFrdc{(}dvisvgm \EFb{:programs}
      \EFrdd{(}\EFs{"lualatex"} \EFs{"dvisvgm"}\EFrdd{)}
      \EFb{:description} \EFs{"dvi > svg"} \EFb{:message} \EFs{"you need to install the programs: lualatex and dvisvgm."} \EFb{:image-input-type} \EFs{"dvi"} \EFb{:image-output-type} \EFs{"svg"} \EFb{:image-size-adjust}
      \EFrdd{(}\EFhn{1.7} . \EFhn{1.5}\EFrdd{)}
      \EFb{:latex-compiler}
      \EFrdd{(}\EFs{"lualatex -interaction nonstopmode -output-directory \%o \%f"}\EFrdd{)}
      \EFb{:image-converter}
      \EFrdd{(}\EFs{"dvisvgm \%f -n -b min -c \%S -o \%O"}\EFrdd{)}\EFrdc{)}
     \EFrdc{(}imagemagick \EFb{:programs}
      \EFrdd{(}\EFs{"lualatex"} \EFs{"convert"}\EFrdd{)}
      \EFb{:description} \EFs{"pdf > png"} \EFb{:message} \EFs{"you need to install the programs: lualatex and imagemagick."} \EFb{:image-input-type} \EFs{"pdf"} \EFb{:image-output-type} \EFs{"png"} \EFb{:image-size-adjust}
      \EFrdd{(}\EFhn{1.0} . \EFhn{1.0}\EFrdd{)}
      \EFb{:latex-compiler}
      \EFrdd{(}\EFs{"lualatex -interaction nonstopmode -output-directory \%o \%f"}\EFrdd{)}
      \EFb{:image-converter}
      \EFrdd{(}\EFs{"convert -density \%D -trim -antialias \%f -quality 100 \%O"}\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{latex-tweaks}\EFrda{)}
\end{Verbatim}
\end{Code}

\subsection{Org Links}
\label{sec:org792cbbc}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFrda{(}\EFk{load-module} \EFhq{'}\EFhs{org-links}\EFrda{)}
\end{Verbatim}
\end{Code}
\subsubsection{Requirements}
\label{sec:org42d457f}
\subsubsection{Code}
\label{sec:orge45e5df}
\begin{Code}
\begin{Verbatim}
\color{EFD}\EFcd{;;; }\EFc{ol-man.el - Support for links to man pages in Org mode}
\EFrda{(}\EFo{require} \EFhq{'}\EFo{ol}\EFrda{)}

\EFrda{(}\EFo{org-link-set-parameters} \EFs{"b"}
                         \EFb{:follow} \EFhq{\#'}\EFhs{org-b-open}
                         \EFb{:export} \EFhq{\#'}\EFhs{org-b-export}
                         \EFb{:store} \EFhq{\#'}\EFhs{org-b-store-link}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-b-open} \EFrdb{(}verse \_\EFrdb{)}
  \EFd{"Visit the verse."}
  \EFrdb{(}\EFo{funcall} org-b-command path\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-b-store-link} \EFrdb{(}\EFrdb{)}
  \EFd{"Store a link to a man page."}
  \EFrdb{(}\EFk{when} \EFrdc{(}\EFo{memq} \EFv{major-mode} \EFhq{'}\EFrdd{(}Man-mode woman-mode\EFrdd{)}\EFrdc{)}
    \EFcd{;; }\EFc{This is a man page, we do make this link.}
    \EFrdc{(}\EFk{let*} \EFrdd{(}\EFrda{(}page \EFrdb{(}org-man-get-page-name\EFrdb{)}\EFrda{)}
           \EFrda{(}link \EFrdb{(}\EFo{concat} \EFs{"b:"} page\EFrdb{)}\EFrda{)}
           \EFrda{(}description \EFrdb{(}\EFo{format} \EFs{"B page for \%s"} page\EFrdb{)}\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFo{org-link-store-props}
       \EFb{:type} \EFs{"b"}
       \EFb{:link} link
       \EFb{:description} description\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-man-get-page-name} \EFrdb{(}\EFrdb{)}
  \EFd{"Extract the page name from the buffer name."}
  \EFcd{;; }\EFc{This works for both `}\textcolor[HTML]{a9a1e1}{Man-mode}\EFc{' and `}\textcolor[HTML]{a9a1e1}{woman-mode}\EFc{'.}
  \EFrdb{(}\EFk{if} \EFrdc{(}\EFo{string-match} \EFs{" }\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{(}}\EFs{\char92{}\char92{}S-+}\textcolor[HTML]{51afef}{\textbf{\char92{}\char92{}}}\textcolor[HTML]{51afef}{\textbf{)}}\EFs{\char92{}\char92{}*"} \EFrdd{(}\EFo{buffer-name}\EFrdd{)}\EFrdc{)}
      \EFrdc{(}\EFo{match-string} \EFhn{1} \EFrdd{(}\EFo{buffer-name}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFo{error} \EFs{"Cannot create link to this man page"}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFk{defun} \EFf{org-b-export} \EFrdb{(}link description format \_\EFrdb{)}
  \EFd{"Export a man page link from Org files."}
  \EFrdb{(}\EFk{let} \EFrdc{(}\EFrdd{(}path \EFrda{(}\EFo{format} \EFs{"http://man.he.net/?topic=\%s\&section=all"} link\EFrda{)}\EFrdd{)}
        \EFrdd{(}desc \EFrda{(}\EFk{or} description link\EFrda{)}\EFrdd{)}\EFrdc{)}
    \EFrdc{(}\EFk{pcase} format
      \EFrdd{(}\EFhq{`}\EFhs{html} \EFrda{(}\EFo{format} \EFs{"<a target=\char92{}"\_blank\char92{}" href=\char92{}"\%s\char92{}">\%s</a>"} path desc\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFhq{`}\EFhs{latex} \EFrda{(}\EFo{format} \EFs{"\char92{}\char92{}href\{\%s\}\{\%s\}"} path desc\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFhq{`}\EFhs{texinfo} \EFrda{(}\EFo{format} \EFs{"@uref\{\%s,\%s\}"} path desc\EFrda{)}\EFrdd{)}
      \EFrdd{(}\EFhq{`}\EFhs{ascii} \EFrda{(}\EFo{format} \EFs{"\%s (\%s)"} desc path\EFrda{)}\EFrdd{)}
      \EFrdd{(}t path\EFrdd{)}\EFrdc{)}\EFrdb{)}\EFrda{)}

\EFrda{(}\EFo{provide} \EFhq{'}\EFo{org-links}\EFrda{)}
\end{Verbatim}
\end{Code}
\end{document}