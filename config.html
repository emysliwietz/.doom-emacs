<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-02-10 Fri 16:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emacs config</title>
<meta name="author" content="Egidius Mysliwietz" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Emacs config</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org5ba2620">1. Config</a></li>
<li><a href="#org650986b">2. Packages</a></li>
<li><a href="#org08b014d">3. Secrets&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></a></li>
<li><a href="#org9504871">4. Modules</a>
<ul>
<li><a href="#org61e8e59">4.1. Utility functions</a>
<ul>
<li><a href="#orgb541d43">4.1.1. Code</a></li>
</ul>
</li>
<li><a href="#orga060801">4.2. Autocorrect</a></li>
<li><a href="#orgdea7bf0">4.3. Beancount</a></li>
<li><a href="#orgde5a6e7">4.4. Dired</a>
<ul>
<li><a href="#org9610859">4.4.1. Dired Inline images</a>
<ul>
<li><a href="#org629db7a">4.4.1.1. Code</a></li>
</ul>
</li>
<li><a href="#orgbd7531b">4.4.2. Dired Tweaks</a>
<ul>
<li><a href="#orgafb4476">4.4.2.1. Code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgab62090">4.5. Ebooks</a>
<ul>
<li><a href="#orgb689a4e">4.5.1. Code</a></li>
</ul>
</li>
<li><a href="#org4d8ed86">4.6. Org-Roam</a>
<ul>
<li><a href="#orgaf3fa76">4.6.1. Requirements</a></li>
<li><a href="#org05d7a34">4.6.2. Code</a></li>
</ul>
</li>
<li><a href="#orged1c04e">4.7. Editing</a>
<ul>
<li><a href="#org6f2753a">4.7.1. Requirements</a></li>
<li><a href="#org556959f">4.7.2. Code</a></li>
</ul>
</li>
<li><a href="#org919188a">4.8. Elfeed Tweaks</a>
<ul>
<li><a href="#org0f89e09">4.8.1. Requirements</a></li>
<li><a href="#org280d812">4.8.2. Code</a></li>
</ul>
</li>
<li><a href="#orga90fe10">4.9. Interface</a>
<ul>
<li><a href="#org9e95a37">4.9.1. Requirements</a></li>
<li><a href="#org341a82c">4.9.2. Code</a>
<ul>
<li><a href="#org257cef3">4.9.2.1. General settings</a></li>
<li><a href="#orgb20b181">4.9.2.2. Font</a></li>
<li><a href="#org5b4ec93">4.9.2.3. Other</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org33aef93">4.10. EXWM Tweaks</a>
<ul>
<li><a href="#orga52a890">4.10.1. Requirements</a></li>
<li><a href="#orgef9fedd">4.10.2. Code</a></li>
</ul>
</li>
<li><a href="#org6d00e1a">4.11. General</a>
<ul>
<li><a href="#orgf60ff76">4.11.1. Requirements</a></li>
<li><a href="#org3a8bbfa">4.11.2. Code</a></li>
</ul>
</li>
<li><a href="#orge63e629">4.12. Navigation</a>
<ul>
<li><a href="#org51136da">4.12.1. Requirements</a></li>
<li><a href="#orge0fd911">4.12.2. Code</a></li>
</ul>
</li>
<li><a href="#orgf297934">4.13. Shortcuts</a>
<ul>
<li><a href="#org3499431">4.13.1. Requirements</a></li>
<li><a href="#org2b1ab14">4.13.2. Code</a></li>
</ul>
</li>
<li><a href="#orgfb7b8da">4.14. Config visit</a>
<ul>
<li><a href="#orgd5d3ee8">4.14.1. Requirements</a></li>
<li><a href="#org2a39cba">4.14.2. Code</a></li>
</ul>
</li>
<li><a href="#org4d7260b">4.15. Search</a>
<ul>
<li><a href="#orgfcb4c32">4.15.1. Requirements</a></li>
<li><a href="#org6e7284a">4.15.2. Code</a></li>
</ul>
</li>
<li><a href="#org7dc5335">4.16. Read Aloud</a>
<ul>
<li><a href="#orga9c97df">4.16.1. Requirements</a></li>
<li><a href="#org08957e9">4.16.2. Code</a></li>
</ul>
</li>
<li><a href="#org9752a6e">4.17. Speed Read</a>
<ul>
<li><a href="#org70b46ec">4.17.1. Requirements</a></li>
<li><a href="#orgc2cf1c2">4.17.2. Code</a></li>
</ul>
</li>
<li><a href="#org942ba25">4.18. Spaced Repetition</a>
<ul>
<li><a href="#org9043233">4.18.1. Requirements</a></li>
<li><a href="#org50de7be">4.18.2. Code</a></li>
</ul>
</li>
<li><a href="#org49b410c">4.19. Accounting</a>
<ul>
<li><a href="#org0b2ed12">4.19.1. Requirements</a></li>
<li><a href="#org30e783e">4.19.2. Code</a></li>
</ul>
</li>
<li><a href="#org0e93755">4.20. Popes</a>
<ul>
<li><a href="#orged8d803">4.20.1. Requirements</a></li>
<li><a href="#orgde69dcf">4.20.2. Code</a></li>
</ul>
</li>
<li><a href="#org002b0aa">4.21. Keycast Tweaks</a>
<ul>
<li><a href="#org9190871">4.21.1. Requirements</a></li>
<li><a href="#org9fc9b58">4.21.2. Code</a></li>
</ul>
</li>
<li><a href="#orga582210">4.22. Weather</a>
<ul>
<li><a href="#org6855b46">4.22.1. Requirements</a></li>
<li><a href="#orgd1f9814">4.22.2. Code</a></li>
</ul>
</li>
<li><a href="#org6ba438b">4.23. Org Tweaks</a>
<ul>
<li><a href="#org3f6311d">4.23.1. Requirements</a></li>
<li><a href="#orgf15511e">4.23.2. Code</a></li>
</ul>
</li>
<li><a href="#org069fece">4.24. Languages</a>
<ul>
<li><a href="#org809bcbc">4.24.1. Requirements</a></li>
<li><a href="#org347f700">4.24.2. Code</a></li>
</ul>
</li>
<li><a href="#orgc052403">4.25. Email</a>
<ul>
<li><a href="#orgf37fa49">4.25.1. Requirements</a></li>
<li><a href="#orgc234c72">4.25.2. Code</a></li>
</ul>
</li>
<li><a href="#org8c826e6">4.26. Email Config</a>
<ul>
<li><a href="#org9b94a95">4.26.1. Requirements</a></li>
<li><a href="#org339d82f">4.26.2. Code</a></li>
</ul>
</li>
<li><a href="#org7d7bc57">4.27. Email Accounts</a>
<ul>
<li><a href="#org4126a66">4.27.1. Requirements</a></li>
<li><a href="#org651c195">4.27.2. Code</a></li>
</ul>
</li>
<li><a href="#orgcba149b">4.28. Latex Tweaks</a>
<ul>
<li><a href="#org8d26594">4.28.1. Requirements</a></li>
<li><a href="#orgd833bb8">4.28.2. Code</a></li>
</ul>
</li>
<li><a href="#org4b159c6">4.29. Org Links</a>
<ul>
<li><a href="#orgb22cb44">4.29.1. Requirements</a></li>
<li><a href="#orgf4b4a7a">4.29.2. Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org5ba2620" class="outline-2">
<h2 id="org5ba2620"><span class="section-number-2">1.</span> Config</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">$DOOMDIR/config.el -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Place your private configuration here! Remember, you do not need to run 'doom</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">sync' after modifying this file!</span>


<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Some functionality uses this to identify you, e.g. GPG configuration, email</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">clients, file templates and snippets.</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">user-full-name</span> <span style="color: #98be65;">"Egidius Mysliwietz"</span>
      <span style="color: #dcaeea;">user-mail-address</span> <span style="color: #98be65;">"egidius@mysliwietz.de"</span>
      <span style="color: #dcaeea;">auth-sources</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"~/.authinfo"</span><span style="color: #c678dd;">)</span>
      <span style="color: #dcaeea;">auth-source-cache-expiry</span> nil<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Doom exposes five (optional) variables for controlling fonts in Doom. Here</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">are the three important ones:</span>
<span style="color: #5B6268;">;;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">+ `</span><span style="color: #a9a1e1;">doom-font</span><span style="color: #5B6268;">'</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">+ `</span><span style="color: #a9a1e1;">doom-variable-pitch-font</span><span style="color: #5B6268;">'</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">+ `</span><span style="color: #a9a1e1;">doom-big-font</span><span style="color: #5B6268;">' -- used for `</span><span style="color: #a9a1e1;">doom-big-font-mode</span><span style="color: #5B6268;">'; use this for</span>
<span style="color: #5B6268;">;;   </span><span style="color: #5B6268;">presentations or streaming.</span>
<span style="color: #5B6268;">;;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">They all accept either a font-spec, font string ("Input Mono-12"), or xlfd</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">font string. You generally only need these two:</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">(setq doom-font (font-spec :family "monospace" :size 12 :weight 'semi-light)</span>
<span style="color: #5B6268;">;;       </span><span style="color: #5B6268;">doom-variable-pitch-font (font-spec :family "sans" :size 13))</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">There are two ways to load a theme. Both assume the theme is installed and</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">available. You can either set `</span><span style="color: #a9a1e1;">doom-theme</span><span style="color: #5B6268;">' or manually load a theme with the</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">`</span><span style="color: #a9a1e1;">load-theme</span><span style="color: #5B6268;">' function. This is the default:</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">doom-theme</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">doom-one</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">custom-set-faces!</span>
  <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>doom-modeline-buffer-modified <span style="color: #c678dd;">:foreground</span> <span style="color: #98be65;">"orange"</span><span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>org-cite <span style="color: #c678dd;">:foreground</span> <span style="color: #98be65;">"purple"</span><span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>org-cite-key <span style="color: #c678dd;">:foreground</span> <span style="color: #98be65;">"MediumPurple1"</span> <span style="color: #c678dd;">:slant</span> italic<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">If you use `</span><span style="color: #a9a1e1;">org</span><span style="color: #5B6268;">' and don't want your org files in the default location below,</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">change `</span><span style="color: #a9a1e1;">org-directory</span><span style="color: #5B6268;">'. It must be set before org loads!</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-directory</span> <span style="color: #98be65;">"~/org/"</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This determines the style of line numbers in effect. If set to `</span><span style="color: #a9a1e1;">nil</span><span style="color: #5B6268;">', line</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">numbers are disabled. For relative line numbers, set this to `</span><span style="color: #a9a1e1;">relative</span><span style="color: #5B6268;">'.</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">display-line-numbers-type</span> t<span style="color: #51afef;">)</span>


<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Here are some additional functions/macros that could help you configure Doom:</span>
<span style="color: #5B6268;">;;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">- `</span><span style="color: #a9a1e1;">load!</span><span style="color: #5B6268;">' for loading external *.el files relative to this one</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">- `</span><span style="color: #a9a1e1;">use-package!</span><span style="color: #5B6268;">' for configuring packages</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">- `</span><span style="color: #a9a1e1;">after!</span><span style="color: #5B6268;">' for running code after a package has loaded</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">- `</span><span style="color: #a9a1e1;">add-load-path!</span><span style="color: #5B6268;">' for adding directories to the `</span><span style="color: #a9a1e1;">load-path</span><span style="color: #5B6268;">', relative to</span>
<span style="color: #5B6268;">;;   </span><span style="color: #5B6268;">this file. Emacs searches the `</span><span style="color: #a9a1e1;">load-path</span><span style="color: #5B6268;">' when you load packages with</span>
<span style="color: #5B6268;">;;   </span><span style="color: #5B6268;">`</span><span style="color: #a9a1e1;">require</span><span style="color: #5B6268;">' or `</span><span style="color: #a9a1e1;">use-package</span><span style="color: #5B6268;">'.</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">- `</span><span style="color: #a9a1e1;">map!</span><span style="color: #5B6268;">' for binding new keys</span>
<span style="color: #5B6268;">;;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">To get information about any of these functions/macros, move the cursor over</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">the highlighted symbol at press '</span><span style="color: #a9a1e1;">K</span><span style="color: #5B6268;">' (non-evil users must press 'C-c c k').</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This will open documentation for it, including demos of how they are used.</span>
<span style="color: #5B6268;">;;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">You can also try '</span><span style="color: #a9a1e1;">gd</span><span style="color: #5B6268;">' (or 'C-c c d') to jump to their definition and see how</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">they are implemented.</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">load-path</span> <span style="color: #98be65;">"~/.doom.d/modules"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defmacro</span> <span style="color: #c678dd;">--</span> <span style="color: #c678dd;">(</span>var<span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> ,var
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> ,var <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">-</span> ,var <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defmacro</span> <span style="color: #c678dd;">++</span> <span style="color: #c678dd;">(</span>var<span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> ,var
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> ,var <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">+</span> ,var <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(when (or (not debug-my-config) (&gt; debug-my-config 0)) (dec debug-my-config) (message "a"))</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">use-package-verbose</span> t<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">async-bytecomp-package-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">after-startup</span> <span style="color: #c678dd;">(</span>func<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> debug-my-config <span style="color: #98be65;">(</span><span style="color: #51afef;">add-hook!</span> after-startup-hook
                             <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">load-module</span> func<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">mkdir</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #dcaeea;">doom-private-dir</span> <span style="color: #98be65;">"modules"</span><span style="color: #c678dd;">)</span> t<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Variable to determine how many modules are loaded, for debugging</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Any number is number of modules</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">nil means all</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> debug-my-config nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defmacro</span> <span style="color: #c678dd;">load-module</span> <span style="color: #c678dd;">(</span>module<span style="color: #c678dd;">)</span>
   <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">not</span> debug-my-config<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">&gt;</span> debug-my-config <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">--</span> debug-my-config<span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">make-thread</span>
   <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>time <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">current-time</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(message (format "Loading %s." func-name))</span>
     <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> ,module<span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"Loaded %s in %.06f."</span> ,module <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">float-time</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">time-since</span> time<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Load a module only if dependency could successfully be loaded</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defmacro</span> <span style="color: #c678dd;">load-module-if</span> <span style="color: #c678dd;">(</span>dependency module<span style="color: #c678dd;">)</span>
<span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">require</span> ,dependency nil <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">noerror</span><span style="color: #98be65;">)</span>
   <span style="color: #98be65;">(</span><span style="color: #51afef;">load-module</span> ,module<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">cl</span><span style="color: #51afef;">)</span> <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Still a requirement for ivy</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-tweaks</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">general</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">navigation</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">shortcuts</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">private-config</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">search</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">read-aloud</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">read-single</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">pamparam</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">beancount-tweaks</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">popes</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(load-module '(require 'bible))</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">keycast-tweaks</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">wttrin</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-tweaks</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">languages</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">mu4e</span> nil <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">noerror</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">email</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">email-config</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">email-accounts</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">latex-tweaks</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">; </span><span style="color: #5B6268;">Unsorted</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">doom-modeline-enable-word-count</span> t<span style="color: #51afef;">)</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(doom/quickload-session)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">doom--get-modules</span> <span style="color: #c678dd;">(</span>file<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-exists-p</span> file<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">user-error</span> <span style="color: #98be65;">"%s does not exist"</span> file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-temp-buffer</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert-file-contents</span> file<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"(doom! "</span> nil t<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">match-beginning</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">sexp-at-point</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">doom--put-modules</span> <span style="color: #c678dd;">(</span>tmpfile modules<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-temp-file</span> tmpfile
    <span style="color: #98be65;">(</span><span style="color: #dcaeea;">delay-mode-hooks</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">emacs-lisp-mode</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">replace-regexp-in-string</span> <span style="color: #98be65;">" "</span> <span style="color: #98be65;">"\n"</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">prin1-to-string</span> modules<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">indent-region</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">doom/what-has-changed</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Open an ediff session to compare the module list in</span>
<span style="color: #83898d;">~/.emacs.d/init.example.el and ~/.doom.d/init.el."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>old-modules <span style="color: #51afef;">(</span><span style="color: #c678dd;">doom--get-modules</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #dcaeea;">doom-emacs-dir</span> <span style="color: #98be65;">"templates/init.example.el"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>new-modules <span style="color: #51afef;">(</span><span style="color: #c678dd;">doom--get-modules</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"init.el"</span> <span style="color: #dcaeea;">doom-private-dir</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>example-init-el <span style="color: #98be65;">"/tmp/doom-init.example.el"</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>private-init-el <span style="color: #98be65;">"/tmp/doom-private-init.el"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">doom--put-modules</span> example-init-el old-modules<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">doom--put-modules</span> private-init-el new-modules<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">ediff</span> private-init-el example-init-el<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-org650986b" class="outline-2">
<h2 id="org650986b"><span class="section-number-2">2.</span> Packages</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">-*- no-byte-compile: t; -*-</span>
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">$DOOMDIR/packages.el</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">To install a package with Doom you must declare them here and run 'doom sync'</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">on the command line, then restart Emacs for the changes to take effect -- or</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">use 'M-x doom/reload'.</span>


<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">To install SOME-PACKAGE from MELPA, ELPA or emacsmirror:</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(package! some-package)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">To install a package directly from a remote git repo, you must specify a</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">`</span><span style="color: #a9a1e1;">:recipe</span><span style="color: #5B6268;">'. You'll find documentation on what `</span><span style="color: #a9a1e1;">:recipe</span><span style="color: #5B6268;">' accepts here:</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">https://github.com/raxod502/straight.el#the-recipe-format</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(package! another-package</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">:recipe (:host github :repo "username/repo"))</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">If the package you are trying to install does not contain a PACKAGENAME.el</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">file, or is located in a subdirectory of the repo, you'll need to specify</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">`</span><span style="color: #a9a1e1;">:files</span><span style="color: #5B6268;">' in the `</span><span style="color: #a9a1e1;">:recipe</span><span style="color: #5B6268;">':</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(package! this-package</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">:recipe (:host github :repo "username/repo"</span>
<span style="color: #5B6268;">;           </span><span style="color: #5B6268;">:files ("some-file.el" "src/lisp/*.el")))</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">If you'd like to disable a package included with Doom, you can do so here</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">with the `</span><span style="color: #a9a1e1;">:disable</span><span style="color: #5B6268;">' property:</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(package! builtin-package :disable t)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">You can override the recipe of a built in package without having to specify</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">all the properties for `</span><span style="color: #a9a1e1;">:recipe</span><span style="color: #5B6268;">'. These will inherit the rest of its recipe</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">from Doom or MELPA/ELPA/Emacsmirror:</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(package! builtin-package :recipe (:nonrecursive t))</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(package! builtin-package-2 :recipe (:repo "myfork/package"))</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Specify a `</span><span style="color: #a9a1e1;">:branch</span><span style="color: #5B6268;">' to install a package from a particular branch or tag.</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This is required for some packages whose default branch isn't '</span><span style="color: #a9a1e1;">master</span><span style="color: #5B6268;">' (which</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">our package manager can't deal with; see raxod502/straight.el#279)</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(package! builtin-package :recipe (:branch "develop"))</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Use `</span><span style="color: #a9a1e1;">:pin</span><span style="color: #5B6268;">' to specify a particular commit to install.</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(package! builtin-package :pin "1a2b3c4d5e")</span>


<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Doom's packages are pinned to a specific commit and updated from release to</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">release. The `</span><span style="color: #a9a1e1;">unpin!</span><span style="color: #5B6268;">' macro allows you to unpin single packages...</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(unpin! pinned-package)</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">...or multiple packages</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(unpin! pinned-package another-pinned-package)</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">...Or *all* packages (NOT RECOMMENDED; will likely break things)</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(unpin! t)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> xelb<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> exwm<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> winum<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> switch-window<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> try<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> counsel<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> ivy<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> all-the-icons-ibuffer<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> all-the-icons-ivy<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> swiper<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> <span style="color: #dcaeea;">ido-vertical-mode</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> amx<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> diredfl<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> all-the-icons-dired<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> diredful<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> dired-git-info<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> async<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> dired-quick-sort<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> openwith<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> lispy<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> hydra<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> ace-link<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> sudo-edit<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> beancount <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:host</span> github <span style="color: #c678dd;">:repo</span> <span style="color: #98be65;">"beancount/be..."</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"ea8257881b7e..."</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> rotate<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> vlf<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> evil-escape <span style="color: #c678dd;">:disable</span> t<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">; </span><span style="color: #5B6268;">Auto Activating Snippets</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> aas <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:host</span> github <span style="color: #c678dd;">:repo</span> <span style="color: #98be65;">"ymarco/auto-activating-snippets"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"1699bec4d244..."</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> string-inflection <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"fd7926ac1729..."</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> info-colors <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"47ee73cc19b1..."</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> modus-themes <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"392ebb115b07..."</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> theme-magic <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"844c4311bd26..."</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> keycast <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"04ba7519f344..."</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> page-break-lines <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:host</span> github <span style="color: #c678dd;">:repo</span> <span style="color: #98be65;">"purcell/page-break-lines"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> spray <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"74d9dcfa2e8b..."</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(package! authinfo-color-mode</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">:recipe (:repo "lisp/authinfo-color-mode"))</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> systemd <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"b6ae63a23660..."</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">; </span><span style="color: #5B6268;">Ebooks</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> calibredb <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"cb93563d0ec9..."</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> nov <span style="color: #c678dd;">:pin</span> <span style="color: #98be65;">"b3c7cc28e95f..."</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">; </span><span style="color: #5B6268;">Email</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-mime<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-auto-tangle<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> mu4e-alert<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> outline-minor-faces<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> mu4e-conversation<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> elfeed-summary<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-modern<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> good-scroll<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> desktop-environment<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> emms<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> elfeed-tube<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> mpv<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> elfeed-tube-mpv<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> spell-fu<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> wallpaper<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org08b014d" class="outline-2">
<h2 id="org08b014d"><span class="section-number-2">3.</span> Secrets&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></h2>
<div class="outline-text-2" id="text-3">
<p>
&#x2013;&#x2014;BEGIN PGP MESSAGE&#x2013;&#x2014;
</p>

<p>
jA0ECQMCpaa2IHWz/qX/0ncB5MHYMuE7woX9lpKqkvubmgY7wy3/6LCoYMn6XYRY
sY2v9BQxlfFkz+rwgWnsdRYeGLR8Yd8mpHGeGg4jrvC8v5eiOhaqCKpyNiAcMpOv
age95IpQjrQoIy0CPDtiouDWKNrXrTSQctareltEAkkB+p48HdVkKg==
=z0qj
&#x2013;&#x2014;END PGP MESSAGE&#x2013;&#x2014;
</p>
</div>
</div>
<div id="outline-container-org9504871" class="outline-2">
<h2 id="org9504871"><span class="section-number-2">4.</span> Modules</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org61e8e59" class="outline-3">
<h3 id="org61e8e59"><span class="section-number-3">4.1.</span> Utility functions</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">utility-functions</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgb541d43" class="outline-4">
<h4 id="orgb541d43"><span class="section-number-4">4.1.1.</span> Code</h4>
<div class="outline-text-4" id="text-4-1-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">string-inflection</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">string-inflection-title-to-lisp-case-function</span> <span style="color: #c678dd;">(</span>title-str<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Title String for Something =&gt; title-string-for-something"</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string-inflection-kebab-case-function</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">s-replace-all</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #98be65;">" "</span> . <span style="color: #98be65;">"-"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> title-str<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">utility-functions</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga060801" class="outline-3">
<h3 id="orga060801"><span class="section-number-3">4.2.</span> Autocorrect</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">auto-correct</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">auto-correct.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">define-key</span> <span style="color: #dcaeea;">ctl-x-map</span> <span style="color: #98be65;">"\C-i"</span>
  <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">endless/ispell-word-then-abbrev</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">endless/simple-get-word</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">car-safe</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">save-excursion</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">ispell-get-word</span> nil<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">endless/ispell-word-then-abbrev</span> <span style="color: #c678dd;">(</span>p<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Call `</span><span style="color: #a9a1e1;">ispell-word</span><span style="color: #83898d;">', then create an abbrev for it.</span>
<span style="color: #83898d;">With prefix P, create local abbrev. Otherwise it will</span>
<span style="color: #83898d;">be global.</span>
<span style="color: #83898d;">If there's nothing wrong with the word at point, keep</span>
<span style="color: #83898d;">looking for a typo until the beginning of buffer. You can</span>
<span style="color: #83898d;">skip typos you don't want to fix with `</span><span style="color: #a9a1e1;">SPC</span><span style="color: #83898d;">', and you can</span>
<span style="color: #83898d;">abort completely with `</span><span style="color: #a9a1e1;">C-g</span><span style="color: #83898d;">'."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"P"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span>bef aft<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">save-excursion</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> bef <span style="color: #98be65;">(</span><span style="color: #c678dd;">endless/simple-get-word</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                 <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Word was corrected or used quit.</span>
                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">ispell-word</span> nil <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">quiet</span><span style="color: #98be65;">)</span>
                     nil <span style="color: #5B6268;">; </span><span style="color: #5B6268;">End the loop.</span>
                   <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Also end if we reach `</span><span style="color: #a9a1e1;">bob</span><span style="color: #5B6268;">'.</span>
                   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">bobp</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
               <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">If there's no word at point, keep looking</span>
               <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">until `</span><span style="color: #a9a1e1;">bob</span><span style="color: #5B6268;">'.</span>
               <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">bobp</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">backward-word</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">backward-char</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> aft <span style="color: #51afef;">(</span><span style="color: #c678dd;">endless/simple-get-word</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> aft bef <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">equal</span> aft bef<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>aft <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">downcase</span> aft<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
              <span style="color: #c678dd;">(</span>bef <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">downcase</span> bef<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">define-abbrev</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> p <span style="color: #dcaeea;">local-abbrev-table</span> <span style="color: #dcaeea;">global-abbrev-table</span><span style="color: #c678dd;">)</span>
            bef aft<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"\"%s\" now expands to \"%s\" %sally"</span>
                   bef aft <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> p <span style="color: #98be65;">"loc"</span> <span style="color: #98be65;">"glob"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">user-error</span> <span style="color: #98be65;">"No typo at or before point"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">save-abbrevs</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">silently</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span> <span style="color: #dcaeea;">abbrev-mode</span> t<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">auto-correct</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdea7bf0" class="outline-3">
<h3 id="orgdea7bf0"><span class="section-number-3">4.3.</span> Beancount</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">beancount-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">beancount.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> beancount
  <span style="color: #c678dd;">:mode</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">"\\.beancount\\'"</span> . beancount-mode<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:init</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">after!</span> all-the-icons
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">all-the-icons-icon-alist</span>
                 <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\.beancount\\'"</span> all-the-icons-material <span style="color: #98be65;">"attach_money"</span> <span style="color: #c678dd;">:face</span> all-the-icons-lblue<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">all-the-icons-mode-icon-alist</span>
                 <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span>beancount-mode all-the-icons-material <span style="color: #98be65;">"attach_money"</span> <span style="color: #c678dd;">:face</span> all-the-icons-lblue<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> beancount-electric-currency t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">beancount-bal</span> <span style="color: #98be65;">()</span>
    <span style="color: #83898d;">"Run bean-report bal."</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">compilation-read-command</span> nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span>beancount--run <span style="color: #98be65;">"bean-report"</span>
                      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-relative-name</span> <span style="color: #dcaeea;">buffer-file-name</span><span style="color: #51afef;">)</span> <span style="color: #98be65;">"bal"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> beancount-mode-map
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"TAB"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">beancount-align-to-previous-number</span>
        <span style="color: #c678dd;">:i</span> <span style="color: #98be65;">"RET"</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">cmd!</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">newline-and-indent</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>beancount-align-to-previous-number<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">beancount-tweaks</span><span style="color: #51afef;">)</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-orgde5a6e7" class="outline-3">
<h3 id="orgde5a6e7"><span class="section-number-3">4.4.</span> Dired</h3>
<div class="outline-text-3" id="text-4-4">
</div>
<div id="outline-container-org9610859" class="outline-4">
<h4 id="org9610859"><span class="section-number-4">4.4.1.</span> Dired Inline images</h4>
<div class="outline-text-4" id="text-4-4-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-inline-images</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org629db7a" class="outline-5">
<h5 id="org629db7a"><span class="section-number-5">4.4.1.1.</span> Code</h5>
<div class="outline-text-5" id="text-4-4-1-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">dired-inline-images.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">dired-preview--dired-line-is-previewable</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Return non-nil if line under point is previewable"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>fname <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">dired-get-filename</span> nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>ext <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">upcase</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-name-extension</span> fname<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>allowed-extensions <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span><span style="color: #98be65;">"PBM"</span> <span style="color: #98be65;">"XBM"</span> <span style="color: #98be65;">"XPM"</span> <span style="color: #98be65;">"GIF"</span> <span style="color: #98be65;">"JPEG"</span> <span style="color: #98be65;">"JPG"</span> <span style="color: #98be65;">"TIFF"</span> <span style="color: #98be65;">"TIF"</span> <span style="color: #98be65;">"PNG"</span> <span style="color: #98be65;">"SVG"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>search-fun <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">apply-partially</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">(</span>a b<span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string=</span> a b<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> ext<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>is-ext-allowed <span style="color: #51afef;">(</span><span style="color: #c678dd;">seq-find</span> search-fun allowed-extensions nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    is-ext-allowed<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">dired-preview--readin</span> <span style="color: #c678dd;">(</span>filename<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Read in the file.</span>

<span style="color: #83898d;">Return a string suitable for insertion in `</span><span style="color: #a9a1e1;">dired</span><span style="color: #83898d;">' buffer."</span>
    <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>preview-image <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">create-image</span> filename <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">imagemagick</span> nil <span style="color: #c678dd;">:height</span> <span style="color: #da8548; font-weight: bold;">200</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">with-temp-buffer</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert-image</span> preview-image<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"\n"</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">buffer-string</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">dired-preview-insert</span> <span style="color: #c678dd;">()</span>          <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Copied more or less directly from dired-subtree</span>
  <span style="color: #83898d;">"Insert preview under this file."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">dired-preview--dired-line-is-previewable</span><span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #51afef;">(</span>dired-subtree--is-expanded-p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>filename <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">dired-get-filename</span> nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>listing <span style="color: #c678dd;">(</span><span style="color: #c678dd;">dired-preview--readin</span> filename<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           beg end<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">read-only-mode</span> <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">move-end-of-line</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">this is pretty ugly, I'm sure it can be done better</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">save-excursion</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> listing<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> end <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">+</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #98be65;">)</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">newline</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> beg <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dcaeea;">inhibit-read-only</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">remove-text-properties</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">1-</span> beg<span style="color: #c678dd;">)</span> beg <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>dired-filename<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>ov <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">make-overlay</span> beg end<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>parent <span style="color: #98be65;">(</span>dired-subtree--get-ov <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">1-</span> beg<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>depth <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> parent <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">+</span> <span style="color: #da8548; font-weight: bold;">2</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">overlay-get</span> parent <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-subtree-depth</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                        <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>face <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">intern</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"dired-subtree-depth-%d-face"</span> depth<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> dired-subtree-use-backgrounds
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">overlay-put</span> ov <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> face<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">refactor this to some function</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">overlay-put</span> ov <span style="color: #51afef;">'</span><span style="color: #dcaeea;">line-prefix</span>
                     <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">stringp</span> dired-subtree-line-prefix<span style="color: #98be65;">)</span>
                         <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">not</span> dired-subtree-use-backgrounds<span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">apply</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">concat</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">-repeat</span> depth dired-subtree-line-prefix<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span>
                            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> nil dired-subtree-line-prefix-face<span style="color: #c678dd;">)</span>
                             <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">apply</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">concat</span>
                                    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">-repeat</span> depth dired-subtree-line-prefix<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">subtree</span> dired-subtree-line-prefix-face<span style="color: #c678dd;">)</span>
                             <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span>
                              dired-subtree-line-prefix
                              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">propertize</span>
                               <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">apply</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">concat</span>
                                      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">-repeat</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">1-</span> depth<span style="color: #c678dd;">)</span> dired-subtree-line-prefix<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                               <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> face<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">parents</span> dired-subtree-line-prefix-face<span style="color: #c678dd;">)</span>
                             <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span>
                              dired-subtree-line-prefix
                              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">apply</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">concat</span>
                                     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">--map</span>
                                      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">propertize</span> dired-subtree-line-prefix
                                                  <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span>
                                                  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">intern</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"dired-subtree-depth-%d-face"</span> it<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                                      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">number-sequence</span> <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">1-</span> depth<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">funcall</span> dired-subtree-line-prefix depth<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">overlay-put</span> ov <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-subtree-name</span> filename<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">overlay-put</span> ov <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-subtree-parent</span> parent<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">overlay-put</span> ov <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-subtree-depth</span> depth<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">overlay-put</span> ov <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">evaporate</span> t<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">push</span> ov dired-subtree-overlays<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">-</span> beg <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">dired-move-to-filename</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">read-only-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">run-hooks</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-subtree-after-insert-hook</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">dired-preview-insert-preview-or-subtree</span> <span style="color: #c678dd;">(</span>orig-fun<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Call the right insert function for a preview or a subtree"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>dired-subtree--dired-line-is-directory-or-link-p<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">apply</span> orig-fun nil<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">dired-preview--dired-line-is-previewable</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">dired-preview-insert</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">advice-add</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-subtree-insert</span> <span style="color: #c678dd;">:around</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">dired-preview-insert-preview-or-subtree</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">dired-inline-images</span><span style="color: #51afef;">)</span>

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbd7531b" class="outline-4">
<h4 id="orgbd7531b"><span class="section-number-4">4.4.2.</span> Dired Tweaks</h4>
<div class="outline-text-4" id="text-4-4-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgafb4476" class="outline-5">
<h5 id="orgafb4476"><span class="section-number-5">4.4.2.1.</span> Code</h5>
<div class="outline-text-5" id="text-4-4-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">dired-tweaks.el -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Dired</span>
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Colourful dired</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> diredfl
  <span style="color: #c678dd;">:init</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">diredfl-global-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> all-the-icons-dired
  <span style="color: #c678dd;">:config</span>
  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(all-the-icons-dired-mode 1)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">dired-mode-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">all-the-icons-dired-mode</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">dired-open-file</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"In dired, open the file named on this line."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>file <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">dired-get-filename</span> nil t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Opening %s..."</span> file<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">call-process</span> <span style="color: #98be65;">"xdg-open"</span> nil <span style="color: #da8548; font-weight: bold;">0</span> nil file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">define-minor-mode</span> <span style="color: #dcaeea;">dired-follow-mode</span>
  <span style="color: #83898d;">"Diplay file at point in dired after a move."</span>
  <span style="color: #c678dd;">:lighter</span> <span style="color: #98be65;">" dired-f"</span>
  <span style="color: #c678dd;">:global</span> t
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #dcaeea;">dired-follow-mode</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">advice-add</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-next-line</span> <span style="color: #c678dd;">:after</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>arg<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">dired-display-file</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">advice-remove</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-next-line</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>arg<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">dired-display-file</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">vc-follow-symlinks</span> t
      <span style="color: #dcaeea;">dired-listing-switches</span> <span style="color: #98be65;">"-ahlt"</span>
      diredp-toggle-find-file-reuse-dir <span style="color: #da8548; font-weight: bold;">1</span>
      image-dired-thumb-size <span style="color: #da8548; font-weight: bold;">100</span>
      diredp-image-preview-in-tooltip <span style="color: #da8548; font-weight: bold;">100</span>
      <span style="color: #dcaeea;">dired-auto-revert-buffer</span> t
      diredp-hide-details-initially-flag nil
      <span style="color: #dcaeea;">dired-hide-details-mode</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defmacro</span> <span style="color: #c678dd;">image-view</span> <span style="color: #c678dd;">(</span>direction<span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span>
     <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
     <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">quit-window</span><span style="color: #98be65;">)</span>
     <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>pt <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           filename<span style="color: #a9a1e1;">)</span>
       <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">ignore-errors</span>
             <span style="color: #c678dd;">(</span><span style="color: #51afef;">catch</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">filename</span>
               <span style="color: #98be65;">(</span><span style="color: #51afef;">while</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">dired-next-line</span> ,direction<span style="color: #a9a1e1;">)</span>
                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">image-type-from-file-name</span>
                        <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> filename <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">dired-get-filename</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                   <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">throw</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">filename</span> filename<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> pt<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
       <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">dired-view-file</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">eval-after-load</span> <span style="color: #98be65;">"image-mode"</span>
  <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>progn
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> image-mode-map <span style="color: #98be65;">"n"</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">image-view</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> image-mode-map <span style="color: #98be65;">"p"</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">image-view</span> <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(use-package dired-k</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">;; use dired-k as alternative to revert buffer. This will refresh git status</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">:hook (dired-mode . dired-k)</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">:bind (:map dired-mode-map</span>
<span style="color: #5B6268;">;              </span><span style="color: #5B6268;">("g" . dired-k)))</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> diredful
  <span style="color: #c678dd;">:config</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">diredful-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">; </span><span style="color: #5B6268;">I don't like colors that much, icons already do everything</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(use-package dired-rainbow</span>
<span style="color: #5B6268;">;</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">:defer t</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">:config</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">(progn</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define-chmod directory "#6cb2eb" "d.*")</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define html "#eb5286" ("css" "less" "sass" "scss" "htm" "html" "jhtm" "mht" "eml" "mustache" "xhtml"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define xml "#f2d024" ("xml" "xsd" "xsl" "xslt" "wsdl" "bib" "json" "msg" "pgn" "rss" "yaml" "yml" "rdata"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define document "#9561e2" ("docm" "doc" "docx" "odb" "odt" "pdb" "pdf" "ps" "rtf" "djvu" "epub" "odp" "ppt" "pptx"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define markdown "#ffed4a" ("org" "etx" "info" "markdown" "md" "mkd" "nfo" "pod" "rst" "tex" "textfile" "txt"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define database "#6574cd" ("xlsx" "xls" "csv" "accdb" "db" "mdb" "sqlite" "nc"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define media "#de751f" ("mp3" "mp4" "MP3" "MP4" "avi" "mpeg" "mpg" "flv" "ogg" "mov" "mid" "midi" "wav" "aiff" "flac"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define image "#f66d9b" ("tiff" "tif" "cdr" "gif" "ico" "jpeg" "jpg" "png" "psd" "eps" "svg"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define log "#c17d11" ("log"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define shell "#f6993f" ("awk" "bash" "bat" "sed" "sh" "zsh" "vim"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define interpreted "#38c172" ("py" "ipynb" "rb" "pl" "t" "msql" "mysql" "pgsql" "sql" "r" "clj" "cljs" "scala" "js"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define compiled "#4dc0b5" ("asm" "cl" "lisp" "el" "c" "h" "c++" "h++" "hpp" "hxx" "m" "cc" "cs" "cp" "cpp" "go" "f" "for" "ftn" "f90" "f95" "f03" "f08" "s" "rs" "hi" "hs" "pyc" ".java"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define executable "#8cc4ff" ("exe" "msi"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define compressed "#51d88a" ("7z" "zip" "bz2" "tgz" "txz" "gz" "xz" "z" "Z" "jar" "war" "ear" "rar" "sar" "xpi" "apk" "xz" "tar"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define packaged "#faad63" ("deb" "rpm" "apk" "jad" "jar" "cab" "pak" "pk3" "vdf" "vpk" "bsp"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define encrypted "#ffed4a" ("gpg" "pgp" "asc" "bfe" "enc" "signature" "sig" "p12" "pem"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define fonts "#6cb2eb" ("afm" "fon" "fnt" "pfb" "pfm" "ttf" "otf"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define partition "#e3342f" ("dmg" "iso" "bin" "nrg" "qcow" "toast" "vcd" "vmdk" "bak"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define vc "#0074d9" ("git" "gitignore" "gitattributes" "gitmodules"))</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(dired-rainbow-define-chmod executable-unix "#38c172" "-.*x.*")</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">))</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> dired-git-info
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">dgi-auto-hide-details-p</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">dired-after-readin-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-git-info-auto-enable</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> async
  <span style="color: #c678dd;">:init</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">dired-async-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> dired-quick-sort
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">dired-quick-sort-setup</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">dired-quick-sort-suppress-setup-warning</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> openwith
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">openwith-associations</span>
        <span style="color: #98be65;">(</span><span style="color: #51afef;">cond</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #dcaeea;">system-type</span> <span style="color: #98be65;">"darwin"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"\\.</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">dmg</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">doc</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">docs</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">xls</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">xlsx</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">$"</span>
             <span style="color: #98be65;">"open"</span> <span style="color: #98be65;">(</span>file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #98be65;">"\\.</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">mp4</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">mp3</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">webm</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">avi</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">flv</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">mov</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">$"</span>
             <span style="color: #98be65;">"open"</span> <span style="color: #98be65;">(</span><span style="color: #98be65;">"-a"</span> <span style="color: #98be65;">"VLC"</span> file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #dcaeea;">system-type</span> <span style="color: #98be65;">"gnu/linux"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"\\.</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">mp4</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">m4a</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">mp3</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">mkv</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">webm</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">avi</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">flv</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">mov</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">pdf</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">part</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">$"</span>
             <span style="color: #98be65;">"xdg-open"</span> <span style="color: #98be65;">(</span>file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">openwith-mode</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">large-file-warning-threshold</span> <span style="color: #da8548; font-weight: bold;">3000000000</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">define-key</span> <span style="color: #dcaeea;">dired-mode-map</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"&lt;backspace&gt;"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-up-directory</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Docview j and k go forward a line which is weird behaviour in a pdf</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Paging is prefered to scrolling</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> doc-view-mode
<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">define-key</span> doc-view-mode-map <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"j"</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">doc-view-next-page</span><span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">define-key</span> doc-view-mode-map <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"k"</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">doc-view-previous-page</span><span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Convert files automatically</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">dired-convert-file</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Converts pptx or docx files to pdf"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">cl-map</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">nil</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span>lambda <span style="color: #a9a1e1;">(</span>file<span style="color: #a9a1e1;">)</span>
                   <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>ext <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-extension</span> file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                         <span style="color: #c678dd;">(</span>base-name-sans-ext <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-sans-extension</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> file<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                     <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span>
                      <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"pptx"</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"ppt"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">async-shell-command</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"libreoffice --headless --invisible --convert-to pdf \"%s\""</span> file<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                      <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"docx"</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"doc"</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"epub"</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"tex"</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #98be65;">"html"</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"org"</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"txt"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">async-shell-command</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"pandoc -i \"%s\" -o \"%s.pdf\""</span> file base-name-sans-ext<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                      <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"jpg"</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"jpeg"</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> ext <span style="color: #98be65;">"png"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">async-shell-command</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"convert \"%s\" -rotate 90 \"%s\""</span> file file<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                      <span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #ECBE7B;">dired-get-marked-files</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Toggle youtube-dl-list if in elfeed-youtube buffer, else perform regular load</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">dired-load-or-youtube-toggle</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-name</span><span style="color: #51afef;">)</span> <span style="color: #98be65;">"elfeed-youtube"</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">youtube-dl-list</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">youtube-dl-list-mode</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kill-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>t <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">dired-do-load</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> <span style="color: #dcaeea;">dired-mode-map</span>
      <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:after dired-mode</span>
      <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:n doom-leader-key nil</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"c"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">dired-convert-file</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"L"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">dired-load-or-youtube-toggle</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> <span style="color: #dcaeea;">youtube-dl-list-mode-map</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"L"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">dired-load-or-youtube-toggle</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">dired-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgab62090" class="outline-3">
<h3 id="orgab62090"><span class="section-number-3">4.5.</span> Ebooks</h3>
<div class="outline-text-3" id="text-4-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ebook-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgb689a4e" class="outline-4">
<h4 id="orgb689a4e"><span class="section-number-4">4.5.1.</span> Code</h4>
<div class="outline-text-4" id="text-4-5-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">ebook-tweaks.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> calibredb
  <span style="color: #c678dd;">:commands</span> calibredb
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> calibredb-root-dir <span style="color: #98be65;">"/home/user/sshfs/calibre/"</span>
        calibredb-db-dir <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"metadata.db"</span> calibredb-root-dir<span style="color: #98be65;">)</span>
        sql-sqlite-program <span style="color: #98be65;">"sqlite3"</span><span style="color: #c678dd;">)</span>

<span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> calibredb-id-width <span style="color: #da8548; font-weight: bold;">12</span><span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> calibredb-format-all-the-icons t<span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> calibredb-format-icons-in-terminal t<span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> calibredb-format-character-icons t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> calibredb-show-mode-map
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"?"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-entry-dispatch</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"o"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-find-file</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"O"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-find-file-other-frame</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"V"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-open-file-with-default-tool</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"s"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata-dispatch</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"e"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-export-dispatch</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"q"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-entry-quit</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"."</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-open-dired</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">[</span>tab<span style="color: #98be65;">]</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-toggle-view-at-point</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-t"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--tags</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-a"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--author_sort</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-A"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--authors</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-T"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--title</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-c"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--comments</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> calibredb-search-mode-map
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">[</span>mouse-3<span style="color: #98be65;">]</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-search-mouse</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"RET"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-find-file</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"?"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-dispatch</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"a"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-add</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"A"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-add-dir</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"c"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-clone</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"d"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-remove</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"D"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-remove-marked-items</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"j"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-next-entry</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"k"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-previous-entry</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"l"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-virtual-library-list</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"L"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-library-list</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"n"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-virtual-library-next</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"N"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-library-next</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"p"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-virtual-library-previous</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"P"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-library-previous</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"s"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata-dispatch</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"S"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-switch-library</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"o"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-find-file</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"O"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-find-file-other-frame</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"v"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-view</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"V"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-open-file-with-default-tool</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"."</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-open-dired</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"b"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-catalog-bib-dispatch</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"e"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-export-dispatch</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"r"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-search-refresh-and-clear-filter</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"R"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-search-clear-filter</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"q"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-search-quit</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"m"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-mark-and-forward</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"f"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-toggle-favorite-at-point</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"x"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-toggle-archive-at-point</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"h"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-toggle-highlight-at-point</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"u"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-unmark-and-forward</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"i"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-edit-annotation</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"DEL"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-unmark-and-backward</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">[</span>backtab<span style="color: #98be65;">]</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-toggle-view</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">[</span>tab<span style="color: #98be65;">]</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-toggle-view-at-point</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-n"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-show-next-entry</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-p"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-show-previous-entry</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"/"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-search-live-filter</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-t"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--tags</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-a"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--author_sort</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-A"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--authors</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-T"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--title</span>
        <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"M-c"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">calibredb-set-metadata--comments</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> nov
  <span style="color: #c678dd;">:mode</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">"\\.epub\\'"</span> . nov-mode<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> nov-mode-map
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"RET"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">nov-scroll-up</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">doom-modeline-segment--nov-info</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span>
     <span style="color: #98be65;">" "</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">propertize</span>
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cdr</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">assoc</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">creator</span> nov-metadata<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">doom-modeline-project-parent-dir</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #98be65;">" "</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">assoc</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">title</span> nov-metadata<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #98be65;">" "</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">propertize</span>
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%d/%d"</span>
              <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">1+</span> nov-documents-index<span style="color: #c678dd;">)</span>
              <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">length</span> nov-documents<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">doom-modeline-info</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">advice-add</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">nov-render-title</span> <span style="color: #c678dd;">:override</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">ignore</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">+nov-mode-setup</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">face-remap-add-relative</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">variable-pitch</span>
                             <span style="color: #c678dd;">:family</span> <span style="color: #98be65;">"Merriweather"</span>
                             <span style="color: #c678dd;">:height</span> <span style="color: #da8548; font-weight: bold;">1.4</span>
                             <span style="color: #c678dd;">:width</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">semi-expanded</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">face-remap-add-relative</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">default</span> <span style="color: #c678dd;">:height</span> <span style="color: #da8548; font-weight: bold;">0.7</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">line-spacing</span> <span style="color: #da8548; font-weight: bold;">0.1</span>
                <span style="color: #dcaeea;">next-screen-context-lines</span> <span style="color: #da8548; font-weight: bold;">4</span>
                shr-use-colors nil<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">visual-fill-column</span> nil t<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">visual-fill-column-center-text</span> t
                <span style="color: #dcaeea;">visual-fill-column-width</span> <span style="color: #da8548; font-weight: bold;">81</span>
                nov-text-width <span style="color: #da8548; font-weight: bold;">120</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #dcaeea;">visual-fill-column-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #dcaeea;">hl-line-mode</span> <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">+lookup-definition-functions</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">+lookup/dictionary-definition</span><span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">mode-line-format</span>
                <span style="color: #51afef;">`</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #c678dd;">:eval</span>
                   <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">doom-modeline-segment--workspace-name</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #c678dd;">:eval</span>
                   <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">doom-modeline-segment--window-number</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #c678dd;">:eval</span>
                   <span style="color: #c678dd;">(</span>doom-modeline-segment--nov-info<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                  ,<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">propertize</span>
                    <span style="color: #98be65;">" %P "</span>
                    <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">doom-modeline-buffer-minor-mode</span><span style="color: #51afef;">)</span>
                  ,<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">propertize</span>
                    <span style="color: #98be65;">" "</span>
                    <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">doom-modeline--active</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mode-line</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mode-line-inactive</span><span style="color: #c678dd;">)</span>
                    <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">display</span> <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>space
                                <span style="color: #c678dd;">:align-to</span>
                                <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">+</span> right right-fringe right-margin<span style="color: #51afef;">)</span>
                                   ,<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">*</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>width <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">doom-modeline--font-width</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                                         <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">=</span> width <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
                                             <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">/</span> width <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">frame-char-width</span><span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">1.0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                                       <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string-width</span>
                                        <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format-mode-line</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cons</span> <span style="color: #98be65;">""</span> <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span><span style="color: #c678dd;">:eval</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">doom-modeline-segment--major-mode</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #c678dd;">:eval</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">doom-modeline-segment--major-mode</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">nov-mode-hook</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">+nov-mode-setup</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">ebook-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4d8ed86" class="outline-3">
<h3 id="org4d8ed86"><span class="section-number-3">4.6.</span> Org-Roam</h3>
<div class="outline-text-3" id="text-4-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-roam-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgaf3fa76" class="outline-4">
<h4 id="orgaf3fa76"><span class="section-number-4">4.6.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-6-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-roam<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-roam-ui<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-roam-timestamps<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-roam-bibtex<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> citar-org-roam<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org05d7a34" class="outline-4">
<h4 id="org05d7a34"><span class="section-number-4">4.6.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-6-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-roam-directory</span> <span style="color: #98be65;">"~/dox/sync/org/roam"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">org-roam-db-autosync-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">org-roam-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orged1c04e" class="outline-3">
<h3 id="orged1c04e"><span class="section-number-3">4.7.</span> Editing</h3>
<div class="outline-text-3" id="text-4-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">editing</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org6f2753a" class="outline-4">
<h4 id="org6f2753a"><span class="section-number-4">4.7.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-7-1">
<p>
#+begin<sub>src</sub> emacs-lisp :tangle packages.el
</p>
</div>
</div>

<div id="outline-container-org556959f" class="outline-4">
<h4 id="org556959f"><span class="section-number-4">4.7.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-7-2">
<p>
#+end<sub>src</sub>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">editing.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">which-active-modes</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Return which minor modes are enabled in the current buffer."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>active-modes<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">mapc</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>mode<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">condition-case</span> nil
                        <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">symbolp</span> mode<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">symbol-value</span> mode<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">active-modes</span> mode<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                      <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">error</span> nil<span style="color: #c678dd;">)</span> <span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #dcaeea;">minor-mode-list</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s"</span> active-modes<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">replace-regexp-entire-buffer</span> <span style="color: #c678dd;">(</span>pattern replacement<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Perform regular-expression replacement throughout buffer."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span>
   <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>args <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">query-replace-read-args</span> <span style="color: #98be65;">"Replace"</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">setcdr</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cdr</span> args<span style="color: #51afef;">)</span> nil<span style="color: #a9a1e1;">)</span>    <span style="color: #5B6268;">; </span><span style="color: #5B6268;">remove third value returned from query---args</span>
     args<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">save-excursion</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">while</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">re-search-forward</span> pattern nil t<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">replace-match</span> replacement<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> toggle-auto-fill-boolean nil
      <span style="color: #dcaeea;">which-key-idle-delay</span> <span style="color: #da8548; font-weight: bold;">0.5</span>
      <span style="color: #dcaeea;">which-key-allow-multiple-replacements</span> t<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> which-key
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">pushnew!</span>
   <span style="color: #dcaeea;">which-key-replacement-alist</span>
   <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #98be65;">""</span> . <span style="color: #98be65;">"\\`+?evil[-:]?</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(?:</span><span style="color: #98be65;">a-</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">?</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">.*</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span><span style="color: #a9a1e1;">)</span> . <span style="color: #a9a1e1;">(</span>nil . <span style="color: #98be65;">"&#9666;\\1"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
   <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\`g s"</span> . <span style="color: #98be65;">"\\`evilem--?motion-</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">.*</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span><span style="color: #a9a1e1;">)</span> . <span style="color: #a9a1e1;">(</span>nil . <span style="color: #98be65;">"&#9667;\\1"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
   <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> company
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">company-idle-delay</span> <span style="color: #da8548; font-weight: bold;">0.5</span>
        <span style="color: #dcaeea;">company-minimum-prefix-length</span> <span style="color: #da8548; font-weight: bold;">2</span>
        <span style="color: #dcaeea;">company-show-numbers</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">evil-normal-state-entry-hook</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">company-abort</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #c678dd;">set-company-backend!</span>
  <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>text-mode
    markdown-mode
    gfm-mode<span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #c678dd;">:seperate</span>
    company-ispell
    company-files
    company-yasnippet<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #c678dd;">set-company-backend!</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ess-r-mode</span>
  <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>company-R-args company-R-objects company-dabbrev-code <span style="color: #c678dd;">:separate</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> vlf-setup
  <span style="color: #c678dd;">:defer-incrementally</span> vlf-tune vlf-base vlf-write vlf-search vlf-occur vlf-follow vlf-ediff vlf<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">eros-eval-result-prefix</span> <span style="color: #98be65;">"&#10233; "</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">toggle-auto-fill-on</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">set-fill-column</span> <span style="color: #da8548; font-weight: bold;">100</span><span style="color: #c678dd;">)</span> <span style="color: #5B6268;">;</span><span style="color: #5B6268;">80</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">auto-fill-mode</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> toggle-auto-fill-boolean t<span style="color: #c678dd;">)</span>
  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(string-match-p "auto-fill-function" (which-active-modes))</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"auto-fill-mode on"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">toggle-auto-fill-off</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">replace-regexp-entire-buffer</span> <span style="color: #98be65;">"\n"</span> <span style="color: #98be65;">" "</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">auto-fill-mode</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> toggle-auto-fill-boolean nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"auto-fill-mode off"</span><span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">toggle-auto-fill</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Toggle auto fill mode and reset buffer to non-auto-fill."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> toggle-auto-fill-boolean
      <span style="color: #98be65;">(</span><span style="color: #c678dd;">toggle-auto-fill-off</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">toggle-auto-fill-on</span><span style="color: #98be65;">)</span>
    <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>



<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"M-q"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">toggle-auto-fill</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> aas
  <span style="color: #c678dd;">:commands</span> aas-mode<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">yas-triggers-in-field</span> t<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> string-inflection
  <span style="color: #c678dd;">:commands</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string-inflection-all-cycle</span>
             string-inflection-toggle
             string-inflection-camelcase
             string-inflection-lower-camelcase
             string-inflection-kebab-case
             string-inflection-underscore
             string-inflection-capital-underscore
             string-inflection-upcase<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:init</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:leader</span> <span style="color: #c678dd;">:prefix</span> <span style="color: #98be65;">(</span><span style="color: #98be65;">"c~"</span> . <span style="color: #98be65;">"naming convention"</span><span style="color: #98be65;">)</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"cycle"</span> <span style="color: #98be65;">"~"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">string-inflection-all-cycle</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"toggle"</span> <span style="color: #98be65;">"t"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">string-inflection-toggle</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"CamelCase"</span> <span style="color: #98be65;">"c"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">string-inflection-camelcase</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"downCase"</span> <span style="color: #98be65;">"d"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">string-inflection-lower-camelcase</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"kebab-case"</span> <span style="color: #98be65;">"k"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">string-inflection-kebab-case</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"under_score"</span> <span style="color: #98be65;">"_"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">string-inflection-underscore</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"Upper_Score"</span> <span style="color: #98be65;">"u"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">string-inflection-capital-underscore</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"UP_CASE"</span> <span style="color: #98be65;">"U"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">string-inflection-upcase</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">after!</span> evil
    <span style="color: #98be65;">(</span><span style="color: #51afef;">evil-define-operator</span> <span style="color: #c678dd;">evil-operator-string-inflection</span> <span style="color: #a9a1e1;">(</span>beg end _type<span style="color: #a9a1e1;">)</span>
      <span style="color: #83898d;">"Define a new evil operator that cycles symbol casing."</span>
      <span style="color: #c678dd;">:move-point</span> nil
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"&lt;R&gt;"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-inflection-all-cycle</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">evil-repeat-info</span> <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span><span style="color: #c678dd;">[</span>?g ?~<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> <span style="color: #dcaeea;">evil-normal-state-map</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"g~"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">evil-operator-string-inflection</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> <span style="color: #dcaeea;">evil-normal-state-map</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"&lt;remap&gt; &lt;evil-next-line&gt;"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">evil-next-visual-line</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> <span style="color: #dcaeea;">evil-normal-state-map</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"&lt;remap&gt; &lt;evil-previous-line&gt;"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">evil-previous-visual-line</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> <span style="color: #dcaeea;">evil-motion-state-map</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"&lt;remap&gt; &lt;evil-next-line&gt;"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">evil-next-visual-line</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> <span style="color: #dcaeea;">evil-motion-state-map</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"&lt;remap&gt; &lt;evil-previous-line&gt;"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">evil-previous-visual-line</span><span style="color: #98be65;">)</span>
    <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">sp-local-pair</span>
 <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>org-mode<span style="color: #c678dd;">)</span>
 <span style="color: #98be65;">"&lt;&lt;"</span> <span style="color: #98be65;">"&gt;&gt;"</span>
 <span style="color: #c678dd;">:actions</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>insert<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> authinfo-color-mode
  <span style="color: #c678dd;">:mode</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">"authinfo.gpg\\'"</span> . authinfo-color-mode<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:init</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">advice-add</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">authinfo-mode</span> <span style="color: #c678dd;">:override</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">authinfo-color-mode</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> systemd
  <span style="color: #c678dd;">:defer</span> t<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">global-visual-line-mode</span> t
 <span style="color: #dcaeea;">evil-respect-visual-line-mode</span> t<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">editing</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org919188a" class="outline-3">
<h3 id="org919188a"><span class="section-number-3">4.8.</span> Elfeed Tweaks</h3>
<div class="outline-text-3" id="text-4-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org0f89e09" class="outline-4">
<h4 id="org0f89e09"><span class="section-number-4">4.8.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-8-1">
<p>
#+begin<sub>src</sub> emacs-lisp :tangle packages.el
</p>
</div>
</div>

<div id="outline-container-org280d812" class="outline-4">
<h4 id="org280d812"><span class="section-number-4">4.8.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-8-2">
<p>
#+end<sub>src</sub>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">elfeed-tweaks.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> rmh-elfeed-org-files <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">cons</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"ext/elfeed/elfeed.org"</span> <span style="color: #dcaeea;">doom-private-dir</span><span style="color: #98be65;">)()</span><span style="color: #c678dd;">)</span>
      elfeed-db-directory <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"ext/elfeed/db/"</span> <span style="color: #dcaeea;">doom-private-dir</span><span style="color: #c678dd;">)</span>
      elfeed-thumbnail-dir <span style="color: #98be65;">"/tmp/elfeed-thumbnails/"</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> elfeed-search-mode-map
      <span style="color: #c678dd;">:after</span> elfeed-search
                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">[remap kill-this-buffer] "q"</span>
                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">[remap kill-buffer] "q"</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #dcaeea;">doom-leader-key</span> nil
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"q"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-save-summary</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"e"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-update</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"r"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-untag-all-unread</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"u"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-tag-all-unread</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"s"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-live-filter</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"RET"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-show-entry</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"p"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-pdf</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"v"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-youtube-dl</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"L"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">youtube-dl-list</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"+"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-tag-all</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"-"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-untag-all</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"S"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-set-filter</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"b"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-browse-url</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"t"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-thumbnail</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"y"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-yank</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> elfeed-show-mode-map
      <span style="color: #c678dd;">:after</span> elfeed-show
                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">[remap kill-this-buffer] "q"</span>
                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">[remap kill-buffer] "q"</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #dcaeea;">doom-leader-key</span> nil
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"q"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-save-close</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"o"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">ace-link-elfeed</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"A"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-wget-url</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"RET"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-tube-mpv-open</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"n"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-next</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"N"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-prev</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"p"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-pdf</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"v"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-youtube-dl</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"d"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-download-enclosure</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"D"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-download-enclosure</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"L"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">youtube-dl-list</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"+"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-tag</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"-"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-untag</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"s"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-new-live-search</span>
      <span style="color: #c678dd;">:nm</span> <span style="color: #98be65;">"y"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-show-yank</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> elfeed-summary-mode-map
      <span style="color: #c678dd;">:after</span> elfeed-summary
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"L"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">youtube-dl-list</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"V"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">open-yt-dl-videos</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"R"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-summary-load-update</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"C-x C-s"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-summary-save</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"RET"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-summary-action-save-location</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> elfeed-search
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">set-evil-initial-state!</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-search-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">normal</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> elfeed-show-mode
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">set-evil-initial-state!</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-show-mode</span>   <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">normal</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> evil-snipe
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">push</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-show-mode</span>   <span style="color: #dcaeea;">evil-snipe-disabled-modes</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">push</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-search-mode</span> <span style="color: #dcaeea;">evil-snipe-disabled-modes</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> elfeed
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">elfeed-org</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">use-package!</span> elfeed-link<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>elfeed-db-load<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #5B6268;">;</span><span style="color: #5B6268;">elfeed-search-filter "@1-week-ago +unread"</span>
        elfeed-search-filter <span style="color: #98be65;">"@3-days-ago unread"</span>
        <span style="color: #dcaeea;">flycheck-global-modes</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span>not . <span style="color: #a9a1e1;">(</span>elfeed-search-mode<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        elfeed-summary--only-unread t
        elfeed-search-print-entry-function <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">+rss/elfeed-search-print-entry</span>
        elfeed-search-title-min-width <span style="color: #da8548; font-weight: bold;">80</span>
        elfeed-show-entry-switch <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">pop-to-buffer</span>
        elfeed-show-entry-delete <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">+rss/delete-pane</span>
        elfeed-show-refresh-function <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">+rss/elfeed-show-refresh--better-style</span>
        shr-max-image-proportion <span style="color: #da8548; font-weight: bold;">0.6</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-show-mode-hook</span> <span style="color: #98be65;">(</span><span style="color: #dcaeea;">hide-mode-line-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-eb-garamond</span> <span style="color: #98be65;">()</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">buffer-face-set</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:family</span> <span style="color: #98be65;">"EB Garamond"</span> <span style="color: #c678dd;">:height</span> <span style="color: #da8548; font-weight: bold;">120</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

<span style="color: #c678dd;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-show-mode-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-eb-garamond</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-search-update-hook</span> <span style="color: #51afef;">#'</span><span style="color: #dcaeea;">hide-mode-line-mode</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defface</span> <span style="color: #dcaeea;">elfeed-show-title-face</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #51afef;">(</span><span style="color: #c678dd;">:weight</span> ultrabold <span style="color: #c678dd;">:slant</span> italic <span style="color: #c678dd;">:height</span> <span style="color: #da8548; font-weight: bold;">1.5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #83898d;">"title face in elfeed show buffer"</span>
    <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defface</span> <span style="color: #dcaeea;">elfeed-show-author-face</span> <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #51afef;">(</span><span style="color: #c678dd;">:weight</span> light<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #83898d;">"title face in elfeed show buffer"</span>
    <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">set-face-attribute</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-search-title-face</span> nil
                      <span style="color: #c678dd;">:foreground</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">nil</span>
                      <span style="color: #c678dd;">:weight</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">light</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defadvice!</span> +rss-elfeed-wrap-h-nicer <span style="color: #98be65;">()</span>
    <span style="color: #83898d;">"Enhances an elfeed entry's readability by wrapping it to a width of</span>
<span style="color: #83898d;">`</span><span style="color: #a9a1e1;">fill-column</span><span style="color: #83898d;">' and centering it with `</span><span style="color: #a9a1e1;">visual-fill-column-mode</span><span style="color: #83898d;">'."</span>
    <span style="color: #c678dd;">:override</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">+rss-elfeed-wrap-h</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">truncate-lines</span> nil
                shr-width <span style="color: #da8548; font-weight: bold;">120</span>
                <span style="color: #dcaeea;">visual-fill-column-center-text</span> t
                <span style="color: #dcaeea;">default-text-properties</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span>line-height <span style="color: #da8548; font-weight: bold;">1.1</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">inhibit-read-only</span> t<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #dcaeea;">inhibit-modification-hooks</span> t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">visual-fill-column-mode</span> nil<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq-local</span> shr-current-font <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span><span style="color: #c678dd;">:family</span> <span style="color: #98be65;">"Linux Libertine O"</span> <span style="color: #c678dd;">:height</span> <span style="color: #da8548; font-weight: bold;">1.2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">set-buffer-modified-p</span> nil<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">+rss/elfeed-search-print-entry</span> <span style="color: #98be65;">(</span>entry<span style="color: #98be65;">)</span>
    <span style="color: #83898d;">"Print ENTRY to the buffer."</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>elfeed-goodies/tag-column-width <span style="color: #da8548; font-weight: bold;">40</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>elfeed-goodies/feed-source-column-width <span style="color: #da8548; font-weight: bold;">30</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>title <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">(</span>elfeed-meta entry <span style="color: #c678dd;">:title</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span>elfeed-entry-title entry<span style="color: #98be65;">)</span> <span style="color: #98be65;">""</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>title-faces <span style="color: #c678dd;">(</span>elfeed-search--faces <span style="color: #98be65;">(</span>elfeed-entry-tags entry<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>feed <span style="color: #c678dd;">(</span>elfeed-entry-feed entry<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>feed-title
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> feed
              <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span>elfeed-meta feed <span style="color: #c678dd;">:title</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>elfeed-feed-title feed<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>tags <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapcar</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">symbol-name</span> <span style="color: #98be65;">(</span>elfeed-entry-tags entry<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>tags-str <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">mapconcat</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">identity</span> tags <span style="color: #98be65;">","</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>title-width <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">window-width</span><span style="color: #98be65;">)</span> elfeed-goodies/feed-source-column-width
                           elfeed-goodies/tag-column-width <span style="color: #da8548; font-weight: bold;">4</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

           <span style="color: #51afef;">(</span>tag-column <span style="color: #c678dd;">(</span>elfeed-format-column
                        tags-str <span style="color: #98be65;">(</span>elfeed-clamp <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">length</span> tags-str<span style="color: #a9a1e1;">)</span>
                                               elfeed-goodies/tag-column-width
                                               elfeed-goodies/tag-column-width<span style="color: #98be65;">)</span>
                        <span style="color: #c678dd;">:left</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>feed-column <span style="color: #c678dd;">(</span>elfeed-format-column
                         feed-title <span style="color: #98be65;">(</span>elfeed-clamp elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width<span style="color: #98be65;">)</span>
                         <span style="color: #c678dd;">:left</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>

                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(insert (propertize feed-column 'face 'elfeed-search-feed-face) " ")</span>
                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(insert (propertize tag-column 'face 'elfeed-search-tag-face) " ")</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">propertize</span> title <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> title-faces <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">kbd-help</span> title<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">line-spacing</span> <span style="color: #da8548; font-weight: bold;">0.2</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">+rss/elfeed-show-refresh--better-style</span> <span style="color: #98be65;">()</span>
    <span style="color: #83898d;">"Update the buffer to match the selected entry, using a mail-style."</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">inhibit-read-only</span> t<span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>title <span style="color: #c678dd;">(</span>elfeed-entry-title elfeed-show-entry<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>date <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">seconds-to-time</span> <span style="color: #98be65;">(</span>elfeed-entry-date elfeed-show-entry<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>author <span style="color: #c678dd;">(</span>elfeed-meta elfeed-show-entry <span style="color: #c678dd;">:author</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>link <span style="color: #c678dd;">(</span>elfeed-entry-link elfeed-show-entry<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>tags <span style="color: #c678dd;">(</span>elfeed-entry-tags elfeed-show-entry<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>tagsstr <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapconcat</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">symbol-name</span> tags <span style="color: #98be65;">", "</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>nicedate <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format-time-string</span> <span style="color: #98be65;">"%a, %e %b %Y %T %Z"</span> date<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>content <span style="color: #c678dd;">(</span>elfeed-deref <span style="color: #98be65;">(</span>elfeed-entry-content elfeed-show-entry<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>type <span style="color: #c678dd;">(</span>elfeed-entry-content-type elfeed-show-entry<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>feed <span style="color: #c678dd;">(</span>elfeed-entry-feed elfeed-show-entry<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>feed-title <span style="color: #c678dd;">(</span>elfeed-feed-title feed<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>base <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> feed <span style="color: #98be65;">(</span>elfeed-compute-base <span style="color: #a9a1e1;">(</span>elfeed-feed-url feed<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">erase-buffer</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"\n"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s\n\n"</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">propertize</span> title <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-show-title-face</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s\t"</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">propertize</span> feed-title <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-search-feed-face</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> author elfeed-show-entry-author<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s\n"</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">propertize</span> author <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-show-author-face</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s\n\n"</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">propertize</span> nicedate <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-log-date-face</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> tags
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s\n"</span>
                        <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">propertize</span> tagsstr <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-search-tag-face</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">(insert (propertize "Link: " 'face 'message-header-name))</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">(elfeed-insert-link link link)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">(insert "\n")</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cl-loop</span> for enclosure in <span style="color: #51afef;">(</span>elfeed-entry-enclosures elfeed-show-entry<span style="color: #51afef;">)</span>
               do <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">propertize</span> <span style="color: #98be65;">"Enclosure: "</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">message-header-name</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
               do <span style="color: #51afef;">(</span>elfeed-insert-link <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">car</span> enclosure<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
               do <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"\n"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"\n"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> content
          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> type <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">html</span><span style="color: #c678dd;">)</span>
              <span style="color: #c678dd;">(</span>elfeed-insert-html content base<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert</span> content<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">propertize</span> <span style="color: #98be65;">"(empty)\n"</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">italic</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defface</span> <span style="color: #dcaeea;">elfeed-youtube</span>
    <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #c678dd;">:foreground</span> <span style="color: #98be65;">"purple"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #83898d;">"Marks YouTube videos in Elfeed."</span>
    <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defface</span> <span style="color: #dcaeea;">elfeed-religion</span>
    <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #c678dd;">:foreground</span> <span style="color: #98be65;">"gold"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #83898d;">"Marks YouTube videos in Elfeed."</span>
    <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defface</span> <span style="color: #dcaeea;">elfeed-tech</span>
    <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>t <span style="color: #c678dd;">:foreground</span> <span style="color: #98be65;">"LightSteelBlue4"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #83898d;">"Marks Tech videos in Elfeed."</span>
    <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">push</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span>youtube elfeed-youtube<span style="color: #98be65;">)</span>
        elfeed-search-face-alist<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">push</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span>religion elfeed-religion<span style="color: #98be65;">)</span>
        elfeed-search-face-alist<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">push</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span>tech elfeed-tech<span style="color: #98be65;">)</span>
        elfeed-search-face-alist<span style="color: #c678dd;">)</span>


  <span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> elfeed-show
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">url</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-show-download-enclosure</span> <span style="color: #98be65;">()</span>
    <span style="color: #83898d;">"Download the enclosure to yt-dlp directory"</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>url-enclosure <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">car</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">elt</span> <span style="color: #a9a1e1;">(</span>elfeed-entry-enclosures elfeed-show-entry<span style="color: #a9a1e1;">)</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>filename <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> elfeed-enclosure-default-dir <span style="color: #98be65;">"/"</span> <span style="color: #98be65;">(</span>elfeed-entry-title elfeed-show-entry<span style="color: #98be65;">)</span> <span style="color: #98be65;">".mp3"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span>elfeed--download-enclosure url-enclosure filename<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"Downloading %s"</span> filename<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">elfeed-pdf-dir</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"pdfs/"</span>
                      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-name-directory</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">directory-file-name</span> elfeed-enclosure-default-dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">elfeed-link-pdfs</span>
    <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"https://www.jstatsoft.org/index.php/jss/article/view/v0</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">/]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> . <span style="color: #98be65;">"https://www.jstatsoft.org/index.php/jss/article/view/v0\\1/v\\1.pdf"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"http://arxiv.org/abs/</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">/]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> . <span style="color: #98be65;">"https://arxiv.org/pdf/\\1.pdf"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #83898d;">"List of alists of the form (REGEX-FOR-LINK . FORM-FOR-PDF)"</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-show-pdf</span> <span style="color: #98be65;">(</span>entry<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">list</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> elfeed-show-entry <span style="color: #c678dd;">(</span>elfeed-search-selected <span style="color: #c678dd;">:ignore-region</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>link <span style="color: #c678dd;">(</span>elfeed-entry-link entry<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>feed-name <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #98be65;">(</span>elfeed-feed-meta <span style="color: #a9a1e1;">(</span>elfeed-entry-feed entry<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #c678dd;">:title</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>title <span style="color: #c678dd;">(</span>elfeed-entry-title entry<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>file-view-function
           <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">(</span>f<span style="color: #98be65;">)</span>
             <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> elfeed-show-entry
               <span style="color: #a9a1e1;">(</span>elfeed-kill-buffer<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
             <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">pop-to-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">find-file-noselect</span> f<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          pdf<span style="color: #a9a1e1;">)</span>

      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>file <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span>
                   <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">subst-char-in-string</span> ?/ ?, title<span style="color: #51afef;">)</span> <span style="color: #98be65;">".pdf"</span><span style="color: #a9a1e1;">)</span>
                   <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">subst-char-in-string</span> ?/ ?, feed-name<span style="color: #51afef;">)</span>
                                     elfeed-pdf-dir<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-exists-p</span> file<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">funcall</span> file-view-function file<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #98be65;">(</span>link-pdf elfeed-link-pdfs<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">string-match-p</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">car</span> link-pdf<span style="color: #c678dd;">)</span> link<span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">not</span> pdf<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> pdf <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">replace-regexp-in-string</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">car</span> link-pdf<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">cdr</span> link-pdf<span style="color: #c678dd;">)</span> link<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">not</span> pdf<span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"No associated PDF for entry"</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Fetching %s"</span> pdf<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-exists-p</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-name-directory</span> file<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">make-directory</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-name-directory</span> file<span style="color: #51afef;">)</span> t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">url-copy-file</span> pdf file<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">funcall</span> file-view-function file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> elfeed-summary
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">elfeed-org</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-summary-save</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Save database"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>elfeed-db-save-safe<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-save-summary</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Save database and go to summary"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>elfeed-db-save-safe<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kill-this-buffer</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">elfeed-summary</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">boundp</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-summary--current-pos</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> elfeed-summary--current-pos<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-save-close</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Save database and close rss"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>elfeed-db-save-safe<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">+rss/delete-pane</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-load-summary</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Load database and go to summary"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">functionp</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-db-load</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">get-buffer</span> <span style="color: #98be65;">"*elfeed-summary*"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">make-thread</span> <span style="color: #a9a1e1;">(</span>elfeed-db-load<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">elfeed-summary</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">boundp</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-summary--current-pos</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">progn</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> elfeed-summary--current-pos<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">recenter-top-bottom</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-summary-load-update</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Loads the database again before updating"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>elfeed-db-load<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Refreshing db..."</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">elfeed-update</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>elfeed-summary-update<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> elfeed-summary-settings
      <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Blogs [Security]"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> people security<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Blogs [People]"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> people <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">not</span> security<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                <span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Religion"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . religion<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Cooking"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . cooking<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"ASMR"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . asmr<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Crafting"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . crafting<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Entertainment"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . entertainment<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Finances"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . finances<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Foreign Places"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . foreign_places<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Geography"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . geography<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"History"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . history<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Language"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . language<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Math"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . music<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Nature"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . nature<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Philosophy"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . philosophy<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Politics"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . politics<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Science"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . science<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"SCP"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . scp<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Tech"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . tech<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Podcasts"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . podcast<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Pictures"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                <span style="color: #51afef;">(</span>query . picture<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">...</span>
        <span style="color: #98be65;">(</span>group <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Miscellaneous"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:elements</span>
                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(group</span>
                                        <span style="color: #5B6268;">; </span><span style="color: #5B6268;">(:title . "Searches")</span>
                                        <span style="color: #5B6268;">; </span><span style="color: #5B6268;">(:elements</span>
                                        <span style="color: #5B6268;">;  </span><span style="color: #5B6268;">(search</span>
                                        <span style="color: #5B6268;">;   </span><span style="color: #5B6268;">(:filter . "@6-months-ago")</span>
                                        <span style="color: #5B6268;">;   </span><span style="color: #5B6268;">(:title . "Unread"))))</span>
                <span style="color: #51afef;">(</span>group
                 <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:title</span> . <span style="color: #98be65;">"Ungrouped"</span><span style="color: #c678dd;">)</span>
                 <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:elements</span> <span style="color: #c678dd;">:misc</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-e"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-load-summary</span><span style="color: #51afef;">)</span>

                                        <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Elfeed Youtube</span>

                                        <span style="color: #5B6268;">; </span><span style="color: #5B6268;">External youtube-dl library</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">load-path</span> <span style="color: #98be65;">"~/.doom.d/lisp/youtube-dl-emacs"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #c678dd;">after-startup</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">youtube-dl</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">youtube-dl-directory</span> <span style="color: #98be65;">"~/elfeed-youtube"</span>
      elfeed-enclosure-default-dir <span style="color: #dcaeea;">youtube-dl-directory</span>
      youtube-dl-temp-directory <span style="color: #98be65;">"/tmp/elfeed-youtube"</span>
      <span style="color: #dcaeea;">youtube-dl-program</span> <span style="color: #98be65;">"yt-dlp"</span>
      <span style="color: #dcaeea;">youtube-dl-arguments</span>
      <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">nconc</span> <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"-f"</span> <span style="color: #98be65;">"bestvideo[height&lt;=1080]+bestaudio/best[height&lt;=1080]"</span>
               <span style="color: #98be65;">"--sponsorblock-remove"</span> <span style="color: #98be65;">"default"</span>
               <span style="color: #98be65;">"--prefer-free-formats"</span>
               <span style="color: #98be65;">"--embed-subs"</span>
               <span style="color: #98be65;">"--embed-metadata"</span>
               <span style="color: #98be65;">"--embed-chapters"</span>
               <span style="color: #98be65;">"--ffmpeg-location"</span> <span style="color: #98be65;">"/home/user/.doom.d/ext/bin/"</span>
               <span style="color: #98be65;">"--no-colors"</span><span style="color: #98be65;">)</span>
             <span style="color: #dcaeea;">youtube-dl-arguments</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                                        <span style="color: #5B6268;">; </span><span style="color: #5B6268;">(setq youtube-dl-arguments nil)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-v"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">open-yt-dl-videos</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-V"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">open-yt-dl-temp-videos</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">open-yt-dl-videos</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #dcaeea;">youtube-dl-directory</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">open-yt-dl-temp-videos</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> youtube-dl-temp-directory<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">elfeed-show-youtube-dl</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;key</span> slow<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Download the current entry with youtube-dl."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">null</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">youtube-dl</span> <span style="color: #51afef;">(</span>elfeed-entry-link elfeed-show-entry<span style="color: #51afef;">)</span>
                        <span style="color: #c678dd;">:title</span> <span style="color: #51afef;">(</span>elfeed-entry-title elfeed-show-entry<span style="color: #51afef;">)</span>
                        <span style="color: #c678dd;">:slow</span> slow<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Entry is not a YouTube link!"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Downloading %s"</span> <span style="color: #a9a1e1;">(</span>elfeed-entry-title elfeed-show-entry<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">elfeed-search-youtube-dl</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;key</span> slow<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Download the current entry with youtube-dl."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>entries <span style="color: #51afef;">(</span>elfeed-search-selected<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #a9a1e1;">(</span>entry entries<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">null</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">youtube-dl</span> <span style="color: #98be65;">(</span>elfeed-entry-link entry<span style="color: #98be65;">)</span>
                            <span style="color: #c678dd;">:title</span> <span style="color: #98be65;">(</span>elfeed-entry-title entry<span style="color: #98be65;">)</span>
                            <span style="color: #c678dd;">:slow</span> slow<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Entry is not a YouTube link!"</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Downloading %s"</span> <span style="color: #c678dd;">(</span>elfeed-entry-title entry<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span>elfeed-untag entry <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">unread</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span>elfeed-search-update-entry entry<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">use-region-p</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">forward-line</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">youtube-dl-list-url</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Return url of item under point."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>n <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">1-</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">line-number-at-pos</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>item <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">nth</span> n <span style="color: #dcaeea;">youtube-dl-items</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> item
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">youtube-dl-item-destination</span> item<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                                        <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Faces</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-summary-action-save-location</span> <span style="color: #c678dd;">(</span>pos <span style="color: #ECBE7B;">&amp;optional</span> event<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"@d"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> elfeed-summary--current-pos pos<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>elfeed-summary--action pos event<span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>



<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">image-tooltip</span> <span style="color: #c678dd;">(</span>img-path<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Display image at img-path as tooltip"</span>
  <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">tooltip-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">tooltip-show</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">propertize</span> <span style="color: #98be65;">"Look in minbuffer"</span>
                <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">display</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">create-image</span> img-path<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-search-thumbnail</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Display the thumbnail of the currently selected video"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mkdir</span> elfeed-thumbnail-dir t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>buffer <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>entries <span style="color: #51afef;">(</span>elfeed-search-selected<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">cl-loop</span> for entry in entries
             when <span style="color: #a9a1e1;">(</span>elfeed-entry-link entry<span style="color: #a9a1e1;">)</span>
             do <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>title <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> elfeed-thumbnail-dir <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">secure-hash</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">sha224</span> <span style="color: #51afef;">(</span>elfeed-entry-title entry<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-exists-p</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> title <span style="color: #98be65;">".jpg"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                      <span style="color: #c678dd;">(</span><span style="color: #c678dd;">image-tooltip</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> title <span style="color: #98be65;">".jpg"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                    <span style="color: #c678dd;">(</span><span style="color: #c678dd;">youtube-dl-get-video-thumbnail</span> it title <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>a<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">image-tooltip</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span> title <span style="color: #98be65;">".jpg"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">with-current-buffer</span> buffer
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">mapc</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">elfeed-search-update-entry</span> entries<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> elfeed-search-remain-on-entry <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">use-region-p</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-wget-url</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Wgets URL at point to elfeed video dir"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>url <span style="color: #51afef;">(</span>shr-url-at-point <span style="color: #dcaeea;">current-prefix-arg</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">display-buffer-alist</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"*Async Shell Command*"</span> display-buffer-no-window <span style="color: #51afef;">(</span>nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">async-shell-command</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"wget -O "</span> <span style="color: #dcaeea;">youtube-dl-directory</span> <span style="color: #98be65;">"/\""</span> <span style="color: #51afef;">(</span>elfeed-entry-title elfeed-show-entry<span style="color: #51afef;">)</span> <span style="color: #98be65;">"\".mp3 "</span> url<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">youtube-dl-move-temp</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Moves content of elfeed video dir to temporary location"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mkdir</span> youtube-dl-temp-directory t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">display-buffer-alist</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"*Async Shell Command*"</span> display-buffer-no-window <span style="color: #a9a1e1;">(</span>nil<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">async-shell-command</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"mv "</span> <span style="color: #dcaeea;">youtube-dl-directory</span> <span style="color: #98be65;">"/* "</span> youtube-dl-temp-directory <span style="color: #98be65;">"/"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> elfeed-tube
  <span style="color: #c678dd;">:after</span> elfeed
  <span style="color: #c678dd;">:demand</span> t
  <span style="color: #c678dd;">:config</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">(setq elfeed-tube-auto-save-p nil) ; default value</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">(setq elfeed-tube-auto-fetch-p t)  ; default value</span>
  <span style="color: #c678dd;">(</span>elfeed-tube-setup<span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">:bind</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:map</span> elfeed-show-mode-map
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"F"</span> . elfeed-tube-fetch<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">[</span>remap save-buffer<span style="color: #a9a1e1;">]</span> . elfeed-tube-save<span style="color: #98be65;">)</span>
         <span style="color: #c678dd;">:map</span> elfeed-search-mode-map
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"F"</span> . elfeed-tube-fetch<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">[</span>remap save-buffer<span style="color: #a9a1e1;">]</span> . elfeed-tube-save<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> elfeed-tube-mpv
  <span style="color: #c678dd;">:bind</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"C-c C-f"</span> . elfeed-tube-mpv-follow-mode<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"C-c C-w"</span> . elfeed-tube-mpv-where<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> elfeed-tube-captions-languages <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"en"</span> <span style="color: #98be65;">"de"</span> <span style="color: #98be65;">"la"</span> <span style="color: #98be65;">"english (auto generated)"</span> <span style="color: #98be65;">"german (auto generated)"</span><span style="color: #c678dd;">)</span>
      elfeed-tube-captions-chunk-time <span style="color: #da8548; font-weight: bold;">60</span>
      elfeed-tube-thumbnail-size <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">large</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">elfeed-tube-mpv-open</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Opens selected elfeed tube feed in mpv and activates follow mode"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">elfeed-tube-mpv-follow-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>elfeed-tube-mpv <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">elfeed-show-mode-hook</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>lambda <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">elfeed-tube-mpv-follow-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">elfeed-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga90fe10" class="outline-3">
<h3 id="orga90fe10"><span class="section-number-3">4.9.</span> Interface</h3>
<div class="outline-text-3" id="text-4-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">interface</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org9e95a37" class="outline-4">
<h4 id="org9e95a37"><span class="section-number-4">4.9.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-9-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org341a82c" class="outline-4">
<h4 id="org341a82c"><span class="section-number-4">4.9.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-9-2">
</div>
<div id="outline-container-org257cef3" class="outline-5">
<h5 id="org257cef3"><span class="section-number-5">4.9.2.1.</span> General settings</h5>
<div class="outline-text-5" id="text-4-9-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span>
 <span style="color: #dcaeea;">x-stretch-cursor</span> t<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">good-scroll-mode</span> <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span> <span style="color: #dcaeea;">word-wrap</span> t<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">undo-limit</span> <span style="color: #da8548; font-weight: bold;">80000000</span>                         <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Raise undo-limit to 80Mb</span>
      <span style="color: #dcaeea;">evil-want-fine-undo</span> t                       <span style="color: #5B6268;">; </span><span style="color: #5B6268;">By default while in insert all changes are one big blob. Be more granular</span>
      <span style="color: #dcaeea;">truncate-string-ellipsis</span> <span style="color: #98be65;">"&#8230;"</span>                <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Unicode ellispis are nicer than "...", and also save /precious/ space</span>
      <span style="color: #dcaeea;">password-cache-expiry</span> nil                   <span style="color: #5B6268;">; </span><span style="color: #5B6268;">I can trust my computers ... can't I?</span>
      <span style="color: #dcaeea;">scroll-margin</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span>                            <span style="color: #5B6268;">; </span><span style="color: #5B6268;">It's nice to maintain a little margin</span>

<span style="color: #51afef;">(</span><span style="color: #dcaeea;">display-time-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>                             <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Enable time in the mode-line</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">display-battery-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb20b181" class="outline-5">
<h5 id="orgb20b181"><span class="section-number-5">4.9.2.2.</span> Font</h5>
<div class="outline-text-5" id="text-4-9-2-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Unicode emojis</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">&gt;=</span> <span style="color: #dcaeea;">emacs-major-version</span> <span style="color: #da8548; font-weight: bold;">27</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">set-fontset-font</span> t <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #da8548; font-weight: bold;">#x1f000</span> . <span style="color: #da8548; font-weight: bold;">#x1faff</span><span style="color: #98be65;">)</span>
                      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">font-spec</span> <span style="color: #c678dd;">:family</span> <span style="color: #98be65;">"Noto Color Emoji"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">set-face-attribute</span>
 <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">default</span> nil <span style="color: #c678dd;">:stipple</span> nil <span style="color: #c678dd;">:height</span> <span style="color: #da8548; font-weight: bold;">120</span> <span style="color: #c678dd;">:width</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">normal</span> <span style="color: #c678dd;">:inverse-video</span> nil <span style="color: #c678dd;">:box</span> nil <span style="color: #c678dd;">:strike-through</span> nil <span style="color: #c678dd;">:overline</span> nil <span style="color: #c678dd;">:underline</span> nil <span style="color: #c678dd;">:slant</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">normal</span> <span style="color: #c678dd;">:weight</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">normal</span> <span style="color: #c678dd;">:foundry</span> <span style="color: #98be65;">"outline"</span> <span style="color: #c678dd;">:family</span> <span style="color: #98be65;">"Source Code Pro for Powerline"</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">;;;; </span><span style="color: #5B6268;">setting up composition functions for emoji modifiers</span>
<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">(dolist (items `(((?&#127462; . ?&#127487;) [".[&#127462;-&#127487;]+" 0 font-shape-gstring])</span>
<span style="color: #5B6268;">;                 </span><span style="color: #5B6268;">((?&#127987; . ?&#127988;) [".[&#65039;&#8205;&#127752;&#9895;&#9760;&#917536;-&#917631;]*" 0 font-shape-gstring])</span>
<span style="color: #5B6268;">;                 </span><span style="color: #5B6268;">(?&#8419; ["[#*0-9]&#65039;&#8419;" 2 font-shape-gstring])</span>
<span style="color: #5B6268;">;                 </span><span style="color: #5B6268;">;; </span><span style="color: #ECBE7B; font-weight: bold;">TODO:</span><span style="color: #5B6268;"> I can't make keycap sequences work because I</span>
<span style="color: #5B6268;">;                 </span><span style="color: #5B6268;">;; think they're trying to shape with the wrong font.</span>
<span style="color: #5B6268;">;                 </span><span style="color: #5B6268;">,@(mapcar (lambda (range) (list range [".&#8205;?[&#127995;-&#127999;]?[&#8205;&#65039;&#9794;&#9792;]*&#65039;?" 0 font-shape-gstring]))</span>
<span style="color: #5B6268;">;                           </span><span style="color: #5B6268;">(concatenate 'list "&#9757;&#127877;&#127943;&#128066;&#128067;&#128102;&#128103;&#128124;&#128143;&#128145;&#128170;&#128372;&#128373;&#128378;&#128400;&#128405;&#128406;&#128583;&#128675;&#128704;&#128716;&#129295;&#129310;&#129311;&#129318;&#129341;&#129342;&#129399;&#129467;&#128111;&#10084;"</span>
<span style="color: #5B6268;">;                                        </span><span style="color: #5B6268;">'((?&#9977; . ?&#9997;) (?&#127938; . ?&#127940;) (?&#127946; . ?&#127948;) (?&#128070; . ?&#128080;)</span>
<span style="color: #5B6268;">;                                          </span><span style="color: #5B6268;">(?&#128107; . ?&#128110;) (?&#128112; . ?&#128120;) (?&#128129; . ?&#128135;) (?&#128581; . ?&#128583;) (?&#128587; . ?&#128591;)</span>
<span style="color: #5B6268;">;                                          </span><span style="color: #5B6268;">(?&#128692; . ?&#128694;) (?&#129304; . ?&#129308;) (?&#129328; . ?&#129337;) (?&#129340; . ?&#129342;) (?&#129461; . ?&#129465;)</span>
<span style="color: #5B6268;">;                                          </span><span style="color: #5B6268;">(?&#129485; . ?&#129487;) (?&#129490; . ?&#129503;))) )</span>
<span style="color: #5B6268;">;                 </span><span style="color: #5B6268;">(?&#129489; [".&#8205;?[&#127995;-&#127999;]?[&#8205;&#9877;&#9878;&#9992;&#10084;&#65039;&#127806;&#127859;&#127868;&#127876;&#127891;&#127908;&#127912;&#127979;&#127981;&#128102;-&#128105;&#128139;&#128187;&#128188;&#128295;&#128300;&#128640;&#128658;&#129309;&#129455;&#129456;-&#129459;&#129468;&#129469;&#129489;]*" 0 font-shape-gstring])</span>
<span style="color: #5B6268;">;                 </span><span style="color: #5B6268;">((?&#128104; . ?&#128105;) [".&#8205;?[&#127995;-&#127999;]?[&#8205;&#9877;&#9878;&#9992;&#10084;&#65039;&#127806;&#127859;&#127868;&#127876;&#127891;&#127908;&#127912;&#127979;&#127981;&#128102;-&#128105;&#128139;&#128187;&#128188;&#128295;&#128300;&#128640;&#128658;&#129309;&#129455;&#129456;-&#129459;&#129468;&#129469;&#129489;]*" 0 font-shape-gstring])</span>
<span style="color: #5B6268;">;                 </span><span style="color: #5B6268;">,@(mapcar (lambda (str) (list (elt str 0) (vector str 0 'font-shape-gstring)))</span>
<span style="color: #5B6268;">;                           </span><span style="color: #5B6268;">'("&#128566;&#8205;&#127787;&#65039;" "&#128008;&#8205;&#11035;" "&#128021;&#8205;&#129466;" "&#128059;&#8205;&#10052;&#65039;" "&#128065;&#65039;&#8205;&#128488;&#65039;" "&#128558;&#8205;&#128168;" "&#128565;&#8205;&#128171;"))))</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">(set-char-table-range</span>
<span style="color: #5B6268;">;   </span><span style="color: #5B6268;">composition-function-table</span>
<span style="color: #5B6268;">;   </span><span style="color: #5B6268;">(car items)</span>
<span style="color: #5B6268;">;   </span><span style="color: #5B6268;">(list (cadr items))))</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">emojify-emoji-set</span> <span style="color: #98be65;">"twemoji-v2"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">emojify--replace-text-with-emoji</span> <span style="color: #c678dd;">(</span>orig-fn emoji text buffer start end <span style="color: #ECBE7B;">&amp;optional</span> target<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Modify `</span><span style="color: #a9a1e1;">emojify--propertize-text-for-emoji</span><span style="color: #83898d;">' to replace ascii/github emoticons with unicode emojis, on the fly."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #dcaeea;">emoticon-to-emoji</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">length</span> text<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">funcall</span> orig-fn emoji text buffer start end target<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-region</span> start end<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">ht-get</span> emoji <span style="color: #98be65;">"unicode"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define-minor-mode</span> <span style="color: #dcaeea;">emoticon-to-emoji</span>
  <span style="color: #83898d;">"Write ascii/gh emojis, and have them converted to unicode live."</span>
  <span style="color: #c678dd;">:global</span> nil
  <span style="color: #c678dd;">:init-value</span> nil
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #dcaeea;">emoticon-to-emoji</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">progn</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">emojify-emoji-styles</span> <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span>ascii github unicode<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">advice-add</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">emojify--propertize-text-for-emoji</span> <span style="color: #c678dd;">:around</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">emojify--replace-text-with-emoji</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> <span style="color: #dcaeea;">emojify-mode</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">emojify-turn-on-emojify-mode</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">emojify-emoji-styles</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">default-value</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">emojify-emoji-styles</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">advice-remove</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">emojify--propertize-text-for-emoji</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">emojify--replace-text-with-emoji</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>mu4e-compose-mode org-msg-edit-mode circe-channel-mode org-mode<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">emoticon-to-emoji</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5b4ec93" class="outline-5">
<h5 id="org5b4ec93"><span class="section-number-5">4.9.2.3.</span> Other</h5>
<div class="outline-text-5" id="text-4-9-2-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">interface.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"&lt;f5&gt;"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">revert-buffer</span><span style="color: #51afef;">)</span>

                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(unless (string-match-p "^Power N/A" (battery))   ; On laptops...</span>
                                        <span style="color: #5B6268;">;  </span><span style="color: #5B6268;">(display-battery-mode 1))                       ; it's nice to know how much power you have</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">global-subword-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>                           <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Iterate through CamelCase words</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">battery-mode-line-format</span> <span style="color: #98be65;">"%t"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">display-battery-mode</span> t<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">display-battery-mode</span> <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #51afef;">)</span>



<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> selectic-mode
  <span style="color: #c678dd;">:commands</span> selectic-mode<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">set-char-table-range</span> <span style="color: #dcaeea;">composition-function-table</span> ?f <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">[</span><span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(?:</span><span style="color: #98be65;">ff?[fijlt]</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> <span style="color: #da8548; font-weight: bold;">0</span> font-shape-gstring<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">set-char-table-range</span> <span style="color: #dcaeea;">composition-function-table</span> ?T <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">[</span><span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(?:</span><span style="color: #98be65;">Th</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> <span style="color: #da8548; font-weight: bold;">0</span> font-shape-gstring<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> centaur-tabs
  <span style="color: #c678dd;">(</span>centaur-tabs-mode <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> centaur-tabs-height <span style="color: #da8548; font-weight: bold;">12</span>
        centaur-tabs-set-icons t
        centaur-tabs-modified-marker <span style="color: #98be65;">"o"</span>
        centaur-tabs-close-button <span style="color: #98be65;">"&#215;"</span>
        centaur-tabs-set-bar <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">above</span>
        centaur-tabs-gray-out-icons <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">buffer</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>centaur-tabs-change-fonts <span style="color: #98be65;">"SourceCodePro"</span> <span style="color: #da8548; font-weight: bold;">100</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">cleanup-after-init</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span> <span style="color: #98be65;">"*scratch*"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">delete-other-windows</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">kill-unwanted-buffers</span><span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">schedule-cleanup-after-init</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">run-at-time</span> <span style="color: #98be65;">"1 sec"</span> nil <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">cleanup-after-init</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(schedule-cleanup-after-init)</span>

                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(add-hook 'after-init-hook 'schedule-cleanup-after-init)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> info-colors
  <span style="color: #c678dd;">:commands</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">info-colors-fontify-node</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">Info-selection-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">info-colors-fontify-node</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> page-break-lines
  <span style="color: #c678dd;">:commands</span> page-break-lines-mode
  <span style="color: #c678dd;">:init</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">autoload</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">turn-on-page-break-lines-mode</span> <span style="color: #98be65;">"page-break-lines"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> page-break-lines-max-width <span style="color: #dcaeea;">fill-column</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:prefix</span> <span style="color: #98be65;">"g"</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"Prev page break"</span> <span style="color: #c678dd;">:nv</span> <span style="color: #98be65;">"["</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">backward-page</span>
        <span style="color: #c678dd;">:desc</span> <span style="color: #98be65;">"Next page break"</span> <span style="color: #c678dd;">:nv</span> <span style="color: #98be65;">"]"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">forward-page</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> theme-magic
  <span style="color: #c678dd;">:commands</span> theme-magic-from-emacs
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defadvice!</span> theme-magic--auto-extract-16-doom-colors <span style="color: #98be65;">()</span>
    <span style="color: #c678dd;">:override</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">theme-magic--auto-extract-16-colors</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">list</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">face-attribute</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">default</span> <span style="color: #c678dd;">:background</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-color</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">error</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-color</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">success</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-color</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">type</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-color</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">keywords</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-color</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">constants</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-color</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">functions</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">face-attribute</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">default</span> <span style="color: #c678dd;">:foreground</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">face-attribute</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">shadow</span> <span style="color: #c678dd;">:foreground</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-blend</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">base8</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">error</span> <span style="color: #da8548; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-blend</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">base8</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">success</span> <span style="color: #da8548; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-blend</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">base8</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">type</span> <span style="color: #da8548; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-blend</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">base8</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">keywords</span> <span style="color: #da8548; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-blend</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">base8</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">constants</span> <span style="color: #da8548; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">doom-blend</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">base8</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">functions</span> <span style="color: #da8548; font-weight: bold;">0.1</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">face-attribute</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">default</span> <span style="color: #c678dd;">:foreground</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">run-with-idle-timer</span> <span style="color: #da8548; font-weight: bold;">0.1</span> nil <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">doom-load-theme-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">theme-magic-from-emacs</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

                                        <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Modern org mode</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">global-org-modern-mode</span> t<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Transparent scratch buffer</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">buffer-empty-p</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;optional</span> buffer<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">buffer-size</span> buffer<span style="color: #98be65;">)</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">frame-trans-on</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">set-frame-parameter</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">selected-frame</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">alpha</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">frame-trans-off</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">set-frame-parameter</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">selected-frame</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">alpha</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #da8548; font-weight: bold;">100</span> <span style="color: #da8548; font-weight: bold;">100</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">scratch-trans</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> my-buffer <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">get-buffer</span> <span style="color: #98be65;">"*scratch*"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> my-buffer <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">window-buffer</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">selected-window</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">length</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">window-list</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">frame-trans-on</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">frame-trans-off</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">get-buffer-window</span> my-buffer<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">frame-trans-off</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>t
         <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">frame-trans-off</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">window-configuration-change-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">scratch-trans</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Async shell commands without popup buffer</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">async-shell-command-no-window</span>
    <span style="color: #c678dd;">(</span>command<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Execute async shell command without popup buffer."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">display-buffer-alist</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">list</span>
         <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">cons</span>
          <span style="color: #98be65;">"\\*Async Shell Command\\*.*"</span>
          <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">cons</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">display-buffer-no-window</span> nil<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">async-shell-command</span> command<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">interface</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org33aef93" class="outline-3">
<h3 id="org33aef93"><span class="section-number-3">4.10.</span> EXWM Tweaks</h3>
<div class="outline-text-3" id="text-4-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orga52a890" class="outline-4">
<h4 id="orga52a890"><span class="section-number-4">4.10.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-10-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-orgef9fedd" class="outline-4">
<h4 id="orgef9fedd"><span class="section-number-4">4.10.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-10-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">exwm-tweaks.el -*- lexical-binding: t; -*-</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> exwm
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">mouse-autoselect-window</span> t
        <span style="color: #dcaeea;">focus-follows-mouse</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">exwm</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">exwm-config</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">exwm-config-default</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">exwm-randr</span><span style="color: #c678dd;">)</span>

<span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string=</span> <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">system-name</span><span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">"astaroth"</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">exwm-randr-workspace-output-plist</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span><span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #98be65;">"DP-2-1"</span> <span style="color: #da8548; font-weight: bold;">2</span> <span style="color: #98be65;">"HDMI-2"</span> <span style="color: #da8548; font-weight: bold;">3</span> <span style="color: #98be65;">"DP-2-2"</span> <span style="color: #da8548; font-weight: bold;">4</span> <span style="color: #98be65;">"eDP-1"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string=</span> <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">system-name</span><span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">"jarvis"</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">exwm-randr-workspace-output-plist</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span><span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #98be65;">"DisplayPort-0"</span> <span style="color: #da8548; font-weight: bold;">2</span> <span style="color: #98be65;">"DVI-0"</span> <span style="color: #da8548; font-weight: bold;">3</span> <span style="color: #98be65;">"HDMI-0"</span> <span style="color: #da8548; font-weight: bold;">4</span> <span style="color: #98be65;">"eDP-1"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">exwm-randr-screen-change-hook</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">()</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">start-process-shell-command</span>
               <span style="color: #98be65;">"xrandr"</span> nil <span style="color: #98be65;">"xrandr --output eDP-1 --primary --mode 1920x1080 --pos 1920x0 --rotate normal --output DP-1 --off --output HDMI-1 --off --output DP-2 --off --output HDMI-2 --mode 1920x1080 --pos 0x0 --rotate normal"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">exwm-randr-enable</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">winner-mode</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">exwm-systemtray</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">exwm-systemtray-enable</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">define-key</span> <span style="color: #dcaeea;">exwm-mode-map</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c"</span><span style="color: #98be65;">)</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">exwm-input-simulation-keys</span>
        <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-b<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>left<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-f<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>right<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-p<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>up<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-n<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>down<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-a<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>home<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-e<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>end<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\M-a<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>C-a<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\M-v<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>prior<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-d<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>delete<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-k<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>S-end delete<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-w<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>?\C-x<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\M-w<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>?\C-c<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-y<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>?\C-v<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">search</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\C-s<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>?\C-f<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\M-s<span style="color: #51afef;">]</span> . <span style="color: #51afef;">[</span>?\C-s<span style="color: #51afef;">]</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">functionp</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-enable-ido-workaround</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span>exwm-enable-ido-workaround<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-eval-after-load</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ediff-wind</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> ediff-control-frame-parameters
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cons</span> <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span>unsplittable . t<span style="color: #51afef;">)</span> ediff-control-frame-parameters<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-x C-c"</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">save-buffers-kill-emacs</span><span style="color: #c678dd;">)</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">(global-set-key (kbd "C-c m") 'toggle-maximize-buffer)</span>


  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">fullscreen</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-mode</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">call-interactively</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-layout-toggle-fullscreen</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">toggle-maximize-buffer</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Make current buffer float</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">toggle-float-buffer</span> <span style="color: #98be65;">()</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-mode</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">call-interactively</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-floating-toggle-floating</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">call-interactively</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-layout-hide-mode-line</span><span style="color: #51afef;">)</span>
      <span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>


<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Sometimes exwm fails to sets a buffer, so set it to scratch</span>
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">with a button press</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">go-to-scratch</span> <span style="color: #98be65;">()</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"%s"</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">selected-window</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span> <span style="color: #98be65;">"*scratch*"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

<span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">go-to-scratch-other</span> <span style="color: #98be65;">()</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">switch-to-buffer-other-frame</span> <span style="color: #98be65;">"*scratch*"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

<span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> save-temp-location <span style="color: #98be65;">"~/dox/temp-save/"</span><span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">save-buffer-temp</span> <span style="color: #98be65;">()</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>s <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-string</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span>ss <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-string</span> s <span style="color: #98be65;">" "</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span>nl <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">butlast</span> ss <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">length</span> ss<span style="color: #a9a1e1;">)</span> <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

         <span style="color: #a9a1e1;">)</span>
    <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">set-visited-file-name</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span> save-temp-location <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapconcat</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span>lambda <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>  <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s"</span> x<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>  nl <span style="color: #98be65;">" "</span><span style="color: #c678dd;">)</span> <span style="color: #98be65;">".org"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
    <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">save-buffer</span><span style="color: #a9a1e1;">)</span>
    <span style="color: #98be65;">)</span>
  <span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">switchmonitor-next</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">shell-command</span> <span style="color: #98be65;">"xdotool mousemove_relative 1920 0"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">switchmonitor-prev</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">shell-command</span> <span style="color: #98be65;">"xdotool mousemove_relative -- -1920 0"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>


  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">exwm-workspace-number</span> <span style="color: #da8548; font-weight: bold;">9</span>
        <span style="color: #dcaeea;">exwm-workspace-show-all-buffers</span> t
        <span style="color: #dcaeea;">exwm-layout-show-all-buffers</span> t
        <span style="color: #dcaeea;">exwm-manage-force-tiling</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">exwm-input-global-keys</span>
      <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\s-f<span style="color: #51afef;">]</span> . fullscreen<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\s-F<span style="color: #51afef;">]</span> . toggle-maximize-buffer<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\s-g<span style="color: #51afef;">]</span> . toggle-float-buffer<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\s-q<span style="color: #51afef;">]</span> . kill-curr-buffer<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\s-n<span style="color: #51afef;">]</span> . switchmonitor-next<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">[</span>?\s-p<span style="color: #51afef;">]</span> . switchmonitor-prev<span style="color: #a9a1e1;">)</span>
        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">((kbd "s-&lt;return&gt;") . switchmonitor-prev)</span>
        ,@<span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">mapcar</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>i<span style="color: #c678dd;">)</span>
                    <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span>,<span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"s-%d"</span> i<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> .
                      <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">()</span>
                        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">interactive</span><span style="color: #a9a1e1;">)</span>
                        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">exwm-workspace-switch-create</span> ,i<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">number-sequence</span> <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #da8548; font-weight: bold;">9</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">exwm-manage-finish-hook</span>
          <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">()</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #dcaeea;">exwm-class-name</span>
                       <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string=</span> <span style="color: #dcaeea;">exwm-class-name</span> <span style="color: #98be65;">"St"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
                <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">exwm-input-release-keyboard</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">exwm-layout-hide-mode-line</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

<span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">exwm-input-prefix-keys</span>
<span style="color: #51afef;">'</span><span style="color: #98be65;">(</span>?\C-x ?\C-u ?\C-h ?\M-x ?\M-<span style="color: #51afef;">`</span> <span style="color: #ECBE7B;">?</span>\M-&amp; ?\M-:<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>


<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-&lt;f4&gt;"</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">go-to-scratch</span><span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-S-&lt;f4&gt;"</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">save-buffer-temp</span><span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">exwm-edit</span><span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">ag-exwm/on-exwm-edit-compose</span> <span style="color: #98be65;">()</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">funcall</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-mode</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">exwm-edit-compose-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ag-exwm/on-exwm-edit-compose</span><span style="color: #c678dd;">)</span>


<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">exwm-update-title-hook</span>
          <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">()</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">exwm-workspace-rename-buffer</span> <span style="color: #dcaeea;">exwm-title</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">exwm-manage-configurations</span>
      <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #dcaeea;">exwm-class-name</span> <span style="color: #98be65;">"Nm-applet"</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #dcaeea;">exwm-class-name</span> <span style="color: #98be65;">"Surf"</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #dcaeea;">exwm-class-name</span> <span style="color: #98be65;">"Steam"</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #dcaeea;">exwm-class-name</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
           floating t
           floating-mode-line nil
<span style="color: #5B6268;">;           </span><span style="color: #5B6268;">width 0.4</span>
<span style="color: #5B6268;">;           </span><span style="color: #5B6268;">height 0.4</span>
           <span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">equal</span> <span style="color: #dcaeea;">exwm-window-type</span> <span style="color: #dcaeea;">xcb:Atom:_NET_WM_WINDOW_TYPE_DIALOG</span><span style="color: #a9a1e1;">)</span>
         floating t
         floating-mode-line nil<span style="color: #98be65;">)</span>
        <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">exwm-floating--set-floating</span> <span style="color: #c678dd;">(</span>id<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Make window ID floating."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>window <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">get-buffer-window</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">exwm--id-&gt;buffer</span> id<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> window
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Hide the non-floating X window first.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">set-window-buffer</span> window <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">other-buffer</span> nil t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>original-frame <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-local-value</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">exwm--frame</span>
                                             <span style="color: #c678dd;">(</span><span style="color: #c678dd;">exwm--id-&gt;buffer</span> id<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Create new frame</span>
         <span style="color: #a9a1e1;">(</span>frame <span style="color: #51afef;">(</span><span style="color: #51afef;">with-current-buffer</span>
                    <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">get-buffer</span> <span style="color: #98be65;">"*scratch*"</span><span style="color: #98be65;">)</span>
                        <span style="color: #98be65;">(</span><span style="color: #51afef;">progn</span>
                          <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">set-buffer-major-mode</span>
                           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">get-buffer-create</span> <span style="color: #98be65;">"*scratch*"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                          <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">get-buffer</span> <span style="color: #98be65;">"*scratch*"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">make-frame</span>
                   <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>minibuffer . ,<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">minibuffer-window</span> <span style="color: #dcaeea;">exwm--frame</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span>left . ,<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">*</span> <span style="color: #dcaeea;">window-min-width</span> <span style="color: #da8548; font-weight: bold;">-10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span>top . ,<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">*</span> <span style="color: #dcaeea;">window-min-height</span> <span style="color: #da8548; font-weight: bold;">-10000</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span>width . ,<span style="color: #dcaeea;">window-min-width</span><span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span>height . ,<span style="color: #dcaeea;">window-min-height</span><span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span>unsplittable . t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #5B6268;">;</span><span style="color: #5B6268;">and fix the size later</span>
         <span style="color: #a9a1e1;">(</span>outer-id <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-to-number</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">frame-parameter</span> frame <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">outer-window-id</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>window-id <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-to-number</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">frame-parameter</span> frame <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">window-id</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>frame-container <span style="color: #51afef;">(</span><span style="color: #c678dd;">xcb:generate-id</span> <span style="color: #dcaeea;">exwm--connection</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>window <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">frame-first-window</span> frame<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #5B6268;">;</span><span style="color: #5B6268;">and it's the only window</span>
         <span style="color: #a9a1e1;">(</span>x <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">slot-value</span> <span style="color: #dcaeea;">exwm--geometry</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">x</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>y <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">slot-value</span> <span style="color: #dcaeea;">exwm--geometry</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">y</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>width <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">slot-value</span> <span style="color: #dcaeea;">exwm--geometry</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">width</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>height <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">slot-value</span> <span style="color: #dcaeea;">exwm--geometry</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">height</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Force drawing menu-bar &amp; tool-bar.</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">redisplay</span> t<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">exwm-workspace--update-offsets</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">exwm--log</span> <span style="color: #98be65;">"Floating geometry (original): %dx%d%+d%+d"</span> width height x y<span style="color: #98be65;">)</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Save frame parameters.</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">set-frame-parameter</span> frame <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-outer-id</span> outer-id<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">set-frame-parameter</span> frame <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-id</span> window-id<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">set-frame-parameter</span> frame <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">exwm-container</span> frame-container<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">set-frame-parameter</span> frame <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">alpha</span> <span style="color: #da8548; font-weight: bold;">10</span><span style="color: #98be65;">)</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Fix illegal parameters</span>
    <span style="color: #5B6268;">;; </span><span style="color: #ff6c6b; font-weight: bold;">FIXME:</span><span style="color: #5B6268;"> check normal hints restrictions</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>workarea <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">elt</span> <span style="color: #dcaeea;">exwm-workspace--workareas</span>
                          <span style="color: #98be65;">(</span><span style="color: #c678dd;">exwm-workspace--position</span> original-frame<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>x* <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">aref</span> workarea <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>y* <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">aref</span> workarea <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>width* <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">aref</span> workarea <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>height* <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">aref</span> workarea <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Center floating windows</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">=</span> x <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">=</span> x x*<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                 <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">=</span> y <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">=</span> y y*<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>buffer <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">exwm--id-&gt;buffer</span> <span style="color: #dcaeea;">exwm-transient-for</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
              window edges<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> buffer <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> window <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">get-buffer-window</span> buffer<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> edges <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">window-inside-absolute-pixel-edges</span> window<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">&lt;=</span> width <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                         <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">&lt;=</span> height <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> edges nil<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> edges
              <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Put at the center of leading window</span>
              <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> x <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">+</span> x* <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">/</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span> width<span style="color: #c678dd;">)</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                    y <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">+</span> y* <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">/</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span> height<span style="color: #c678dd;">)</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Put at the center of screen</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> x <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">/</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">-</span> width* width<span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span>
                  y <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">/</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">-</span> height* height<span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">&gt;</span> width width*<span style="color: #51afef;">)</span>
          <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Too wide</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> x x*
                       width width*<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Invalid width</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #da8548; font-weight: bold;">0</span> width<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> width <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">/</span> width* <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Make sure at least half of the window is visible</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">&lt;</span> x* <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> x <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">/</span> width <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> x* width*<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> x <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> x* <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">/</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">-</span> width* width<span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">&gt;</span> height height*<span style="color: #51afef;">)</span>
          <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Too tall</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> y y*
                height height*<span style="color: #51afef;">)</span>
        <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Invalid height</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #da8548; font-weight: bold;">0</span> height<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> height <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">/</span> height* <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Make sure at least half of the window is visible</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">&lt;</span> y* <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> y <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">/</span> height <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> y* height*<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> y <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> y* <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">/</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">-</span> height* height<span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">The geometry can be overridden by user options.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>x** <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #dcaeea;">exwm--configurations</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">x</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span>y** <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #dcaeea;">exwm--configurations</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">y</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span>width** <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #dcaeea;">exwm--configurations</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">width</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span>height** <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #dcaeea;">exwm--configurations</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">height</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">integerp</span> x**<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> x <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> x* x**<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">floatp</span> x**<span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">&gt;=</span> <span style="color: #da8548; font-weight: bold;">1</span> x** <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> x <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">+</span> x* <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">round</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">*</span> x** width*<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">integerp</span> y**<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> y <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> y* y**<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">floatp</span> y**<span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">&gt;=</span> <span style="color: #da8548; font-weight: bold;">1</span> y** <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> y <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">+</span> y* <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">round</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">*</span> y** height*<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">integerp</span> width**<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> width width**<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">floatp</span> width**<span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">&gt;</span> <span style="color: #da8548; font-weight: bold;">1</span> width** <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> width <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">max</span> <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">round</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">*</span> width** width*<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">integerp</span> height**<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> height height**<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">floatp</span> height**<span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">&gt;</span> <span style="color: #da8548; font-weight: bold;">1</span> height** <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> height <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">max</span> <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">round</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">*</span> height** height*<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">exwm--set-geometry</span> id x y nil nil<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">xcb:flush</span> <span style="color: #dcaeea;">exwm--connection</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">exwm--log</span> <span style="color: #98be65;">"Floating geometry (corrected): %dx%d%+d%+d"</span> width height x y<span style="color: #98be65;">)</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Fit frame to client</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">It seems we have to make the frame invisible in order to resize it</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">timely.</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">The frame will be made visible by `</span><span style="color: #a9a1e1;">select-frame-set-input-focus</span><span style="color: #5B6268;">'.</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">make-frame-invisible</span> frame<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>edges <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">window-inside-pixel-edges</span> window<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">frame-width</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">+</span> width <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">frame-pixel-width</span> frame<span style="color: #a9a1e1;">)</span>
                                    <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">frame-height</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">+</span> height <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">frame-pixel-height</span> frame<span style="color: #a9a1e1;">)</span>
                                      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">elt</span> edges <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                            <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Use `</span><span style="color: #a9a1e1;">frame-outer-height</span><span style="color: #5B6268;">' in the future.</span>
                            <span style="color: #dcaeea;">exwm-workspace--frame-y-offset</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>floating-mode-line <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #dcaeea;">exwm--configurations</span>
                                          <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">floating-mode-line</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>floating-header-line <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #dcaeea;">exwm--configurations</span>
                                            <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">floating-header-line</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>border-pixel <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">exwm--color-&gt;pixel</span> <span style="color: #dcaeea;">exwm-floating-border-color</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> floating-mode-line
          <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">exwm--mode-line-format</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #dcaeea;">exwm--mode-line-format</span>
                                           <span style="color: #dcaeea;">mode-line-format</span><span style="color: #c678dd;">)</span>
                <span style="color: #dcaeea;">mode-line-format</span> floating-mode-line<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">plist-member</span> <span style="color: #dcaeea;">exwm--configurations</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">floating-mode-line</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                 <span style="color: #dcaeea;">exwm--mwm-hints-decorations</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #dcaeea;">exwm--mode-line-format</span>
              <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">mode-line-format</span> <span style="color: #dcaeea;">exwm--mode-line-format</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">The mode-line need to be hidden in floating mode.</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> frame-height <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">-</span> frame-height <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">window-mode-line-height</span>
                                              <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">frame-root-window</span> frame<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                <span style="color: #dcaeea;">exwm--mode-line-format</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #dcaeea;">exwm--mode-line-format</span>
                                           <span style="color: #dcaeea;">mode-line-format</span><span style="color: #98be65;">)</span>
                <span style="color: #dcaeea;">mode-line-format</span> nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> floating-header-line
          <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">header-line-format</span> floating-header-line<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">plist-member</span> <span style="color: #dcaeea;">exwm--configurations</span>
                                    <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">floating-header-line</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                 <span style="color: #dcaeea;">exwm--mwm-hints-decorations</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">header-line-format</span> nil<span style="color: #c678dd;">)</span>
          <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">The header-line need to be hidden in floating mode.</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> frame-height <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">-</span> frame-height <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">window-header-line-height</span>
                                              <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">frame-root-window</span> frame<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                <span style="color: #dcaeea;">header-line-format</span> nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">set-frame-size</span> frame frame-width frame-height t<span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Create the frame container as the parent of the frame.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">xcb:+request</span> <span style="color: #dcaeea;">exwm--connection</span>
          <span style="color: #51afef;">(</span><span style="color: #c678dd;">make-instance</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">xcb:CreateWindow</span>
                         <span style="color: #c678dd;">:depth</span> <span style="color: #da8548; font-weight: bold;">0</span>
                         <span style="color: #c678dd;">:wid</span> frame-container
                         <span style="color: #c678dd;">:parent</span> <span style="color: #dcaeea;">exwm--root</span>
                         <span style="color: #c678dd;">:x</span> x
                         <span style="color: #c678dd;">:y</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">-</span> y <span style="color: #dcaeea;">exwm-workspace--window-y-offset</span><span style="color: #c678dd;">)</span>
                         <span style="color: #c678dd;">:width</span> width
                         <span style="color: #c678dd;">:height</span> height
                         <span style="color: #c678dd;">:border-width</span>
                         <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">exwm--id-&gt;buffer</span> id<span style="color: #98be65;">)</span>
                           <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>border-witdh <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #dcaeea;">exwm--configurations</span>
                                                          <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">border-width</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">integerp</span> border-witdh<span style="color: #c678dd;">)</span>
                                      <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">&gt;=</span> border-witdh <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                                 border-witdh
                               <span style="color: #dcaeea;">exwm-floating-border-width</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                         <span style="color: #c678dd;">:class</span> <span style="color: #dcaeea;">xcb:WindowClass:InputOutput</span>
                         <span style="color: #c678dd;">:visual</span> <span style="color: #da8548; font-weight: bold;">0</span>
                         <span style="color: #c678dd;">:value-mask</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">logior</span> <span style="color: #dcaeea;">xcb:CW:BackPixmap</span>
                                             <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> border-pixel
                                                 <span style="color: #dcaeea;">xcb:CW:BorderPixel</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span>
                                             <span style="color: #dcaeea;">xcb:CW:OverrideRedirect</span><span style="color: #c678dd;">)</span>
                         <span style="color: #c678dd;">:background-pixmap</span> <span style="color: #dcaeea;">xcb:BackPixmap:ParentRelative</span>
                         <span style="color: #c678dd;">:border-pixel</span> border-pixel
                         <span style="color: #c678dd;">:override-redirect</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">xcb:+request</span> <span style="color: #dcaeea;">exwm--connection</span>
          <span style="color: #51afef;">(</span><span style="color: #c678dd;">make-instance</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">xcb:ewmh:set-_NET_WM_NAME</span>
                         <span style="color: #c678dd;">:window</span> frame-container
                         <span style="color: #c678dd;">:data</span>
                         <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"EXWM floating frame container for 0x%x"</span> id<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Map it.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">xcb:+request</span> <span style="color: #dcaeea;">exwm--connection</span>
          <span style="color: #51afef;">(</span><span style="color: #c678dd;">make-instance</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">xcb:MapWindow</span> <span style="color: #c678dd;">:window</span> frame-container<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Put the X window right above this frame container.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">xcb:+request</span> <span style="color: #dcaeea;">exwm--connection</span>
          <span style="color: #51afef;">(</span><span style="color: #c678dd;">make-instance</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">xcb:ConfigureWindow</span>
                         <span style="color: #c678dd;">:window</span> id
                         <span style="color: #c678dd;">:value-mask</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">logior</span> <span style="color: #dcaeea;">xcb:ConfigWindow:Sibling</span>
                                             <span style="color: #dcaeea;">xcb:ConfigWindow:StackMode</span><span style="color: #c678dd;">)</span>
                         <span style="color: #c678dd;">:sibling</span> frame-container
                         <span style="color: #c678dd;">:stack-mode</span> <span style="color: #dcaeea;">xcb:StackMode:Above</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Reparent this frame to its container.</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">xcb:+request</span> <span style="color: #dcaeea;">exwm--connection</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">make-instance</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">xcb:ReparentWindow</span>
                       <span style="color: #c678dd;">:window</span> outer-id <span style="color: #c678dd;">:parent</span> frame-container <span style="color: #c678dd;">:x</span> <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #c678dd;">:y</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">exwm-floating--set-allowed-actions</span> id nil<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">xcb:flush</span> <span style="color: #dcaeea;">exwm--connection</span><span style="color: #98be65;">)</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Set window/buffer</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">exwm--id-&gt;buffer</span> id<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">window-size-fixed</span> <span style="color: #dcaeea;">exwm--fixed-size</span>
            <span style="color: #dcaeea;">exwm--floating-frame</span> frame<span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Do the refresh manually.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">remove-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">window-configuration-change-hook</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">exwm-layout--refresh</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">set-window-buffer</span> window <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #5B6268;">;</span><span style="color: #5B6268;">this changes current buffer</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">window-configuration-change-hook</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">exwm-layout--refresh</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">set-window-dedicated-p</span> window t<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">exwm-layout--show</span> id window<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">exwm--id-&gt;buffer</span> id<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-layout--iconic-state-p</span> id<span style="color: #51afef;">)</span>
          <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Hide iconic floating X windows.</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-floating-hide</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">with-selected-frame</span> <span style="color: #dcaeea;">exwm--frame</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">exwm-layout--refresh</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">select-frame-set-input-focus</span> frame<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #5B6268;">;; </span><span style="color: #ff6c6b; font-weight: bold;">FIXME:</span><span style="color: #5B6268;"> Strangely, the Emacs frame can move itself at this point</span>
    <span style="color: #5B6268;">;;        </span><span style="color: #5B6268;">when there are left/top struts set.  Force resetting its</span>
    <span style="color: #5B6268;">;;        </span><span style="color: #5B6268;">position seems working, but it'd better to figure out why.</span>
    <span style="color: #5B6268;">;; </span><span style="color: #ff6c6b; font-weight: bold;">FIXME:</span><span style="color: #5B6268;"> This also happens in another case (#220) where the cause is</span>
    <span style="color: #5B6268;">;;        </span><span style="color: #5B6268;">still unclear.</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">exwm--set-geometry</span> outer-id <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #da8548; font-weight: bold;">0</span> nil nil<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">xcb:flush</span> <span style="color: #dcaeea;">exwm--connection</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">exwm--id-&gt;buffer</span> id<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">run-hooks</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">exwm-floating-setup-hook</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Redraw the frame.</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">redisplay</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Additional commands that should also work in exwm</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-&lt;return&gt;"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">+vterm/toggle</span> nil<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-e"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">elfeed-load-summary</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-v"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">open-yt-dl-videos</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-r"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">progn</span>
  <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">+vterm/here</span> t<span style="color: #a9a1e1;">)</span>
  <span style="color: #a9a1e1;">(</span>vterm-send-string <span style="color: #98be65;">"cd /home/user/dox/install/rosarium &amp;&amp; cargo run\n"</span><span style="color: #a9a1e1;">)</span>
<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-&lt;f4&gt;"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">go-to-scratch</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-&lt;left&gt;"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">winner-undo</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-&lt;right&gt;"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">winner-undo</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-a"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">org-agenda-list</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-m"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span>mu4e--goto-inbox<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">exwm-input--update-global-prefix-keys</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Wallpaper</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defmacro</span> <span style="color: #c678dd;">ifdirexists</span> <span style="color: #c678dd;">(</span>dir <span style="color: #ECBE7B;">&amp;rest</span> actions<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Execute functions taking dir as an argument if dir exists"</span>
  <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-exists-p</span> ,dir<span style="color: #98be65;">)</span>
     <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>dir<span style="color: #51afef;">)</span>
       ,@actions<span style="color: #a9a1e1;">)</span> <span style="color: #ECBE7B;">,dir</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">ifdirexists</span> <span style="color: #98be65;">"/home/user/dox/wallpapers"</span>
             <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> wallpaper-cycle-directory dir<span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span><span style="color: #c678dd;">wallpaper-set-wallpaper</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">exwm-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6d00e1a" class="outline-3">
<h3 id="org6d00e1a"><span class="section-number-3">4.11.</span> General</h3>
<div class="outline-text-3" id="text-4-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">general</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgf60ff76" class="outline-4">
<h4 id="orgf60ff76"><span class="section-number-4">4.11.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-11-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org3a8bbfa" class="outline-4">
<h4 id="org3a8bbfa"><span class="section-number-4">4.11.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-11-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">general.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">mouse-autoselect-window</span> t
      <span style="color: #dcaeea;">focus-follows-mouse</span> t<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Disable backup files</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">make-backup-files</span> nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">auto-save-default</span> nil<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Delete selection when pasting</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">delete-selection-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Save the session</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">desktop-save-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> desktop-restore-eager <span style="color: #da8548; font-weight: bold;">10</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Save last visited place in files</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span> <span style="color: #dcaeea;">save-place</span> t<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">save-place-file</span> <span style="color: #98be65;">"~/.emacs.d/etc/saveplace"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">general</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge63e629" class="outline-3">
<h3 id="orge63e629"><span class="section-number-3">4.12.</span> Navigation</h3>
<div class="outline-text-3" id="text-4-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">navigation</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org51136da" class="outline-4">
<h4 id="org51136da"><span class="section-number-4">4.12.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-12-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-orge0fd911" class="outline-4">
<h4 id="orge0fd911"><span class="section-number-4">4.12.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-12-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">navigation.el -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Kill minibuffer when loosing focus</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">stop-using-minibuffer</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"kill the minibuffer"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">&gt;=</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">recursion-depth</span><span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">active-minibuffer-window</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">abort-recursive-edit</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">mouse-leave-buffer-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">stop-using-minibuffer</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">doom-fallback-buffer-name</span> <span style="color: #98be65;">"&#9658; Doom"</span>
      <span style="color: #dcaeea;">+doom-dashboard-name</span> <span style="color: #98be65;">"&#9658; Doom"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> <span style="color: #dcaeea;">+doom-dashboard-mode-map</span>
      <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"f"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">find-file</span>
      <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"r"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">consult-recent-file</span>
      <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"p"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">doom/open-private-config</span>
      <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"c"</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">cmd!</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"config.org"</span> <span style="color: #dcaeea;">doom-private-dir</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
      <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"."</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">cmd!</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">doom-project-find-file</span> <span style="color: #98be65;">"~/.config/"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #5B6268;">; </span><span style="color: #5B6268;">. for dotfiles</span>
      <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"b"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">+vertico/switch-workspace-buffer</span>
      <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"B"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">consult-buffer</span>
      <span style="color: #c678dd;">:ne</span> <span style="color: #98be65;">"q"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">save-buffers-kill-terminal</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:n</span> <span style="color: #c678dd;">[</span>mouse-8<span style="color: #c678dd;">]</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">better-jumper-jump-backward</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #c678dd;">[</span>mouse-9<span style="color: #c678dd;">]</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">better-jumper-jump-forward</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(setq org-roam-directory "") ;; Temporary workaroundA</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(setq frame-title-format</span>
<span style="color: #5B6268;">;      </span><span style="color: #5B6268;">'(""</span>
<span style="color: #5B6268;">;        </span><span style="color: #5B6268;">(:eval</span>
<span style="color: #5B6268;">;         </span><span style="color: #5B6268;">(if (s-contains-p org-roam-directory (or buffer-file-name ""))</span>
<span style="color: #5B6268;">;             </span><span style="color: #5B6268;">(replace-regexp-in-string</span>
<span style="color: #5B6268;">;              </span><span style="color: #5B6268;">".*/[0-9]*-?" "&#9776; "</span>
<span style="color: #5B6268;">;              </span><span style="color: #5B6268;">(subst-char-in-string ?_ ?  buffer-file-name))</span>
<span style="color: #5B6268;">;           </span><span style="color: #5B6268;">"%b"))</span>
<span style="color: #5B6268;">;        </span><span style="color: #5B6268;">(:eval</span>
<span style="color: #5B6268;">;         </span><span style="color: #5B6268;">(let ((project-name (projectile-project-name)))</span>
<span style="color: #5B6268;">;           </span><span style="color: #5B6268;">(unless (string= "-" project-name)</span>
<span style="color: #5B6268;">;             </span><span style="color: #5B6268;">(format (if (buffer-modified-p)  " &#9673; %s" " &#8198;&#9679;&#8198; %s") project-name))))))</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">display-line-numbers-type</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">relative</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">ignore-dired-buffers-ivy</span> <span style="color: #c678dd;">(</span>str<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Return non-nil if STR names a Dired buffer.</span>
<span style="color: #83898d;">This function is intended for use with `</span><span style="color: #a9a1e1;">ivy-ignore-buffers</span><span style="color: #83898d;">'."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>buf <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">get-buffer</span> str<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> buf <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-local-value</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">major-mode</span> buf<span style="color: #51afef;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-mode</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">ignore-help-buffers-ivy</span> <span style="color: #c678dd;">(</span>str<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Return non-nil if STR names a help buffer (buffers starting and ending with *)</span>
<span style="color: #83898d;">This function is intended for use with `</span><span style="color: #a9a1e1;">ivy-ignore-buffers</span><span style="color: #83898d;">'."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span>
   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">s-starts-with-p</span> <span style="color: #98be65;">"*"</span> str<span style="color: #98be65;">)</span>
   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">s-ends-with-p</span> <span style="color: #98be65;">"*"</span> str<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">ignore-unwanted-buffers-ivy</span> <span style="color: #c678dd;">(</span>str<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Return non-nil if STR names a Dired buffer.</span>
<span style="color: #83898d;">This function is intended for use with `</span><span style="color: #a9a1e1;">ivy-ignore-buffers</span><span style="color: #83898d;">'."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span>
   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #98be65;">"elfeed.org"</span> str<span style="color: #98be65;">)</span>
   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">member</span> str <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">map</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">list</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">file-name-nondirectory</span> <span style="color: #dcaeea;">org-agenda-files</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
   <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">with-eval-after-load</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ivy</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">progn</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">ivy-ignore-buffers</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">ignore-dired-buffers-ivy</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">ivy-ignore-buffers</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">ignore-help-buffers-ivy</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">ivy-ignore-buffers</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">ignore-unwanted-buffers-ivy</span><span style="color: #98be65;">)</span>
  <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Switch window</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> switch-window
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">switch-window-multiple-frames</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">switch-window-input-style</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">minibuffer</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> switch-window-increase <span style="color: #da8548; font-weight: bold;">4</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">switch-window-threshold</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">switch-window-shortcut-style</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">qwerty</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">switch-window-qwerty-shortcuts</span>
        <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"j"</span> <span style="color: #98be65;">"k"</span> <span style="color: #98be65;">"l"</span> <span style="color: #98be65;">"a"</span> <span style="color: #98be65;">"s"</span> <span style="color: #98be65;">"d"</span> <span style="color: #98be65;">"f"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #5B6268;">; </span><span style="color: #5B6268;">&#246; does not work without pressing RET</span>
  <span style="color: #c678dd;">:bind</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">[</span>remap other-window<span style="color: #98be65;">]</span> . switch-window<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Temporarily maximize current buffer</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">toggle-maximize-buffer</span> <span style="color: #c678dd;">()</span> <span style="color: #83898d;">"Maximize buffer"</span>
       <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
       <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">length</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">window-list</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
           <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">jump-to-register</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">_</span><span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #51afef;">progn</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">window-configuration-to-register</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">_</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">delete-other-windows</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">transparent-buffer-advice</span>
  <span style="color: #c678dd;">(</span>orig-fun <span style="color: #ECBE7B;">&amp;rest</span> args<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">shell-command</span> <span style="color: #98be65;">"transset -p 1"</span><span style="color: #c678dd;">)</span> <span style="color: #5B6268;">; </span><span style="color: #5B6268;">0.3</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>res
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">apply</span> orig-fun args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">shell-command</span> <span style="color: #98be65;">"transset -p 1"</span><span style="color: #98be65;">)</span>
    res<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">kill current buffer</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">kill-curr-buffer</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-name</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #98be65;">"*scratch*"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kill-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">bury-buffer</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span> <span style="color: #98be65;">"*scratch*"</span><span style="color: #98be65;">)</span>
  <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">move to start and end of buffer</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"M-n"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">end-of-buffer</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"M-p"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">beginning-of-buffer</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Kill all buffers</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">close-all-buffers</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapc</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">kill-buffer</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">buffer-list</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-x C-k k"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">close-all-buffers</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Kill unwanted buffers</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">kill-if-unwanted</span> <span style="color: #c678dd;">(</span>buffer<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>b <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-name</span> buffer<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>bfn <span style="color: #51afef;">(</span><span style="color: #dcaeea;">buffer-file-name</span> buffer<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>bmm <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-local-value</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">major-mode</span> buffer<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>unwanted-buffers <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span>
                            <span style="color: #98be65;">"*Messages*"</span>
                            <span style="color: #98be65;">"*Backtrace*"</span>
                            <span style="color: #98be65;">"*Help*"</span>
                            <span style="color: #98be65;">"*Warnings*"</span>
                            <span style="color: #98be65;">"*Compile-Log*"</span>
                            <span style="color: #98be65;">"*elfeed-log*"</span>
                            <span style="color: #98be65;">"*system-packages*"</span>
                            <span style="color: #98be65;">"*Async Shell Command*"</span>
                            <span style="color: #98be65;">"*Flycheck errors*"</span>
                            <span style="color: #98be65;">"*Flycheck error messages*"</span>
                            <span style="color: #98be65;">"*Flymake log*"</span>
                            <span style="color: #98be65;">"*Calendar*"</span>
                            <span style="color: #98be65;">"*XELB-DEBUG*"</span>
                            <span style="color: #98be65;">"*Read-Aloud Log*"</span>
                            <span style="color: #98be65;">"*elfeed-search*"</span>
                            <span style="color: #98be65;">"elfeed.org"</span>
                            <span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">member</span> b unwanted-buffers<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">member</span> bfn <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapcar</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">expand-file-name</span> <span style="color: #dcaeea;">org-agenda-files</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dired-mode</span> bmm<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"^</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">*tramp.*</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">*$"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">.png$"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">.jpg$"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">.jpeg$"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">.gif$"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">.log$"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"^_region_.tex$"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"^</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">*helpful .*</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">*"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"- Thunar"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"^magit"</span> b<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"^</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">*.*</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">*$"</span> b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kill-buffer</span> b<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">kill-unwanted-buffers</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapc</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">kill-if-unwanted</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">buffer-list</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-x k"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">kill-unwanted-buffers</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Window splitting</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">split-and-follow-horizontally</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-window-below</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">balance-windows</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">other-window</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-x 2"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">split-and-follow-horizontally</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">split-and-follow-vertically</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-window-right</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">balance-windows</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">other-window</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-x 3"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">split-and-follow-vertically</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">kill-and-balance</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">delete-window</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">balance-windows</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-x 0"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">kill-and-balance</span><span style="color: #51afef;">)</span>



<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Subword moving</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">global-subword-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Cycle though tabs</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(global-set-key (kbd "C-&lt;tab&gt;") 'next-buffer)</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(global-set-key (kbd "&lt;C-iso-lefttab&gt;") 'previous-buffer)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Winum mode for easy moving through windows</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> winum
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> winum-auto-setup-mode-line nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">winum-mode</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:bind</span> <span style="color: #c678dd;">(</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-="</span> . winum-select-window-0<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-!"</span> . winum-select-window-1<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-\""</span> . winum-select-window-2<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-&#167;"</span> . winum-select-window-3<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-$"</span> . winum-select-window-4<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-%"</span> . winum-select-window-5<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-&amp;"</span> . winum-select-window-6<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-/"</span> . winum-select-window-7<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-("</span> . winum-select-window-8<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-)"</span> . winum-select-window-9<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"s-&#176;"</span> . winum-select-window-by-number<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">navigation</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf297934" class="outline-3">
<h3 id="orgf297934"><span class="section-number-3">4.13.</span> Shortcuts</h3>
<div class="outline-text-3" id="text-4-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">shortcuts</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org3499431" class="outline-4">
<h4 id="org3499431"><span class="section-number-4">4.13.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-13-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org2b1ab14" class="outline-4">
<h4 id="org2b1ab14"><span class="section-number-4">4.13.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-13-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">shortcuts.el -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;;;; </span><span style="color: #5B6268;">Copy-whole-line</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">copy-whole-line</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">save-excursion</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kill-ring-save</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-at-bol</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-at-eol</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c w l"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">copy-whole-line</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;;; </span><span style="color: #5B6268;">Copy-line-above and copy-line-below (and paste)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">copy-line-above</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">save-excursion</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">evil-previous-visual-line</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">copy-whole-line</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">evil-next-visual-line</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">evil-paste-after</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c l a"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">copy-line-above</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">copy-line-below</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">save-excursion</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">evil-next-visual-line</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">copy-whole-line</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">evil-previous-visual-line</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">evil-paste-after</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c l b"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">copy-line-below</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;;; </span><span style="color: #5B6268;">Duplicate line</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">duplicate-line</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">save-excursion</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">evil-open-below</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">copy-line-above</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">evil-next-visual-line</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">evil-normal-state</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">evil-forward-char</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c l l"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">duplicate-line</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Kill word improved</span>
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">normal kill-word kills forward, but not whole word. This fixes that</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">kill-whole-word</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">backward-word</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kill-word</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c k w"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">kill-whole-word</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">File shortcuts</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Note taken on [2018-08-03 Fri 18:19]</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-unset-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defadvice</span> <span style="color: #c678dd;">goto-line</span> <span style="color: #c678dd;">(</span>after unfold-tree activate<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">outline-invisible-p</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">save-excursion</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">outline-previous-visible-heading</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">org-fold-show-subtree</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">agenda-today</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-line</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-to-number</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">shell-command-to-string</span> <span style="color: #98be65;">"~/.scripts/agendatoday"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">org-reveal</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">dailyplan</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">shell-command-to-string</span> <span style="color: #98be65;">"date +'</span><span style="color: #a9a1e1;">/home/user/dp/dailyplan/%Y/%Y-%m/%Y-%m-%d.org</span><span style="color: #98be65;">' | tr -d '</span><span style="color: #a9a1e1;">\n</span><span style="color: #98be65;">'"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">end-of-buffer</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(add-hook 'find-file-hook 'dailyplan-hook)</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(defun dailyplan-hook ()</span>
<span style="color: #5B6268;">;  </span><span style="color: #5B6268;">(when (string= (buffer-file-name) "dailyplan.org")</span>
<span style="color: #5B6268;">;    </span><span style="color: #5B6268;">(agenda-today)))</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">books</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/pCloudDrive/agenda/books.org"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">thesis</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/nextcloud/bachelor/thesis/structure.tex"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">projects</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/pCloudDrive/agenda/currprojects.org"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">movies</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/pCloudDrive/agenda/movies.org"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">reviews</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/pCloudDrive/agenda/reviews/2018.org"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">split-and-follow-vertically</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/pCloudDrive/agenda/reviews/template.org"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">ceres</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"/ssh:user@sermak.xyz:~"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">ceres-root</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"/ssh:user@sermak.xyz|sudo:root@sermak.xyz:/"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">jarvis</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"/ssh:user@sermak.xyz|sudo:root@jarvis:/"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">jarvis-root</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"/ssh:user@sermak.xyz|ssh:user@jarvis:/"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z d"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">dailyplan</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z b"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">books</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z m"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">movies</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z r"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">reviews</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z p"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">projects</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z t"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">thesis</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z e"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mu4e</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z s c"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ceres</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c z s r"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ceres-root</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">University</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> uni-base-folder <span style="color: #98be65;">"/mnt/server-de/mnt/backup/backups/pre_master/Uni"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">open-uni-folder</span> <span style="color: #c678dd;">(</span>folder<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Mount/Open university folder specified as FOLDER."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-exists-p</span> uni-base-folder<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">shell-command</span> <span style="color: #98be65;">"sshfs sermak.xyz:/ /mnt/server-de"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">f-join</span> uni-base-folder folder<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defmacro</span> <span style="color: #c678dd;">uni-folder-shortcut</span> <span style="color: #c678dd;">(</span>shortcut folder funcname<span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">progn</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">defun</span> ,funcname <span style="color: #a9a1e1;">()</span>
    ,<span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"Open Uni/%s"</span> folder<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">interactive</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">open-uni-folder</span> ,folder<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"C-c u "</span> ,shortcut<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span>,funcname<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"u"</span> <span style="color: #98be65;">""</span> uni<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"6"</span> <span style="color: #98be65;">"6"</span> uni6<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"l 1"</span> <span style="color: #98be65;">"6/Orthodox Liturgy I"</span> orthodox-liturgy-1<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"l 2"</span> <span style="color: #98be65;">"6/Orthodox Liturgy II"</span> orthodox-liturgy-2<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"h 1"</span> <span style="color: #98be65;">"6/Orthodox History I"</span> orthodox-history-1<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"h 2"</span> <span style="color: #98be65;">"6/Orthodox History II"</span> orthodox-history-2<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"t 1"</span> <span style="color: #98be65;">"6/Orthodox Theology I"</span> orthodox-theology-1<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"t 2"</span> <span style="color: #98be65;">"6/Orthodox Theology II"</span> orthodox-theology-2<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"s"</span> <span style="color: #98be65;">"6/Orthodox Scripture"</span> orthodox-scripture<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"a"</span> <span style="color: #98be65;">"6/Orthodox Anthropology"</span> orthodox-anthropology<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"w"</span> <span style="color: #98be65;">"6/War and Statesbuilding in Afghanistan"</span> war-and-statesbuilding<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"e"</span> <span style="color: #98be65;">"6/Exegesis of the Old and New Testament"</span> exegesis<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">uni-folder-shortcut</span> <span style="color: #98be65;">"m"</span> <span style="color: #98be65;">"6/Monte Carlo Techniques"</span> monte-carlo<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Tones</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c -"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#772;"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c ^"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#770;"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Chinese tones</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c 1"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#772;"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c 2"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#769;"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c 3"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#780;"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c 4"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#768;"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Rectangle mark mode</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-&#246;"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #dcaeea;">rectangle-mark-mode</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Sudo-edit</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> sudo-edit
  <span style="color: #c678dd;">:bind</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">"C-c s"</span> . sudo-edit<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">rededicate-window</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Toggles window dedication in the selected window."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>dedication <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">window-dedicated-p</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">selected-window</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s"</span> dedication<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">set-window-dedicated-p</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">selected-window</span><span style="color: #a9a1e1;">)</span> dedication<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-&lt;return&gt;"</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">+vterm/toggle</span> nil<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">; </span><span style="color: #5B6268;">Org agenda</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">agenda-folder</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"/home/user/sync/agenda/"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">agenda-uni</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"/home/user/sync/agenda/uni.org"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">agenda-personal</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"/home/user/sync/agenda/personal.org"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c a a"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">agenda-folder</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c a u"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">agenda-uni</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c a p"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">agenda-personal</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">; </span><span style="color: #5B6268;">Books</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">books</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"/home/user/dox/books/"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c b"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">books</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">shortcuts</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb7b8da" class="outline-3">
<h3 id="orgfb7b8da"><span class="section-number-3">4.14.</span> Config visit</h3>
<div class="outline-text-3" id="text-4-14">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">config-visit</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgd5d3ee8" class="outline-4">
<h4 id="orgd5d3ee8"><span class="section-number-4">4.14.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-14-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org2a39cba" class="outline-4">
<h4 id="org2a39cba"><span class="section-number-4">4.14.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-14-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">config.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> module-dir <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #dcaeea;">doom-private-dir</span> <span style="color: #98be65;">"modules/"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span> <span style="color: #dcaeea;">custom-file</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">".custom.el"</span> <span style="color: #dcaeea;">doom-private-dir</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-exists-p</span> <span style="color: #dcaeea;">custom-file</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">load</span> <span style="color: #dcaeea;">custom-file</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">config-visit</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #dcaeea;">doom-private-dir</span> <span style="color: #98be65;">"config.org"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">init-visit</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #dcaeea;">doom-private-dir</span> <span style="color: #98be65;">"init.el"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">packages-visit</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #dcaeea;">doom-private-dir</span> <span style="color: #98be65;">"packages.el"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">module-visit</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> module-dir<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">recompile-modules</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">digit-argument</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">byte-recompile-directory</span> module-dir <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">config-reload</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #5B6268;">;;</span><span style="color: #5B6268;">(recompile-modules)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">org-babel-tangle-file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #dcaeea;">doom-private-dir</span> <span style="color: #98be65;">"config.org"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">load-file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #dcaeea;">doom-private-dir</span> <span style="color: #98be65;">"config.el"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c e c"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">config-visit</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c e p"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">packages-visit</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c e i"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">init-visit</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c e m"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">module-visit</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c r"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">config-reload</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">config-visit</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4d7260b" class="outline-3">
<h3 id="org4d7260b"><span class="section-number-3">4.15.</span> Search</h3>
<div class="outline-text-3" id="text-4-15">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">search</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgfcb4c32" class="outline-4">
<h4 id="orgfcb4c32"><span class="section-number-4">4.15.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-15-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org6e7284a" class="outline-4">
<h4 id="org6e7284a"><span class="section-number-4">4.15.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-15-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">search.el -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Swiper / Ivy / Counsel</span>
<span style="color: #5B6268;">;;  </span><span style="color: #5B6268;">Swiper gives us a really efficient incremental search with regular expressions</span>
<span style="color: #5B6268;">;;  </span><span style="color: #5B6268;">and Ivy / Counsel replace a lot of ido or helms completion functionality</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> counsel
  <span style="color: #c678dd;">:bind</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"M-y"</span> . counsel-yank-pop<span style="color: #98be65;">)</span>
   <span style="color: #c678dd;">:map</span> <span style="color: #dcaeea;">ivy-minibuffer-map</span>
   <span style="color: #98be65;">(</span><span style="color: #98be65;">"M-y"</span> . ivy-next-line<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> ivy
  <span style="color: #c678dd;">:diminish</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">ivy-mode</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:bind</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"C-x C-b"</span> . ivy-icon-switch-buffer<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">ivy-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">ivy-use-virtual-buffers</span> t
        <span style="color: #dcaeea;">ivy-count-format</span> <span style="color: #98be65;">"%d/%d "</span>
        <span style="color: #dcaeea;">ivy-height</span> <span style="color: #da8548; font-weight: bold;">20</span>
        <span style="color: #dcaeea;">enable-recursive-minibuffers</span> t
        <span style="color: #dcaeea;">ivy-display-style</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">fancy</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> all-the-icons-ibuffer
  <span style="color: #c678dd;">:init</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">all-the-icons-ibuffer-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">ivy-icon-switch-buffer</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"ivy-switch-buffer with icons"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">condition-case</span> nil
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">all-the-icons-ivy-setup</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

<span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">all-the-icons-ivy--buffer-transformer</span> <span style="color: #98be65;">(</span>b s<span style="color: #98be65;">)</span>
  <span style="color: #83898d;">"Return a candidate string for buffer B named S preceded by an icon.</span>
<span style="color: #83898d;">Try to find the icon for the buffer's B `</span><span style="color: #a9a1e1;">major-mode</span><span style="color: #83898d;">'.</span>
<span style="color: #83898d;">If that fails look for an icon for the mode that the `</span><span style="color: #a9a1e1;">major-mode</span><span style="color: #83898d;">' is derived from."</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>mode <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-local-value</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">major-mode</span> b<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span>buffname <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">replace-regexp-in-string</span> <span style="color: #98be65;">"&lt;.*&gt;$"</span> <span style="color: #98be65;">""</span> s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
    <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"%s"</span> <span style="color: #dcaeea;">all-the-icons-spacer</span> <span style="color: #98be65;">"%s"</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">propertize</span> <span style="color: #98be65;">"\t"</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">display</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span>
                                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">all-the-icons-ivy--icon-for-mode</span> mode<span style="color: #98be65;">)</span>
                                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">all-the-icons-ivy--icon-for-mode</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">get</span> mode <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">derived-mode-parent</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                                       <span style="color: #98be65;">(</span><span style="color: #c678dd;">all-the-icons-ivy--icon-for-firefox</span> mode buffname<span style="color: #98be65;">)</span>
                                       <span style="color: #98be65;">(</span><span style="color: #c678dd;">all-the-icons-ivy--icon-for-tor</span> mode buffname<span style="color: #98be65;">)</span>
                                       <span style="color: #98be65;">(</span><span style="color: #c678dd;">all-the-icons-ivy--icon-for-exwm</span> mode buffname<span style="color: #98be65;">)</span>
                                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">funcall</span>
                                        <span style="color: #dcaeea;">all-the-icons-ivy-family-fallback-for-buffer</span>
                                        <span style="color: #dcaeea;">all-the-icons-ivy-name-fallback-for-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-ivy--buffer-propertize</span> b s<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>


  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">ivy-switch-buffer</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">all-the-icons-ivy-file-commands</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>counsel-find-file counsel-file-jump counsel-recentf counsel-projectile-find-file counsel-projectile-find-dir<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Overwrite some stuff for exwm and icons in Firefox</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">all-the-icons-ivy--icon-for-firefox</span> <span style="color: #c678dd;">(</span>mode buffname<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Apply `</span><span style="color: #a9a1e1;">all-the-icons-icon-for-url</span><span style="color: #83898d;">' on Firefox window in exwm-mode.</span>
<span style="color: #83898d;">Assuming that url is in title like in Keepass Helper extension."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s"</span> mode<span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">"exwm-mode"</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>bnl <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-string</span> buffname <span style="color: #98be65;">" - "</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span>fnl <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-string</span> buffname <span style="color: #98be65;">" &#8212; "</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>browser <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s"</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">last</span> fnl<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-equal</span> browser <span style="color: #98be65;">"(Mozilla Firefox)"</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-equal</span> browser <span style="color: #98be65;">"(Mozilla Firefox (Private Browsing))"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"firefox"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-red</span><span style="color: #c678dd;">)</span>
        <span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Overwrite some stuff for exwm and icons in Tor Browser</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">all-the-icons-ivy--icon-for-tor</span> <span style="color: #c678dd;">(</span>mode buffname<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Apply youtube icon on Tor Browser window in exwm-mode.</span>
<span style="color: #83898d;">Not assuming that url is in title like in Keepass Helper extension, for privacy."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s"</span> mode<span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">"exwm-mode"</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>bnl <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-string</span> buffname <span style="color: #98be65;">" - "</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s"</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">last</span> bnl<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #98be65;">"(Tor Browser)"</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s"</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">last</span> bnl <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">"(YouTube Tor Browser)"</span><span style="color: #c678dd;">)</span>
                <span style="color: #c678dd;">(</span><span style="color: #c678dd;">all-the-icons-icon-for-url</span> <span style="color: #98be65;">"youtube.com"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-red</span><span style="color: #c678dd;">)</span>
              <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"user-secret"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-red</span><span style="color: #c678dd;">)</span>
              <span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Overwrite some stuff for exwm</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">all-the-icons-ivy--icon-for-exwm</span> <span style="color: #c678dd;">(</span>mode buffname<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Hard-code some icons for common programs."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s"</span> mode<span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">"exwm-mode"</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-prefix-p</span> <span style="color: #98be65;">"Signal"</span> buffname<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"comment"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-blue-alt</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-prefix-p</span> <span style="color: #98be65;">"Skype"</span> buffname<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"skype"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-blue</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-suffix-p</span> <span style="color: #98be65;">" - Discord"</span> buffname<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"simplybuilt"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-purple</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-prefix-p</span> <span style="color: #98be65;">"OBS"</span> buffname<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"video-camera"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-purple-alt</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #98be65;">"Volume Control"</span> buffname<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"volume-up"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-purple-alt</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-directory-p</span> buffname<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"folder-open"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-yellow</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-suffix-p</span> <span style="color: #98be65;">" - mpv"</span> buffname<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"play"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-orange</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-suffix-p</span> <span style="color: #98be65;">"</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">.java"</span> buffname<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-alltheicon</span> <span style="color: #98be65;">"java"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-orange</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">or</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #98be65;">"st"</span> buffname<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string-prefix-p</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">user-login-name</span><span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">"@"</span><span style="color: #98be65;">)</span> buffname<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string-prefix-p</span> <span style="color: #98be65;">"root@"</span> buffname<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">all-the-icons-faicon</span> <span style="color: #98be65;">"terminal"</span> <span style="color: #c678dd;">:face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">all-the-icons-green</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> swiper
  <span style="color: #c678dd;">:bind</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"C-s"</span> . swiper<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"C-r"</span> . swiper<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"C-c C-r"</span> . ivy-resume<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"M-x"</span> . counsel-M-x<span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #98be65;">"C-x C-f"</span> . counsel-find-file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">progn</span>
    <span style="color: #98be65;">(</span><span style="color: #dcaeea;">ivy-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">ivy-use-virtual-buffers</span> t<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">ivy-display-style</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">fancy</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> <span style="color: #dcaeea;">read-expression-map</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-r"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">counsel-expression-history</span><span style="color: #98be65;">)</span>
    <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">IDO</span>
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">enable ido mode</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">ido-enable-flex-matching</span> nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">ido-create-new-buffer</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">always</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">ido-everywhere</span> t<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">ido-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">ido vertical</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> <span style="color: #dcaeea;">ido-vertical-mode</span>
  <span style="color: #c678dd;">:init</span>
  <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">ido-vertical-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">ido-vertical-define-keys</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">C-n-and-C-p-only</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">smex</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> amx
  <span style="color: #c678dd;">:init</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">amx-initialize</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">amx-backend</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ivy</span>
        -show-key-bindings t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:bind</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"M-x"</span> . amx<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">switch buffer</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-x b"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ido-switch-buffer</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">search</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7dc5335" class="outline-3">
<h3 id="org7dc5335"><span class="section-number-3">4.16.</span> Read Aloud</h3>
<div class="outline-text-3" id="text-4-16">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">read-aloud</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orga9c97df" class="outline-4">
<h4 id="orga9c97df"><span class="section-number-4">4.16.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-16-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org08957e9" class="outline-4">
<h4 id="org08957e9"><span class="section-number-4">4.16.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-16-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">read-aloud.el -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">read-aloud.el --- A simple interface to TTS engines  -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Author: Alexander Gromnitsky <a href="mailto:alexander.gromnitsky%40gmail.com">&lt;alexander.gromnitsky@gmail.com&gt;</a></span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Version: 0.0.2</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Package-Requires: ((emacs "24.4"))</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Keywords: multimedia</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">URL: https://github.com/gromnitsky/read-aloud.el</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This file is not part of GNU Emacs.</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">License:</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">MIT</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Commentary:</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This package uses an external TTS engine (like flite) to pronounce</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">the word at or near point, the selected region or a whole buffer.</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Code:</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">read-aloud-engine</span> <span style="color: #98be65;">"speech-dispatcher"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud-engine</span> <span style="color: #98be65;">"flite"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">read-aloud-engines</span>
  <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"speech-dispatcher"</span>                 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Linux/FreeBSD only</span>
    <span style="color: #98be65;">(</span>cmd <span style="color: #98be65;">"spd-say"</span> args <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"-e"</span> <span style="color: #98be65;">"-w"</span><span style="color: #a9a1e1;">)</span> kill <span style="color: #98be65;">"spd-say -S"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">"flite"</span>                             <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Cygwin?</span>
    <span style="color: #98be65;">(</span>cmd <span style="color: #98be65;">"flite"</span> args nil<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">"jampal"</span>                            <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Windows</span>
    <span style="color: #98be65;">(</span>cmd <span style="color: #98be65;">"cscript"</span> args <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"C:\\Program Files\\Jampal\\ptts.vbs"</span> <span style="color: #98be65;">"-r"</span> <span style="color: #98be65;">"5"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">"say"</span>                               <span style="color: #5B6268;">; </span><span style="color: #5B6268;">macOS</span>
    <span style="color: #98be65;">(</span>cmd <span style="color: #98be65;">"say"</span> args nil<span style="color: #98be65;">)</span>
    <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">read-aloud-max</span> <span style="color: #da8548; font-weight: bold;">160</span><span style="color: #51afef;">)</span>             <span style="color: #5B6268;">; </span><span style="color: #5B6268;">chars</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defface</span> <span style="color: #dcaeea;">read-aloud-text-face</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>t <span style="color: #c678dd;">:inverse-video</span> t<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"For highlighting the text that is being read"</span><span style="color: #51afef;">)</span>

&#12;

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">cl-lib</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">subr-x</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">read-aloud-word-hist</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">()</span><span style="color: #51afef;">)</span>       <span style="color: #5B6268;">; </span><span style="color: #5B6268;">(*-current-word) uses it</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defconst</span> <span style="color: #dcaeea;">read-aloud--logbufname</span> <span style="color: #98be65;">"*Read-Aloud Log*"</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">this should be in cl-defstruct</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defconst</span> <span style="color: #dcaeea;">read-aloud--c-pr</span> nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defconst</span> <span style="color: #dcaeea;">read-aloud--c-buf</span> nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defconst</span> <span style="color: #dcaeea;">read-aloud--c-bufpos</span> nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defconst</span> <span style="color: #dcaeea;">read-aloud--c-locked</span> nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defconst</span> <span style="color: #dcaeea;">read-aloud--c-overlay</span> nil<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--log</span><span style="color: #c678dd;">(</span>msg <span style="color: #ECBE7B;">&amp;optional</span> args<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>buf <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">get-buffer-create</span> <span style="color: #dcaeea;">read-aloud--logbufname</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> buf
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert-before-markers</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> msg <span style="color: #98be65;">"\n"</span><span style="color: #c678dd;">)</span> args<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud-test</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Open a new tmp buffer, insert a string, try to read it."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>buf <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">get-buffer-create</span> <span style="color: #98be65;">"*Read-Aloud Test*"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> buf
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">erase-buffer</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"Here lies the body of William Jay,</span>
<span style="color: #98be65;">Who died maintaining his right of way--</span>
<span style="color: #98be65;">He was right, dead right, as he speed along,</span>
<span style="color: #98be65;">But he's just as dead as if he were wrong."</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>

    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">show our logs</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span> <span style="color: #dcaeea;">read-aloud--logbufname</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud--u-switch-to-buffer</span> buf<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-buf</span> buf<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-bufpos</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud-buf</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud-change-engine</span><span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Select another TTS engine."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud-engine</span>
        <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">ido-completing-read</span>
         <span style="color: #98be65;">"read aloud with: "</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cl-loop</span> for <span style="color: #51afef;">(</span>key _<span style="color: #51afef;">)</span> on <span style="color: #dcaeea;">read-aloud-engines</span> by <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">cddr</span>
                  collect key<span style="color: #a9a1e1;">)</span>
         nil nil nil nil <span style="color: #dcaeea;">read-aloud-engine</span>
         <span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--cmd</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">lax-plist-get</span> <span style="color: #dcaeea;">read-aloud-engines</span> <span style="color: #dcaeea;">read-aloud-engine</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">cmd</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">user-error</span> <span style="color: #98be65;">"Failed to get the default TTS engine"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--args</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">lax-plist-get</span> <span style="color: #dcaeea;">read-aloud-engines</span> <span style="color: #dcaeea;">read-aloud-engine</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">args</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--valid-str-p</span> <span style="color: #c678dd;">(</span>str<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> str <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">equal</span> <span style="color: #98be65;">""</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-trim</span> str<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--overlay-rm</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #dcaeea;">read-aloud--c-overlay</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-overlay</span> <span style="color: #dcaeea;">read-aloud--c-overlay</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-overlay</span> nil<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--overlay-make</span><span style="color: #c678dd;">(</span>beg end<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> beg end<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-overlay</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">make-overlay</span> beg end<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">overlay-put</span> <span style="color: #dcaeea;">read-aloud--c-overlay</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">read-aloud-text-face</span><span style="color: #98be65;">)</span> <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--reset</span><span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Reset internal state."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-pr</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-buf</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-bufpos</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-locked</span> nil<span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">read-aloud--overlay-rm</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">read-aloud--log</span> <span style="color: #98be65;">"RESET"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">read-aloud--string</span><span style="color: #c678dd;">(</span>str source<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Open an async process, feed its stdin with STR. SOURCE is an</span>
<span style="color: #83898d;">arbitual string like '</span><span style="color: #a9a1e1;">buffer</span><span style="color: #83898d;">', '</span><span style="color: #a9a1e1;">word</span><span style="color: #83898d;">' or '</span><span style="color: #a9a1e1;">selection</span><span style="color: #83898d;">'."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud--valid-str-p</span> str<span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">cl-return-from</span> read-aloud--string<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">process-connection-type</span> nil<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #5B6268;">; </span><span style="color: #5B6268;">(start-process) requires this</span>

    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #dcaeea;">read-aloud--c-locked</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Read-aloud is LOCKED"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-locked</span> source<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">condition-case</span> err
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-pr</span>
              <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">apply</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">start-process</span> <span style="color: #98be65;">"read-aloud"</span> nil
                     <span style="color: #c678dd;">(</span><span style="color: #c678dd;">read-aloud--cmd</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">read-aloud--args</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">error</span>
       <span style="color: #51afef;">(</span><span style="color: #c678dd;">read-aloud--reset</span><span style="color: #51afef;">)</span>
       <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">user-error</span> <span style="color: #98be65;">"External TTS engine failed to start: %s"</span>
                   <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">error-message-string</span> err<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">set-process-sentinel</span> <span style="color: #dcaeea;">read-aloud--c-pr</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">read-aloud--sentinel</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> str <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-trim</span> str<span style="color: #51afef;">)</span> <span style="color: #98be65;">"\n"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud--log</span> <span style="color: #98be65;">"Sending: `%s`"</span> str<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">process-send-string</span> <span style="color: #dcaeea;">read-aloud--c-pr</span> str<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">process-send-eof</span> <span style="color: #dcaeea;">read-aloud--c-pr</span><span style="color: #98be65;">)</span>
    <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--sentinel</span> <span style="color: #c678dd;">(</span>process event<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>source <span style="color: #dcaeea;">read-aloud--c-locked</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> event <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-trim</span> event<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">equal</span> event <span style="color: #98be65;">"finished"</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #51afef;">(</span><span style="color: #c678dd;">read-aloud--overlay-rm</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-locked</span> nil<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span>
           <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">equal</span> source <span style="color: #98be65;">"buffer"</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud-buf</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
           <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">equal</span> source <span style="color: #98be65;">"word"</span><span style="color: #98be65;">)</span> t<span style="color: #c678dd;">)</span>      <span style="color: #5B6268;">; </span><span style="color: #5B6268;">do nothing</span>
           <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">equal</span> source <span style="color: #98be65;">"selection"</span><span style="color: #98be65;">)</span> t<span style="color: #c678dd;">)</span> <span style="color: #5B6268;">; </span><span style="color: #5B6268;">do nothing</span>
           <span style="color: #c678dd;">(</span>t <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Unknown source: %s"</span> source<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #a9a1e1;">)</span>

      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">else</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">read-aloud--reset</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">user-error</span> <span style="color: #98be65;">"%s ended w/ the event: %s"</span> process event<span style="color: #a9a1e1;">)</span>
      <span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud-stop</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Ask a TTS engine to stop."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kill-process</span> <span style="color: #dcaeea;">read-aloud--c-pr</span><span style="color: #c678dd;">)</span>

  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">if a tts engine has a separate step to switch itself off, use it</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>c <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">plist-get</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">lax-plist-get</span> <span style="color: #dcaeea;">read-aloud-engines</span> <span style="color: #dcaeea;">read-aloud-engine</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">kill</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> c
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">start-process-shell-command</span> <span style="color: #98be65;">"read-aloud-kill"</span> <span style="color: #dcaeea;">read-aloud--logbufname</span> c<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">read-aloud--log</span> <span style="color: #98be65;">"INTERRUPTED BY USER"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud-reset</span><span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-buf</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">read-aloud-buf</span><span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Read the current buffer, highlighting words along the</span>
<span style="color: #83898d;">read. Run it again to stop reading."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #dcaeea;">read-aloud--c-locked</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud-stop</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">cl-return-from</span> read-aloud-buf<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> <span style="color: #dcaeea;">read-aloud--c-buf</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-buf</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> <span style="color: #dcaeea;">read-aloud--c-bufpos</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-bufpos</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span>tb<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #dcaeea;">read-aloud--c-buf</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">eobp</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #c678dd;">read-aloud--log</span> <span style="color: #98be65;">"END OF BUFFER"</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #c678dd;">read-aloud--reset</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">cl-return-from</span> read-aloud-buf<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>

      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> tb <span style="color: #51afef;">(</span><span style="color: #c678dd;">read-aloud--grab-text</span> <span style="color: #dcaeea;">read-aloud--c-buf</span> <span style="color: #dcaeea;">read-aloud--c-bufpos</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> tb
        <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #c678dd;">(</span><span style="color: #c678dd;">read-aloud--log</span> <span style="color: #98be65;">"SPACES AT THE END OF BUFFER"</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #c678dd;">read-aloud--reset</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">cl-return-from</span> read-aloud-buf<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>

      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">highlight text</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">read-aloud--overlay-make</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">plist-get</span> tb <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">beg</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">plist-get</span> tb <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">end</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>

      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">plist-get</span> tb <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">end</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">read-aloud--string</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">plist-get</span> tb <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">text</span><span style="color: #51afef;">)</span> <span style="color: #98be65;">"buffer"</span><span style="color: #a9a1e1;">)</span>

      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">read-aloud--c-bufpos</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">plist-get</span> tb <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">end</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">read-aloud--grab-text</span><span style="color: #c678dd;">(</span>buf point<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Return (text \"omglol\" beg 10 end 20) plist or nil on</span>
<span style="color: #83898d;">eof. BUF &amp; POINT are the starting location for the job."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">max</span> t2 p pstart chunks pchunk<span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> buf
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">save-excursion</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> point<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">skip-chars-forward</span> <span style="color: #98be65;">"[\\-,.:!;[:space:]\r\n]"</span><span style="color: #51afef;">)</span>

        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> max <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">+</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #98be65;">)</span> <span style="color: #dcaeea;">read-aloud-max</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">&gt;</span> max <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> max <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> t2 <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #98be65;">)</span> max<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">string-empty-p</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-trim-right</span> t2<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
            <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">we have spaces at the end of buffer, there is nothing to grab</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">cl-return-from</span> read-aloud--grab-text nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> pstart <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">=</span> max <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">progn</span>
            <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">look for the 1st non-space in `t` from the end &amp; cut</span>
            <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">off that part</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> p <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"[[:space:]\r\n]"</span>
                                  <span style="color: #51afef;">(</span><span style="color: #c678dd;">read-aloud--u-str-reverse</span> t2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> p <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> t2 <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">substring</span> t2 <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">length</span> t2<span style="color: #98be65;">)</span> p <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> chunks
              <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-string</span> t2 <span style="color: #98be65;">"[,.:!;]</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">-</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">\n</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">\r\n</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\\{2,\\}"</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> chunks
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">progn</span>
              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">search-forward</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">car</span> chunks<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> pchunk <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">search-backward</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">car</span> chunks<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> pstart <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> t2 <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span> pstart pchunk<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #51afef;">(</span><span style="color: #c678dd;">read-aloud--log</span> <span style="color: #98be65;">"text grab: `%s`"</span> t2<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">`</span><span style="color: #51afef;">(</span>text ,t2
               beg ,pstart
               end ,<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">+</span> pstart <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">length</span> t2<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">read-aloud--current-word</span><span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Pronounce a word under the pointer. If under there is rubbish,</span>
<span style="color: #83898d;">ask user for an additional input."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>cw <span style="color: #51afef;">(</span><span style="color: #c678dd;">read-aloud--u-current-word</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>word <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">2</span> cw<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> word <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"[[:alnum:]]"</span> word<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">maybe we should share the hist list w/ `wordnut-completion-hist`?</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> word <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">read-string</span> <span style="color: #98be65;">"read aloud: "</span> word <span style="color: #51afef;">'</span><span style="color: #dcaeea;">read-aloud-word-hist</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">)</span>

    <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud--overlay-make</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">0</span> cw<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">1</span> cw<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud--string</span> word <span style="color: #98be65;">"word"</span><span style="color: #98be65;">)</span>
    <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">read-aloud-this</span><span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Pronounce either the selection or a word under the pointer."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #dcaeea;">read-aloud--c-locked</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud-stop</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">cl-return-from</span> read-aloud-selection<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">use-region-p</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud--string</span>
       <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">region-beginning</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">region-end</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
       <span style="color: #98be65;">"selection"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">read-aloud--current-word</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">)</span>

&#12;

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--u-switch-to-buffer</span><span style="color: #c678dd;">(</span>buf<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #a9a1e1;">)</span> buf<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">window-list</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">split-window-vertically</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">other-window</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span> buf<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">for emacs &lt; 25</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--u-str-reverse</span> <span style="color: #c678dd;">(</span>str<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Reverse the STR."</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">apply</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">string</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">reverse</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">string-to-list</span> str<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">read-aloud--u-current-word</span><span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"This is a modified (current-word) that doesn't take any args &amp;</span>
<span style="color: #83898d;">return (beg end word) or nil."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">save-excursion</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>oldpoint <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>start <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>end <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>syntaxes <span style="color: #98be65;">"w_"</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>not-syntaxes <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"^"</span> syntaxes<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">skip-syntax-backward</span> syntaxes<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> start <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> oldpoint<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">skip-syntax-forward</span> syntaxes<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> end <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> start oldpoint<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> end oldpoint<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Look for preceding word in same line.</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">skip-syntax-backward</span> not-syntaxes <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">bolp</span><span style="color: #c678dd;">)</span>
            <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">No preceding word in same line.</span>
            <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Look for following word in same line.</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">progn</span>
              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">skip-syntax-forward</span> not-syntaxes <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> start <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">skip-syntax-forward</span> syntaxes<span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> end <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> end <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">skip-syntax-backward</span> syntaxes<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> start <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">If we found something nonempty, return it as a list.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">=</span> start end<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">list</span> start end <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span> start end<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">read-aloud</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9752a6e" class="outline-3">
<h3 id="org9752a6e"><span class="section-number-3">4.17.</span> Speed Read</h3>
<div class="outline-text-3" id="text-4-17">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">speed-read</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org70b46ec" class="outline-4">
<h4 id="org70b46ec"><span class="section-number-4">4.17.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-17-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc2cf1c2" class="outline-4">
<h4 id="orgc2cf1c2"><span class="section-number-4">4.17.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-17-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">read-single.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> spray
  <span style="color: #c678dd;">:commands</span> spray-mode
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> spray-wpm <span style="color: #da8548; font-weight: bold;">400</span>
        spray-height <span style="color: #da8548; font-weight: bold;">300</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">spray-mode-hide-cursor</span> <span style="color: #98be65;">()</span>
    <span style="color: #83898d;">"Hide or unhide the cursor as is appropriate."</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> spray-mode
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq-local</span> spray--last-evil-cursor-state <span style="color: #dcaeea;">evil-normal-state-cursor</span>
                    <span style="color: #dcaeea;">evil-normal-state-cursor</span> <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span>nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">evil-normal-state-cursor</span> spray--last-evil-cursor-state<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">spray-mode-hook</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-mode-hide-cursor</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> spray-mode-map
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"&lt;return&gt;"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-start/stop</span>
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"SPC"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-start/stop</span>
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"f"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-faster</span>
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"s"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-slower</span>
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"t"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-time</span>
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"&lt;right&gt;"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-forward-word</span>
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"h"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-forward-word</span>
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"&lt;left&gt;"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-backward-word</span>
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"l"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-backward-word</span>
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"q"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">spray-quit</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">speed-read</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org942ba25" class="outline-3">
<h3 id="org942ba25"><span class="section-number-3">4.18.</span> Spaced Repetition</h3>
<div class="outline-text-3" id="text-4-18">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">spaced-repetition</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org9043233" class="outline-4">
<h4 id="org9043233"><span class="section-number-4">4.18.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-18-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org50de7be" class="outline-4">
<h4 id="org50de7be"><span class="section-number-4">4.18.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-18-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">pamparam.el -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">pamparam.el --- Simple and fast flashcards. -*- lexical-binding: t -*-</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Copyright (C) 2016-2020 Oleh Krehel</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Author: Oleh Krehel <a href="mailto:ohwoeowho%40gmail.com">&lt;ohwoeowho@gmail.com&gt;</a></span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">URL: https://github.com/abo-abo/pamparam</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Version: 0.1.0</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Package-Requires: ((emacs "26.1") (lispy "0.27.0") (worf "0.1.0") (ivy-posframe "0.5.5"))</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Keywords: outlines, hypermedia, flashcards, memory</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This file is not part of GNU Emacs</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This file is free software; you can redistribute it and/or modify</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">the Free Software Foundation; either version 3, or (at your option)</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">any later version.</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">GNU General Public License for more details.</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">For a full copy of the GNU General Public License</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">see <a href="http://www.gnu.org/licenses/">&lt;http://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Commentary:</span>
<span style="color: #5B6268;">;;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">An example master file is given in doc/sets/capitals/capitals.org.</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Use `</span><span style="color: #a9a1e1;">hydra-pamparam/body</span><span style="color: #5B6268;">' as the entry point.</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">See README.org for more info.</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Code:</span>

<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">* Requires</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">worf</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">ivy</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defgroup</span> <span style="color: #ECBE7B;">pamparam</span> nil
  <span style="color: #83898d;">"Simple and fast flashcards."</span>
  <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">flashcards</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">* Pure</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-sm2</span> <span style="color: #c678dd;">(</span>card-stats q<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Determine the next iteration of CARD-STATS based on Q.</span>

<span style="color: #83898d;">CARD-STATS is (EASE-FACTOR . INTERVALS), the result has the</span>
<span style="color: #83898d;">same shape, with updated values.</span>

<span style="color: #83898d;">EASE-FACTOR - the previous ease factor of the card.  All cards are</span>
<span style="color: #83898d;">initialized with EASE-FACTOR of 2.5.  It will decrease for</span>
<span style="color: #83898d;">difficult cards, but not below 1.3.</span>

<span style="color: #83898d;">INTERVALS - list of integer day intervals between repetitions.</span>

<span style="color: #83898d;">Q - the quality of the answer:</span>
<span style="color: #83898d;">  5 - perfect response</span>
<span style="color: #83898d;">  4 - correct response after a hesitation</span>
<span style="color: #83898d;">  3 - correct response recalled with serious difficulty</span>
<span style="color: #83898d;">  2 - incorrect response; where the correct one seemed easy to recall</span>
<span style="color: #83898d;">  1 - incorrect response; the correct one remembered</span>
<span style="color: #83898d;">  0 - complete blackout"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>EF <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">car</span> card-stats<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>intervals <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cdr</span> card-stats<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> EF <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">max</span> <span style="color: #da8548; font-weight: bold;">1.3</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">+</span> EF <span style="color: #da8548; font-weight: bold;">0.1</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">-</span> q <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> <span style="color: #da8548; font-weight: bold;">0.08</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">*</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #da8548; font-weight: bold;">5</span> q<span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">0.02</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">&lt;</span> q <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cons</span> EF <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cons</span> <span style="color: #da8548; font-weight: bold;">1</span> intervals<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cons</span> EF
            <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cons</span>
             <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">null</span> intervals<span style="color: #a9a1e1;">)</span>
                    <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span>
                   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">car</span> intervals<span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
                    <span style="color: #da8548; font-weight: bold;">6</span><span style="color: #98be65;">)</span>
                   <span style="color: #98be65;">(</span>t
                    <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">round</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">*</span> EF <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">car</span> intervals<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             intervals<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">* Card files</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-insert-score</span> <span style="color: #c678dd;">(</span>score actual-answer<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Insert SCORE into the current card file."</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">outline-show-all</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\*\\* scores"</span> nil t<span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">outline-end-of-subtree</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">forward-line</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"** scores\n"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">backward-char</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> actual-answer
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kill-new</span> actual-answer<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format-time-string</span> <span style="color: #98be65;">"\n| &lt;%Y-%m-%d&gt; "</span><span style="color: #98be65;">)</span>
          <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"| %d |"</span> score<span style="color: #98be65;">)</span>
          <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">" %s |"</span>
                  <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> actual-answer <span style="color: #98be65;">""</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">org-table-align</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-wdiff</span> <span style="color: #c678dd;">(</span>actual-answer<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>expected-answer
         <span style="color: #51afef;">(</span><span style="color: #51afef;">save-excursion</span>
           <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
           <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">skip-chars-backward</span> <span style="color: #98be65;">"\n"</span><span style="color: #c678dd;">)</span>
           <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> actual-answer
               <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-equal</span> actual-answer expected-answer<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">executable-find</span> <span style="color: #98be65;">"wdiff"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">message</span>
       <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-trim</span>
        <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">shell-command-to-string</span>
         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span>
          <span style="color: #98be65;">"wdiff -i &lt;(echo \"%s\") &lt;(echo \"%s\")"</span>
          actual-answer
          <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-trim-right</span> expected-answer <span style="color: #98be65;">"[.?!]"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-read-stats</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\*\\* stats\n"</span> nil t<span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>beg <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span>exp1 <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">read</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span>exp2 <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">read</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            ease-factor intervals<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">0</span> exp1<span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">setq</span><span style="color: #c678dd;">)</span>
                 <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">1</span> exp1<span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ease-factor</span><span style="color: #c678dd;">)</span>
                 <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">numberp</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">2</span> exp1<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> ease-factor <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">2</span> exp1<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Bad sexp %S"</span> exp1<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">0</span> exp2<span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">setq</span><span style="color: #c678dd;">)</span>
                 <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">1</span> exp2<span style="color: #98be65;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">intervals</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> intervals <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">cadr</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">2</span> exp2<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Bad sexp %S"</span> exp2<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">delete-region</span> beg <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cons</span> ease-factor intervals<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\*\\* scores\n"</span> nil t<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">outline-end-of-subtree</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"\n** stats\n"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">list</span> <span style="color: #da8548; font-weight: bold;">2.5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"** scores not found"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-insert-stats</span> <span style="color: #c678dd;">(</span>stats<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"(setq ease-factor %f)\n"</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">car</span> stats<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"(setq intervals '%S)"</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cdr</span> stats<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-delete-region</span> <span style="color: #c678dd;">(</span>beg end<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>str <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span> beg end<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-region</span> beg end<span style="color: #98be65;">)</span>
    str<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-save-buffer</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">inhibit-message</span> t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">write-file</span> <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-card-abbreviate</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-abbreviate</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>fname <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">&gt;</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">length</span> fname<span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">60</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">rename-buffer</span>
       <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"card-"</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">substring</span> fname <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #da8548; font-weight: bold;">6</span><span style="color: #c678dd;">)</span> <span style="color: #98be65;">".org"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-score</span> <span style="color: #c678dd;">(</span>score <span style="color: #ECBE7B;">&amp;optional</span> actual-answer<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>card-file <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>todo-file <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>state <span style="color: #51afef;">(</span><span style="color: #51afef;">with-current-buffer</span> todo-file
                  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">search-forward</span> card-file<span style="color: #c678dd;">)</span>
                  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> <span style="color: #da8548; font-weight: bold;">2</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span>
                   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #98be65;">)</span>
                   <span style="color: #98be65;">(</span><span style="color: #51afef;">progn</span>
                     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">forward-word</span><span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">save-silently</span> t<span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">inhibit-read-only</span> t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string=</span> state <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">REVIEW</span><span style="color: #98be65;">"</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">with-current-buffer</span> todo-file
             <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">search-forward</span> card-file<span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">=</span> score <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">=</span> score <span style="color: #da8548; font-weight: bold;">4</span><span style="color: #a9a1e1;">)</span>
                     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">=</span> score <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                 <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">org-log-done</span> nil<span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #dcaeea;">inhibit-message</span> t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                   <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">org-todo</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">done</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
               <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>item <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-delete-region</span>
                            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                 <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                 <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> item<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string=</span> state <span style="color: #98be65;">"DONE"</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">y-or-n-p</span> <span style="color: #98be65;">"Card already done today.  Re-rate? "</span><span style="color: #c678dd;">)</span>
               <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam--card-score</span> score t actual-answer<span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">user-error</span> <span style="color: #98be65;">"This card is already done today"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string=</span> state <span style="color: #98be65;">"</span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #98be65;">"</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam--card-score</span> score nil actual-answer<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span>t
           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">user-error</span> <span style="color: #98be65;">"Unexpected state: %s"</span> state<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> todo-file
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam--recalculate-progress</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">outline-show-all</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-manual-score</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Score the card 0-5 manually."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">undo</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>score <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">completing-read</span> <span style="color: #98be65;">"score: "</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"0"</span> <span style="color: #98be65;">"1"</span> <span style="color: #98be65;">"2"</span> <span style="color: #98be65;">"3"</span> <span style="color: #98be65;">"4"</span> <span style="color: #98be65;">"5"</span><span style="color: #c678dd;">)</span> nil t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-card-score</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-to-number</span> score<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--todo-from-file</span> <span style="color: #c678dd;">(</span>card-file<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"\\`</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">-]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">-"</span> card-file<span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span>
       <span style="color: #98be65;">"* </span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #98be65;"> [[file:cards/%s/%s][%s]]\n"</span>
       <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">substring</span> card-file <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #a9a1e1;">)</span>
       card-file
       <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> card-file<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Unexpected file name"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--card-score</span> <span style="color: #c678dd;">(</span>score <span style="color: #ECBE7B;">&amp;optional</span> already-done actual-answer<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>card-file <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        stats
        new-interval<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">save-excursion</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-card-insert-score</span> score actual-answer<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> stats <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-card-read-stats</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> stats <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-sm2</span> stats score<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-card-insert-stats</span> stats<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> new-interval <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">1</span> stats<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> already-done
        <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>todo-entry <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam--todo-from-file</span> card-file<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
               str<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">search-forward</span> card-file<span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">memq</span> score <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #da8548; font-weight: bold;">4</span> <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
                    <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">beginning-of-line</span><span style="color: #c678dd;">)</span>
                    <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">looking-at</span> <span style="color: #98be65;">"\\* </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #51afef; font-weight: bold;">REVIEW</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span><span style="color: #98be65;">)</span>
                        <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">replace-match</span> <span style="color: #98be65;">"DONE"</span> nil nil nil <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span>
                      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Unexpected"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> str <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span>
                           <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> <span style="color: #da8548; font-weight: bold;">7</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                           <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">delete-region</span>
                 <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #c678dd;">)</span>
                 <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"* </span><span style="color: #51afef; font-weight: bold;">REVIEW</span><span style="color: #98be65;"> "</span> str<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-todo-file</span> new-interval<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">search-forward</span> todo-entry nil t<span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> todo-entry<span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kill-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-wdiff</span> actual-answer<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar-local</span> <span style="color: #dcaeea;">pamparam-card-answer-validate-p</span> nil<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">pamparam-card-answer-function</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">pamparam-card-answer-at-point</span>
  <span style="color: #83898d;">"Select how to answer the card."</span>
  <span style="color: #c678dd;">:type</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>choice
          <span style="color: #98be65;">(</span>const <span style="color: #c678dd;">:tag</span> <span style="color: #98be65;">"Answer at point"</span> pamparam-card-answer-at-point<span style="color: #98be65;">)</span>
          <span style="color: #98be65;">(</span>const <span style="color: #c678dd;">:tag</span> <span style="color: #98be65;">"Answer in a child frame"</span> pamparam-card-answer-posframe<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-answer-at-point</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Answer the current card.</span>
<span style="color: #83898d;">Enter the answer at point, then press \".\" to validate."</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\* m$"</span> nil t<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-region</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">match-beginning</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"* \n"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">pamparam-card-answer-validate-p</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">outline-hide-body</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-posframe-keymap</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">map</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">make-sparse-keymap</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> map <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-v"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">pamparam-card-reveal</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> map <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"."</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">ivy-done</span><span style="color: #98be65;">)</span>
    map<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"The keymap for `</span><span style="color: #a9a1e1;">pamparam-card-answer-posframe</span><span style="color: #83898d;">'"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-reveal</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">ivy-state-buffer</span> <span style="color: #dcaeea;">ivy-last</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-shifttab</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--ivy-read-posframe</span> <span style="color: #c678dd;">(</span>prompt<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>ivy-posframe-state <span style="color: #51afef;">(</span><span style="color: #51afef;">bound-and-true-p</span> ivy-posframe-mode<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> ivy-posframe-state
      <span style="color: #a9a1e1;">(</span>ivy-posframe-mode <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">unwind-protect</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #dcaeea;">ivy-add-newline-after-prompt</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">ivy-read</span> prompt nil
                     <span style="color: #c678dd;">:keymap</span> <span style="color: #dcaeea;">pamparam-posframe-keymap</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> ivy-posframe-state
        <span style="color: #51afef;">(</span>ivy-posframe-mode <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-answer-posframe</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">outline-hide-body</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">read-only-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>card-front
          <span style="color: #51afef;">(</span><span style="color: #51afef;">save-excursion</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">zo-down</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">substring-no-properties</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">org-get-heading</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>answer <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam--ivy-read-posframe</span>
                  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> card-front <span style="color: #98be65;">": "</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string=</span> answer <span style="color: #98be65;">""</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-card-validate</span> answer <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam--card-true-answer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">remove-overlays</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">invisible</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">outline</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">read-only-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-answer</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Answer the current card."</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">funcall</span> <span style="color: #dcaeea;">pamparam-card-answer-function</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-is-redo</span> nil<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--card-true-answer</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">save-excursion</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-backward</span> <span style="color: #98be65;">"^\\*"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">beginning-of-line</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">1-</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-validate-maybe</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;optional</span> arg<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Validate the given answer and score the current card.</span>

<span style="color: #83898d;">The given answer is the text between the card's first heading and</span>
<span style="color: #83898d;">point."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"p"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #dcaeea;">pamparam-card-answer-validate-p</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>tans <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam--card-true-answer</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span>actual-answer <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span>
                            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">+</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #a9a1e1;">)</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">delete-region</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">pamparam-card-answer-validate-p</span> nil<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-card-validate</span> actual-answer tans<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">self-insert-command</span> arg<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-validate</span> <span style="color: #c678dd;">(</span>actual-answer correct-answer<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Give a card score, comparing ACTUAL-ANSWER to CORRECT-ANSWER."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-equal</span> actual-answer correct-answer<span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">save-excursion</span>
            <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">re-search-backward</span> <span style="color: #98be65;">"^\\* "</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">overlays-in</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #dcaeea;">pamparam-is-redo</span>
              <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-card-score</span> <span style="color: #da8548; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-card-score</span> <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-card-score</span> <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-card-score</span> <span style="color: #da8548; font-weight: bold;">0</span> actual-answer<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">* Equivalence testing</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-equiv-hash</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">make-hash-table</span> <span style="color: #c678dd;">:test</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">equal</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-equiv-classes</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"we"</span> <span style="color: #98be65;">"wij"</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #98be65;">"je"</span> <span style="color: #98be65;">"jij"</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #98be65;">"ze"</span> <span style="color: #98be65;">"zij"</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #98be65;">"u"</span> <span style="color: #98be65;">"jij"</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #98be65;">"dichtbij"</span> <span style="color: #98be65;">"vlakbij"</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #98be65;">"test"</span> <span style="color: #98be65;">"toets"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-make-equivalent</span> <span style="color: #c678dd;">(</span>a b<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">puthash</span> a b <span style="color: #dcaeea;">pamparam-equiv-hash</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">puthash</span> b b <span style="color: #dcaeea;">pamparam-equiv-hash</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #c678dd;">(</span>c <span style="color: #dcaeea;">pamparam-equiv-classes</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-make-equivalent</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">car</span> c<span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">cadr</span> c<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-equal</span> <span style="color: #c678dd;">(</span>sa sb<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Check if the answer SA matches the question SB.</span>
<span style="color: #83898d;">When SB has multiple lines, SA may match one of them."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">string-match-p</span> <span style="color: #98be65;">"\n"</span> sb<span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>sbl <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-string</span> sb <span style="color: #98be65;">"\n"</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            res<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">null</span> res<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> sb <span style="color: #98be65;">(</span><span style="color: #51afef;">pop</span> sbl<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> res <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-equal-single</span> sa sb<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        res<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-equal-single</span> sa sb<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-equal-single</span> <span style="color: #c678dd;">(</span>sa sb<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Check if SA matches SB."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>lista <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-sloppy</span> sa<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>listb <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-sloppy</span> sb<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>res t<span style="color: #a9a1e1;">)</span>
        a b
        ah<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">while</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> res lista<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> a <span style="color: #51afef;">(</span><span style="color: #51afef;">pop</span> lista<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> b <span style="color: #51afef;">(</span><span style="color: #51afef;">pop</span> listb<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string=</span> a b<span style="color: #c678dd;">)</span>
                  <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> ah <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">gethash</span> a <span style="color: #dcaeea;">pamparam-equiv-hash</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">equal</span> ah
                              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">gethash</span> b <span style="color: #dcaeea;">pamparam-equiv-hash</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> res nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> res <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">null</span> listb<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-sloppy</span> <span style="color: #c678dd;">(</span>str<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapcar</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">downcase</span>
          <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">split-string</span> str <span style="color: #98be65;">"[.,?!: ]"</span> t<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-load-file-name</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #dcaeea;">load-file-name</span>
                                    <span style="color: #98be65;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-path</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">expand-file-name</span>
                       <span style="color: #98be65;">"doc/sets/capitals/capitals.pam"</span>
                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-directory</span> <span style="color: #dcaeea;">pamparam-load-file-name</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Point to a default repository. In case you call `</span><span style="color: #a9a1e1;">pamparam-drill</span><span style="color: #83898d;">'</span>
<span style="color: #83898d;">while not in any repo, this repo will be selected."</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-alist</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">list</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">cons</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"capitals.org"</span>
                                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-name-directory</span> <span style="color: #dcaeea;">pamparam-path</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #dcaeea;">pamparam-path</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Map a master file to the corresponding repository.</span>
<span style="color: #83898d;">Otherwise, the repository will be in the same directory as the master file."</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">* Schedule files</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-repo-directory</span> <span style="color: #c678dd;">(</span>file<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Return the Git repository that corresponds to FILE."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">cdr</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">assoc</span> file <span style="color: #dcaeea;">pamparam-alist</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> file
          <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">expand-file-name</span>
           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-name-sans-extension</span>
             <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span>
              file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
            <span style="color: #98be65;">".pam/"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">locate-dominating-file</span> <span style="color: #dcaeea;">default-directory</span> <span style="color: #98be65;">".git"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-repo-init</span> <span style="color: #c678dd;">(</span>repo-dir<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Initialize REPO-DIR Git repository."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-exists-p</span> repo-dir<span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-directory-p</span> repo-dir<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"%s must be a directory"</span> repo-dir<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">make-directory</span> repo-dir<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">default-directory</span> repo-dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">shell-command</span> <span style="color: #98be65;">"git init"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">make-directory</span> <span style="color: #98be65;">"cards/"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-new-cards-per-day</span> <span style="color: #da8548; font-weight: bold;">75</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-delete</span> <span style="color: #c678dd;">(</span>file<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Delete the card in FILE.</span>
<span style="color: #83898d;">When called interactively, delete the card in the current buffer."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">list</span> <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-exists-p</span> file<span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">y-or-n-p</span>
              <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"Really delete %s? "</span>
                      <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> file<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-file</span> file<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string=</span> <span style="color: #51afef;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #51afef;">)</span> file<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kill-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam--update-card</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> file<span style="color: #a9a1e1;">)</span>
     nil<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--update-card</span> <span style="color: #c678dd;">(</span>prev-file new-entry<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>prev-scheduled <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"git grep %s"</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">shell-quote-argument</span> prev-file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">save-silently</span> t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #a9a1e1;">(</span>prev prev-scheduled<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"\\`</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">:]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">:.*\\[\\[file:cards/</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">.*</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\\]\\[</span><span style="color: #a9a1e1;">.*\\</span><span style="color: #98be65;">]\\'"</span> prev<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">user-error</span> <span style="color: #98be65;">"Bad scheduled item: %s"</span> prev<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>schedule-file
             <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> prev<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span>entry <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">2</span> prev<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">with-temp-buffer</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert-file-contents</span> schedule-file<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-forward</span> entry nil t<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> new-entry
                <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">replace-match</span> new-entry<span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">delete-region</span>
               <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">write-file</span> schedule-file<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-hash-card-name-&gt;file</span> nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-hash-card-body-&gt;file</span> nil<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-cmd-to-list</span> <span style="color: #c678dd;">(</span>cmd <span style="color: #ECBE7B;">&amp;optional</span> directory<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">default-directory</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> directory <span style="color: #dcaeea;">default-directory</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">split-string</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">shell-command-to-string</span> cmd<span style="color: #a9a1e1;">)</span>
     <span style="color: #98be65;">"\n"</span> t<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-cards</span> <span style="color: #c678dd;">(</span>repo-dir<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span>
   <span style="color: #98be65;">"git ls-files cards/"</span>
   repo-dir<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-visited-cards</span> <span style="color: #c678dd;">(</span>repo-dir<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span>
   <span style="color: #98be65;">"git grep --files-with-matches '^\\*\\* scores'"</span>
   repo-dir<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-unvisited-cards</span> <span style="color: #c678dd;">(</span>repo-dir<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span>
   <span style="color: #98be65;">"git grep --files-without-match '^\\*\\* scores' | grep cards/"</span>
   repo-dir<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-pile</span> <span style="color: #c678dd;">(</span>repo-dir<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Pile up all unvisited cards into a single file."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>unvisited-cards <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-unvisited-cards</span> repo-dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>schedule-files <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span> <span style="color: #98be65;">"git ls-files --full-name pamparam-*-[0-9][0-9].org"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">save-silently</span> t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #a9a1e1;">(</span>sf schedule-files<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">expand-file-name</span> sf repo-dir<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #c678dd;">(</span>card unvisited-cards<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">while</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">search-forward</span> card nil t<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-region</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">kill-buffer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"pampile.org"</span> repo-dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">delete-region</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #51afef;">(</span>card unvisited-cards<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam--todo-from-file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> card<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kill-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-pull</span> <span style="color: #c678dd;">(</span>arg <span style="color: #ECBE7B;">&amp;optional</span> buffer<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Pull ARG cards into BUFFER.</span>
<span style="color: #83898d;">When called interactively, use today's schedule file."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span>
   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">list</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">read-number</span> <span style="color: #98be65;">"how many cards: "</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">save-silently</span> t<span style="color: #a9a1e1;">)</span>
        cards<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> arg <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">min</span> <span style="color: #da8548; font-weight: bold;">100</span> arg<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span> buffer<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">find-file-noselect</span>
                          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"pampile.org"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">end-of-line</span> arg<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> cards <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-delete-region</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #c678dd;">)</span>
                                     <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">min</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                                          <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kill-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-goto-schedule-part</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert</span> cards<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-goto-schedule-part</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\*"</span> nil t<span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">match-beginning</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--recompute-git-cards</span> <span style="color: #c678dd;">(</span>repo-dir<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">pamparam-hash-card-name-&gt;file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">make-hash-table</span> <span style="color: #c678dd;">:test</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">equal</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">pamparam-hash-card-body-&gt;file</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">make-hash-table</span> <span style="color: #c678dd;">:test</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">equal</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>git-files <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-cards</span> repo-dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #a9a1e1;">(</span>gf git-files<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"\\`cards/[0-9a-f]\\{2\\}/</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">-]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">-</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">.]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\\.org\\'"</span> gf<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">puthash</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> gf<span style="color: #98be65;">)</span> gf <span style="color: #dcaeea;">pamparam-hash-card-name-&gt;file</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">puthash</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">2</span> gf<span style="color: #98be65;">)</span> gf <span style="color: #dcaeea;">pamparam-hash-card-body-&gt;file</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Unexpected file name %s"</span> gf<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--replace-card</span> <span style="color: #c678dd;">(</span>_card-front _card-body repo-dir card-file prev-file<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>full-name <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span> prev-file repo-dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>old-metadata
          <span style="color: #51afef;">(</span><span style="color: #51afef;">with-temp-buffer</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert-file-contents</span> full-name<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">looking-at</span> <span style="color: #98be65;">"\\* m$"</span><span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">outline-end-of-subtree</span><span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-kill-buffer-of-file</span> full-name<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-file</span> full-name<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">default-directory</span> repo-dir<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>fnn <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> card-file<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam--update-card</span> prev-file <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">substring</span> fnn <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #c678dd;">)</span> <span style="color: #98be65;">"/"</span> fnn<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    old-metadata<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">eval-and-compile</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">system-type</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">windows-nt</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-spit</span> <span style="color: #a9a1e1;">(</span>str file<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">find-file-noselect</span> file<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">erase-buffer</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> str<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">save-buffer</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">kill-buffer</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-spit</span> <span style="color: #a9a1e1;">(</span>str file<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>cmd <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"echo '</span><span style="color: #a9a1e1;">%s</span><span style="color: #98be65;">' &gt; %s"</span>
                         <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">replace-regexp-in-string</span> <span style="color: #98be65;">"'"</span> <span style="color: #98be65;">"'</span><span style="color: #a9a1e1;">\\</span><span style="color: #98be65;">''"</span> str t t<span style="color: #a9a1e1;">)</span>
                         <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">shell-quote-argument</span> file<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">call-process-shell-command</span> cmd<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Command failed: %s"</span> cmd<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-slurp</span> <span style="color: #c678dd;">(</span>f<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-temp-buffer</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">insert-file-contents</span> f<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">buffer-string</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-update-card</span> <span style="color: #c678dd;">(</span>card-front card-body repo-dir<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>card-front-id <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">md5</span> card-front<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>card-body-id <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">md5</span> card-body<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>prev-file
          <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span>
           <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">gethash</span> card-front-id <span style="color: #dcaeea;">pamparam-hash-card-name-&gt;file</span><span style="color: #c678dd;">)</span>
           <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">gethash</span> card-body-id <span style="color: #dcaeea;">pamparam-hash-card-body-&gt;file</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>subdir <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">substring</span> card-front-id <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>card-file
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span>
           <span style="color: #98be65;">"cards/"</span> subdir <span style="color: #98be65;">"/"</span> card-front-id <span style="color: #98be65;">"-"</span> card-body-id <span style="color: #98be65;">".org"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>full-card-file <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span> card-file repo-dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>metadata nil<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">null</span> prev-file<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string=</span> card-file prev-file<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span>t
           <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-exists-p</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span> prev-file repo-dir<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> metadata <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam--replace-card</span>
                             card-front card-body repo-dir card-file prev-file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-exists-p</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span> card-file repo-dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>txt
              <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> metadata <span style="color: #98be65;">"* m\n#+STARTUP: content\n"</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"* %s\n%s"</span> card-front card-body<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">make-directory</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-name-directory</span> full-card-file<span style="color: #c678dd;">)</span> t<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-spit</span> txt full-card-file<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cons</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> metadata
                  <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">update</span>
                <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">new</span><span style="color: #c678dd;">)</span>
              card-file<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defconst</span> <span style="color: #dcaeea;">pamparam-card-source-regexp</span> <span style="color: #98be65;">"^\\*+ .*:cards:"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-sync</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Synchronize the current `</span><span style="color: #a9a1e1;">org-mode</span><span style="color: #83898d;">' master file to the cards repository.</span>

<span style="color: #83898d;">Create the cards repository if it doesn't exist.</span>

<span style="color: #83898d;">Each card is uniquely identifiable by either its front or its</span>
<span style="color: #83898d;">back.  So if you want to modify both the front and the back, first</span>
<span style="color: #83898d;">modify the front, call `</span><span style="color: #a9a1e1;">pamparam-sync</span><span style="color: #83898d;">', then modify the back and call</span>
<span style="color: #83898d;">`</span><span style="color: #a9a1e1;">pamparam-sync</span><span style="color: #83898d;">' again.  Otherwise, there's no way to \"connect\" the</span>
<span style="color: #83898d;">new card to the old one, and the old card will remain in the</span>
<span style="color: #83898d;">repository, while the new card will start with empty metadata."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-mode</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Must be in `</span><span style="color: #a9a1e1;">org-mode</span><span style="color: #98be65;">' file"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam--cards-available-p</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>repo-dir <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-repo-directory</span> <span style="color: #98be65;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #dcaeea;">make-backup-files</span> nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-repo-init</span> repo-dir<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam--recompute-git-cards</span> repo-dir<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam--sync</span> repo-dir<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-kill-buffer-of-file</span> <span style="color: #c678dd;">(</span>fname<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #98be65;">(</span>buf <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">buffer-list</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">equal</span> fname <span style="color: #51afef;">(</span><span style="color: #dcaeea;">buffer-file-name</span> buf<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kill-buffer</span> buf<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">org-keyword-properties</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamapram--cards-at-level-one-p</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>alist <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">boundp</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-file-properties</span><span style="color: #c678dd;">)</span>
                   org-file-properties
                 <span style="color: #dcaeea;">org-keyword-properties</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">assoc-string</span> <span style="color: #98be65;">"pamparam"</span> alist t<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--cards-available-p</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamapram--cards-at-level-one-p</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">save-excursion</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #dcaeea;">pamparam-card-source-regexp</span> nil t<span style="color: #51afef;">)</span>
            t
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"No outlines with the :cards: tag found"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--sync</span> <span style="color: #c678dd;">(</span>repo-dir<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>old-point <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>processed-headings nil<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>new-cards nil<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>updated-cards nil<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>cards-at-level-one-p <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamapram--cards-at-level-one-p</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>regex <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> cards-at-level-one-p
                      <span style="color: #98be65;">"\\*+ .*$"</span>
                    <span style="color: #dcaeea;">pamparam-card-source-regexp</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">re-search-forward</span> regex nil t<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> cards-at-level-one-p
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">beginning-of-line</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">lispy-destructuring-setq</span> <span style="color: #c678dd;">(</span>processed-headings new-cards updated-cards<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-sync-current-outline</span>
             processed-headings new-cards updated-cards repo-dir<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> old-point<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> new-cards updated-cards<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>pile-fname <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"pampile.org"</span> repo-dir<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-kill-buffer-of-file</span> pile-fname<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-schedule-today</span>
         <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapcar</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">pamparam--todo-from-file</span> new-cards<span style="color: #c678dd;">)</span>
         <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file-noselect</span> pile-fname<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">shell-command-to-string</span>
       <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span>
        <span style="color: #98be65;">"cd %s &amp;&amp; git add . &amp;&amp; git commit -m %s"</span>
        <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">shell-quote-argument</span> repo-dir<span style="color: #c678dd;">)</span>
        <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">shell-quote-argument</span>
         <span style="color: #98be65;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">null</span> updated-cards<span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"Add %d new card(s)"</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">length</span> new-cards<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">null</span> new-cards<span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"Update %d card(s)"</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">length</span> updated-cards<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span>t
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"Add %d new card(s), update %d cards"</span>
                        <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">length</span> new-cards<span style="color: #c678dd;">)</span>
                        <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">length</span> updated-cards<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"%d new cards, %d updated, %d total"</span>
             <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">length</span> new-cards<span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">length</span> updated-cards<span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">length</span> processed-headings<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--card-info</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>bnd <span style="color: #51afef;">(</span><span style="color: #c678dd;">worf--bounds-subtree</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>str <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">lispy--string-dwim</span> bnd<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         front back<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"^\\*+ a\n</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">.*</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> str<span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> front <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">substring</span> str <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">match-beginning</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> back <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"* a\n"</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> str<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> front <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string-trim-left</span> front<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">cdr</span> bnd<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"\\`\\*+ </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">.*</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\n</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">*]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(?:</span><span style="color: #98be65;">\n\\*</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">?"</span> str<span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> front <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> str<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> back <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">2</span> str<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">+</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">car</span> bnd<span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">match-end</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> back <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">string-trim-right</span> back<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"\\`</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">\\*+ </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">.*{</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">}]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">}.*\\'"</span> str<span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> front
                 <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">substring</span> str <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">match-end</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">1-</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">match-beginning</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                         <span style="color: #98be65;">"[...]"</span>
                         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">substring</span> str <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">match-end</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> back <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">2</span> str<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span>t
           <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"unexpected"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">cons</span> front back<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-sync-current-outline</span> <span style="color: #c678dd;">(</span>processed-headings new-cards updated-cards repo-dir<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>end <span style="color: #51afef;">(</span><span style="color: #51afef;">save-excursion</span>
               <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">outline-end-of-subtree</span><span style="color: #c678dd;">)</span>
               <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">while</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\*+ </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">.*</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">$"</span> end t<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>card-info <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam--card-info</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>card-front <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">car</span> card-info<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>card-body <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">cdr</span> card-info<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             card-file<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">member</span> card-front processed-headings<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Duplicate heading encountered: %s"</span> card-front<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">push</span> card-front processed-headings<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> card-info <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-update-card</span> card-front card-body repo-dir<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> card-file <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cdr</span> card-info<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">cond</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">car</span> card-info<span style="color: #51afef;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">new</span><span style="color: #a9a1e1;">)</span>
                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">push</span> card-file new-cards<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">car</span> card-info<span style="color: #51afef;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">update</span><span style="color: #a9a1e1;">)</span>
                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">push</span> card-file updated-cards<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">list</span> processed-headings new-cards updated-cards<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-default-directory</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"^</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">.*\\.pam/</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> <span style="color: #dcaeea;">default-directory</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #dcaeea;">default-directory</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #dcaeea;">pamparam-path</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-kill-buffers</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>pdir <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-default-directory</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>cards-dir <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"cards/"</span> pdir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #a9a1e1;">(</span>b <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-list</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #dcaeea;">buffer-file-name</span> b<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>dir <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-name-directory</span> <span style="color: #51afef;">(</span><span style="color: #dcaeea;">buffer-file-name</span> b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">equal</span> dir cards-dir<span style="color: #a9a1e1;">)</span>
                    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">equal</span> dir pdir<span style="color: #51afef;">)</span>
                         <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">equal</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span>
                                      <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">buffer-file-name</span> b<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                                     <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-schedule-file</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">current-time</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">kill-buffer</span> b<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-schedule-file</span> <span style="color: #c678dd;">(</span>time<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>year <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format-time-string</span> <span style="color: #98be65;">"%Y"</span> time<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>current-year <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format-time-string</span> <span style="color: #98be65;">"%Y"</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">current-time</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>base <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format-time-string</span> <span style="color: #98be65;">"pam-%Y-%m-%d.org"</span> time<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string=</span> year current-year<span style="color: #a9a1e1;">)</span>
        base
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>dir <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span>
                  year <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">expand-file-name</span> <span style="color: #98be65;">"years"</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-default-directory</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-exists-p</span> dir<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">make-directory</span> dir t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span> base dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-todo-file</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;optional</span> offset<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> offset <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> offset <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">default-directory</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-default-directory</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>todo-file <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span>
                     <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-schedule-file</span>
                      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">time-add</span>
                       <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">current-time</span><span style="color: #a9a1e1;">)</span>
                       <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">days-to-time</span> offset<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">save-silently</span> t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-exists-p</span> todo-file<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">save-current-buffer</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">find-file</span> todo-file<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"#+SEQ_</span><span style="color: #ECBE7B; font-weight: bold;">TODO:</span><span style="color: #98be65;"> </span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #98be65;"> </span><span style="color: #51afef; font-weight: bold;">REVIEW</span><span style="color: #98be65;"> | DONE\n"</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> offset <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-pull</span> <span style="color: #da8548; font-weight: bold;">10</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Schedule was empty, used `</span><span style="color: #a9a1e1;">pamparam-pull</span><span style="color: #98be65;">' for 10 cards"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">find-file-noselect</span> todo-file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-last-rechedule</span> nil<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-schedule-today</span> <span style="color: #c678dd;">(</span>cards <span style="color: #ECBE7B;">&amp;optional</span> buffer<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> buffer <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-goto-schedule-part</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #a9a1e1;">(</span>card cards<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> card<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">save-silently</span> t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar-local</span> <span style="color: #dcaeea;">pamparam--progress</span> nil
  <span style="color: #83898d;">"Cache the current progress."</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-current-progress</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #dcaeea;">pamparam--progress</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam--recalculate-progress</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam--recalculate-progress</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">pamparam--progress</span>
        <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>n-done <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span>n-todo <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span>n-review <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">save-excursion</span>
            <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">while</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\* </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">DONE</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #51afef; font-weight: bold;">REVIEW</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> nil t<span style="color: #c678dd;">)</span>
              <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>ms <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                <span style="color: #98be65;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string=</span> ms <span style="color: #98be65;">"</span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #98be65;">"</span><span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #51afef;">cl-incf</span> n-todo<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string=</span> ms <span style="color: #98be65;">"DONE"</span><span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #51afef;">cl-incf</span> n-done<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string=</span> ms <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">REVIEW</span><span style="color: #98be65;">"</span><span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #51afef;">cl-incf</span> n-review<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">list</span> n-done n-todo n-review<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-mode-line</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cl-destructuring-bind</span> <span style="color: #98be65;">(</span>n-done n-todo n-review<span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-current-progress</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"(pam: %d/%d+%d)"</span> n-done n-todo n-review<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-day-limit</span> <span style="color: #da8548; font-weight: bold;">50</span>
  <span style="color: #83898d;">"Limit for today's repetitions.</span>
<span style="color: #83898d;">All cards above this number that would be scheduled for today</span>
<span style="color: #83898d;">will instead be moved to tomorrow."</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-merge-schedules</span> <span style="color: #c678dd;">(</span>from to<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Copy items FROM -&gt; TO. Delete FROM."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>from-lines
         <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cl-remove-if-not</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">(</span>s<span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">string-match-p</span> <span style="color: #98be65;">"^\\*"</span> s<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-string</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-slurp</span> from<span style="color: #98be65;">)</span> <span style="color: #98be65;">"\n"</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>to-lines <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">split-string</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-slurp</span> to<span style="color: #c678dd;">)</span> <span style="color: #98be65;">"\n"</span> t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-spit</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">mapconcat</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">identity</span>
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">append</span> to-lines from-lines<span style="color: #51afef;">)</span>
                <span style="color: #98be65;">"\n"</span><span style="color: #a9a1e1;">)</span>
     to<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-file</span> from<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-carryover-year-maybe</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Move e.g. years/2018/*.org to . if the current year is 2018."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>today <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">calendar-current-date</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>year <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">2</span> today<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">default-directory</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-default-directory</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>year-directory <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"years/%d"</span> year<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-exists-p</span> year-directory<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>year-files <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">directory-files</span> year-directory nil <span style="color: #98be65;">"org$"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #c678dd;">(</span>file year-files<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>file-from <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span> file year-directory<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                <span style="color: #a9a1e1;">(</span>file-to <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">expand-file-name</span> file<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-exists-p</span> file-to<span style="color: #a9a1e1;">)</span>
                <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-merge-schedules</span> file-from file-to<span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">rename-file</span> file-from file-to<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">delete-directory</span> year-directory<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-check</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Check the repo for inconsistencies and fix them.</span>

<span style="color: #83898d;">Check that all existing cards are scheduled, and only once.</span>
<span style="color: #83898d;">Check that there are no scheduled unexisting cards."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">default-directory</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-default-directory</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>all-cards <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-cards</span> <span style="color: #dcaeea;">default-directory</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>all-schedules <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">delq</span> nil
                              <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapcar</span>
                               <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>s<span style="color: #a9a1e1;">)</span>
                                 <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"file:</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">]]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> s<span style="color: #51afef;">)</span>
                                   <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> s<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                               <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span>
                                <span style="color: #98be65;">"git grep '^\\* TODO'"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>unscheduled-cards <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cl-set-difference</span>
                             all-cards
                             all-schedules
                             <span style="color: #c678dd;">:test</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">equal</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>unexisting-cards <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cl-set-difference</span>
                            all-schedules
                            all-cards
                            <span style="color: #c678dd;">:test</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">equal</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>all-schedules-nodups <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">delete-dups</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">copy-sequence</span> all-schedules<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>duplicate-cards <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cl-set-difference</span> all-schedules all-schedules-nodups<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">find-file-noselect</span> <span style="color: #98be65;">"pampile.org"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #51afef;">(</span>card unscheduled-cards<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"* </span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #98be65;"> [[file:%s][%s]]\n"</span>
                        card <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">split-string</span> card <span style="color: #98be65;">"[-.]"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">save-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #a9a1e1;">(</span>card <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">append</span> duplicate-cards unexisting-cards<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>occurences <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"git grep %s"</span> card<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #c678dd;">(</span>occ <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">length</span> occurences<span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
                         occurences
                       <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cdr</span> occurences<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">find-file-noselect</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">car</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">split-string</span> occ <span style="color: #98be65;">":"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-forward</span> card<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-region</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">save-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-reschedule-maybe</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-carryover-year-maybe</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>today <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">calendar-current-date</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">unless</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #dcaeea;">pamparam-last-rechedule</span>
                 <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">&lt;</span>
                  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">calendar-absolute-from-gregorian</span> today<span style="color: #c678dd;">)</span>
                  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">calendar-absolute-from-gregorian</span> <span style="color: #dcaeea;">pamparam-last-rechedule</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">pamparam-last-rechedule</span> today<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>today-file <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>today-file-name <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span>
                               <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">buffer-file-name</span> today-file<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>pdir <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-directory</span>
                    <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">buffer-file-name</span> today-file<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>all-files <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">directory-files</span> pdir nil <span style="color: #98be65;">"org$"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>idx <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">cl-position</span> today-file-name all-files
                               <span style="color: #c678dd;">:test</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">equal</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>old-files <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">reverse</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">cl-subseq</span> all-files <span style="color: #da8548; font-weight: bold;">0</span> idx<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #c678dd;">(</span>old-file old-files<span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> old-file <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">expand-file-name</span> old-file pdir<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span>cards<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">find-file-noselect</span> old-file<span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\* </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #51afef; font-weight: bold;">REVIEW</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;"> "</span> nil t<span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #51afef;">push</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span>
                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                      cards<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-schedule-today</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">mapcar</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>s<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"* </span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #98be65;"> "</span> s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                                             <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">nreverse</span> cards<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-file</span> old-file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">with-current-buffer</span> today-file
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\* </span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #98be65;">"</span> nil t <span style="color: #dcaeea;">pamparam-day-limit</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">beginning-of-line</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>rescheduled <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span>
                                <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">delete-region</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">save-buffer</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-todo-file</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> rescheduled<span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">save-buffer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-drill</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Start a learning session.</span>

<span style="color: #83898d;">When `</span><span style="color: #a9a1e1;">default-directory</span><span style="color: #83898d;">' is in a *.pam repository, use that repository.</span>
<span style="color: #83898d;">Otherwise, use the repository that `</span><span style="color: #a9a1e1;">pamparam-path</span><span style="color: #83898d;">' points to.</span>

<span style="color: #83898d;">See `</span><span style="color: #a9a1e1;">pamparam-sync</span><span style="color: #83898d;">' for creating and updating a *.pam repository.</span>

<span style="color: #83898d;">If you have no more cards scheduled for today, use `</span><span style="color: #a9a1e1;">pamparam-pull</span><span style="color: #83898d;">'."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-reschedule-maybe</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span>card-link card-file<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">bound-and-true-p</span> <span style="color: #dcaeea;">pamparam-card-mode</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-modified-p</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kill-buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-other-windows</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">split-window-vertically</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-kill-buffers</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^* </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #51afef; font-weight: bold;">REVIEW</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;"> "</span> nil t<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">recenter</span> <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> card-link <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-substring-no-properties</span>
                       <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">beginning-of-line</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">set-window-point</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">selected-window</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">other-window</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">null</span> card-link<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"%d cards learned/reviewed today. Well done!"</span>
                 <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cl-count-if</span>
                  <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">(</span>x<span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"^\\* DONE"</span> x<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">split-string</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #a9a1e1;">)</span>
                                  <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">buffer-string</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #ECBE7B;">"\n"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"\\`\\[\\[file:</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">]]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\\]\\[</span><span style="color: #a9a1e1;">.*\\</span><span style="color: #98be65;">]\\]\\'"</span> card-link<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Bad entry in %s: %s"</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #c678dd;">)</span> card-link<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> card-file <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> card-link<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span>
       <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">find-file-noselect</span>
        <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">expand-file-name</span> card-file <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-default-directory</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">pamparam-card-mode</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-commit</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Commit the current progress using Git."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>repo-dir <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-repo-directory</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">default-directory</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-exists-p</span> repo-dir<span style="color: #c678dd;">)</span>
                                repo-dir
                              <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-default-directory</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>status <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span> <span style="color: #98be65;">"git status"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>card-count
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">cl-count-if</span>
           <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">(</span>s<span style="color: #98be65;">)</span>
             <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"modified.*cards/"</span> s<span style="color: #a9a1e1;">)</span>
                 <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"new file.*cards/"</span> s<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
           status<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>card-str <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">=</span> card-count <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
                       <span style="color: #98be65;">"card"</span>
                     <span style="color: #98be65;">"cards"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">replace-regexp-in-string</span>
      <span style="color: #98be65;">"%"</span> <span style="color: #98be65;">"%%"</span>
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">shell-command-to-string</span>
       <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span>
        <span style="color: #98be65;">"git add . &amp;&amp; git commit -m 'Do %s %s'"</span>
        card-count card-str<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-unschedule-card</span> <span style="color: #c678dd;">(</span>card-file<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Unschedule CARD-FILE everywhere and schedule it for today."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>repo-dir <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">locate-dominating-file</span> card-file <span style="color: #98be65;">".git"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>s-files <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"git add . &amp;&amp; git grep --files-with-matches %s"</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">shell-quote-argument</span> card-file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                                        repo-dir<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #a9a1e1;">(</span>file s-files<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">find-file-noselect</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">expand-file-name</span> file repo-dir<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">save-excursion</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">while</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-forward</span> card-file nil t<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-region</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">line-beginning-position</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">line-end-position</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">save-silently</span> t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">equal</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kill-buffer</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-todo-file</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-goto-schedule-part</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^\\* </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #51afef; font-weight: bold;">REVIEW</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> nil t<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">match-beginning</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam--todo-from-file</span> card-file<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-card-redo</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Redo the current card without penalty."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">string-match-p</span> <span style="color: #98be65;">"cards/.*org\\'"</span> <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>fname <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-save-buffer</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-cmd-to-list</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"git checkout -- %s"</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">shell-quote-argument</span> fname<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">revert-buffer</span> nil t nil<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">pamparam-unschedule-card</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-name-nondirectory</span> fname<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">pamparam-is-redo</span> t<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">pamparam-card-mode</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">user-error</span> <span style="color: #98be65;">"Applies only to card files"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-shifttab</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Hide/show everything."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">inhibit-message</span> t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">org-cycle-global-status</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">overview</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-cycle-global-status</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">contents</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">this-command</span> <span style="color: #dcaeea;">last-command</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">org-cycle-internal-global</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">* `</span><span style="color: #a9a1e1;">pamparam-card-mode</span><span style="color: #5B6268;">'</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">pamparam-card-mode-map</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">map</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">make-sparse-keymap</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">worf-define-key</span> map <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"q"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">bury-buffer</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">worf-define-key</span> map <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"R"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">pamparam-card-redo</span>
                     <span style="color: #c678dd;">:break</span> t<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">worf-define-key</span> map <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"n"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">pamparam-drill</span>
                     <span style="color: #c678dd;">:break</span> t<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">worf-define-key</span> map <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"D"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">pamparam-card-delete</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> map <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"."</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">pamparam-card-validate-maybe</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> map <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"M-m"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">pamparam-card-manual-score</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">define-key</span> map <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"&lt;S-iso-lefttab&gt;"</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">pamparam-shifttab</span><span style="color: #98be65;">)</span>
    map<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define-minor-mode</span> <span style="color: #dcaeea;">pamparam-card-mode</span>
  <span style="color: #83898d;">"Minor mode for Pam cards.</span>

<span style="color: #83898d;">\\{pamparam-card-mode-map}"</span>
  <span style="color: #c678dd;">:lighter</span> <span style="color: #98be65;">" p"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #dcaeea;">pamparam-card-mode</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-mode</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-card-abbreviate</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #dcaeea;">mode-line-format</span>
                      <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #dcaeea;">pamparam-card-mode</span>
                         <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">:eval</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-mode-line</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                        ,@<span style="color: #98be65;">(</span><span style="color: #a9a1e1;">assq-delete-all</span>
                           <span style="color: #51afef;">'</span><span style="color: #dcaeea;">pamparam-card-mode</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">default-value</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">mode-line-format</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">force-mode-line-update</span> t<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-cycle-global-status</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">contents</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #c678dd;">pamparam-card-answer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">pamparam-card-mode</span> <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #dcaeea;">lispy-mode</span> t<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">lispy-raise-minor-mode</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">pamparam-card-mode</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-latin</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/dox/pamparam/latin/Latin.org"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-tagalog</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/dox/pamparam/tagalog/Tagalog.org"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-drill-latin</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/dox/pamparam/latin/Latin.pam"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-drill</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-drill-tagalog</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/dox/pamparam/tagalog/Tagalog.pam"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">pamparam-drill</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-magit-commit</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">find-file</span> <span style="color: #98be65;">"~/dox/pamparam/"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">magit</span><span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">pamparam-push</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">async-shell-command</span> <span style="color: #98be65;">"cd ~/dox/pamparam/ &amp;&amp; ~/dox/pamparam/update.sh"</span><span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">* `</span><span style="color: #a9a1e1;">hydra-pamparam</span><span style="color: #5B6268;">'</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defhydra</span> hydra-pamparam <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:exit</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"pam"</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"t"</span> pamparam-drill-tagalog <span style="color: #98be65;">"tagalog"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"l"</span> pamparam-drill-latin <span style="color: #98be65;">"latin"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"d"</span> pamparam-drill <span style="color: #98be65;">"drill"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"s"</span> pamparam-sync <span style="color: #98be65;">"sync"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"m"</span> pamparam-pull <span style="color: #98be65;">"more cards"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"p"</span> pamparam-push <span style="color: #98be65;">"push"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"gl"</span> pamparam-latin <span style="color: #98be65;">"goto latin"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"gt"</span> pamparam-tagalog <span style="color: #98be65;">"goto tagalog"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"q"</span> nil <span style="color: #98be65;">"quit"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">hydra-set-property</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">hydra-pamparam</span> <span style="color: #c678dd;">:verbosity</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"C-c v"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">hydra-pamparam/body</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">pamparam-path</span> <span style="color: #98be65;">"/home/user/dox/pamparam/pamparam.pam"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">spaced-repetition</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org49b410c" class="outline-3">
<h3 id="org49b410c"><span class="section-number-3">4.19.</span> Accounting</h3>
<div class="outline-text-3" id="text-4-19">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">accounting</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org0b2ed12" class="outline-4">
<h4 id="org0b2ed12"><span class="section-number-4">4.19.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-19-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org30e783e" class="outline-4">
<h4 id="org30e783e"><span class="section-number-4">4.19.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-19-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">beancount.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> beancount
  <span style="color: #c678dd;">:mode</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">"\\.beancount\\'"</span> . beancount-mode<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:init</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">after!</span> all-the-icons
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">all-the-icons-icon-alist</span>
                 <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\.beancount\\'"</span> all-the-icons-material <span style="color: #98be65;">"attach_money"</span> <span style="color: #c678dd;">:face</span> all-the-icons-lblue<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">all-the-icons-mode-icon-alist</span>
                 <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span>beancount-mode all-the-icons-material <span style="color: #98be65;">"attach_money"</span> <span style="color: #c678dd;">:face</span> all-the-icons-lblue<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> beancount-electric-currency t<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">beancount-bal</span> <span style="color: #98be65;">()</span>
    <span style="color: #83898d;">"Run bean-report bal."</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">compilation-read-command</span> nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span>beancount--run <span style="color: #98be65;">"bean-report"</span>
                      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">file-relative-name</span> <span style="color: #dcaeea;">buffer-file-name</span><span style="color: #51afef;">)</span> <span style="color: #98be65;">"bal"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> beancount-mode-map
        <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"TAB"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">beancount-align-to-previous-number</span>
        <span style="color: #c678dd;">:i</span> <span style="color: #98be65;">"RET"</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">cmd!</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">newline-and-indent</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>beancount-align-to-previous-number<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">accounting</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0e93755" class="outline-3">
<h3 id="org0e93755"><span class="section-number-3">4.20.</span> Popes</h3>
<div class="outline-text-3" id="text-4-20">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">popes</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orged8d803" class="outline-4">
<h4 id="orged8d803"><span class="section-number-4">4.20.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-20-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-orgde69dcf" class="outline-4">
<h4 id="orgde69dcf"><span class="section-number-4">4.20.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-20-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">popes.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">get-pope-image</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span>
         <span style="color: #a9a1e1;">(</span>folder <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #dcaeea;">doom-private-dir</span> <span style="color: #98be65;">"/scripts/popes/images/"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>files <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">directory-files</span> folder nil <span style="color: #98be65;">"\\.png\\'"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>number-popes <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">length</span> files<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>pope-img <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">random</span> number-popes<span style="color: #c678dd;">)</span> files<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> currently-displayed-pope <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">replace-regexp-in-string</span> <span style="color: #98be65;">".png"</span> <span style="color: #98be65;">""</span> pope-img<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> pope-info <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">shell-command-to-string</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"grep -m1 \""</span> currently-displayed-pope <span style="color: #98be65;">"\" "</span> folder <span style="color: #98be65;">"../pope_info.txt"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">concat</span> folder pope-img<span style="color: #98be65;">)</span>
    <span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">psalm</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">shell-command-to-string</span> <span style="color: #98be65;">"~/.scripts/psalms.sh de"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> fancy-splash-last-size nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> fancy-splash-last-theme nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">set-appropriate-splash</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;rest</span> _<span style="color: #c678dd;">)</span>
   <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">fancy-splash-image</span> <span style="color: #98be65;">(</span><span style="color: #c678dd;">get-pope-image</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
   <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">+doom-dashboard-banner-padding</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #da8548; font-weight: bold;">5</span> . <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
   <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> fancy-splash-last-theme <span style="color: #dcaeea;">doom-theme</span><span style="color: #c678dd;">)</span>
   <span style="color: #c678dd;">(</span><span style="color: #c678dd;">+doom-dashboard-reload</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">window-size-change-functions</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">set-appropriate-splash</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">doom-load-theme-hook</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">set-appropriate-splash</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">doom-dashboard-phrase</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Get a splash phrase, flow it over multiple lines as needed, and make fontify it."</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">mapconcat</span>
   <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>line<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">+doom-dashboard--center</span>
      <span style="color: #dcaeea;">+doom-dashboard--width</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">with-temp-buffer</span>
        <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert-text-button</span>
         line
         <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">action</span>
         <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>_<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">+doom-dashboard-reload</span> t<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
         <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">doom-dashboard-menu-title</span>
         <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mouse-face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">doom-dashboard-menu-title</span>
         <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">help-echo</span> currently-displayed-pope
         <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">follow-link</span> t<span style="color: #c678dd;">)</span>
        <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">buffer-string</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">split-string</span>
    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">with-temp-buffer</span>
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"Seine Heiligkeit "</span> currently-displayed-pope <span style="color: #98be65;">"\n\n"</span> pope-info <span style="color: #98be65;">"\n"</span> <span style="color: #98be65;">"Heiliger Vater, bete f&#252;r uns."</span> <span style="color: #98be65;">"\n\n"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">fill-column</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">min</span> <span style="color: #da8548; font-weight: bold;">70</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">/</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">*</span> <span style="color: #da8548; font-weight: bold;">2</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">window-width</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">fill-region</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-string</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
    <span style="color: #98be65;">"\n"</span><span style="color: #98be65;">)</span>
   <span style="color: #98be65;">"\n"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defadvice!</span> doom-dashboard-widget-loaded-with-phrase <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">:override</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">doom-dashboard-widget-loaded</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">line-spacing</span> <span style="color: #da8548; font-weight: bold;">0.2</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert</span>
   <span style="color: #98be65;">"\n\n"</span>
   <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">propertize</span>
    <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">+doom-dashboard--center</span>
     <span style="color: #dcaeea;">+doom-dashboard--width</span>
     <span style="color: #51afef;">(</span><span style="color: #c678dd;">doom-display-benchmark-h</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">return</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
    <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">face</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">doom-dashboard-loaded</span><span style="color: #98be65;">)</span>
   <span style="color: #98be65;">"\n"</span>
   <span style="color: #98be65;">(</span><span style="color: #c678dd;">doom-dashboard-phrase</span><span style="color: #98be65;">)</span>
   <span style="color: #98be65;">(</span><span style="color: #c678dd;">psalm</span><span style="color: #98be65;">)</span>
   <span style="color: #98be65;">"\n"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">remove-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">+doom-dashboard-functions</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">doom-dashboard-widget-shortmenu</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">+doom-dashboard-mode-hook</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">hide-mode-line-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">hl-line-mode</span> <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq-hook!</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">+doom-dashboard-mode-hook</span> <span style="color: #dcaeea;">evil-normal-state-cursor</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">list</span> nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">popes</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org002b0aa" class="outline-3">
<h3 id="org002b0aa"><span class="section-number-3">4.21.</span> Keycast Tweaks</h3>
<div class="outline-text-3" id="text-4-21">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">keycast-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org9190871" class="outline-4">
<h4 id="org9190871"><span class="section-number-4">4.21.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-21-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org9fc9b58" class="outline-4">
<h4 id="org9fc9b58"><span class="section-number-4">4.21.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-21-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">keycast.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> keycast
  <span style="color: #c678dd;">:commands</span> <span style="color: #dcaeea;">keycast-mode</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">define-minor-mode</span> <span style="color: #dcaeea;">keycast-mode</span>
    <span style="color: #83898d;">"Show current command and its key binding in the mode line."</span>
    <span style="color: #c678dd;">:global</span> t
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #dcaeea;">keycast-mode</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">pre-command-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">keycast--update</span> t<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">global-mode-string</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">""</span> <span style="color: #dcaeea;">mode-line-keycast</span> <span style="color: #98be65;">" "</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">remove-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">pre-command-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">keycast--update</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">global-mode-string</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">remove</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">""</span> <span style="color: #dcaeea;">mode-line-keycast</span> <span style="color: #98be65;">" "</span><span style="color: #c678dd;">)</span> <span style="color: #dcaeea;">global-mode-string</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">custom-set-faces!</span>
    <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span>keycast-command <span style="color: #c678dd;">:inherit</span> doom-modeline-debug
                      <span style="color: #c678dd;">:height</span> <span style="color: #da8548; font-weight: bold;">0.9</span><span style="color: #98be65;">)</span>
    <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span>keycast-key <span style="color: #c678dd;">:inherit</span> custom-modified
                  <span style="color: #c678dd;">:height</span> <span style="color: #da8548; font-weight: bold;">1.1</span>
                  <span style="color: #c678dd;">:weight</span> bold<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">keycast-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga582210" class="outline-3">
<h3 id="orga582210"><span class="section-number-3">4.22.</span> Weather</h3>
<div class="outline-text-3" id="text-4-22">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">weather</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org6855b46" class="outline-4">
<h4 id="org6855b46"><span class="section-number-4">4.22.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-22-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd1f9814" class="outline-4">
<h4 id="orgd1f9814"><span class="section-number-4">4.22.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-22-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">wttrin.el --- Emacs frontend for weather web service wttr.in -*- lexical-binding: t; -*-</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Copyright (C) 2016 Carl X. Su</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Author: Carl X. Su <a href="mailto:bcbcarl%40gmail.com">&lt;bcbcarl@gmail.com&gt;</a></span>
<span style="color: #5B6268;">;;         </span><span style="color: #5B6268;">ono hiroko (kuanyui) <a href="mailto:azazabc123%40gmail.com">&lt;azazabc123@gmail.com&gt;</a></span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Version: 0.2.0</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Package-Requires: ((emacs "24.4") (xterm-color "1.0"))</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Keywords: comm, weather, wttrin</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">URL: https://github.com/bcbcarl/emacs-wttrin</span>
<span style="color: #5B6268;">;;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Modifications made by @tecosaur</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Commentary:</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Provides the weather information from wttr.in based on your query condition.</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Code:</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">url</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">xterm-color</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defgroup</span> <span style="color: #ECBE7B;">wttrin</span> nil
  <span style="color: #83898d;">"Emacs frontend for weather web service wttr.in."</span>
  <span style="color: #c678dd;">:prefix</span> <span style="color: #98be65;">"wttrin-"</span>
  <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">comm</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">wttrin-default-api-version</span> <span style="color: #da8548; font-weight: bold;">1</span>
  <span style="color: #83898d;">"Specifies which version of the wttrin API to use."</span>
  <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">wttrn</span>
  <span style="color: #c678dd;">:type</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>choice <span style="color: #98be65;">(</span>const <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span>const <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">wttrin-default-cities</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"Amsterdam"</span>
                                   <span style="color: #98be65;">"Baghdad"</span>
                                   <span style="color: #98be65;">"Beijing"</span>
                                   <span style="color: #98be65;">"Brussels"</span>
                                   <span style="color: #98be65;">"Buenos Aires"</span>
                                   <span style="color: #98be65;">"Cairo"</span>
                                   <span style="color: #98be65;">"Delhi"</span>
                                   <span style="color: #98be65;">"Gurnsey"</span>
                                   <span style="color: #98be65;">"Ho Chi Ming City"</span>
                                   <span style="color: #98be65;">"Hong Kong"</span>
                                   <span style="color: #98be65;">"Istanbul"</span>
                                   <span style="color: #98be65;">"Johannesburg"</span>
                                   <span style="color: #98be65;">"K&#246;ln"</span>
                                   <span style="color: #98be65;">"Kuala Lumpur"</span>
                                   <span style="color: #98be65;">"Leipzig"</span>
                                   <span style="color: #98be65;">"Lima"</span>
                                   <span style="color: #98be65;">"London"</span>
                                   <span style="color: #98be65;">"Madrid"</span>
                                   <span style="color: #98be65;">"Manila"</span>
                                   <span style="color: #98be65;">"Mexico City"</span>
                                   <span style="color: #98be65;">"Miami"</span>
                                   <span style="color: #98be65;">"Moscow"</span>
                                   <span style="color: #98be65;">"Mumbai"</span>
                                   <span style="color: #98be65;">"M&#252;nchen"</span>
                                   <span style="color: #98be65;">"New York"</span>
                                   <span style="color: #98be65;">"Nijmegen"</span>
                                   <span style="color: #98be65;">"Paris"</span>
                                   <span style="color: #98be65;">"Seoul"</span>
                                   <span style="color: #98be65;">"Shanghai"</span>
                                   <span style="color: #98be65;">"Singapore"</span>
                                   <span style="color: #98be65;">"Surat"</span>
                                   <span style="color: #98be65;">"Sydney"</span>
                                   <span style="color: #98be65;">"Tokyo"</span>
                                   <span style="color: #98be65;">"Toronto"</span>
                                   <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">and the fun one!</span>
                                   <span style="color: #98be65;">"Moon"</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Specify default cities list for quick completion."</span>
  <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">wttrin</span>
  <span style="color: #c678dd;">:type</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">list</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">wttrin-default-accept-language</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"Accept-Language"</span> . <span style="color: #98be65;">"en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4"</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Specify default HTTP request Header for Accept-Language."</span>
  <span style="color: #c678dd;">:group</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">wttrin</span>
  <span style="color: #c678dd;">:type</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>list<span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">wttrin-fetch-raw-string</span> <span style="color: #c678dd;">(</span>query <span style="color: #ECBE7B;">&amp;optional</span> api-version<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Get the weather information based on your QUERY."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> api-version <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> api-version <span style="color: #dcaeea;">wttrin-default-api-version</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">url-user-agent</span> <span style="color: #98be65;">"curl"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">url-request-extra-headers</span> <span style="color: #dcaeea;">wttrin-default-accept-language</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">url-retrieve-synchronously</span>
         <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"http://v"</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">number-to-string</span> api-version<span style="color: #c678dd;">)</span> <span style="color: #98be65;">".wttr.in/"</span> query<span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>status<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">current-buffer</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">decode-coding-string</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">buffer-string</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">utf-8</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">wttrin-exit</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">quit-window</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">wttrin-query</span> <span style="color: #c678dd;">(</span>city-name <span style="color: #ECBE7B;">&amp;optional</span> api-version<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Query weather of CITY-NAME via wttrin, and display the result in new buffer."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>raw-string <span style="color: #51afef;">(</span><span style="color: #c678dd;">wttrin-fetch-raw-string</span> city-name api-version<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"ERROR"</span> raw-string<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Cannot get weather data. Maybe you inputed a wrong city name?"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>buffer <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">get-buffer-create</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"*wttr.in - %s*"</span> city-name<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">switch-to-buffer</span> buffer<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">buffer-read-only</span> nil<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">erase-buffer</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">xterm-color-filter</span> raw-string<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">goto-char</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">save-excursion</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"^$"</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">delete-region</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">1+</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">point</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">save-excursion</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">while</span>  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">re-search-forward</span> <span style="color: #98be65;">"(B"</span> nil t<span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">delete-region</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">match-beginning</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">match-end</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">use-local-map</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">make-sparse-keymap</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">local-set-key</span> <span style="color: #98be65;">"q"</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">wttrin-exit</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">local-set-key</span> <span style="color: #98be65;">"g"</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">wttrin</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">buffer-read-only</span> t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">wttrin</span> <span style="color: #c678dd;">(</span>city <span style="color: #ECBE7B;">&amp;optional</span> api-version<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Display weather information for CITY."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span>
   <span style="color: #98be65;">(</span><span style="color: #51afef;">cond</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">equal</span> <span style="color: #dcaeea;">current-prefix-arg</span> nil<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">list</span> <span style="color: #98be65;">""</span> nil<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">equal</span> <span style="color: #dcaeea;">current-prefix-arg</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">list</span> <span style="color: #98be65;">""</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">equal</span> <span style="color: #dcaeea;">current-prefix-arg</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">list</span> <span style="color: #98be65;">""</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span>t <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">list</span>
             <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">completing-read</span> <span style="color: #98be65;">"City name: "</span> <span style="color: #dcaeea;">wttrin-default-cities</span> nil nil
                              <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">=</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">length</span> <span style="color: #dcaeea;">wttrin-default-cities</span><span style="color: #51afef;">)</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span>
                                <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">car</span> <span style="color: #dcaeea;">wttrin-default-cities</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">wttrin-query</span> city api-version<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6ba438b" class="outline-3">
<h3 id="org6ba438b"><span class="section-number-3">4.23.</span> Org Tweaks</h3>
<div class="outline-text-3" id="text-4-23">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org3f6311d" class="outline-4">
<h4 id="org3f6311d"><span class="section-number-4">4.23.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-23-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf15511e" class="outline-4">
<h4 id="orgf15511e"><span class="section-number-4">4.23.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-23-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">org-tweaks.el -*- lexical-binding: t; -*-</span>
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Code:</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">ifdirexists</span> <span style="color: #98be65;">"~/sync/org/"</span>
               <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-directory</span> dir<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">ifdirexists</span> <span style="color: #98be65;">"~/sync/agenda"</span>
               <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-agenda-files</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">directory-files</span> <span style="color: #98be65;">"~/sync/agenda/"</span> t <span style="color: #51afef;">(</span><span style="color: #51afef;">rx</span> <span style="color: #98be65;">".org"</span> eos<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-todo-keywords</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>sequence <span style="color: #98be65;">"</span><span style="color: #ECBE7B; font-weight: bold;">TODO</span><span style="color: #98be65;">(t)"</span> <span style="color: #98be65;">"LECT(l)"</span> <span style="color: #98be65;">"EXAM(e)"</span> <span style="color: #98be65;">"MEET(m)"</span> <span style="color: #98be65;">"PROJ(p)"</span> <span style="color: #98be65;">"LOOP(L)"</span> <span style="color: #98be65;">"START(s)"</span> <span style="color: #98be65;">"WAIT(w)"</span> <span style="color: #98be65;">"HOLD(h)"</span> <span style="color: #98be65;">"IDEA(i)"</span> <span style="color: #98be65;">"INPRO(n)"</span> <span style="color: #98be65;">"OPT(o)"</span> <span style="color: #98be65;">"READ(r)"</span> <span style="color: #98be65;">"|"</span> <span style="color: #98be65;">"DONE(d)"</span> <span style="color: #98be65;">"KILL(k)"</span><span style="color: #a9a1e1;">)</span>
                            <span style="color: #a9a1e1;">(</span>sequence <span style="color: #98be65;">"[ ](T)"</span> <span style="color: #98be65;">"[-](S)"</span> <span style="color: #98be65;">"[?](W)"</span> <span style="color: #98be65;">"|"</span> <span style="color: #98be65;">"[X](D)"</span><span style="color: #a9a1e1;">)</span>
                            <span style="color: #a9a1e1;">(</span>sequence <span style="color: #98be65;">"|"</span> <span style="color: #98be65;">"OKAY(O)"</span> <span style="color: #98be65;">"YES(Y)"</span> <span style="color: #98be65;">"NO(N)"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        <span style="color: #dcaeea;">org-startup-folded</span> t
        <span style="color: #dcaeea;">org-log-done</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">time</span>
        <span style="color: #dcaeea;">org-log-reschedule</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">time</span>
        <span style="color: #dcaeea;">initial-major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-mode</span>
        <span style="color: #dcaeea;">org-export-async-init-file</span> <span style="color: #98be65;">"/home/user/.doom.d/ext/export/org-export-init.el"</span>
        <span style="color: #dcaeea;">org-latex-src-block-backend</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">engraved</span><span style="color: #c678dd;">)</span>

  <span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Add org mode to txt and archive files</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">auto-mode-alist</span> <span style="color: #51afef;">'</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"\\.</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">org</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">org_archive</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">txt</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">$"</span> . org-mode<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Org Babel</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-confirm-babel-evaluate</span> nil
        <span style="color: #dcaeea;">org-src-fontify-natively</span> t
        <span style="color: #dcaeea;">org-src-tab-acts-natively</span> t
        <span style="color: #dcaeea;">org-auto-tangle-default</span> t<span style="color: #c678dd;">)</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Auto tangle</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">org-mode-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">org-auto-tangle-mode</span><span style="color: #c678dd;">)</span>
<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> beancount-main-file <span style="color: #98be65;">"/media/user/keychain/finances/wallet.beancount"</span>
      beancount-local-file <span style="color: #98be65;">"~/dox/notes/wallet.org"</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Capture</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-default-notes-file</span> <span style="color: #98be65;">"~/dox/notes/notes.org"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-capture-templates</span>
      <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"b"</span> <span style="color: #98be65;">"Beancount Entry"</span> plain
         <span style="color: #a9a1e1;">(</span>file beancount-local-file<span style="color: #a9a1e1;">)</span>
         <span style="color: #5B6268;">;</span><span style="color: #5B6268;">"%(progn (yas-expand-snippet (yas-lookup-snippet \"beancount\" 'org-mode)) nil)")))</span>
         <span style="color: #98be65;">"bc"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">org-agenda-export-to-ics</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Exports current org agenda buffer to ics, treating DEADLINES as dates"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-temp-buffer</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">cl-map</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">nil</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">insert-file-contents</span> <span style="color: #dcaeea;">org-agenda-files</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">replace-regexp-entire-buffer</span> <span style="color: #98be65;">"&lt;.*&gt; </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">&lt;.*&gt;</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> <span style="color: #98be65;">"\\1"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">replace-regexp-entire-buffer</span> <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">&lt;.*&gt;</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;"> &lt;.*&gt;"</span> <span style="color: #98be65;">"\\1"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">replace-regexp-entire-buffer</span> <span style="color: #98be65;">"SCHEDULED: </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">&lt;.*&gt;</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> <span style="color: #98be65;">"\\1"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">replace-regexp-entire-buffer</span> <span style="color: #98be65;">"DEADLINE: </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">&lt;.*&gt;</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span> <span style="color: #98be65;">"\\1"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">org-icalendar-export-to-ics</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">org-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org069fece" class="outline-3">
<h3 id="org069fece"><span class="section-number-3">4.24.</span> Languages</h3>
<div class="outline-text-3" id="text-4-24">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">languages</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org809bcbc" class="outline-4">
<h4 id="org809bcbc"><span class="section-number-4">4.24.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-24-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org347f700" class="outline-4">
<h4 id="org347f700"><span class="section-number-4">4.24.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-24-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">languages.el -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Rust</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> rustic-format-trigger <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">on-save</span>
      rustic-format-on-save t<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Latin</span>
<span style="color: #5B6268;">;;</span>

<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define-minor-mode</span> <span style="color: #dcaeea;">latin-minor-mode</span>
  <span style="color: #83898d;">"Minor mode for writing Church Latin"</span>
  <span style="color: #c678dd;">:lighter</span> <span style="color: #98be65;">" &#9767;"</span>
  <span style="color: #c678dd;">:global</span> t<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">latin-minor-mode--insert-ae</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Replace ae with &#230;"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">bound-and-true-p</span> <span style="color: #dcaeea;">latin-minor-mode</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">char-before</span><span style="color: #51afef;">)</span> ?a<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">backward-delete-char</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#230;"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">char-before</span><span style="color: #c678dd;">)</span> ?A<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">backward-delete-char</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#198;"</span><span style="color: #c678dd;">)</span>
          <span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"e"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">self-insert-command</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">latin-minor-mode--insert-versicle</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Replace VV with &#8483;"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">bound-and-true-p</span> <span style="color: #dcaeea;">latin-minor-mode</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">char-before</span><span style="color: #51afef;">)</span> ?V<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">backward-delete-char</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#8483;"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"V"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">self-insert-command</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">latin-minor-mode--insert-response</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Replace RR with &#8479;"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">bound-and-true-p</span> <span style="color: #dcaeea;">latin-minor-mode</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">char-before</span><span style="color: #51afef;">)</span> ?R<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">backward-delete-char</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"&#8479;"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">insert</span> <span style="color: #98be65;">"R"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">self-insert-command</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>



<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> latin-minor-mode-map
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"e"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">latin-minor-mode--insert-ae</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"R"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">latin-minor-mode--insert-response</span>
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"V"</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">latin-minor-mode--insert-versicle</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">For some reason, that doesn't work...</span>
<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">(progn</span>
<span style="color: #5B6268;">;;  </span><span style="color: #5B6268;">(global-set-key (kbd "e") 'latin-minor-mode--insert-ae)</span>
<span style="color: #5B6268;">;;  </span><span style="color: #5B6268;">(global-set-key (kbd "R") 'latin-minor-mode--insert-response)</span>
<span style="color: #5B6268;">;;  </span><span style="color: #5B6268;">(global-set-key (kbd "V") 'latin-minor-mode--insert-versicle))</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">languages</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc052403" class="outline-3">
<h3 id="orgc052403"><span class="section-number-3">4.25.</span> Email</h3>
<div class="outline-text-3" id="text-4-25">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module-if</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mu4e</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">email</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgf37fa49" class="outline-4">
<h4 id="orgf37fa49"><span class="section-number-4">4.25.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-25-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc234c72" class="outline-4">
<h4 id="orgc234c72"><span class="section-number-4">4.25.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-25-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">email.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> mu4e-mu-binary <span style="color: #98be65;">"/bin/mu"</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">mu4e reindexing when tmp file exists</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> mu4e
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">mu4e-reindex-request-file</span> <span style="color: #98be65;">"/tmp/mu_reindex_now"</span>
    <span style="color: #83898d;">"Location of the reindex request, signaled by existance"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">mu4e-reindex-request-min-seperation</span> <span style="color: #da8548; font-weight: bold;">5.0</span>
    <span style="color: #83898d;">"Don't refresh again until this many second have elapsed.</span>
<span style="color: #83898d;">Prevents a series of redisplays from being called (when set to an appropriate value)"</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">mu4e-reindex-request--file-watcher</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">mu4e-reindex-request--file-just-deleted</span> nil<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">mu4e-reindex-request--last-time</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">mu4e-reindex-request--add-watcher</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> mu4e-reindex-request--file-just-deleted nil<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">setq</span> mu4e-reindex-request--file-watcher
          <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-notify-add-watch</span> mu4e-reindex-request-file
                                 <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span>change<span style="color: #51afef;">)</span>
                                 <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">mu4e-file-reindex-request</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defadvice!</span> mu4e-stop-watching-for-reindex-request <span style="color: #98be65;">()</span>
    <span style="color: #c678dd;">:after</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">mu4e~proc-kill</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> mu4e-reindex-request--file-watcher
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-notify-rm-watch</span> mu4e-reindex-request--file-watcher<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defadvice!</span> mu4e-watch-for-reindex-request <span style="color: #98be65;">()</span>
    <span style="color: #c678dd;">:after</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">mu4e~proc-start</span>
    <span style="color: #98be65;">(</span>mu4e-stop-watching-for-reindex-request<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">file-exists-p</span> mu4e-reindex-request-file<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">delete-file</span> mu4e-reindex-request-file<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span>mu4e-reindex-request--add-watcher<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">mu4e-file-reindex-request</span> <span style="color: #98be65;">(</span>event<span style="color: #98be65;">)</span>
    <span style="color: #83898d;">"Act based on the existance of `</span><span style="color: #a9a1e1;">mu4e-reindex-request-file</span><span style="color: #83898d;">'"</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> mu4e-reindex-request--file-just-deleted
        <span style="color: #a9a1e1;">(</span>mu4e-reindex-request--add-watcher<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">equal</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">nth</span> <span style="color: #da8548; font-weight: bold;">1</span> event<span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">created</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">delete-file</span> mu4e-reindex-request-file<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> mu4e-reindex-request--file-just-deleted t<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span>mu4e-reindex-maybe t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>

  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">mu4e-reindex-maybe</span> <span style="color: #98be65;">(</span><span style="color: #ECBE7B;">&amp;optional</span> new-request<span style="color: #98be65;">)</span>
    <span style="color: #83898d;">"Run `</span><span style="color: #a9a1e1;">mu4e~proc-index</span><span style="color: #83898d;">' if it's been more than</span>
<span style="color: #83898d;">`</span><span style="color: #a9a1e1;">mu4e-reindex-request-min-seperation</span><span style="color: #83898d;">'seconds since the last request,"</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>time-since-last-request <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">-</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">float-time</span><span style="color: #98be65;">)</span>
                                      mu4e-reindex-request--last-time<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> new-request
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> mu4e-reindex-request--last-time <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">float-time</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">&gt;</span> time-since-last-request mu4e-reindex-request-min-seperation<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>mu4e~proc-index nil t<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> new-request
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">run-at-time</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">*</span> <span style="color: #da8548; font-weight: bold;">1.1</span> mu4e-reindex-request-min-seperation<span style="color: #98be65;">)</span> nil
                       <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">mu4e-reindex-maybe</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">email</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8c826e6" class="outline-3">
<h3 id="org8c826e6"><span class="section-number-3">4.26.</span> Email Config</h3>
<div class="outline-text-3" id="text-4-26">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module-if</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mu4e</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">email-config</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org9b94a95" class="outline-4">
<h4 id="org9b94a95"><span class="section-number-4">4.26.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-26-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org339d82f" class="outline-4">
<h4 id="org339d82f"><span class="section-number-4">4.26.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-26-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">email-config.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">mu4e</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">smtpmail</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">define-key</span> mu4e-view-mode-map <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"f"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mu4e-view-go-to-url</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> mu4e-root-maildir <span style="color: #98be65;">"~/mail"</span>
      <span style="color: #5B6268;">;</span><span style="color: #5B6268;">mu4e-get-mail-command "offlineimap -q -f INBOX"</span>
      mu4e-get-mail-command <span style="color: #98be65;">"mbsync -a || true"</span>
      mu4e-update-interval <span style="color: #da8548; font-weight: bold;">300</span> <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">second</span>
      mu4e-compose-signature-auto-include nil
      mu4e-view-show-images t
      mu4e-view-prefer-html t
      mu4e-html2text-command <span style="color: #98be65;">"iconv -c -t utf-8 | pandoc -f html -t plain"</span>
      mu4e-headers-auto-update t
      mu4e-compose-format-flowed t
      smtpmail-stream-type <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">starttls</span>
      mu4e-view-show-addresses t
      mu4e-split-view <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">single-window</span> <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">horizontal (default), vertical</span>
      mu4e-attachment-dir <span style="color: #98be65;">"~/Downloads"</span>
      smtpmail-queue-mail nil
      smtpmail-queue-dir <span style="color: #98be65;">"~/mail/queue/cur"</span>
      mu4e-compose-in-new-frame nil
      mu4e-compose-dont-reply-to-self t
      mu4e-headers-date-format <span style="color: #98be65;">"%Y-%m-%d %H:%M"</span>
      <span style="color: #dcaeea;">message-kill-buffer-on-exit</span> nil
      mu4e-confirm-quit nil
      mu4e-context-policy <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">ask-if-none</span>
      mu4e-compose-context-policy <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">always-ask</span>
      mu4e-headers-results-limit <span style="color: #da8548; font-weight: bold;">500</span>
      mu4e-use-fancy-chars t<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">mu4e--view-quit-and-back</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Quit mu4e view buffer and go back to mu4e"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mu4e~view-quit-buffer<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">=mu4e</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">mu4e--goto-inbox</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Goto mu4e inbox"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>mu4e~headers-jump-to-maildir <span style="color: #98be65;">"/gmail/INBOX"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #c678dd;">:map</span> mu4e-view-mode-map
      <span style="color: #c678dd;">:after</span> mu4e-view
      <span style="color: #c678dd;">:n</span> <span style="color: #98be65;">"&lt;backspace&gt;"</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mu4e--view-quit-and-back</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">global-set-key</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"s-m"</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mu4e--goto-inbox</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">fboundp</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">imagemagick-register-types</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">imagemagick-register-types</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(require 'org-mu4e)</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">(setq org-mu4e-convert-to-html t</span>
<span style="color: #5B6268;">;</span><span style="color: #5B6268;">org-mu4e-link-query-in-headers-mode nil)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">org-mime</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">this seems to fix the babel file saving thing</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">org~mu4e-mime-replace-images</span> <span style="color: #c678dd;">(</span>str current-file<span style="color: #c678dd;">)</span>
<span style="color: #83898d;">"Replace images in html files with cid links."</span>
<span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span>html-images<span style="color: #98be65;">)</span>
<span style="color: #98be65;">(</span><span style="color: #a9a1e1;">cons</span>
<span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">replace-regexp-in-string</span> <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">replace images in html</span>
<span style="color: #98be65;">"src=\"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">\"]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\""</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>text<span style="color: #c678dd;">)</span>
<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span>
        <span style="color: #98be65;">"src=\"./:%s\""</span>
        <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>url <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">"src=\"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">\"]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\""</span> text<span style="color: #98be65;">)</span>
                        <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> text<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span>path <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">expand-file-name</span>
                url <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-directory</span> current-file<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span>ext <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-name-extension</span> path<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span>id <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">replace-regexp-in-string</span> <span style="color: #98be65;">"[</span><span style="color: #ECBE7B;">\</span><span style="color: #98be65;">/\\\\]"</span> <span style="color: #98be65;">"_"</span> path<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">html-images</span>
                <span style="color: #51afef;">(</span>org~mu4e-mime-file
                <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"image/"</span> ext<span style="color: #c678dd;">)</span> path id<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        id<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
str<span style="color: #a9a1e1;">)</span>
html-images<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mu4e-view-actions</span>
<span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"ViewInBrowser"</span> . mu4e-action-view-in-browser<span style="color: #c678dd;">)</span> t<span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">email-config</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7d7bc57" class="outline-3">
<h3 id="org7d7bc57"><span class="section-number-3">4.27.</span> Email Accounts</h3>
<div class="outline-text-3" id="text-4-27">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module-if</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">mu4e</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">email-accounts</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org4126a66" class="outline-4">
<h4 id="org4126a66"><span class="section-number-4">4.27.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-27-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-org651c195" class="outline-4">
<h4 id="org651c195"><span class="section-number-4">4.27.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-27-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Email Accounts</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">email-refile</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">smtpmail</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> +mu4e-gmail-accounts <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"e.p.mysliwietz@gmail.com"</span> . <span style="color: #98be65;">"/gmail"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
      mu4e-contexts
      <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span>
       ,<span style="color: #98be65;">(</span>make-mu4e-context
          <span style="color: #c678dd;">:name</span> <span style="color: #98be65;">"gmail"</span>
          <span style="color: #c678dd;">:enter-func</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">()</span> <span style="color: #51afef;">(</span>mu4e-message <span style="color: #98be65;">"Switching to gmail context"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #c678dd;">:leave-func</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">()</span> <span style="color: #51afef;">(</span>mu4e-message <span style="color: #98be65;">"Leaving gmail context"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #c678dd;">:vars</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span>
                  <span style="color: #51afef;">(</span> <span style="color: #dcaeea;">user-full-name</span>               . <span style="color: #98be65;">"Egidius Mysliwietz"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> <span style="color: #dcaeea;">user-mail-address</span>            . <span style="color: #98be65;">"e.p.mysliwietz@gmail.com"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-mail-address        . <span style="color: #98be65;">"e.p.mysliwietz@gmail.com"</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-smtp-user           . <span style="color: #98be65;">"e.p.mysliwietz@gmail.com"</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> mu4e-drafts-folder           . <span style="color: #98be65;">"/gmail/[Gmail]/Entw&#252;rfe"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> mu4e-sent-folder             . <span style="color: #98be65;">"/gmail/[Gmail]/Gesendet"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> mu4e-trash-folder            . <span style="color: #98be65;">"/gmail/[Gmail]/Papierkorb"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> mu4e-refile-folder           . gmail-refile <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-default-smtp-server . <span style="color: #98be65;">"smtp.gmail.com"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-smtp-server         . <span style="color: #98be65;">"smtp.gmail.com"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-local-domain        . <span style="color: #98be65;">"gmail.com"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-smtp-service        . <span style="color: #da8548; font-weight: bold;">587</span> <span style="color: #51afef;">)</span>
                  <span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
        ,<span style="color: #98be65;">(</span>make-mu4e-context
          <span style="color: #c678dd;">:name</span> <span style="color: #98be65;">"emysliwietz"</span>
          <span style="color: #c678dd;">:enter-func</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">()</span> <span style="color: #51afef;">(</span>mu4e-message <span style="color: #98be65;">"Switching to egidius context"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #c678dd;">:leave-func</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">()</span> <span style="color: #51afef;">(</span>mu4e-message <span style="color: #98be65;">"Leaving egidius context"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">we match based on the contact-fields of the message</span>
          <span style="color: #c678dd;">:vars</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span>
                  <span style="color: #51afef;">(</span> <span style="color: #dcaeea;">user-full-name</span>               . <span style="color: #98be65;">"Egidius Mysliwietz"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> <span style="color: #dcaeea;">user-mail-address</span>            . <span style="color: #98be65;">"egidius@mysliwietz.de"</span>  <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-mail-address        . <span style="color: #98be65;">"egidius@mysliwietz.de"</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-smtp-user           . <span style="color: #98be65;">"egidius@mysliwietz.de"</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> mu4e-archive-folder          . <span style="color: #98be65;">"/egidius/Archive"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> mu4e-drafts-folder           . <span style="color: #98be65;">"/egidius/Drafts"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> mu4e-sent-folder             . <span style="color: #98be65;">"/egidius/Sent"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> mu4e-trash-folder            . <span style="color: #98be65;">"/egidius/Trash"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> mu4e-refile-folder           . gmail-refile <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-default-smtp-server . <span style="color: #98be65;">"smtp.strato.de"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-smtp-server         . <span style="color: #98be65;">"smtp.strato.de"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-local-domain        . <span style="color: #98be65;">"strato.de"</span> <span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span> smtpmail-smtp-service        . <span style="color: #da8548; font-weight: bold;">465</span> <span style="color: #51afef;">)</span>
                  <span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #5B6268;">;</span><span style="color: #5B6268;">,(make-mu4e-context</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:name "xgmx"</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:enter-func (lambda () (mu4e-message "Switching to gmx context"))</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:leave-func (lambda () (mu4e-message "Leaving gmx context"))</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:vars '(</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( user-full-name              . "Egidius Mysliwietz" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( user-mail-address           . "egidius.mysliwietz@gmx.de" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-mail-address        . "egidius.mysliwietz@gmx.de")</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-user           . "egidius.mysliwietz@gmx.de")</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-archive-folder          . "/gmx/Archiv" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-drafts-folder           . "/gmx/Entw&#252;rfe" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-sent-folder             . "/gmx/Gesendet" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-trash-folder            . "/gmx/Gel&#246;scht" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-default-smtp-server . "mail.gmx.net" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-server         . "mail.gmx.net" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-local-domain        . "gmx.net" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-service        . 465 )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">))</span>
       <span style="color: #5B6268;">;</span><span style="color: #5B6268;">,(make-mu4e-context</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:name "radboud"</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:enter-func (lambda () (mu4e-message "Switch to radboud context"))</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:leave-func (lambda () (mu4e-message "Leaving radboud context"))</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:vars '(</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( user-full-name              . "Egidius Mysliwietz" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( user-mail-address           . "e.mysliwietz@student.ru.nl" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-mail-address        . "e.mysliwietz@student.ru.nl")</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-user           . "s1000796")</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-drafts-folder           . "/radboud/Drafts" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-sent-folder             . "/radboud/Sent Items" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-trash-folder            . "/radboud/Trash" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-default-smtp-server . "smtp-auth.ru.nl" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-server         . "smtp-auth.ru.nl" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-local-domain        . "ru.nl" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-service        . 587 )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">))</span>
       <span style="color: #5B6268;">;</span><span style="color: #5B6268;">,(make-mu4e-context</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:name "eindhoven"</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:enter-func (lambda () (mu4e-message "Switch to eindhoven context"))</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:leave-func (lambda () (mu4e-message "Leaving eindhoven context"))</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:vars '(</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( user-full-name              . "Egidius Mysliwietz" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( user-mail-address           . "e.p.j.mysliwietz@student.tue.nl" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-mail-address        . "e.p.j.mysliwietz@student.tue.nl")</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-user           . "e.p.j.mysliwietz@student.tue.nl")</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-archive-folder          . "/eindhoven/Archive" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-drafts-folder           . "/eindhoven/Drafts" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-sent-folder             . "/eindhoven/Sent Items" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-trash-folder            . "/eindhoven/Trash" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-default-smtp-server . "smtp.office365.com" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-server         . "smtp.office365.com" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-local-domain        . "office365.com" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-service        . 587 )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">))</span>
       <span style="color: #5B6268;">;</span><span style="color: #5B6268;">,(make-mu4e-context</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:name "ntu"</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:enter-func (lambda () (mu4e-message "Switch to ntu context"))</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:leave-func (lambda () (mu4e-message "Leaving ntu context"))</span>
          <span style="color: #5B6268;">;</span><span style="color: #5B6268;">:vars '(</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( user-full-name              . "Egidius Mysliwietz" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( user-mail-address           . "n1903483e@e.ntu.edu.sg" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-mail-address        . "n1903483e@e.ntu.edu.sg")</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-user           . "n1903483e@e.ntu.edu.sg")</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-archive-folder          . "/ntu/Archive" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-drafts-folder           . "/ntu/Drafts" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-sent-folder             . "/ntu/Sent Items" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( mu4e-trash-folder            . "/ntu/Trash" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-default-smtp-server . "smtp.office365.com" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-server         . "smtp.office365.com" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-local-domain        . "office365.com" )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">( smtpmail-smtp-service        . 587 )</span>
                  <span style="color: #5B6268;">;</span><span style="color: #5B6268;">))</span>
       <span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">email-accounts</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcba149b" class="outline-3">
<h3 id="orgcba149b"><span class="section-number-3">4.28.</span> Latex Tweaks</h3>
<div class="outline-text-3" id="text-4-28">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">latex-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org8d26594" class="outline-4">
<h4 id="org8d26594"><span class="section-number-4">4.28.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-28-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd833bb8" class="outline-4">
<h4 id="orgd833bb8"><span class="section-number-4">4.28.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-28-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">latex.el -*- lexical-binding: t; -*-</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">TeX-command-extra-options</span> <span style="color: #98be65;">"--shell-escape"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">TeX-engine</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">luatex</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">org-mode-hook</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span>
            <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">local-set-key</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">kbd</span> <span style="color: #98be65;">"&lt;f6&gt;"</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">()</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">interactive</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">org-latex-export-to-pdf</span> t<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">force-compile</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Set the file modification times on the current file, then call</span>
<span style="color: #83898d;">TeX-command-sequence.</span>
<span style="color: #83898d;">This forces a complete recompilation of the document, even if the source</span>
<span style="color: #83898d;">(.tex) is older than any existing outputs (.pdf etc)."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">set-buffer-modified-p</span> t<span style="color: #c678dd;">)</span> <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">sets mod time to current time</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">save-buffer</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>TeX-command-sequence t t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">auto-async-export</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-mode</span><span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">string-equal</span> <span style="color: #98be65;">"t"</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">pop</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">cdr</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">car</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">org-collect-keywords</span> <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span><span style="color: #98be65;">"auto_async_export"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Exporting to pdf..."</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">org-latex-export-to-pdf</span> t<span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">latex-mode</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #c678dd;">force-compile</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #c678dd;">)</span>
  <span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">org-after-save-cmd</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-mode</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>cmd <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">cdr</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">car</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">org-collect-keywords</span> <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span><span style="color: #98be65;">"on_save_cmd"</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> cmd
  <span style="color: #51afef;">(</span><span style="color: #c678dd;">async-shell-command-no-window</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">pop</span> cmd<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">password-cache</span> t <span style="color: #5B6268;">; </span><span style="color: #5B6268;">enable password caching</span>
      <span style="color: #dcaeea;">password-cache-expiry</span> <span style="color: #da8548; font-weight: bold;">36000</span><span style="color: #51afef;">)</span> <span style="color: #5B6268;">; </span><span style="color: #5B6268;">for ten hours (time in secs)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">after-save-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">auto-async-export</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">after-save-hook</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-after-save-cmd</span><span style="color: #51afef;">)</span>
                                        <span style="color: #5B6268;">;</span><span style="color: #5B6268;">(global-set-key [f6] (lambda () (interactive) (org-latex-export-to-pdf t)))</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-latex-compiler</span> <span style="color: #98be65;">"lualatex"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span> <span style="color: #dcaeea;">TeX-master</span> nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">add-to-list</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">org-latex-packages-alist</span>
             <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"AUTO"</span> <span style="color: #98be65;">"polyglossia"</span> t <span style="color: #98be65;">(</span><span style="color: #98be65;">"xelatex"</span> <span style="color: #98be65;">"lualatex"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">latex-word-count</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Return latex word count using texlive"</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>file-name <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">latex-mode</span><span style="color: #c678dd;">)</span>
                       <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #c678dd;">)</span>
                     <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-mode</span><span style="color: #98be65;">)</span>
                         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">file-name-with-extension</span> <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">"tex"</span><span style="color: #98be65;">)</span>
                       <span style="color: #98be65;">(</span><span style="color: #dcaeea;">buffer-file-name</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">shell-command-to-string</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"texcount -1 -merge -template={1} %s"</span> file-name<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Latex classes</span>
  <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-latex-subtitle-separate</span> t
        <span style="color: #dcaeea;">org-latex-subtitle-format</span> <span style="color: #98be65;">"\\subtitle{%s}"</span><span style="color: #51afef;">)</span>
  <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-latex-classes</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #98be65;">"article"</span> <span style="color: #98be65;">"\\documentclass[a4wide,10pt]{article}"</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\section{%s}"</span> . <span style="color: #98be65;">"\\section*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsection{%s}"</span> . <span style="color: #98be65;">"\\subsection*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsubsection{%s}"</span> . <span style="color: #98be65;">"\\subsubsection*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\paragraph{%s}"</span> . <span style="color: #98be65;">"\\paragraph*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subparagraph{%s}"</span> . <span style="color: #98be65;">"\\subparagraph*{%s}"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #98be65;">"report"</span> <span style="color: #98be65;">"\\documentclass[11pt]{report}"</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\part{%s}"</span> . <span style="color: #98be65;">"\\part*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\chapter{%s}"</span> . <span style="color: #98be65;">"\\chapter*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\section{%s}"</span> . <span style="color: #98be65;">"\\section*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsection{%s}"</span> . <span style="color: #98be65;">"\\subsection*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsubsection{%s}"</span> . <span style="color: #98be65;">"\\subsubsection*{%s}"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #98be65;">"artikel"</span> <span style="color: #98be65;">"\\documentclass[fancy, modern, twocolumn, titlepage=head, paper=a4, 12pt]{artikel}"</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\section{%s}"</span> . <span style="color: #98be65;">"\\section*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsection{%s}"</span> . <span style="color: #98be65;">"\\subsection*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsubsection{%s}"</span> . <span style="color: #98be65;">"\\subsubsection*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\paragraph{%s}"</span> . <span style="color: #98be65;">"\\paragraph*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subparagraph{%s}"</span> . <span style="color: #98be65;">"\\subparagraph*{%s}"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #98be65;">"thesis"</span> <span style="color: #98be65;">"\\documentclass[fancy, modern, twocolumn, titlepage=thesis, paper=a4, 12pt]{artikel}"</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\section{%s}"</span> . <span style="color: #98be65;">"\\section*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsection{%s}"</span> . <span style="color: #98be65;">"\\subsection*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsubsection{%s}"</span> . <span style="color: #98be65;">"\\subsubsection*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\paragraph{%s}"</span> . <span style="color: #98be65;">"\\paragraph*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subparagraph{%s}"</span> . <span style="color: #98be65;">"\\subparagraph*{%s}"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                            <span style="color: #98be65;">(</span><span style="color: #98be65;">"book"</span> <span style="color: #98be65;">"\\documentclass[11pt]{book}"</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\part{%s}"</span> . <span style="color: #98be65;">"\\part*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\chapter{%s}"</span> . <span style="color: #98be65;">"\\chapter*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\section{%s}"</span> . <span style="color: #98be65;">"\\section*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsection{%s}"</span> . <span style="color: #98be65;">"\\subsection*{%s}"</span><span style="color: #a9a1e1;">)</span>
                             <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\\subsubsection{%s}"</span> . <span style="color: #98be65;">"\\subsubsection*{%s}"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-export-headline-levels</span> <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">; </span><span style="color: #5B6268;">Allow headlines, but not content, to not be exported (used for structuring org files)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">ox-extra</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">ox-extras-activate</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>ignore-headlines<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>


<span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>base-dir <span style="color: #98be65;">"/home/user/dox/bib/"</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>bibfile <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">concat</span> base-dir <span style="color: #98be65;">"bib.bib"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span>notes-dir <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">concat</span> base-dir <span style="color: #98be65;">"notes/"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span>lib-dir <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">concat</span> base-dir <span style="color: #98be65;">"papers/"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> bibtex-completion-bibliography bibfile
        citar-bibliography <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span>,bibfile<span style="color: #98be65;">)</span>
        bibtex-completion-library-path <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span>,lib-dir<span style="color: #98be65;">)</span>
        bibtex-completion-notes-path notes-dir
        citar-library-paths <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span>,lib-dir<span style="color: #98be65;">)</span>
        citar-notes-paths <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span>,notes-dir<span style="color: #98be65;">)</span>
        <span style="color: #dcaeea;">org-cite-global-bibliography</span> <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span>,bibfile<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-export-with-sub-superscripts</span> <span style="color: #98be65;">"{}"</span>
      <span style="color: #dcaeea;">org-export-with-smart-quotes</span> nil<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">org-preview-latex-process-alist</span>
   <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>dvipng <span style="color: #c678dd;">:programs</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"dvilualatex"</span> <span style="color: #98be65;">"dvipng"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:description</span> <span style="color: #98be65;">"dvi &gt; png"</span> <span style="color: #c678dd;">:message</span> <span style="color: #98be65;">"you need to install the programs: dvilualatex and dvipng."</span> <span style="color: #c678dd;">:image-input-type</span> <span style="color: #98be65;">"dvi"</span> <span style="color: #c678dd;">:image-output-type</span> <span style="color: #98be65;">"png"</span> <span style="color: #c678dd;">:image-size-adjust</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #da8548; font-weight: bold;">1.0</span> . <span style="color: #da8548; font-weight: bold;">1.0</span>
<span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:latex-compiler</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"dvilualatex -interaction nonstopmode -output-directory %o %f"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:image-converter</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"dvipng -D %D -T tight -o %O %f"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:transparent-image-converter</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"dvipng -D %D -T tight -bg Transparent -o %O %f"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
     <span style="color: #98be65;">(</span>dvisvgm <span style="color: #c678dd;">:programs</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"lualatex"</span> <span style="color: #98be65;">"dvisvgm"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:description</span> <span style="color: #98be65;">"dvi &gt; svg"</span> <span style="color: #c678dd;">:message</span> <span style="color: #98be65;">"you need to install the programs: lualatex and dvisvgm."</span> <span style="color: #c678dd;">:image-input-type</span> <span style="color: #98be65;">"dvi"</span> <span style="color: #c678dd;">:image-output-type</span> <span style="color: #98be65;">"svg"</span> <span style="color: #c678dd;">:image-size-adjust</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #da8548; font-weight: bold;">1.7</span> . <span style="color: #da8548; font-weight: bold;">1.5</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:latex-compiler</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"lualatex -interaction nonstopmode -output-directory %o %f"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:image-converter</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"dvisvgm %f -n -b min -c %S -o %O"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
     <span style="color: #98be65;">(</span>imagemagick <span style="color: #c678dd;">:programs</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"lualatex"</span> <span style="color: #98be65;">"convert"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:description</span> <span style="color: #98be65;">"pdf &gt; png"</span> <span style="color: #c678dd;">:message</span> <span style="color: #98be65;">"you need to install the programs: lualatex and imagemagick."</span> <span style="color: #c678dd;">:image-input-type</span> <span style="color: #98be65;">"pdf"</span> <span style="color: #c678dd;">:image-output-type</span> <span style="color: #98be65;">"png"</span> <span style="color: #c678dd;">:image-size-adjust</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #da8548; font-weight: bold;">1.0</span> . <span style="color: #da8548; font-weight: bold;">1.0</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:latex-compiler</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"lualatex -interaction nonstopmode -output-directory %o %f"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #c678dd;">:image-converter</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"convert -density %D -trim -antialias %f -quality 100 %O"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">latex-tweaks</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4b159c6" class="outline-3">
<h3 id="org4b159c6"><span class="section-number-3">4.29.</span> Org Links</h3>
<div class="outline-text-3" id="text-4-29">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">load-module</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">org-links</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgb22cb44" class="outline-4">
<h4 id="orgb22cb44"><span class="section-number-4">4.29.1.</span> Requirements</h4>
<div class="outline-text-4" id="text-4-29-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf4b4a7a" class="outline-4">
<h4 id="orgf4b4a7a"><span class="section-number-4">4.29.2.</span> Code</h4>
<div class="outline-text-4" id="text-4-29-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">ol-man.el - Support for links to man pages in Org mode</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">ol</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">org-link-set-parameters</span> <span style="color: #98be65;">"b"</span>
                         <span style="color: #c678dd;">:follow</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">org-b-open</span>
                         <span style="color: #c678dd;">:export</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">org-b-export</span>
                         <span style="color: #c678dd;">:store</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">org-b-store-link</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">org-b-open</span> <span style="color: #c678dd;">(</span>verse _<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Visit the verse."</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">funcall</span> org-b-command path<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">org-b-store-link</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Store a link to a man page."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">memq</span> <span style="color: #dcaeea;">major-mode</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span>Man-mode woman-mode<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This is a man page, we do make this link.</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>page <span style="color: #c678dd;">(</span>org-man-get-page-name<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>link <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">concat</span> <span style="color: #98be65;">"b:"</span> page<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>description <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"B page for %s"</span> page<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">org-link-store-props</span>
       <span style="color: #c678dd;">:type</span> <span style="color: #98be65;">"b"</span>
       <span style="color: #c678dd;">:link</span> link
       <span style="color: #c678dd;">:description</span> description<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">org-man-get-page-name</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d;">"Extract the page name from the buffer name."</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This works for both `</span><span style="color: #a9a1e1;">Man-mode</span><span style="color: #5B6268;">' and `</span><span style="color: #a9a1e1;">woman-mode</span><span style="color: #5B6268;">'.</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">string-match</span> <span style="color: #98be65;">" </span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">\\S-+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\\*"</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">buffer-name</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">match-string</span> <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">buffer-name</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">error</span> <span style="color: #98be65;">"Cannot create link to this man page"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">org-b-export</span> <span style="color: #c678dd;">(</span>link description format _<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Export a man page link from Org files."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>path <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"http://man.he.net/?topic=%s&amp;section=all"</span> link<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>desc <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> description link<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">pcase</span> format
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">`</span><span style="color: #ECBE7B;">html</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"&lt;a target=\"_blank\" href=\"%s\"&gt;%s&lt;/a&gt;"</span> path desc<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">`</span><span style="color: #ECBE7B;">latex</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"\\href{%s}{%s}"</span> path desc<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">`</span><span style="color: #ECBE7B;">texinfo</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"@uref{%s,%s}"</span> path desc<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">`</span><span style="color: #ECBE7B;">ascii</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format</span> <span style="color: #98be65;">"%s (%s)"</span> desc path<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span>t path<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">provide</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">org-links</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Egidius Mysliwietz</p>
<p class="date">Created: 2023-02-10 Fri 16:03</p>
</div>
</body>
</html>